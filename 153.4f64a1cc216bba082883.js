"use strict";(self.webpackChunkchat_on_angular=self.webpackChunkchat_on_angular||[]).push([[153],{1317:(lo,_e,L)=>{L.d(_e,{ST:()=>Eg});var y=L(7716),pt=L(3637),Yt=L(7574),Rt=L(4402),ie=L(5917),gt=L(7393);function $t(){return e=>e.lift(new Tt)}class Tt{call(t,i){return i.subscribe(new Pt(t))}}class Pt extends gt.L{constructor(t){super(t),this.hasPrev=!1}_next(t){let i;this.hasPrev?i=[this.prev,t]:this.hasPrev=!0,this.prev=t,i&&this.destination.next(i)}}var ot=L(9761),Z=L(8002),B=L(2145),It=L(7519),Zt=L(5435),Qr=L(6136),oe=L(57),Ns=L(8583),Bn=L(2329),ce=L(9759),v=L(4762),U=L(4685),Mt=L(300),Wr=function(e,t){return(Wr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(i[s]=o[s])})(e,t)};function Yr(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],o=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var O,ho="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},jn=jn||{},G=ho||self;function an(){}function Kn(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Oe(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Hn="closure_uid_"+(1e9*Math.random()>>>0),fo=0;function po(e,t,i){return e.call.apply(e.bind,arguments)}function go(e,t,i){if(!e)throw Error();if(2<arguments.length){var o=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,o),e.apply(t,s)}}return function(){return e.apply(t,arguments)}}function mt(e,t,i){return(mt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?po:go).apply(null,arguments)}function cn(e,t){var i=Array.prototype.slice.call(arguments,1);return function(){var o=i.slice();return o.push.apply(o,arguments),e.apply(this,o)}}function ct(e,t){function i(){}i.prototype=t.prototype,e.Z=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.Vb=function(o,s,u){for(var a=Array(arguments.length-2),c=2;c<arguments.length;c++)a[c-2]=arguments[c];return t.prototype[s].apply(o,a)}}function Xt(){this.s=this.s,this.o=this.o}var $r={};Xt.prototype.s=!1,Xt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,Hn)&&e[Hn]||(e[Hn]=++fo)}(this);delete $r[e]}},Xt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Zr=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var i=0;i<e.length;i++)if(i in e&&e[i]===t)return i;return-1},Xr=Array.prototype.forEach?function(e,t,i){Array.prototype.forEach.call(e,t,i)}:function(e,t,i){for(var o=e.length,s="string"==typeof e?e.split(""):e,u=0;u<o;u++)u in s&&t.call(i,s[u],u,e)};function Jn(e){return Array.prototype.concat.apply([],arguments)}function xe(e){var t=e.length;if(0<t){for(var i=Array(t),o=0;o<t;o++)i[o]=e[o];return i}return[]}function ln(e){return/^[\s\xa0]*$/.test(e)}var et,ti=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function _t(e,t){return-1!=e.indexOf(t)}function yt(e,t){return e<t?-1:e>t?1:0}t:{var ei=G.navigator;if(ei){var Ms=ei.userAgent;if(Ms){et=Ms;break t}}et=""}function vo(e,t,i){for(var o in e)t.call(i,e[o],o,e)}function ni(e){var t={};for(var i in e)t[i]=e[i];return t}var ri="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function zn(e,t){for(var i,o,s=1;s<arguments.length;s++){for(i in o=arguments[s])e[i]=o[i];for(var u=0;u<ri.length;u++)i=ri[u],Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}}function Fe(e){return Fe[" "](e),e}Fe[" "]=an;var oi,e,ii=_t(et,"Opera"),ke=_t(et,"Trident")||_t(et,"MSIE"),xs=_t(et,"Edge"),_o=xs||ke,Fs=_t(et,"Gecko")&&!(_t(et.toLowerCase(),"webkit")&&!_t(et,"Edge"))&&!(_t(et,"Trident")||_t(et,"MSIE"))&&!_t(et,"Edge"),pa=_t(et.toLowerCase(),"webkit")&&!_t(et,"Edge");function ks(){var e=G.document;return e?e.documentMode:void 0}t:{var si="",Re=(e=et,Fs?/rv:([^\);]+)(\)|;)/.exec(e):xs?/Edge\/([\d\.]+)/.exec(e):ke?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):pa?/WebKit\/(\S+)/.exec(e):ii?/(?:Version)[ \/]?(\S+)/.exec(e):void 0);if(Re&&(si=Re?Re[1]:""),ke){var be=ks();if(null!=be&&be>parseFloat(si)){oi=String(be);break t}}oi=si}var Qn={};function Wn(){return t=Qn,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var e=0,t=ti(String(oi)).split("."),i=ti("9").split("."),o=Math.max(t.length,i.length),s=0;0==e&&s<o;s++){var u=t[s]||"",a=i[s]||"";do{if(u=/(\d*)(\D*)(.*)/.exec(u)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==u[0].length&&0==a[0].length)break;e=yt(0==u[1].length?0:parseInt(u[1],10),0==a[1].length?0:parseInt(a[1],10))||yt(0==u[2].length,0==a[2].length)||yt(u[2],a[2]),u=u[3],a=a[3]}while(0==e)}return 0<=e}();var t}var $n=G.document&&ke&&(ks()||parseInt(oi,10))||void 0,Rs=function(){if(!G.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{G.addEventListener("test",an,t),G.removeEventListener("test",an,t)}catch(i){}return e}();function bt(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function Pe(e,t){if(bt.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var i=this.type=e.type,o=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Fs){t:{try{Fe(t.nodeName);var s=!0;break t}catch(u){}s=!1}s||(t=null)}}else"mouseover"==i?t=e.fromElement:"mouseout"==i&&(t=e.toElement);this.relatedTarget=t,o?(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Ps[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Pe.Z.h.call(this)}}bt.prototype.h=function(){this.defaultPrevented=!0},ct(Pe,bt);var Ps={2:"touch",3:"pen",4:"mouse"};Pe.prototype.h=function(){Pe.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Le="closure_listenable_"+(1e6*Math.random()|0),Ls=0;function ga(e,t,i,o,s){this.listener=e,this.proxy=null,this.src=t,this.type=i,this.capture=!!o,this.ia=s,this.key=++Ls,this.ca=this.fa=!1}function Zn(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function Ue(e){this.src=e,this.g={},this.h=0}function ai(e,t){var i=t.type;if(i in e.g){var u,o=e.g[i],s=Zr(o,t);(u=0<=s)&&Array.prototype.splice.call(o,s,1),u&&(Zn(t),0==e.g[i].length&&(delete e.g[i],e.h--))}}function Xn(e,t,i,o){for(var s=0;s<e.length;++s){var u=e[s];if(!u.ca&&u.listener==t&&u.capture==!!i&&u.ia==o)return s}return-1}Ue.prototype.add=function(e,t,i,o,s){var u=e.toString();(e=this.g[u])||(e=this.g[u]=[],this.h++);var a=Xn(e,t,o,s);return-1<a?(t=e[a],i||(t.fa=!1)):((t=new ga(t,this.src,u,!!o,s)).fa=i,e.push(t)),t};var hn="closure_lm_"+(1e6*Math.random()|0),Ge={};function Us(e,t,i,o,s){if(o&&o.once)return we(e,t,i,o,s);if(Array.isArray(t)){for(var u=0;u<t.length;u++)Us(e,t[u],i,o,s);return null}return i=dn(i),e&&e[Le]?e.N(t,i,Oe(o)?!!o.capture:!!o,s):qe(e,t,i,!1,o,s)}function qe(e,t,i,o,s,u){if(!t)throw Error("Invalid event type");var a=Oe(s)?!!s.capture:!!s,c=fn(e);if(c||(e[hn]=c=new Ue(e)),(i=c.add(t,i,o,a,u)).proxy)return i;if(o=function(){var t=bo;return function e(i){return t.call(e.src,e.listener,i)}}(),i.proxy=o,o.src=e,o.listener=i,e.addEventListener)Rs||(s=a),void 0===s&&(s=!1),e.addEventListener(t.toString(),o,s);else if(e.attachEvent)e.attachEvent(er(t.toString()),o);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(o)}return i}function we(e,t,i,o,s){if(Array.isArray(t)){for(var u=0;u<t.length;u++)we(e,t[u],i,o,s);return null}return i=dn(i),e&&e[Le]?e.O(t,i,Oe(o)?!!o.capture:!!o,s):qe(e,t,i,!0,o,s)}function Be(e,t,i,o,s){if(Array.isArray(t))for(var u=0;u<t.length;u++)Be(e,t[u],i,o,s);else o=Oe(o)?!!o.capture:!!o,i=dn(i),e&&e[Le]?(e=e.i,(t=String(t).toString())in e.g&&-1<(i=Xn(u=e.g[t],i,o,s))&&(Zn(u[i]),Array.prototype.splice.call(u,i,1),0==u.length&&(delete e.g[t],e.h--))):e&&(e=fn(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Xn(t,i,o,s)),(i=-1<e?t[e]:null)&&ci(i))}function ci(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[Le])ai(t.i,e);else{var i=e.type,o=e.proxy;t.removeEventListener?t.removeEventListener(i,o,e.capture):t.detachEvent?t.detachEvent(er(i),o):t.addListener&&t.removeListener&&t.removeListener(o),(i=fn(t))?(ai(i,e),0==i.h&&(i.src=null,t[hn]=null)):Zn(e)}}}function er(e){return e in Ge?Ge[e]:Ge[e]="on"+e}function bo(e,t){if(e.ca)e=!0;else{t=new Pe(t,this);var i=e.listener,o=e.ia||e.src;e.fa&&ci(e),e=i.call(o,t)}return e}function fn(e){return(e=e[hn])instanceof Ue?e:null}var nr="__closure_events_fn_"+(1e9*Math.random()>>>0);function dn(e){return"function"==typeof e?e:(e[nr]||(e[nr]=function(t){return e.handleEvent(t)}),e[nr])}function st(){Xt.call(this),this.i=new Ue(this),this.P=this,this.I=null}function nt(e,t){var i,o=e.I;if(o)for(i=[];o;o=o.I)i.push(o);if(e=e.P,o=t.type||t,"string"==typeof t)t=new bt(t,e);else if(t instanceof bt)t.target=t.target||e;else{var s=t;zn(t=new bt(o,e),s)}if(s=!0,i)for(var u=i.length-1;0<=u;u--){var a=t.g=i[u];s=Ee(a,o,!0,t)&&s}if(s=Ee(a=t.g=e,o,!0,t)&&s,s=Ee(a,o,!1,t)&&s,i)for(u=0;u<i.length;u++)s=Ee(a=t.g=i[u],o,!1,t)&&s}function Ee(e,t,i,o){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,u=0;u<t.length;++u){var a=t[u];if(a&&!a.ca&&a.capture==i){var c=a.listener,h=a.ia||a.src;a.fa&&ai(e.i,a),s=!1!==c.call(h,o)&&s}}return s&&!o.defaultPrevented}ct(st,Xt),st.prototype[Le]=!0,st.prototype.removeEventListener=function(e,t,i,o){Be(this,e,t,i,o)},st.prototype.M=function(){if(st.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var i=e.g[t],o=0;o<i.length;o++)Zn(i[o]);delete e.g[t],e.h--}}this.I=null},st.prototype.N=function(e,t,i,o){return this.i.add(String(e),t,!1,i,o)},st.prototype.O=function(e,t,i,o){return this.i.add(String(e),t,!0,i,o)};var li=G.JSON.stringify;function Gs(){var e=Io,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Co,ma=function(){function e(){this.h=this.g=null}return e.prototype.add=function(t,i){var o=je.get();o.set(t,i),this.h?this.h.next=o:this.g=o,this.h=o},e}(),je=new(function(){function e(t,i){this.i=t,this.j=i,this.h=0,this.g=null}return e.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},e}())(function(){return new hi},function(e){return e.reset()}),hi=function(){function e(){this.next=this.g=this.h=null}return e.prototype.set=function(t,i){this.h=t,this.g=i,this.next=null},e.prototype.reset=function(){this.next=this.g=this.h=null},e}();function wo(e){G.setTimeout(function(){throw e},0)}function Eo(e,t){Co||function(){var e=G.Promise.resolve(void 0);Co=function(){e.then(Ao)}}(),To||(Co(),To=!0),Io.add(e,t)}var To=!1,Io=new ma;function Ao(){for(var e;e=Gs();){try{e.h.call(e.g)}catch(i){wo(i)}var t=je;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}To=!1}function rr(e,t){st.call(this),this.h=e||1,this.g=t||G,this.j=mt(this.kb,this),this.l=Date.now()}function So(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function ir(e,t,i){if("function"==typeof e)i&&(e=mt(e,i));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=mt(e.handleEvent,e)}return 2147483647<Number(t)?-1:G.setTimeout(e,t||0)}function fi(e){e.g=ir(function(){e.g=null,e.i&&(e.i=!1,fi(e))},e.j);var t=e.h;e.h=null,e.m.apply(null,t)}ct(rr,st),(O=rr.prototype).da=!1,O.S=null,O.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),nt(this,"tick"),this.da&&(So(this),this.start()))}},O.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},O.M=function(){rr.Z.M.call(this),So(this),delete this.g};var Do=function(e){function t(i,o){var s=e.call(this)||this;return s.m=i,s.j=o,s.h=null,s.i=!1,s.g=null,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}Wr(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(t,e),t.prototype.l=function(i){this.h=arguments,this.g?this.i=!0:fi(this)},t.prototype.M=function(){e.prototype.M.call(this),this.g&&(G.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},t}(Xt);function pn(e){Xt.call(this),this.h=e,this.g={}}ct(pn,Xt);var di=[];function No(e,t,i,o){Array.isArray(i)||(i&&(di[0]=i.toString()),i=di);for(var s=0;s<i.length;s++){var u=Us(t,i[s],o||e.handleEvent,!1,e.h||e);if(!u)break;e.g[u.key]=u}}function qs(e){vo(e.g,function(t,i){this.g.hasOwnProperty(i)&&ci(t)},e),e.g={}}function gn(){this.g=!0}function Ke(e,t,i,o){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var o=i[e];if(!(2>o.length)){var s=o[1];if(Array.isArray(s)&&!(1>s.length)){var u=s[0];if("noop"!=u&&"stop"!=u&&"close"!=u)for(var a=1;a<s.length;a++)s[a]=""}}}return li(i)}catch(c){return t}}(e,i)+(o?" "+o:"")})}pn.prototype.M=function(){pn.Z.M.call(this),qs(this)},pn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},gn.prototype.Aa=function(){this.g=!1},gn.prototype.info=function(){};var Ce={},gi=null;function or(){return gi=gi||new st}function mn(e){bt.call(this,Ce.Ma,e)}function yn(e){var t=or();nt(t,new mn(t,e))}function sr(e,t){bt.call(this,Ce.STAT_EVENT,e),this.stat=t}function At(e){var t=or();nt(t,new sr(t,e))}function ur(e,t){bt.call(this,Ce.Na,e),this.size=t}function He(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return G.setTimeout(function(){e()},t)}Ce.Ma="serverreachability",ct(mn,bt),Ce.STAT_EVENT="statevent",ct(sr,bt),Ce.Na="timingevent",ct(ur,bt);var ar={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},cr={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function mi(){}function Oo(){}mi.prototype.h=null;var lr,Te={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function vi(){bt.call(this,"d")}function _i(){bt.call(this,"c")}function hr(){}function fr(e,t,i,o){this.l=e,this.j=t,this.m=i,this.X=o||1,this.V=new pn(this),this.P=js,this.W=new rr(e=_o?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new dr}function dr(){this.i=null,this.g="",this.h=!1}ct(vi,bt),ct(_i,bt),ct(hr,mi),hr.prototype.g=function(){return new XMLHttpRequest},hr.prototype.i=function(){return{}},lr=new hr;var js=45e3,pr={},vn={};function bi(e,t,i){e.K=1,e.v=d(te(t)),e.s=i,e.U=!0,wi(e,null)}function wi(e,t){e.F=Date.now(),_n(e),e.A=te(e.v);var i=e.A,o=e.X;Array.isArray(o)||(o=[String(o)]),wa(i.h,"t",o),e.C=0,i=e.l.H,e.h=new dr,e.g=Ka(e.l,i?t:null,!e.s),0<e.O&&(e.L=new Do(mt(e.Ia,e,e.g),e.O)),No(e.V,e.g,"readystatechange",e.gb),t=e.H?ni(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),yn(1),function(e,t,i,o,s,u){e.info(function(){if(e.g)if(u)for(var a="",c=u.split("&"),h=0;h<c.length;h++){var p=c[h].split("=");if(1<p.length){var g=p[0];p=p[1];var _=g.split("_");a=2<=_.length&&"type"==_[1]?a+(g+"=")+p+"&":a+(g+"=redacted&")}}else a=null;else a=u;return"XMLHTTP REQ ("+o+") [attempt "+s+"]: "+t+"\n"+i+"\n"+a})}(e.j,e.u,e.A,e.m,e.X,e.s)}function xo(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function Ei(e,t,i){for(var s,o=!0;!e.I&&e.C<i.length;){if((s=Ks(e,i))==vn){4==t&&(e.o=4,At(14),o=!1),Ke(e.j,e.m,null,"[Incomplete Response]");break}if(s==pr){e.o=4,At(15),Ke(e.j,e.m,i,"[Invalid Chunk]"),o=!1;break}Ke(e.j,e.m,s,null),Ci(e,s)}xo(e)&&s!=vn&&s!=pr&&(e.h.g="",e.C=0),4!=t||0!=i.length||e.h.h||(e.o=1,At(16),o=!1),e.i=e.i&&o,o?0<i.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+i.length),eu(t),t.L=!0,At(11))):(Ke(e.j,e.m,i,"[Invalid Chunked Response]"),he(e),wn(e))}function Ks(e,t){var i=e.C,o=t.indexOf("\n",i);return-1==o?vn:(i=Number(t.substring(i,o)),isNaN(i)?pr:(o+=1)+i>t.length?vn:(t=t.substr(o,i),e.C=o+i,t))}function _n(e){e.Y=Date.now()+e.P,gr(e,e.P)}function gr(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=He(mt(e.eb,e),t)}function bn(e){e.B&&(G.clearTimeout(e.B),e.B=null)}function wn(e){0==e.l.G||e.I||Ga(e.l,e)}function he(e){bn(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,So(e.W),qs(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Ci(e,t){try{var i=e.l;if(0!=i.G&&(i.g==e||zs(i.i,e)))if(i.I=e.N,!e.J&&zs(i.i,e)&&3==i.G){try{var o=i.Ca.g.parse(t)}catch(D){o=null}if(Array.isArray(o)&&3==o.length){var s=o;if(0==s[0])t:if(i.u)i.ta=s[1],0<i.ta-i.U&&37500>s[2]&&i.N&&0==i.A&&!i.v&&(i.v=He(mt(i.ab,i),6e3));else{if(i.g){if(!(i.g.F+3e3<e.F))break t;Go(i),Lo(i)}tu(i),At(18)}if(1>=Ta(i.i)&&i.ka){try{i.ka()}catch(D){}i.ka=void 0}}else Tn(i,11)}else if((e.J||i.g==e)&&Go(i),!ln(t))for(s=i.Ca.g.parse(t),t=0;t<s.length;t++){var u=s[t];if(i.U=u[0],u=u[1],2==i.G)if("c"==u[0]){i.J=u[1],i.la=u[2];var a=u[3];null!=a&&(i.ma=a,i.h.info("VER="+i.ma));var c=u[4];null!=c&&(i.za=c,i.h.info("SVER="+i.za));var h=u[5];null!=h&&"number"==typeof h&&0<h&&(i.K=o=1.5*h,i.h.info("backChannelRequestTimeoutMs_="+o)),o=i;var p=e.g;if(p){var g=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(g){var _=o.i;!_.g&&(_t(g,"spdy")||_t(g,"quic")||_t(g,"h2"))&&(_.j=_.l,_.g=new Set,_.h&&(Qs(_,_.h),_.h=null))}if(o.D){var b=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;b&&(o.sa=b,X(o.F,o.D,b))}}i.G=3,i.j&&i.j.xa(),i.$&&(i.O=Date.now()-e.F,i.h.info("Handshake RTT: "+i.O+"ms"));var w=e;if((o=i).oa=ja(o,o.H?o.la:null,o.W),w.J){Ia(o.i,w);var E=w,T=o.K;T&&E.setTimeout(T),E.B&&(bn(E),_n(E)),o.g=w}else La(o);0<i.l.length&&Uo(i)}else"stop"!=u[0]&&"close"!=u[0]||Tn(i,7);else 3==i.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Tn(i,7):Zs(i):"noop"!=u[0]&&i.j&&i.j.wa(u),i.A=0)}yn(4)}catch(D){}}function Ti(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Kn(e)||"string"==typeof e)Xr(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var i=e.T();else if(e.R&&"function"==typeof e.R)i=void 0;else if(Kn(e)||"string"==typeof e){i=[];for(var o=e.length,s=0;s<o;s++)i.push(s)}else for(s in i=[],o=0,e)i[o++]=s;s=(o=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(Kn(e)){for(var t=[],i=e.length,o=0;o<i;o++)t.push(e[o]);return t}for(o in t=[],i=0,e)t[i++]=e[o];return t}(e)).length;for(var u=0;u<s;u++)t.call(void 0,o[u],i&&i[u],e)}}function Ie(e,t){this.h={},this.g=[],this.i=0;var i=arguments.length;if(1<i){if(i%2)throw Error("Uneven number of arguments");for(var o=0;o<i;o+=2)this.set(arguments[o],arguments[o+1])}else if(e)if(e instanceof Ie)for(i=e.T(),o=0;o<i.length;o++)this.set(i[o],e.get(i[o]));else for(o in e)this.set(o,e[o])}function Ii(e){if(e.i!=e.g.length){for(var t=0,i=0;t<e.g.length;){var o=e.g[t];fe(e.h,o)&&(e.g[i++]=o),t++}e.g.length=i}if(e.i!=e.g.length){var s={};for(i=t=0;t<e.g.length;)fe(s,o=e.g[t])||(e.g[i++]=o,s[o]=1),t++;e.g.length=i}}function fe(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(O=fr.prototype).setTimeout=function(e){this.P=e},O.gb=function(e){e=e.target;var t=this.L;t&&3==Ae(e)?t.l():this.Ia(e)},O.Ia=function(e){try{if(e==this.g)t:{var t=Ae(this.g),i=this.g.Da(),o=this.g.ba();if(!(3>t)&&(3!=t||_o||this.g&&(this.h.h||this.g.ga()||xa(this.g)))){this.I||4!=t||7==i||yn(8==i||0>=o?3:2),bn(this);var s=this.g.ba();this.N=s;e:if(xo(this)){var u=xa(this.g);e="";var a=u.length,c=4==Ae(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){he(this),wn(this);var h="";break e}this.h.i=new G.TextDecoder}for(i=0;i<a;i++)this.h.h=!0,e+=this.h.i.decode(u[i],{stream:c&&i==a-1});u.splice(0,a),this.h.g+=e,this.C=0,h=this.h.g}else h=this.g.ga();if(this.i=200==s,function(e,t,i,o,s,u,a){e.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+s+"]: "+t+"\n"+i+"\n"+u+" "+a})}(this.j,this.u,this.A,this.m,this.X,t,s),this.i){if(this.$&&!this.J){e:{if(this.g){var p,g=this.g;if((p=g.g?g.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ln(p)){var _=p;break e}}_=null}if(!(s=_)){this.i=!1,this.o=3,At(12),he(this),wn(this);break t}Ke(this.j,this.m,s,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ci(this,s)}this.U?(Ei(this,t,h),_o&&this.i&&3==t&&(No(this.V,this.W,"tick",this.fb),this.W.start())):(Ke(this.j,this.m,h,null),Ci(this,h)),4==t&&he(this),this.i&&!this.I&&(4==t?Ga(this.l,this):(this.i=!1,_n(this)))}else 400==s&&0<h.indexOf("Unknown SID")?(this.o=3,At(12)):(this.o=0,At(13)),he(this),wn(this)}}}catch(b){}},O.fb=function(){if(this.g){var e=Ae(this.g),t=this.g.ga();this.C<t.length&&(bn(this),Ei(this,e,t),this.i&&4!=e&&_n(this))}},O.cancel=function(){this.I=!0,he(this)},O.eb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.K&&(yn(3),At(17)),he(this),this.o=2,wn(this)):gr(this,this.Y-e)},(O=Ie.prototype).R=function(){Ii(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},O.T=function(){return Ii(this),this.g.concat()},O.get=function(e,t){return fe(this.h,e)?this.h[e]:t},O.set=function(e,t){fe(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},O.forEach=function(e,t){for(var i=this.T(),o=0;o<i.length;o++){var s=i[o],u=this.get(s);e.call(t,u,s,this)}};var Hs=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Je(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Je){this.g=void 0!==t?t:e.g,Ai(this,e.j),this.s=e.s,mr(this,e.i),Si(this,e.m),this.l=e.l,t=e.h;var i=new Cn;i.i=t.i,t.g&&(i.g=new Ie(t.g),i.h=t.h),Js(this,i),this.o=e.o}else e&&(i=String(e).match(Hs))?(this.g=!!t,Ai(this,i[1]||"",!0),this.s=m(i[2]||""),mr(this,i[3]||"",!0),Si(this,i[4]),this.l=m(i[5]||"",!0),Js(this,i[6]||"",!0),this.o=m(i[7]||"")):(this.g=!!t,this.h=new Cn(null,this.g))}function te(e){return new Je(e)}function Ai(e,t,i){e.j=i?m(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function mr(e,t,i){e.i=i?m(t,!0):t}function Si(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Js(e,t,i){t instanceof Cn?(e.h=t,function(e,t){t&&!e.j&&(de(e),e.i=null,e.g.forEach(function(i,o){var s=o.toLowerCase();o!=s&&(_a(this,o),wa(this,s,i))},e)),e.j=t}(e.h,e.g)):(i||(t=I(t,Di)),e.h=new Cn(t,e.g))}function X(e,t,i){e.h.set(t,i)}function d(e){return X(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function m(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function I(e,t,i){return"string"==typeof e?(e=encodeURI(e).replace(t,x),i&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function x(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Je.prototype.toString=function(){var e=[],t=this.j;t&&e.push(I(t,rt,!0),":");var i=this.i;return(i||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(I(t,rt,!0),"@"),e.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.m)&&e.push(":",String(i))),(i=this.l)&&(this.i&&"/"!=i.charAt(0)&&e.push("/"),e.push(I(i,"/"==i.charAt(0)?En:ee,!0))),(i=this.h.toString())&&e.push("?",i),(i=this.o)&&e.push("#",I(i,ze)),e.join("")};var rt=/[#\/\?@]/g,ee=/[#\?:]/g,En=/[#\?]/g,Di=/[#\?@]/g,ze=/#/g;function Cn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function de(e){e.g||(e.g=new Ie,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var i=0;i<e.length;i++){var o=e[i].indexOf("="),s=null;if(0<=o){var u=e[i].substring(0,o);s=e[i].substring(o+1)}else u=e[i];t(u,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,i){e.add(decodeURIComponent(t.replace(/\+/g," ")),i)}))}function _a(e,t){de(e),t=yr(e,t),fe(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,fe((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&Ii(e)))}function ba(e,t){return de(e),t=yr(e,t),fe(e.g.h,t)}function wa(e,t,i){_a(e,t),0<i.length&&(e.i=null,e.g.set(yr(e,t),xe(i)),e.h+=i.length)}function yr(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(O=Cn.prototype).add=function(e,t){de(this),this.i=null,e=yr(this,e);var i=this.g.get(e);return i||this.g.set(e,i=[]),i.push(t),this.h+=1,this},O.forEach=function(e,t){de(this),this.g.forEach(function(i,o){Xr(i,function(s){e.call(t,s,o,this)},this)},this)},O.T=function(){de(this);for(var e=this.g.R(),t=this.g.T(),i=[],o=0;o<t.length;o++)for(var s=e[o],u=0;u<s.length;u++)i.push(t[o]);return i},O.R=function(e){de(this);var t=[];if("string"==typeof e)ba(this,e)&&(t=Jn(t,this.g.get(yr(this,e))));else{e=this.g.R();for(var i=0;i<e.length;i++)t=Jn(t,e[i])}return t},O.set=function(e,t){return de(this),this.i=null,ba(this,e=yr(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},O.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},O.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),i=0;i<t.length;i++){var o=t[i],s=encodeURIComponent(String(o));o=this.R(o);for(var u=0;u<o.length;u++){var a=s;""!==o[u]&&(a+="="+encodeURIComponent(String(o[u]))),e.push(a)}}return this.i=e.join("&")};var pf=function(t,i){this.h=t,this.g=i};function Ea(e){this.l=e||gf,e=G.PerformanceNavigationTiming?0<(e=G.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(G.g&&G.g.Ea&&G.g.Ea()&&G.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var gf=10;function Ca(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ta(e){return e.h?1:e.g?e.g.size:0}function zs(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Qs(e,t){e.g?e.g.add(t):e.h=t}function Ia(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Aa(e){var t,i;if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){var o=e.i;try{for(var s=Yr(e.g.values()),u=s.next();!u.done;u=s.next())o=o.concat(u.value.D)}catch(c){t={error:c}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}return o}return xe(e.i)}function Ws(){}function mf(){this.g=new Ws}function yf(e,t,i){var o=i||"";try{Ti(e,function(s,u){var a=s;Oe(s)&&(a=li(s)),t.push(o+u+"="+encodeURIComponent(a))})}catch(s){throw t.push(o+"type="+encodeURIComponent("_badmap")),s}}function ko(e,t,i,o,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(o)}catch(u){}}function Ni(e){this.l=e.$b||null,this.j=e.ib||!1}function Ro(e,t){st.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Ys,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ea.prototype.cancel=function(){var e,t;if(this.i=Aa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var i=Yr(this.g.values()),o=i.next();!o.done;o=i.next())o.value.cancel()}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}this.g.clear()}},Ws.prototype.stringify=function(e){return G.JSON.stringify(e,void 0)},Ws.prototype.parse=function(e){return G.JSON.parse(e,void 0)},ct(Ni,mi),Ni.prototype.g=function(){return new Ro(this.l,this.j)},Ni.prototype.i=function(e){return function(){return e}}({}),ct(Ro,st);var Ys=0;function Sa(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function Vi(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Mi(e)}function Mi(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(O=Ro.prototype).open=function(e,t){if(this.readyState!=Ys)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Mi(this)},O.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||G).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},O.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Vi(this)),this.readyState=Ys},O.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Mi(this)),this.g&&(this.readyState=3,Mi(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==G.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Sa(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},O.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Vi(this):Mi(this),3==this.readyState&&Sa(this)}},O.Ua=function(e){this.g&&(this.response=this.responseText=e,Vi(this))},O.Ta=function(e){this.g&&(this.response=e,Vi(this))},O.ha=function(){this.g&&Vi(this)},O.setRequestHeader=function(e,t){this.v.append(e,t)},O.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},O.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),i=t.next();!i.done;)e.push((i=i.value)[0]+": "+i[1]),i=t.next();return e.join("\r\n")},Object.defineProperty(Ro.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var _f=G.JSON.parse;function lt(e){st.call(this),this.headers=new Ie,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Da,this.K=this.L=!1}ct(lt,st);var Da="",bf=/^https?$/i,wf=["POST","PUT"];function Cf(e){return"content-type"==e.toLowerCase()}function Na(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Va(e),Po(e)}function Va(e){e.D||(e.D=!0,nt(e,"complete"),nt(e,"error"))}function Ma(e){if(e.h&&void 0!==jn&&(!e.C[1]||4!=Ae(e)||2!=e.ba()))if(e.v&&4==Ae(e))ir(e.Fa,0,e);else if(nt(e,"readystatechange"),4==Ae(e)){e.h=!1;try{var o,t=e.ba();t:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var i=!0;break t;default:i=!1}if(!(o=i)){var s;if(s=0===t){var u=String(e.H).match(Hs)[1]||null;if(!u&&G.self&&G.self.location){var a=G.self.location.protocol;u=a.substr(0,a.length-1)}s=!bf.test(u?u.toLowerCase():"")}o=s}if(o)nt(e,"complete"),nt(e,"success");else{e.m=6;try{var c=2<Ae(e)?e.g.statusText:""}catch(h){c=""}e.j=c+" ["+e.ba()+"]",Va(e)}}finally{Po(e)}}}function Po(e,t){if(e.g){Oa(e);var i=e.g,o=e.C[0]?an:null;e.g=null,e.C=null,t||nt(e,"ready");try{i.onreadystatechange=o}catch(s){}}}function Oa(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(G.clearTimeout(e.A),e.A=null)}function Ae(e){return e.g?e.g.readyState:0}function xa(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Da:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function $s(e,t,i){t:{for(o in i){var o=!1;break t}o=!0}o||(i=function(e){var t="";return vo(e,function(i,o){t+=o,t+=":",t+=i,t+="\r\n"}),t}(i),"string"==typeof e?null!=i&&encodeURIComponent(String(i)):X(e,t,i))}function Oi(e,t,i){return i&&i.internalChannelParams&&i.internalChannelParams[e]||t}function Fa(e){this.za=0,this.l=[],this.h=new gn,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Oi("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Oi("baseRetryDelayMs",5e3,e),this.$a=Oi("retryDelaySeedMs",1e4,e),this.Ya=Oi("forwardChannelMaxRetries",2,e),this.ra=Oi("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new Ea(e&&e.concurrentRequestLimit),this.Ca=new mf,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function Zs(e){if(ka(e),3==e.G){var t=e.V++,i=te(e.F);X(i,"SID",e.J),X(i,"RID",t),X(i,"TYPE","terminate"),xi(e,i),(t=new fr(e,e.h,t,void 0)).K=2,t.v=d(te(i)),i=!1,G.navigator&&G.navigator.sendBeacon&&(i=G.navigator.sendBeacon(t.v.toString(),"")),!i&&G.Image&&((new Image).src=t.v,i=!0),i||(t.g=Ka(t.l,null),t.g.ea(t.v)),t.F=Date.now(),_n(t)}Ba(e)}function Lo(e){e.g&&(eu(e),e.g.cancel(),e.g=null)}function ka(e){Lo(e),e.u&&(G.clearTimeout(e.u),e.u=null),Go(e),e.i.cancel(),e.m&&("number"==typeof e.m&&G.clearTimeout(e.m),e.m=null)}function Xs(e,t){e.l.push(new pf(e.Za++,t)),3==e.G&&Uo(e)}function Uo(e){Ca(e.i)||e.m||(e.m=!0,Eo(e.Ha,e),e.C=0)}function Ra(e,t){var i;i=t?t.m:e.V++;var o=te(e.F);X(o,"SID",e.J),X(o,"RID",i),X(o,"AID",e.U),xi(e,o),e.o&&e.s&&$s(o,e.o,e.s),i=new fr(e,e.h,i,e.C+1),null===e.o&&(i.H=e.s),t&&(e.l=t.D.concat(e.l)),t=Pa(e,i,1e3),i.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),Qs(e.i,i),bi(i,o,t)}function xi(e,t){e.j&&Ti({},function(i,o){X(t,o,i)})}function Pa(e,t,i){i=Math.min(e.l.length,i);var o=e.j?mt(e.j.Oa,e.j,e):null;t:for(var s=e.l,u=-1;;){var a=["count="+i];-1==u?0<i?a.push("ofs="+(u=s[0].h)):u=0:a.push("ofs="+u);for(var c=!0,h=0;h<i;h++){var p=s[h].h,g=s[h].g;if(0>(p-=u))u=Math.max(0,s[h].h-100),c=!1;else try{yf(g,a,"req"+p+"_")}catch(_){o&&o(g)}}if(c){o=a.join("&");break t}}return e=e.l.splice(0,i),t.D=e,o}function La(e){e.g||e.u||(e.Y=1,Eo(e.Ga,e),e.A=0)}function tu(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=He(mt(e.Ga,e),qa(e,e.A)),e.A++,0))}function eu(e){null!=e.B&&(G.clearTimeout(e.B),e.B=null)}function Ua(e){e.g=new fr(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=te(e.oa);X(t,"RID","rpc"),X(t,"SID",e.J),X(t,"CI",e.N?"0":"1"),X(t,"AID",e.U),xi(e,t),X(t,"TYPE","xmlhttp"),e.o&&e.s&&$s(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var i=e.g;e=e.la,i.K=1,i.v=d(te(t)),i.s=null,i.U=!0,wi(i,e)}function Go(e){null!=e.v&&(G.clearTimeout(e.v),e.v=null)}function Ga(e,t){var i=null;if(e.g==t){Go(e),eu(e),e.g=null;var o=2}else{if(!zs(e.i,t))return;i=t.D,Ia(e.i,t),o=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==o){i=t.s?t.s.length:0,t=Date.now()-t.F;var s=e.C;nt(o=or(),new ur(o,i,t,s)),Uo(e)}else La(e);else if(3==(s=t.o)||0==s&&0<e.I||!(1==o&&function(e,t){return!(Ta(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=He(mt(e.Ha,e,t),qa(e,e.C)),e.C++,0)))}(e,t)||2==o&&tu(e)))switch(i&&0<i.length&&(t=e.i,t.i=t.i.concat(i)),s){case 1:Tn(e,5);break;case 4:Tn(e,10);break;case 3:Tn(e,6);break;default:Tn(e,2)}}function qa(e,t){var i=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(i*=2),i*t}function Tn(e,t){if(e.h.info("Error code "+t),2==t){var i=null;e.j&&(i=null);var o=mt(e.jb,e);i||(i=new Je("//www.google.com/images/cleardot.gif"),G.location&&"http"==G.location.protocol||Ai(i,"https"),d(i)),function(e,t){var i=new gn;if(G.Image){var o=new Image;o.onload=cn(ko,i,o,"TestLoadImage: loaded",!0,t),o.onerror=cn(ko,i,o,"TestLoadImage: error",!1,t),o.onabort=cn(ko,i,o,"TestLoadImage: abort",!1,t),o.ontimeout=cn(ko,i,o,"TestLoadImage: timeout",!1,t),G.setTimeout(function(){o.ontimeout&&o.ontimeout()},1e4),o.src=e}else t(!1)}(i.toString(),o)}else At(2);e.G=0,e.j&&e.j.va(t),Ba(e),ka(e)}function Ba(e){e.G=0,e.I=-1,e.j&&((0!=Aa(e.i).length||0!=e.l.length)&&(e.i.i.length=0,xe(e.l),e.l.length=0),e.j.ua())}function ja(e,t,i){var o=function(e){return e instanceof Je?te(e):new Je(e,void 0)}(i);if(""!=o.i)t&&mr(o,t+"."+o.i),Si(o,o.m);else{var s=G.location;o=function(e,t,i,o){var s=new Je(null,void 0);return e&&Ai(s,e),t&&mr(s,t),i&&Si(s,i),o&&(s.l=o),s}(s.protocol,t?t+"."+s.hostname:s.hostname,+s.port,i)}return e.aa&&vo(e.aa,function(u,a){X(o,a,u)}),i=e.sa,(t=e.D)&&i&&X(o,t,i),X(o,"VER",e.ma),xi(e,o),o}function Ka(e,t,i){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new lt(i&&e.Ba&&!e.qa?new Ni({ib:!0}):e.qa)).L=e.H,t}function Ha(){}function qo(){if(ke&&!(10<=Number($n)))throw Error("Environmental error: no available transport.")}function Kt(e,t){st.call(this),this.g=new Fa(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!ln(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!ln(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new vr(this)}function Ja(e){vi.call(this);var t=e.__sm__;if(t){t:{for(var i in t){e=i;break t}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function za(){_i.call(this),this.status=1}function vr(e){this.g=e}(O=lt.prototype).ea=function(e,t,i,o){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():lr.g(),this.C=function(e){return e.h||(e.h=e.i())}(this.u?this.u:lr),this.g.onreadystatechange=mt(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(u){return void Na(this,u)}e=i||"";var s=new Ie(this.headers);o&&Ti(o,function(u,a){s.set(a,u)}),o=function(e){t:{for(var t=Cf,i=e.length,o="string"==typeof e?e.split(""):e,s=0;s<i;s++)if(s in o&&t.call(void 0,o[s],s,e)){t=s;break t}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(s.T()),i=G.FormData&&e instanceof G.FormData,!(0<=Zr(wf,t))||o||i||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(u,a){this.g.setRequestHeader(a,u)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Oa(this),0<this.B&&((this.K=function(e){return ke&&Wn()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=mt(this.pa,this)):this.A=ir(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(u){Na(this,u)}},O.pa=function(){void 0!==jn&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,nt(this,"timeout"),this.abort(8))},O.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,nt(this,"complete"),nt(this,"abort"),Po(this))},O.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Po(this,!0)),lt.Z.M.call(this)},O.Fa=function(){this.s||(this.F||this.v||this.l?Ma(this):this.cb())},O.cb=function(){Ma(this)},O.ba=function(){try{return 2<Ae(this)?this.g.status:-1}catch(e){return-1}},O.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},O.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),_f(t)}},O.Da=function(){return this.m},O.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(O=Fa.prototype).ma=8,O.G=1,O.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}},O.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new fr(this,this.h,e,void 0),i=this.s;if(this.P&&(i?zn(i=ni(i),this.P):i=this.P),null===this.o&&(t.H=i),this.ja)t:{for(var o=0,s=0;s<this.l.length;s++){var u=this.l[s];if(void 0===(u="__data__"in u.g&&"string"==typeof(u=u.g.__data__)?u.length:void 0))break;if(4096<(o+=u)){o=s;break t}if(4096===o||s===this.l.length-1){o=s+1;break t}}o=1e3}else o=1e3;o=Pa(this,t,o),X(s=te(this.F),"RID",e),X(s,"CVER",22),this.D&&X(s,"X-HTTP-Session-Id",this.D),xi(this,s),this.o&&i&&$s(s,this.o,i),Qs(this.i,t),this.Ra&&X(s,"TYPE","init"),this.ja?(X(s,"$req",o),X(s,"SID","null"),t.$=!0,bi(t,s,null)):bi(t,s,o),this.G=2}}else 3==this.G&&(e?Ra(this,e):0==this.l.length||Ca(this.i)||Ra(this))},O.Ga=function(){if(this.u=null,Ua(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=He(mt(this.bb,this),e)}},O.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,At(10),Lo(this),Ua(this))},O.ab=function(){null!=this.v&&(this.v=null,Lo(this),tu(this),At(19))},O.jb=function(e){e?(this.h.info("Successfully pinged google.com"),At(2)):(this.h.info("Failed to ping google.com"),At(1))},(O=Ha.prototype).xa=function(){},O.wa=function(){},O.va=function(){},O.ua=function(){},O.Oa=function(){},qo.prototype.g=function(e,t){return new Kt(e,t)},ct(Kt,st),Kt.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,i=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Eo(mt(e.hb,e,t))),At(0),e.W=t,e.aa=i||{},e.N=e.X,e.F=ja(e,null,e.W),Uo(e)},Kt.prototype.close=function(){Zs(this.g)},Kt.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,Xs(this.g,t)}else this.v?((t={}).__data__=li(e),Xs(this.g,t)):Xs(this.g,e)},Kt.prototype.M=function(){this.g.j=null,delete this.j,Zs(this.g),delete this.g,Kt.Z.M.call(this)},ct(Ja,vi),ct(za,_i),ct(vr,Ha),vr.prototype.xa=function(){nt(this.g,"a")},vr.prototype.wa=function(e){nt(this.g,new Ja(e))},vr.prototype.va=function(e){nt(this.g,new za(e))},vr.prototype.ua=function(){nt(this.g,"b")},qo.prototype.createWebChannel=qo.prototype.g,Kt.prototype.send=Kt.prototype.u,Kt.prototype.open=Kt.prototype.m,Kt.prototype.close=Kt.prototype.close,ar.NO_ERROR=0,ar.TIMEOUT=8,ar.HTTP_ERROR=6,cr.COMPLETE="complete",Oo.EventType=Te,Te.OPEN="a",Te.CLOSE="b",Te.ERROR="c",Te.MESSAGE="d",st.prototype.listen=st.prototype.N,lt.prototype.listenOnce=lt.prototype.O,lt.prototype.getLastError=lt.prototype.La,lt.prototype.getLastErrorCode=lt.prototype.Da,lt.prototype.getStatus=lt.prototype.ba,lt.prototype.getResponseJson=lt.prototype.Qa,lt.prototype.getResponseText=lt.prototype.ga,lt.prototype.send=lt.prototype.ea;var Bo=ar,Ya=cr,$a=Ce,nu_PROXY=10,nu_NOPROXY=11,Za=Ni,Fi=Oo,Xa=lt,Ht=function(){function e(t,i){var o=this;this.previousValue=t,i&&(i.sequenceNumberHandler=function(s){return o.t(s)},this.i=function(s){return i.writeSequenceNumber(s)})}return e.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},e.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},e}();Ht.o=-1;var C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},A=function(e){function t(i,o){var s=this;return(s=e.call(this,o)||this).code=i,s.message=o,s.name="FirebaseError",s.toString=function(){return s.name+": [code="+s.code+"]: "+s.message},s}return(0,v.ZT)(t,e),t}(Error),se=new Mt.Yd("@firebase/firestore");function ru(){return se.logLevel}function N(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(se.logLevel<=Mt.in.DEBUG){var o=t.map(iu);se.debug.apply(se,(0,v.ev)(["Firestore (8.10.1): "+e],o))}}function ht(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(se.logLevel<=Mt.in.ERROR){var o=t.map(iu);se.error.apply(se,(0,v.ev)(["Firestore (8.10.1): "+e],o))}}function ki(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(se.logLevel<=Mt.in.WARN){var o=t.map(iu);se.warn.apply(se,(0,v.ev)(["Firestore (8.10.1): "+e],o))}}function iu(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(i){return e}}function F(e){void 0===e&&(e="Unexpected state");var t="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+e;throw ht(t),new Error(t)}function q(e,t){e||F()}function M(e,t){return e}function Af(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),i=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(i);else for(var o=0;o<e;o++)i[o]=Math.floor(256*Math.random());return i}var tc=function(){function e(){}return e.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=Math.floor(256/t.length)*t.length,o="";o.length<20;)for(var s=Af(40),u=0;u<s.length;++u)o.length<20&&s[u]<i&&(o+=t.charAt(s[u]%t.length));return o},e}();function H(e,t){return e<t?-1:e>t?1:0}function _r(e,t,i){return e.length===t.length&&e.every(function(o,s){return i(o,t[s])})}function ec(e){return e+"\0"}var Gt=function(){function e(t,i){if(this.seconds=t,this.nanoseconds=i,i<0)throw new A(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new A(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(t<-62135596800)throw new A(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new A(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return e.now=function(){return e.fromMillis(Date.now())},e.fromDate=function(t){return e.fromMillis(t.getTime())},e.fromMillis=function(t){var i=Math.floor(t/1e3);return new e(i,Math.floor(1e6*(t-1e3*i)))},e.prototype.toDate=function(){return new Date(this.toMillis())},e.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},e.prototype._compareTo=function(t){return this.seconds===t.seconds?H(this.nanoseconds,t.nanoseconds):H(this.seconds,t.seconds)},e.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},e.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},e.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},e.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},e}(),j=function(){function e(t){this.timestamp=t}return e.fromTimestamp=function(t){return new e(t)},e.min=function(){return new e(new Gt(0,0))},e.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},e.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},e.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},e.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},e.prototype.toTimestamp=function(){return this.timestamp},e}();function nc(e){var t=0;for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t++;return t}function In(e,t){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t(i,e[i])}function rc(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var ic=function(){function e(t,i,o){void 0===i?i=0:i>t.length&&F(),void 0===o?o=t.length-i:o>t.length-i&&F(),this.segments=t,this.offset=i,this.len=o}return Object.defineProperty(e.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return 0===e.comparator(this,t)},e.prototype.child=function(t){var i=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(function(o){i.push(o)}):i.push(t),this.construct(i)},e.prototype.limit=function(){return this.offset+this.length},e.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},e.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},e.prototype.firstSegment=function(){return this.segments[this.offset]},e.prototype.lastSegment=function(){return this.get(this.length-1)},e.prototype.get=function(t){return this.segments[this.offset+t]},e.prototype.isEmpty=function(){return 0===this.length},e.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0},e.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0},e.prototype.forEach=function(t){for(var i=this.offset,o=this.limit();i<o;i++)t(this.segments[i])},e.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},e.comparator=function(t,i){for(var o=Math.min(t.length,i.length),s=0;s<o;s++){var u=t.get(s),a=i.get(s);if(u<a)return-1;if(u>a)return 1}return t.length<i.length?-1:t.length>i.length?1:0},e}(),Q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,v.ZT)(t,e),t.prototype.construct=function(i,o,s){return new t(i,o,s)},t.prototype.canonicalString=function(){return this.toArray().join("/")},t.prototype.toString=function(){return this.canonicalString()},t.fromString=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];for(var s=[],u=0,a=i;u<a.length;u++){var c=a[u];if(c.indexOf("//")>=0)throw new A(C.INVALID_ARGUMENT,"Invalid segment ("+c+"). Paths must not contain // in them.");s.push.apply(s,c.split("/").filter(function(h){return h.length>0}))}return new t(s)},t.emptyPath=function(){return new t([])},t}(ic),Sf=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,v.ZT)(t,e),t.prototype.construct=function(i,o,s){return new t(i,o,s)},t.isValidIdentifier=function(i){return Sf.test(i)},t.prototype.canonicalString=function(){return this.toArray().map(function(i){return i=i.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(i)||(i="`"+i+"`"),i}).join(".")},t.prototype.toString=function(){return this.canonicalString()},t.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},t.keyField=function(){return new t(["__name__"])},t.fromServerFormat=function(i){for(var o=[],s="",u=0,a=function(){if(0===s.length)throw new A(C.INVALID_ARGUMENT,"Invalid field path ("+i+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");o.push(s),s=""},c=!1;u<i.length;){var h=i[u];if("\\"===h){if(u+1===i.length)throw new A(C.INVALID_ARGUMENT,"Path has trailing escape character: "+i);var p=i[u+1];if("\\"!==p&&"."!==p&&"`"!==p)throw new A(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+i);s+=p,u+=2}else"`"===h?(c=!c,u++):"."!==h||c?(s+=h,u++):(a(),u++)}if(a(),c)throw new A(C.INVALID_ARGUMENT,"Unterminated ` in path: "+i);return new t(o)},t.emptyPath=function(){return new t([])},t}(ic),br=function(){function e(t){this.fields=t,t.sort(ue.comparator)}return e.prototype.covers=function(t){for(var i=0,o=this.fields;i<o.length;i++)if(o[i].isPrefixOf(t))return!0;return!1},e.prototype.isEqual=function(t){return _r(this.fields,t.fields,function(i,o){return i.isEqual(o)})},e}(),Lt=function(){function e(t){this.binaryString=t}return e.fromBase64String=function(t){return new e(atob(t))},e.fromUint8Array=function(t){return new e(function(i){for(var o="",s=0;s<i.length;++s)o+=String.fromCharCode(i[s]);return o}(t))},e.prototype.toBase64=function(){return btoa(this.binaryString)},e.prototype.toUint8Array=function(){return function(t){for(var i=new Uint8Array(t.length),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return i}(this.binaryString)},e.prototype.approximateByteSize=function(){return 2*this.binaryString.length},e.prototype.compareTo=function(t){return H(this.binaryString,t.binaryString)},e.prototype.isEqual=function(t){return this.binaryString===t.binaryString},e}();Lt.EMPTY_BYTE_STRING=new Lt("");var Df=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Qe(e){if(q(!!e),"string"==typeof e){var t=0,i=Df.exec(e);if(q(!!i),i[1]){var o=i[1];o=(o+"000000000").substr(0,9),t=Number(o)}var s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:ft(e.seconds),nanos:ft(e.nanos)}}function ft(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function wr(e){return"string"==typeof e?Lt.fromBase64String(e):Lt.fromUint8Array(e)}function ou(e){var t,i;return"server_timestamp"===(null===(i=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===i?void 0:i.stringValue)}function oc(e){var t=e.mapValue.fields.__previous_value__;return ou(t)?oc(t):t}function Ri(e){var t=Qe(e.mapValue.fields.__local_write_time__.timestampValue);return new Gt(t.seconds,t.nanos)}function An(e){return null==e}function jo(e){return 0===e&&1/e==-1/0}function sc(e){return"number"==typeof e&&Number.isInteger(e)&&!jo(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var k=function(){function e(t){this.path=t}return e.fromPath=function(t){return new e(Q.fromString(t))},e.fromName=function(t){return new e(Q.fromString(t).popFirst(5))},e.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},e.prototype.isEqual=function(t){return null!==t&&0===Q.comparator(this.path,t.path)},e.prototype.toString=function(){return this.path.toString()},e.comparator=function(t,i){return Q.comparator(t.path,i.path)},e.isDocumentKey=function(t){return t.length%2==0},e.fromSegments=function(t){return new e(new Q(t.slice()))},e}();function Sn(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ou(e)?4:10:F()}function pe(e,t){var s,i=Sn(e);if(i!==Sn(t))return!1;switch(i){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ri(e).isEqual(Ri(t));case 3:return function(o,s){if("string"==typeof o.timestampValue&&"string"==typeof s.timestampValue&&o.timestampValue.length===s.timestampValue.length)return o.timestampValue===s.timestampValue;var u=Qe(o.timestampValue),a=Qe(s.timestampValue);return u.seconds===a.seconds&&u.nanos===a.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return s=t,wr(e.bytesValue).isEqual(wr(s.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(o,s){return ft(o.geoPointValue.latitude)===ft(s.geoPointValue.latitude)&&ft(o.geoPointValue.longitude)===ft(s.geoPointValue.longitude)}(e,t);case 2:return function(o,s){if("integerValue"in o&&"integerValue"in s)return ft(o.integerValue)===ft(s.integerValue);if("doubleValue"in o&&"doubleValue"in s){var u=ft(o.doubleValue),a=ft(s.doubleValue);return u===a?jo(u)===jo(a):isNaN(u)&&isNaN(a)}return!1}(e,t);case 9:return _r(e.arrayValue.values||[],t.arrayValue.values||[],pe);case 10:return function(o,s){var u=o.mapValue.fields||{},a=s.mapValue.fields||{};if(nc(u)!==nc(a))return!1;for(var c in u)if(u.hasOwnProperty(c)&&(void 0===a[c]||!pe(u[c],a[c])))return!1;return!0}(e,t);default:return F()}}function Pi(e,t){return void 0!==(e.values||[]).find(function(i){return pe(i,t)})}function Er(e,t){var s,u,a,c,i=Sn(e),o=Sn(t);if(i!==o)return H(i,o);switch(i){case 0:return 0;case 1:return H(e.booleanValue,t.booleanValue);case 2:return u=t,(a=ft((s=e).integerValue||s.doubleValue))<(c=ft(u.integerValue||u.doubleValue))?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1;case 3:return uc(e.timestampValue,t.timestampValue);case 4:return uc(Ri(e),Ri(t));case 5:return H(e.stringValue,t.stringValue);case 6:return function(s,u){var a=wr(s),c=wr(u);return a.compareTo(c)}(e.bytesValue,t.bytesValue);case 7:return function(s,u){for(var a=s.split("/"),c=u.split("/"),h=0;h<a.length&&h<c.length;h++){var p=H(a[h],c[h]);if(0!==p)return p}return H(a.length,c.length)}(e.referenceValue,t.referenceValue);case 8:return function(s,u){var a=H(ft(s.latitude),ft(u.latitude));return 0!==a?a:H(ft(s.longitude),ft(u.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(s,u){for(var a=s.values||[],c=u.values||[],h=0;h<a.length&&h<c.length;++h){var p=Er(a[h],c[h]);if(p)return p}return H(a.length,c.length)}(e.arrayValue,t.arrayValue);case 10:return function(s,u){var a=s.fields||{},c=Object.keys(a),h=u.fields||{},p=Object.keys(h);c.sort(),p.sort();for(var g=0;g<c.length&&g<p.length;++g){var _=H(c[g],p[g]);if(0!==_)return _;var b=Er(a[c[g]],h[p[g]]);if(0!==b)return b}return H(c.length,p.length)}(e.mapValue,t.mapValue);default:throw F()}}function uc(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return H(e,t);var i=Qe(e),o=Qe(t),s=H(i.seconds,o.seconds);return 0!==s?s:H(i.nanos,o.nanos)}function su(e){return uu(e)}function uu(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?"time("+(s=Qe(e.timestampValue)).seconds+","+s.nanos+")":"stringValue"in e?e.stringValue:"bytesValue"in e?wr(e.bytesValue).toBase64():"referenceValue"in e?k.fromName(e.referenceValue).toString():"geoPointValue"in e?"geo("+(t=e.geoPointValue).latitude+","+t.longitude+")":"arrayValue"in e?function(o){for(var s="[",u=!0,a=0,c=o.values||[];a<c.length;a++)u?u=!1:s+=",",s+=uu(c[a]);return s+"]"}(e.arrayValue):"mapValue"in e?function(o){for(var s="{",u=!0,a=0,c=Object.keys(o.fields||{}).sort();a<c.length;a++){var h=c[a];u?u=!1:s+=",",s+=h+":"+uu(o.fields[h])}return s+"}"}(e.mapValue):F();var s,t}function Ko(e,t){return{referenceValue:"projects/"+e.projectId+"/databases/"+e.database+"/documents/"+t.path.canonicalString()}}function au(e){return!!e&&"integerValue"in e}function cu(e){return!!e&&"arrayValue"in e}function ac(e){return!!e&&"nullValue"in e}function cc(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ho(e){return!!e&&"mapValue"in e}function Li(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return In(e.mapValue.fields,function(s,u){return t.mapValue.fields[s]=Li(u)}),t}if(e.arrayValue){for(var i={arrayValue:{values:[]}},o=0;o<(e.arrayValue.values||[]).length;++o)i.arrayValue.values[o]=Li(e.arrayValue.values[o]);return i}return Object.assign({},e)}var Jt=function(){function e(t){this.value=t}return e.empty=function(){return new e({mapValue:{}})},e.prototype.field=function(t){if(t.isEmpty())return this.value;for(var i=this.value,o=0;o<t.length-1;++o)if(!Ho(i=(i.mapValue.fields||{})[t.get(o)]))return null;return(i=(i.mapValue.fields||{})[t.lastSegment()])||null},e.prototype.set=function(t,i){this.getFieldsMap(t.popLast())[t.lastSegment()]=Li(i)},e.prototype.setAll=function(t){var i=this,o=ue.emptyPath(),s={},u=[];t.forEach(function(c,h){if(!o.isImmediateParentOf(h)){var p=i.getFieldsMap(o);i.applyChanges(p,s,u),s={},u=[],o=h.popLast()}c?s[h.lastSegment()]=Li(c):u.push(h.lastSegment())});var a=this.getFieldsMap(o);this.applyChanges(a,s,u)},e.prototype.delete=function(t){var i=this.field(t.popLast());Ho(i)&&i.mapValue.fields&&delete i.mapValue.fields[t.lastSegment()]},e.prototype.isEqual=function(t){return pe(this.value,t.value)},e.prototype.getFieldsMap=function(t){var i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(var o=0;o<t.length;++o){var s=i.mapValue.fields[t.get(o)];Ho(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},i.mapValue.fields[t.get(o)]=s),i=s}return i.mapValue.fields},e.prototype.applyChanges=function(t,i,o){In(i,function(c,h){return t[c]=h});for(var s=0,u=o;s<u.length;s++)delete t[u[s]]},e.prototype.clone=function(){return new e(Li(this.value))},e}();function lc(e){var t=[];return In(e.fields,function(i,o){var s=new ue([i]);if(Ho(o)){var u=lc(o.mapValue).fields;if(0===u.length)t.push(s);else for(var a=0,c=u;a<c.length;a++)t.push(s.child(c[a]))}else t.push(s)}),new br(t)}var St=function(){function e(t,i,o,s,u){this.key=t,this.documentType=i,this.version=o,this.data=s,this.documentState=u}return e.newInvalidDocument=function(t){return new e(t,0,j.min(),Jt.empty(),0)},e.newFoundDocument=function(t,i,o){return new e(t,1,i,o,0)},e.newNoDocument=function(t,i){return new e(t,2,i,Jt.empty(),0)},e.newUnknownDocument=function(t,i){return new e(t,3,i,Jt.empty(),2)},e.prototype.convertToFoundDocument=function(t,i){return this.version=t,this.documentType=1,this.data=i,this.documentState=0,this},e.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Jt.empty(),this.documentState=0,this},e.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Jt.empty(),this.documentState=2,this},e.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},e.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(e.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isValidDocument=function(){return 0!==this.documentType},e.prototype.isFoundDocument=function(){return 1===this.documentType},e.prototype.isNoDocument=function(){return 2===this.documentType},e.prototype.isUnknownDocument=function(){return 3===this.documentType},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},e.prototype.clone=function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},e}(),Nf=function(e,t,i,o,s,u,a){void 0===t&&(t=null),void 0===i&&(i=[]),void 0===o&&(o=[]),void 0===s&&(s=null),void 0===u&&(u=null),void 0===a&&(a=null),this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=o,this.limit=s,this.startAt=u,this.endAt=a,this.h=null};function hc(e,t,i,o,s,u,a){return void 0===t&&(t=null),void 0===i&&(i=[]),void 0===o&&(o=[]),void 0===s&&(s=null),void 0===u&&(u=null),void 0===a&&(a=null),new Nf(e,t,i,o,s,u,a)}function Ui(e){var t=M(e);if(null===t.h){var i=t.path.canonicalString();null!==t.collectionGroup&&(i+="|cg:"+t.collectionGroup),i+="|f:",i+=t.filters.map(function(o){return(s=o).field.canonicalString()+s.op.toString()+su(s.value);var s}).join(","),i+="|ob:",i+=t.orderBy.map(function(o){return(s=o).field.canonicalString()+s.dir;var s}).join(","),An(t.limit)||(i+="|l:",i+=t.limit),t.startAt&&(i+="|lb:",i+=Qo(t.startAt)),t.endAt&&(i+="|ub:",i+=Qo(t.endAt)),t.h=i}return t.h}function Jo(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(var i=0;i<e.orderBy.length;i++)if(!Pf(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var o=0;o<e.filters.length;o++)if((s=e.filters[o]).op!==(u=t.filters[o]).op||!s.field.isEqual(u.field)||!pe(s.value,u.value))return!1;var s,u;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!pc(e.startAt,t.startAt)&&pc(e.endAt,t.endAt)}function zo(e){return k.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var zt=function(e){function t(i,o,s){var u=this;return(u=e.call(this)||this).field=i,u.op=o,u.value=s,u}return(0,v.ZT)(t,e),t.create=function(i,o,s){return i.isKeyField()?"in"===o||"not-in"===o?this.l(i,o,s):new Vf(i,o,s):"array-contains"===o?new xf(i,s):"in"===o?new Ff(i,s):"not-in"===o?new kf(i,s):"array-contains-any"===o?new Rf(i,s):new t(i,o,s)},t.l=function(i,o,s){return"in"===o?new Mf(i,s):new Of(i,s)},t.prototype.matches=function(i){var o=i.data.field(this.field);return"!="===this.op?null!==o&&this.m(Er(o,this.value)):null!==o&&Sn(this.value)===Sn(o)&&this.m(Er(o,this.value))},t.prototype.m=function(i){switch(this.op){case"<":return i<0;case"<=":return i<=0;case"==":return 0===i;case"!=":return 0!==i;case">":return i>0;case">=":return i>=0;default:return F()}},t.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},t}(function(){}),Vf=function(e){function t(i,o,s){var u=this;return(u=e.call(this,i,o,s)||this).key=k.fromName(s.referenceValue),u}return(0,v.ZT)(t,e),t.prototype.matches=function(i){var o=k.comparator(i.key,this.key);return this.m(o)},t}(zt),Mf=function(e){function t(i,o){var s=this;return(s=e.call(this,i,"in",o)||this).keys=fc(0,o),s}return(0,v.ZT)(t,e),t.prototype.matches=function(i){return this.keys.some(function(o){return o.isEqual(i.key)})},t}(zt),Of=function(e){function t(i,o){var s=this;return(s=e.call(this,i,"not-in",o)||this).keys=fc(0,o),s}return(0,v.ZT)(t,e),t.prototype.matches=function(i){return!this.keys.some(function(o){return o.isEqual(i.key)})},t}(zt);function fc(e,t){var i;return((null===(i=t.arrayValue)||void 0===i?void 0:i.values)||[]).map(function(o){return k.fromName(o.referenceValue)})}var xf=function(e){function t(i,o){return e.call(this,i,"array-contains",o)||this}return(0,v.ZT)(t,e),t.prototype.matches=function(i){var o=i.data.field(this.field);return cu(o)&&Pi(o.arrayValue,this.value)},t}(zt),Ff=function(e){function t(i,o){return e.call(this,i,"in",o)||this}return(0,v.ZT)(t,e),t.prototype.matches=function(i){var o=i.data.field(this.field);return null!==o&&Pi(this.value.arrayValue,o)},t}(zt),kf=function(e){function t(i,o){return e.call(this,i,"not-in",o)||this}return(0,v.ZT)(t,e),t.prototype.matches=function(i){if(Pi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var o=i.data.field(this.field);return null!==o&&!Pi(this.value.arrayValue,o)},t}(zt),Rf=function(e){function t(i,o){return e.call(this,i,"array-contains-any",o)||this}return(0,v.ZT)(t,e),t.prototype.matches=function(i){var o=this,s=i.data.field(this.field);return!(!cu(s)||!s.arrayValue.values)&&s.arrayValue.values.some(function(u){return Pi(o.value.arrayValue,u)})},t}(zt),Gi=function(e,t){this.position=e,this.before=t};function Qo(e){return(e.before?"b":"a")+":"+e.position.map(function(t){return su(t)}).join(",")}var Cr=function(e,t){void 0===t&&(t="asc"),this.field=e,this.dir=t};function Pf(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function dc(e,t,i){for(var o=0,s=0;s<e.position.length;s++){var u=t[s],a=e.position[s];if(o=u.field.isKeyField()?k.comparator(k.fromName(a.referenceValue),i.key):Er(a,i.data.field(u.field)),"desc"===u.dir&&(o*=-1),0!==o)break}return e.before?o<=0:o<0}function pc(e,t){if(null===e)return null===t;if(null===t||e.before!==t.before||e.position.length!==t.position.length)return!1;for(var i=0;i<e.position.length;i++)if(!pe(e.position[i],t.position[i]))return!1;return!0}var Se=function(e,t,i,o,s,u,a,c){void 0===t&&(t=null),void 0===i&&(i=[]),void 0===o&&(o=[]),void 0===s&&(s=null),void 0===u&&(u="F"),void 0===a&&(a=null),void 0===c&&(c=null),this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=o,this.limit=s,this.limitType=u,this.startAt=a,this.endAt=c,this.p=null,this.T=null};function gc(e,t,i,o,s,u,a,c){return new Se(e,t,i,o,s,u,a,c)}function Tr(e){return new Se(e)}function Wo(e){return!An(e.limit)&&"F"===e.limitType}function Yo(e){return!An(e.limit)&&"L"===e.limitType}function lu(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function hu(e){for(var t=0,i=e.filters;t<i.length;t++){var o=i[t];if(o.g())return o.field}return null}function fu(e){return null!==e.collectionGroup}function Ir(e){var t=M(e);if(null===t.p){t.p=[];var i=hu(t),o=lu(t);if(null!==i&&null===o)i.isKeyField()||t.p.push(new Cr(i)),t.p.push(new Cr(ue.keyField(),"asc"));else{for(var s=!1,u=0,a=t.explicitOrderBy;u<a.length;u++){var c=a[u];t.p.push(c),c.field.isKeyField()&&(s=!0)}if(!s){var h=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.p.push(new Cr(ue.keyField(),h))}}}return t.p}function ne(e){var t=M(e);if(!t.T)if("F"===t.limitType)t.T=hc(t.path,t.collectionGroup,Ir(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var i=[],o=0,s=Ir(t);o<s.length;o++){var u=s[o];i.push(new Cr(u.field,"desc"===u.dir?"asc":"desc"))}var c=t.endAt?new Gi(t.endAt.position,!t.endAt.before):null,h=t.startAt?new Gi(t.startAt.position,!t.startAt.before):null;t.T=hc(t.path,t.collectionGroup,i,t.filters,t.limit,c,h)}return t.T}function mc(e,t,i){return new Se(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,i,e.startAt,e.endAt)}function qi(e,t){return Jo(ne(e),ne(t))&&e.limitType===t.limitType}function yc(e){return Ui(ne(e))+"|lt:"+e.limitType}function du(e){return"Query(target="+(i=(t=ne(e)).path.canonicalString(),null!==t.collectionGroup&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=", filters: ["+t.filters.map(function(o){return(s=o).field.canonicalString()+" "+s.op+" "+su(s.value);var s}).join(", ")+"]"),An(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=", orderBy: ["+t.orderBy.map(function(o){return(s=o).field.canonicalString()+" ("+s.dir+")";var s}).join(", ")+"]"),t.startAt&&(i+=", startAt: "+Qo(t.startAt)),t.endAt&&(i+=", endAt: "+Qo(t.endAt)),"Target("+i+"); limitType=")+e.limitType+")";var t,i}function Bi(e,t){return t.isFoundDocument()&&(s=(o=t).key.path,null!==(i=e).collectionGroup?o.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):k.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s))&&function(i,o){for(var s=0,u=i.explicitOrderBy;s<u.length;s++){var a=u[s];if(!a.field.isKeyField()&&null===o.data.field(a.field))return!1}return!0}(e,t)&&function(i,o){for(var s=0,u=i.filters;s<u.length;s++)if(!u[s].matches(o))return!1;return!0}(e,t)&&function(i,o){return!(i.startAt&&!dc(i.startAt,Ir(i),o)||i.endAt&&dc(i.endAt,Ir(i),o))}(e,t);var i,o,s}function vc(e){return function(t,i){for(var o=!1,s=0,u=Ir(e);s<u.length;s++){var a=u[s],c=Lf(a,t,i);if(0!==c)return c;o=o||a.field.isKeyField()}return 0}}function Lf(e,t,i){var s,a,c,h,o=e.field.isKeyField()?k.comparator(t.key,i.key):(a=i,c=t.data.field(s=e.field),h=a.data.field(s),null!==c&&null!==h?Er(c,h):F());switch(e.dir){case"asc":return o;case"desc":return-1*o;default:return F()}}function _c(e,t){if(e.I){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:jo(t)?"-0":t}}function bc(e){return{integerValue:""+e}}function wc(e,t){return sc(t)?bc(t):_c(e,t)}var $o=function(){this._=void 0};function Uf(e,t,i){return e instanceof Ar?(u={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:(o=i).seconds,nanos:o.nanoseconds}}}},(s=t)&&(u.fields.__previous_value__=s),{mapValue:u}):e instanceof Dn?Cc(e,t):e instanceof Nn?Tc(e,t):function(o,s){var u=Ec(o,s),a=Ic(u)+Ic(o.A);return au(u)&&au(o.A)?bc(a):_c(o.R,a)}(e,t);var o,s,u}function Gf(e,t,i){return e instanceof Dn?Cc(e,t):e instanceof Nn?Tc(e,t):i}function Ec(e,t){return e instanceof Sr?au(i=t)||(o=i)&&"doubleValue"in o?t:{integerValue:0}:null;var o,i}var Ar=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,v.ZT)(t,e),t}($o),Dn=function(e){function t(i){var o=this;return(o=e.call(this)||this).elements=i,o}return(0,v.ZT)(t,e),t}($o);function Cc(e,t){for(var i=Ac(t),o=function(a){i.some(function(c){return pe(c,a)})||i.push(a)},s=0,u=e.elements;s<u.length;s++)o(u[s]);return{arrayValue:{values:i}}}var Nn=function(e){function t(i){var o=this;return(o=e.call(this)||this).elements=i,o}return(0,v.ZT)(t,e),t}($o);function Tc(e,t){for(var i=Ac(t),o=function(a){i=i.filter(function(c){return!pe(c,a)})},s=0,u=e.elements;s<u.length;s++)o(u[s]);return{arrayValue:{values:i}}}var Sr=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).R=i,s.A=o,s}return(0,v.ZT)(t,e),t}($o);function Ic(e){return ft(e.integerValue||e.doubleValue)}function Ac(e){return cu(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var ji=function(e,t){this.field=e,this.transform=t},qf=function(e,t){this.version=e,this.transformResults=t},Ot=function(){function e(t,i){this.updateTime=t,this.exists=i}return e.none=function(){return new e},e.exists=function(t){return new e(void 0,t)},e.updateTime=function(t){return new e(t)},Object.defineProperty(e.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},e}();function Zo(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var Xo=function(){};function Bf(e,t,i){var o,s,u,a,c;e instanceof Ki?(s=t,u=i,a=(o=e).value.clone(),c=Vc(o.fieldTransforms,s,u.transformResults),a.setAll(c),s.convertToFoundDocument(u.version,a).setHasCommittedMutations()):e instanceof We?function(o,s,u){if(Zo(o.precondition,s)){var a=Vc(o.fieldTransforms,s,u.transformResults),c=s.data;c.setAll(Nc(o)),c.setAll(a),s.convertToFoundDocument(u.version,c).setHasCommittedMutations()}else s.convertToUnknownDocument(u.version)}(e,t,i):function(o,s,u){s.convertToNoDocument(u.version).setHasCommittedMutations()}(0,t,i)}function pu(e,t,i){var s;e instanceof Ki?function(o,s,u){if(Zo(o.precondition,s)){var a=o.value.clone(),c=Mc(o.fieldTransforms,u,s);a.setAll(c),s.convertToFoundDocument(Dc(s),a).setHasLocalMutations()}}(e,t,i):e instanceof We?function(o,s,u){if(Zo(o.precondition,s)){var a=Mc(o.fieldTransforms,u,s),c=s.data;c.setAll(Nc(o)),c.setAll(a),s.convertToFoundDocument(Dc(s),c).setHasLocalMutations()}}(e,t,i):Zo(e.precondition,s=t)&&s.convertToNoDocument(j.min())}function jf(e,t){for(var i=null,o=0,s=e.fieldTransforms;o<s.length;o++){var u=s[o],a=t.data.field(u.field),c=Ec(u.transform,a||null);null!=c&&(null==i&&(i=Jt.empty()),i.set(u.field,c))}return i||null}function Sc(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(o=t.fieldTransforms,!!(void 0===(i=e.fieldTransforms)&&void 0===o||i&&o&&_r(i,o,function(s,u){return(a=s).field.isEqual((c=u).field)&&(p=c.transform,(h=a.transform)instanceof Dn&&p instanceof Dn||h instanceof Nn&&p instanceof Nn?_r(h.elements,p.elements,pe):h instanceof Sr&&p instanceof Sr?pe(h.A,p.A):h instanceof Ar&&p instanceof Ar);var a,c,h,p})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask));var i,o}function Dc(e){return e.isFoundDocument()?e.version:j.min()}var Ki=function(e){function t(i,o,s,u){void 0===u&&(u=[]);var a=this;return(a=e.call(this)||this).key=i,a.value=o,a.precondition=s,a.fieldTransforms=u,a.type=0,a}return(0,v.ZT)(t,e),t}(Xo),We=function(e){function t(i,o,s,u,a){void 0===a&&(a=[]);var c=this;return(c=e.call(this)||this).key=i,c.data=o,c.fieldMask=s,c.precondition=u,c.fieldTransforms=a,c.type=1,c}return(0,v.ZT)(t,e),t}(Xo);function Nc(e){var t=new Map;return e.fieldMask.fields.forEach(function(i){if(!i.isEmpty()){var o=e.data.field(i);t.set(i,o)}}),t}function Vc(e,t,i){var o=new Map;q(e.length===i.length);for(var s=0;s<i.length;s++){var u=e[s],a=u.transform,c=t.data.field(u.field);o.set(u.field,Gf(a,c,i[s]))}return o}function Mc(e,t,i){for(var o=new Map,s=0,u=e;s<u.length;s++){var a=u[s],c=a.transform,h=i.data.field(a.field);o.set(a.field,Uf(c,h,t))}return o}var dt,J,Hi=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).key=i,s.precondition=o,s.type=2,s.fieldTransforms=[],s}return(0,v.ZT)(t,e),t}(Xo),gu=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).key=i,s.precondition=o,s.type=3,s.fieldTransforms=[],s}return(0,v.ZT)(t,e),t}(Xo),Kf=function(e){this.count=e};function Oc(e){switch(e){case C.OK:return F();case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return F()}}function xc(e){if(void 0===e)return ht("GRPC error has no .code"),C.UNKNOWN;switch(e){case dt.OK:return C.OK;case dt.CANCELLED:return C.CANCELLED;case dt.UNKNOWN:return C.UNKNOWN;case dt.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case dt.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case dt.INTERNAL:return C.INTERNAL;case dt.UNAVAILABLE:return C.UNAVAILABLE;case dt.UNAUTHENTICATED:return C.UNAUTHENTICATED;case dt.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case dt.NOT_FOUND:return C.NOT_FOUND;case dt.ALREADY_EXISTS:return C.ALREADY_EXISTS;case dt.PERMISSION_DENIED:return C.PERMISSION_DENIED;case dt.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case dt.ABORTED:return C.ABORTED;case dt.OUT_OF_RANGE:return C.OUT_OF_RANGE;case dt.UNIMPLEMENTED:return C.UNIMPLEMENTED;case dt.DATA_LOSS:return C.DATA_LOSS;default:return F()}}(J=dt||(dt={}))[J.OK=0]="OK",J[J.CANCELLED=1]="CANCELLED",J[J.UNKNOWN=2]="UNKNOWN",J[J.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",J[J.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",J[J.NOT_FOUND=5]="NOT_FOUND",J[J.ALREADY_EXISTS=6]="ALREADY_EXISTS",J[J.PERMISSION_DENIED=7]="PERMISSION_DENIED",J[J.UNAUTHENTICATED=16]="UNAUTHENTICATED",J[J.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",J[J.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",J[J.ABORTED=10]="ABORTED",J[J.OUT_OF_RANGE=11]="OUT_OF_RANGE",J[J.UNIMPLEMENTED=12]="UNIMPLEMENTED",J[J.INTERNAL=13]="INTERNAL",J[J.UNAVAILABLE=14]="UNAVAILABLE",J[J.DATA_LOSS=15]="DATA_LOSS";var xt=function(){function e(t,i){this.comparator=t,this.root=i||Ye.EMPTY}return e.prototype.insert=function(t,i){return new e(this.comparator,this.root.insert(t,i,this.comparator).copy(null,null,Ye.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ye.BLACK,null,null))},e.prototype.get=function(t){for(var i=this.root;!i.isEmpty();){var o=this.comparator(t,i.key);if(0===o)return i.value;o<0?i=i.left:o>0&&(i=i.right)}return null},e.prototype.indexOf=function(t){for(var i=0,o=this.root;!o.isEmpty();){var s=this.comparator(t,o.key);if(0===s)return i+o.left.size;s<0?o=o.left:(i+=o.left.size+1,o=o.right)}return-1},e.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(e.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),e.prototype.minKey=function(){return this.root.minKey()},e.prototype.maxKey=function(){return this.root.maxKey()},e.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},e.prototype.forEach=function(t){this.inorderTraversal(function(i,o){return t(i,o),!1})},e.prototype.toString=function(){var t=[];return this.inorderTraversal(function(i,o){return t.push(i+":"+o),!1}),"{"+t.join(", ")+"}"},e.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},e.prototype.getIterator=function(){return new ts(this.root,null,this.comparator,!1)},e.prototype.getIteratorFrom=function(t){return new ts(this.root,t,this.comparator,!1)},e.prototype.getReverseIterator=function(){return new ts(this.root,null,this.comparator,!0)},e.prototype.getReverseIteratorFrom=function(t){return new ts(this.root,t,this.comparator,!0)},e}(),ts=function(){function e(t,i,o,s){this.isReverse=s,this.nodeStack=[];for(var u=1;!t.isEmpty();)if(u=i?o(t.key,i):1,s&&(u*=-1),u<0)t=this.isReverse?t.left:t.right;else{if(0===u){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return e.prototype.getNext=function(){var t=this.nodeStack.pop(),i={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return i},e.prototype.hasNext=function(){return this.nodeStack.length>0},e.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},e}(),Ye=function(){function e(t,i,o,s,u){this.key=t,this.value=i,this.color=null!=o?o:e.RED,this.left=null!=s?s:e.EMPTY,this.right=null!=u?u:e.EMPTY,this.size=this.left.size+1+this.right.size}return e.prototype.copy=function(t,i,o,s,u){return new e(null!=t?t:this.key,null!=i?i:this.value,null!=o?o:this.color,null!=s?s:this.left,null!=u?u:this.right)},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},e.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},e.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},e.prototype.minKey=function(){return this.min().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(t,i,o){var s=this,u=o(t,s.key);return(s=u<0?s.copy(null,null,null,s.left.insert(t,i,o),null):0===u?s.copy(null,i,null,null,null):s.copy(null,null,null,null,s.right.insert(t,i,o))).fixUp()},e.prototype.removeMin=function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},e.prototype.remove=function(t,i){var o,s=this;if(i(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===i(t,s.key)){if(s.right.isEmpty())return e.EMPTY;o=s.right.min(),s=s.copy(o.key,o.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp()},e.prototype.isRed=function(){return this.color},e.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},e.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},e.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},e.prototype.rotateLeft=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)},e.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},e.prototype.check=function(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw F();var t=this.left.check();if(t!==this.right.check())throw F();return t+(this.isRed()?0:1)},e}();Ye.EMPTY=null,Ye.RED=!0,Ye.BLACK=!1,Ye.EMPTY=new(function(){function e(){this.size=0}return Object.defineProperty(e.prototype,"key",{get:function(){throw F()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){throw F()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){throw F()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){throw F()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){throw F()},enumerable:!1,configurable:!0}),e.prototype.copy=function(t,i,o,s,u){return this},e.prototype.insert=function(t,i,o){return new Ye(t,i)},e.prototype.remove=function(t,i){return this},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(t){return!1},e.prototype.reverseTraversal=function(t){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.isRed=function(){return!1},e.prototype.checkMaxDepth=function(){return!0},e.prototype.check=function(){return 0},e}());var vt=function(){function e(t){this.comparator=t,this.data=new xt(this.comparator)}return e.prototype.has=function(t){return null!==this.data.get(t)},e.prototype.first=function(){return this.data.minKey()},e.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(e.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),e.prototype.indexOf=function(t){return this.data.indexOf(t)},e.prototype.forEach=function(t){this.data.inorderTraversal(function(i,o){return t(i),!1})},e.prototype.forEachInRange=function(t,i){for(var o=this.data.getIteratorFrom(t[0]);o.hasNext();){var s=o.getNext();if(this.comparator(s.key,t[1])>=0)return;i(s.key)}},e.prototype.forEachWhile=function(t,i){var o;for(o=void 0!==i?this.data.getIteratorFrom(i):this.data.getIterator();o.hasNext();)if(!t(o.getNext().key))return},e.prototype.firstAfterOrEqual=function(t){var i=this.data.getIteratorFrom(t);return i.hasNext()?i.getNext().key:null},e.prototype.getIterator=function(){return new Fc(this.data.getIterator())},e.prototype.getIteratorFrom=function(t){return new Fc(this.data.getIteratorFrom(t))},e.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},e.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},e.prototype.isEmpty=function(){return this.data.isEmpty()},e.prototype.unionWith=function(t){var i=this;return i.size<t.size&&(i=t,t=this),t.forEach(function(o){i=i.add(o)}),i},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var i=this.data.getIterator(),o=t.data.getIterator();i.hasNext();){var s=i.getNext().key,u=o.getNext().key;if(0!==this.comparator(s,u))return!1}return!0},e.prototype.toArray=function(){var t=[];return this.forEach(function(i){t.push(i)}),t},e.prototype.toString=function(){var t=[];return this.forEach(function(i){return t.push(i)}),"SortedSet("+t.toString()+")"},e.prototype.copy=function(t){var i=new e(this.comparator);return i.data=t,i},e}(),Fc=function(){function e(t){this.iter=t}return e.prototype.getNext=function(){return this.iter.getNext().key},e.prototype.hasNext=function(){return this.iter.hasNext()},e}(),Hf=new xt(k.comparator);function re(){return Hf}var Jf=new xt(k.comparator);function mu(){return Jf}var zf=new xt(k.comparator);function kc(){return zf}var Qf=new vt(k.comparator);function Y(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=Qf,o=0,s=e;o<s.length;o++){var u=s[o];i=i.add(u)}return i}var Wf=new vt(H);function es(){return Wf}var yu=function(){function e(t,i,o,s,u){this.snapshotVersion=t,this.targetChanges=i,this.targetMismatches=o,this.documentUpdates=s,this.resolvedLimboDocuments=u}return e.createSynthesizedRemoteEventForCurrentChange=function(t,i){var o=new Map;return o.set(t,vu.createSynthesizedTargetChangeForCurrentChange(t,i)),new e(j.min(),o,es(),re(),Y())},e}(),vu=function(){function e(t,i,o,s,u){this.resumeToken=t,this.current=i,this.addedDocuments=o,this.modifiedDocuments=s,this.removedDocuments=u}return e.createSynthesizedTargetChangeForCurrentChange=function(t,i){return new e(Lt.EMPTY_BYTE_STRING,i,Y(),Y(),Y())},e}(),ns=function(e,t,i,o){this.v=e,this.removedTargetIds=t,this.key=i,this.P=o},Rc=function(e,t){this.targetId=e,this.V=t},Pc=function(e,t,i,o){void 0===i&&(i=Lt.EMPTY_BYTE_STRING),void 0===o&&(o=null),this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=o},Lc=function(){function e(){this.S=0,this.D=Gc(),this.C=Lt.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(e.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),e.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},e.prototype.M=function(){var t=Y(),i=Y(),o=Y();return this.D.forEach(function(s,u){switch(u){case 0:t=t.add(s);break;case 2:i=i.add(s);break;case 1:o=o.add(s);break;default:F()}}),new vu(this.C,this.N,t,i,o)},e.prototype.L=function(){this.k=!1,this.D=Gc()},e.prototype.B=function(t,i){this.k=!0,this.D=this.D.insert(t,i)},e.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},e.prototype.U=function(){this.S+=1},e.prototype.K=function(){this.S-=1},e.prototype.j=function(){this.k=!0,this.N=!0},e}(),Yf=function(){function e(t){this.W=t,this.G=new Map,this.H=re(),this.J=Uc(),this.Y=new vt(H)}return e.prototype.X=function(t){for(var i=0,o=t.v;i<o.length;i++){var s=o[i];t.P&&t.P.isFoundDocument()?this.Z(s,t.P):this.tt(s,t.key,t.P)}for(var u=0,a=t.removedTargetIds;u<a.length;u++)this.tt(s=a[u],t.key,t.P)},e.prototype.et=function(t){var i=this;this.forEachTarget(t,function(o){var s=i.nt(o);switch(t.state){case 0:i.st(o)&&s.O(t.resumeToken);break;case 1:s.K(),s.F||s.L(),s.O(t.resumeToken);break;case 2:s.K(),s.F||i.removeTarget(o);break;case 3:i.st(o)&&(s.j(),s.O(t.resumeToken));break;case 4:i.st(o)&&(i.it(o),s.O(t.resumeToken));break;default:F()}})},e.prototype.forEachTarget=function(t,i){var o=this;t.targetIds.length>0?t.targetIds.forEach(i):this.G.forEach(function(s,u){o.st(u)&&i(u)})},e.prototype.rt=function(t){var i=t.targetId,o=t.V.count,s=this.ot(i);if(s){var u=s.target;if(zo(u))if(0===o){var a=new k(u.path);this.tt(i,a,St.newNoDocument(a,j.min()))}else q(1===o);else this.ct(i)!==o&&(this.it(i),this.Y=this.Y.add(i))}},e.prototype.ut=function(t){var i=this,o=new Map;this.G.forEach(function(a,c){var h=i.ot(c);if(h){if(a.current&&zo(h.target)){var p=new k(h.target.path);null!==i.H.get(p)||i.at(c,p)||i.tt(c,p,St.newNoDocument(p,t))}a.$&&(o.set(c,a.M()),a.L())}});var s=Y();this.J.forEach(function(a,c){var h=!0;c.forEachWhile(function(p){var g=i.ot(p);return!g||2===g.purpose||(h=!1,!1)}),h&&(s=s.add(a))});var u=new yu(t,o,this.Y,this.H,s);return this.H=re(),this.J=Uc(),this.Y=new vt(H),u},e.prototype.Z=function(t,i){if(this.st(t)){var o=this.at(t,i.key)?2:0;this.nt(t).B(i.key,o),this.H=this.H.insert(i.key,i),this.J=this.J.insert(i.key,this.ht(i.key).add(t))}},e.prototype.tt=function(t,i,o){if(this.st(t)){var s=this.nt(t);this.at(t,i)?s.B(i,1):s.q(i),this.J=this.J.insert(i,this.ht(i).delete(t)),o&&(this.H=this.H.insert(i,o))}},e.prototype.removeTarget=function(t){this.G.delete(t)},e.prototype.ct=function(t){var i=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+i.addedDocuments.size-i.removedDocuments.size},e.prototype.U=function(t){this.nt(t).U()},e.prototype.nt=function(t){var i=this.G.get(t);return i||(i=new Lc,this.G.set(t,i)),i},e.prototype.ht=function(t){var i=this.J.get(t);return i||(i=new vt(H),this.J=this.J.insert(t,i)),i},e.prototype.st=function(t){var i=null!==this.ot(t);return i||N("WatchChangeAggregator","Detected inactive target",t),i},e.prototype.ot=function(t){var i=this.G.get(t);return i&&i.F?null:this.W.lt(t)},e.prototype.it=function(t){var i=this;this.G.set(t,new Lc),this.W.getRemoteKeysForTarget(t).forEach(function(o){i.tt(t,o,null)})},e.prototype.at=function(t,i){return this.W.getRemoteKeysForTarget(t).has(i)},e}();function Uc(){return new xt(k.comparator)}function Gc(){return new xt(k.comparator)}var $f={asc:"ASCENDING",desc:"DESCENDING"},Zf={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Xf=function(e,t){this.databaseId=e,this.I=t};function Ji(e,t){return e.I?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}}function qc(e,t){return e.I?t.toBase64():t.toUint8Array()}function td(e,t){return Ji(e,t.toTimestamp())}function wt(e){return q(!!e),j.fromTimestamp((i=Qe(e),new Gt(i.seconds,i.nanos)));var i}function _u(e,t){return(i=e,new Q(["projects",i.projectId,"databases",i.database])).child("documents").child(t).canonicalString();var i}function Bc(e){var t=Q.fromString(e);return q(tl(t)),t}function zi(e,t){return _u(e.databaseId,t.path)}function ge(e,t){var i=Bc(t);if(i.get(1)!==e.databaseId.projectId)throw new A(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+e.databaseId.projectId);if(i.get(3)!==e.databaseId.database)throw new A(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+e.databaseId.database);return new k(Kc(i))}function bu(e,t){return _u(e.databaseId,t)}function jc(e){var t=Bc(e);return 4===t.length?Q.emptyPath():Kc(t)}function Qi(e){return new Q(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Kc(e){return q(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Hc(e,t,i){return{name:zi(e,t),fields:i.value.mapValue.fields}}function Jc(e,t,i){var o=ge(e,t.name),s=wt(t.updateTime),u=new Jt({mapValue:{fields:t.fields}}),a=St.newFoundDocument(o,s,u);return i&&a.setHasCommittedMutations(),i?a.setHasCommittedMutations():a}function rs(e,t){var i,s;if(t instanceof Ki)i={update:Hc(e,t.key,t.value)};else if(t instanceof Hi)i={delete:zi(e,t.key)};else if(t instanceof We)i={update:Hc(e,t.key,t.data),updateMask:od(t.fieldMask)};else{if(!(t instanceof gu))return F();i={verify:zi(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(function(o){return function(s,u){var a=u.transform;if(a instanceof Ar)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Dn)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Nn)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Sr)return{fieldPath:u.field.canonicalString(),increment:a.A};throw F()}(0,o)})),t.precondition.isNone||(i.currentDocument=void 0!==(s=t.precondition).updateTime?{updateTime:td(e,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:F()),i}function zc(e,t){var p,i=t.currentDocument?void 0!==(p=t.currentDocument).updateTime?Ot.updateTime(wt(p.updateTime)):void 0!==p.exists?Ot.exists(p.exists):Ot.none():Ot.none(),o=t.updateTransforms?t.updateTransforms.map(function(p){return function(g,_){var b=null;"setToServerValue"in _?(q("REQUEST_TIME"===_.setToServerValue),b=new Ar):"appendMissingElements"in _?b=new Dn(_.appendMissingElements.values||[]):"removeAllFromArray"in _?b=new Nn(_.removeAllFromArray.values||[]):"increment"in _?b=new Sr(g,_.increment):F();var T=ue.fromServerFormat(_.fieldPath);return new ji(T,b)}(e,p)}):[];if(t.update){var s=ge(e,t.update.name),u=new Jt({mapValue:{fields:t.update.fields}});if(t.updateMask){var a=function(p){return new br((p.fieldPaths||[]).map(function(_){return ue.fromServerFormat(_)}))}(t.updateMask);return new We(s,u,a,i,o)}return new Ki(s,u,i,o)}if(t.delete){var c=ge(e,t.delete);return new Hi(c,i)}if(t.verify){var h=ge(e,t.verify);return new gu(h,i)}return F()}function Qc(e,t){return{documents:[bu(e,t.path)]}}function Wc(e,t){var i={structuredQuery:{}},o=t.path;null!==t.collectionGroup?(i.parent=bu(e,o),i.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i.parent=bu(e,o.popLast()),i.structuredQuery.from=[{collectionId:o.lastSegment()}]);var s=function(c){if(0!==c.length){var h=c.map(function(p){return function(g){if("=="===g.op){if(cc(g.value))return{unaryFilter:{field:Dr(g.field),op:"IS_NAN"}};if(ac(g.value))return{unaryFilter:{field:Dr(g.field),op:"IS_NULL"}}}else if("!="===g.op){if(cc(g.value))return{unaryFilter:{field:Dr(g.field),op:"IS_NOT_NAN"}};if(ac(g.value))return{unaryFilter:{field:Dr(g.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dr(g.field),op:nd(g.op),value:g.value}}}(p)});return 1===h.length?h[0]:{compositeFilter:{op:"AND",filters:h}}}}(t.filters);s&&(i.structuredQuery.where=s);var u=function(c){if(0!==c.length)return c.map(function(h){return{field:Dr((p=h).field),direction:ed(p.dir)};var p})}(t.orderBy);u&&(i.structuredQuery.orderBy=u);var h,a=(h=t.limit,e.I||An(h)?h:{value:h});return null!==a&&(i.structuredQuery.limit=a),t.startAt&&(i.structuredQuery.startAt=Zc(t.startAt)),t.endAt&&(i.structuredQuery.endAt=Zc(t.endAt)),i}function Yc(e){var t=jc(e.parent),i=e.structuredQuery,o=i.from?i.from.length:0,s=null;if(o>0){q(1===o);var u=i.from[0];u.allDescendants?s=u.collectionId:t=t.child(u.collectionId)}var a=[];i.where&&(a=$c(i.where));var c=[];i.orderBy&&(c=i.orderBy.map(function(_){return new Cr(Nr((b=_).field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(b.direction));var b}));var _,b,h=null;i.limit&&(h=An(b="object"==typeof(_=i.limit)?_.value:_)?null:b);var p=null;i.startAt&&(p=Xc(i.startAt));var g=null;return i.endAt&&(g=Xc(i.endAt)),gc(t,s,c,a,h,"F",p,g)}function $c(e){return e?void 0!==e.unaryFilter?[id(e)]:void 0!==e.fieldFilter?[rd(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(function(t){return $c(t)}).reduce(function(t,i){return t.concat(i)}):F():[]}function Zc(e){return{before:e.before,values:e.position}}function Xc(e){return new Gi(e.values||[],!!e.before)}function ed(e){return $f[e]}function nd(e){return Zf[e]}function Dr(e){return{fieldPath:e.canonicalString()}}function Nr(e){return ue.fromServerFormat(e.fieldPath)}function rd(e){return zt.create(Nr(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return F()}}(e.fieldFilter.op),e.fieldFilter.value)}function id(e){switch(e.unaryFilter.op){case"IS_NAN":var t=Nr(e.unaryFilter.field);return zt.create(t,"==",{doubleValue:NaN});case"IS_NULL":var i=Nr(e.unaryFilter.field);return zt.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var o=Nr(e.unaryFilter.field);return zt.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var s=Nr(e.unaryFilter.field);return zt.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return F()}}function od(e){var t=[];return e.fields.forEach(function(i){return t.push(i.canonicalString())}),{fieldPaths:t}}function tl(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function ae(e){for(var t="",i=0;i<e.length;i++)t.length>0&&(t=el(t)),t=sd(e.get(i),t);return el(t)}function sd(e,t){for(var i=t,o=e.length,s=0;s<o;s++){var u=e.charAt(s);switch(u){case"\0":i+="\x01\x10";break;case"\x01":i+="\x01\x11";break;default:i+=u}}return i}function el(e){return e+"\x01\x01"}function De(e){var t=e.length;if(q(t>=2),2===t)return q("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),Q.emptyPath();for(var i=t-2,o=[],s="",u=0;u<t;){var a=e.indexOf("\x01",u);switch((a<0||a>i)&&F(),e.charAt(a+1)){case"\x01":var c=e.substring(u,a),h=void 0;0===s.length?h=c:(h=s+=c,s=""),o.push(h);break;case"\x10":s+=e.substring(u,a),s+="\0";break;case"\x11":s+=e.substring(u,a+1);break;default:F()}u=a+2}return new Q(o)}var ud=function(e,t){this.seconds=e,this.nanoseconds=t},Qt=function(e,t,i){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=i};Qt.store="owner",Qt.key="owner";var $e=function(e,t,i){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=i};$e.store="mutationQueues",$e.keyPath="userId";var tt=function(e,t,i,o,s){this.userId=e,this.batchId=t,this.localWriteTimeMs=i,this.baseMutations=o,this.mutations=s};tt.store="mutations",tt.keyPath="batchId",tt.userMutationsIndex="userMutationsIndex",tt.userMutationsKeyPath=["userId","batchId"];var Ft=function(){function e(){}return e.prefixForUser=function(t){return[t]},e.prefixForPath=function(t,i){return[t,ae(i)]},e.key=function(t,i,o){return[t,ae(i),o]},e}();Ft.store="documentMutations",Ft.PLACEHOLDER=new Ft;var ad=function(e,t){this.path=e,this.readTime=t},cd=function(e,t){this.path=e,this.version=t},ut=function(e,t,i,o,s,u){this.unknownDocument=e,this.noDocument=t,this.document=i,this.hasCommittedMutations=o,this.readTime=s,this.parentPath=u};ut.store="remoteDocuments",ut.readTimeIndex="readTimeIndex",ut.readTimeIndexPath="readTime",ut.collectionReadTimeIndex="collectionReadTimeIndex",ut.collectionReadTimeIndexPath=["parentPath","readTime"];var me=function(e){this.byteSize=e};me.store="remoteDocumentGlobal",me.key="remoteDocumentGlobalKey";var qt=function(e,t,i,o,s,u,a){this.targetId=e,this.canonicalId=t,this.readTime=i,this.resumeToken=o,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=u,this.query=a};qt.store="targets",qt.keyPath="targetId",qt.queryTargetsIndexName="queryTargetsIndex",qt.queryTargetsKeyPath=["canonicalId","targetId"];var Dt=function(e,t,i){this.targetId=e,this.path=t,this.sequenceNumber=i};Dt.store="targetDocuments",Dt.keyPath=["targetId","path"],Dt.documentTargetsIndex="documentTargetsIndex",Dt.documentTargetsKeyPath=["path","targetId"];var Wt=function(e,t,i,o){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=i,this.targetCount=o};Wt.key="targetGlobalKey",Wt.store="targetGlobal";var Vn=function(e,t){this.collectionId=e,this.parent=t};Vn.store="collectionParents",Vn.keyPath=["collectionId","parent"];var Ne=function(e,t,i,o){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=i,this.inForeground=o};Ne.store="clientMetadata",Ne.keyPath="clientId";var Vr=function(e,t,i){this.bundleId=e,this.createTime=t,this.version=i};Vr.store="bundles",Vr.keyPath="bundleId";var Mr=function(e,t,i){this.name=e,this.readTime=t,this.bundledQuery=i};Mr.store="namedQueries",Mr.keyPath="name";var ld=(0,v.ev)((0,v.ev)([],(0,v.ev)((0,v.ev)([],(0,v.ev)((0,v.ev)([],(0,v.ev)((0,v.ev)([],[$e.store,tt.store,Ft.store,ut.store,qt.store,Qt.store,Wt.store,Dt.store]),[Ne.store])),[me.store])),[Vn.store])),[Vr.store,Mr.store]),nl="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",rl=function(){function e(){this.onCommittedListeners=[]}return e.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},e.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},e}(),kt=function(){var e=this;this.promise=new Promise(function(t,i){e.resolve=t,e.reject=i})},S=function(){function e(t){var i=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(o){i.isDone=!0,i.result=o,i.nextCallback&&i.nextCallback(o)},function(o){i.isDone=!0,i.error=o,i.catchCallback&&i.catchCallback(o)})}return e.prototype.catch=function(t){return this.next(void 0,t)},e.prototype.next=function(t,i){var o=this;return this.callbackAttached&&F(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(t,this.result):new e(function(s,u){o.nextCallback=function(a){o.wrapSuccess(t,a).next(s,u)},o.catchCallback=function(a){o.wrapFailure(i,a).next(s,u)}})},e.prototype.toPromise=function(){var t=this;return new Promise(function(i,o){t.next(i,o)})},e.prototype.wrapUserFunction=function(t){try{var i=t();return i instanceof e?i:e.resolve(i)}catch(o){return e.reject(o)}},e.prototype.wrapSuccess=function(t,i){return t?this.wrapUserFunction(function(){return t(i)}):e.resolve(i)},e.prototype.wrapFailure=function(t,i){return t?this.wrapUserFunction(function(){return t(i)}):e.reject(i)},e.resolve=function(t){return new e(function(i,o){i(t)})},e.reject=function(t){return new e(function(i,o){o(t)})},e.waitFor=function(t){return new e(function(i,o){var s=0,u=0,a=!1;t.forEach(function(c){++s,c.next(function(){++u,a&&u===s&&i()},function(h){return o(h)})}),a=!0,u===s&&i()})},e.or=function(t){for(var i=e.resolve(!1),o=function(a){i=i.next(function(c){return c?e.resolve(c):a()})},s=0,u=t;s<u.length;s++)o(u[s]);return i},e.forEach=function(t,i){var o=this,s=[];return t.forEach(function(u,a){s.push(i.call(o,u,a))}),this.waitFor(s)},e}(),il=function(){function e(t,i){var o=this;this.action=t,this.transaction=i,this.aborted=!1,this.ft=new kt,this.transaction.oncomplete=function(){o.ft.resolve()},this.transaction.onabort=function(){i.error?o.ft.reject(new Wi(t,i.error)):o.ft.resolve()},this.transaction.onerror=function(s){var u=wu(s.target.error);o.ft.reject(new Wi(t,u))}}return e.open=function(t,i,o,s){try{return new e(i,t.transaction(s,o))}catch(u){throw new Wi(i,u)}},Object.defineProperty(e.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),e.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(N("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},e.prototype.store=function(t){var i=this.transaction.objectStore(t);return new fd(i)},e}(),Or=function(){function e(t,i,o){this.name=t,this.version=i,this.wt=o,12.2===e._t((0,U.z$)())&&ht("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return N("SimpleDb","Removing database:",t),On(window.indexedDB.deleteDatabase(t)).toPromise()},e.yt=function(){if("undefined"==typeof indexedDB)return!1;if(e.gt())return!0;var t=(0,U.z$)(),i=e._t(t),o=0<i&&i<10,s=e.Et(t),u=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||o||u)},e.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},e.It=function(t,i){return t.store(i)},e._t=function(t){var i=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),o=i?i[1].split("_").slice(0,2).join("."):"-1";return Number(o)},e.Et=function(t){var i=t.match(/Android ([\d.]+)/i),o=i?i[1].split(".").slice(0,2).join("."):"-1";return Number(o)},e.prototype.At=function(t){return(0,v.mG)(this,void 0,void 0,function(){var i,o=this;return(0,v.Jh)(this,function(s){switch(s.label){case 0:return this.db?[3,2]:(N("SimpleDb","Opening database:",this.name),i=this,[4,new Promise(function(u,a){var c=indexedDB.open(o.name,o.version);c.onsuccess=function(h){u(h.target.result)},c.onblocked=function(){a(new Wi(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},c.onerror=function(h){var p=h.target.error;a("VersionError"===p.name?new A(C.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Wi(t,p))},c.onupgradeneeded=function(h){N("SimpleDb",'Database "'+o.name+'" requires upgrade from version:',h.oldVersion),o.wt.Rt(h.target.result,c.transaction,h.oldVersion,o.version).next(function(){N("SimpleDb","Database upgrade to version "+o.version+" complete")})}})]);case 1:i.db=s.sent(),s.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(u){return o.bt(u)}),this.db)]}})})},e.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(i){return t(i)})},e.prototype.runTransaction=function(t,i,o,s){return(0,v.mG)(this,void 0,void 0,function(){var u,a,c,h,p;return(0,v.Jh)(this,function(g){switch(g.label){case 0:u="readonly"===i,a=0,c=function(){var _,b,w,E,T;return(0,v.Jh)(this,function(D){switch(D.label){case 0:++a,D.label=1;case 1:return D.trys.push([1,4,,5]),[4,h.At(t)];case 2:return h.db=D.sent(),_=il.open(h.db,t,u?"readonly":"readwrite",o),b=s(_).catch(function(V){return _.abort(V),S.reject(V)}).toPromise(),w={},b.catch(function(){}),[4,_.dt];case 3:return[2,(w.value=(D.sent(),b),w)];case 4:return N("SimpleDb","Transaction failed with error:",(E=D.sent()).message,"Retrying:",T="FirebaseError"!==E.name&&a<3),h.close(),T?[3,5]:[2,{value:Promise.reject(E)}];case 5:return[2]}})},h=this,g.label=1;case 1:return[5,c()];case 2:if("object"==typeof(p=g.sent()))return[2,p.value];g.label=3;case 3:return[3,1];case 4:return[2]}})})},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),hd=function(){function e(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(e.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),e.prototype.done=function(){this.Vt=!0},e.prototype.Ct=function(t){this.St=t},e.prototype.delete=function(){return On(this.Pt.delete())},e}(),Wi=function(e){function t(i,o){var s=this;return(s=e.call(this,C.UNAVAILABLE,"IndexedDB transaction '"+i+"' failed: "+o)||this).name="IndexedDbTransactionError",s}return(0,v.ZT)(t,e),t}(A);function Mn(e){return"IndexedDbTransactionError"===e.name}var fd=function(){function e(t){this.store=t}return e.prototype.put=function(t,i){var o;return void 0!==i?(N("SimpleDb","PUT",this.store.name,t,i),o=this.store.put(i,t)):(N("SimpleDb","PUT",this.store.name,"<auto-key>",t),o=this.store.put(t)),On(o)},e.prototype.add=function(t){return N("SimpleDb","ADD",this.store.name,t,t),On(this.store.add(t))},e.prototype.get=function(t){var i=this;return On(this.store.get(t)).next(function(o){return void 0===o&&(o=null),N("SimpleDb","GET",i.store.name,t,o),o})},e.prototype.delete=function(t){return N("SimpleDb","DELETE",this.store.name,t),On(this.store.delete(t))},e.prototype.count=function(){return N("SimpleDb","COUNT",this.store.name),On(this.store.count())},e.prototype.Nt=function(t,i){var o=this.cursor(this.options(t,i)),s=[];return this.xt(o,function(u,a){s.push(a)}).next(function(){return s})},e.prototype.kt=function(t,i){N("SimpleDb","DELETE ALL",this.store.name);var o=this.options(t,i);o.Ft=!1;var s=this.cursor(o);return this.xt(s,function(u,a,c){return c.delete()})},e.prototype.$t=function(t,i){var o;i?o=t:(o={},i=t);var s=this.cursor(o);return this.xt(s,i)},e.prototype.Ot=function(t){var i=this.cursor({});return new S(function(o,s){i.onerror=function(u){var a=wu(u.target.error);s(a)},i.onsuccess=function(u){var a=u.target.result;a?t(a.primaryKey,a.value).next(function(c){c?a.continue():o()}):o()}})},e.prototype.xt=function(t,i){var o=[];return new S(function(s,u){t.onerror=function(a){u(a.target.error)},t.onsuccess=function(a){var c=a.target.result;if(c){var h=new hd(c),p=i(c.primaryKey,c.value,h);if(p instanceof S){var g=p.catch(function(_){return h.done(),S.reject(_)});o.push(g)}h.isDone?s():null===h.Dt?c.continue():c.continue(h.Dt)}else s()}}).next(function(){return S.waitFor(o)})},e.prototype.options=function(t,i){var o;return void 0!==t&&("string"==typeof t?o=t:i=t),{index:o,range:i}},e.prototype.cursor=function(t){var i="next";if(t.reverse&&(i="prev"),t.index){var o=this.store.index(t.index);return t.Ft?o.openKeyCursor(t.range,i):o.openCursor(t.range,i)}return this.store.openCursor(t.range,i)},e}();function On(e){return new S(function(t,i){e.onsuccess=function(o){t(o.target.result)},e.onerror=function(o){var s=wu(o.target.error);i(s)}})}var ol=!1;function wu(e){var t=Or._t((0,U.z$)());if(t>=12.2&&t<13){var i="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(i)>=0){var o=new A("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+i+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return ol||(ol=!0,setTimeout(function(){throw o},0)),o}}return e}var sl=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).Mt=i,s.currentSequenceNumber=o,s}return(0,v.ZT)(t,e),t}(rl);function Bt(e,t){var i=M(e);return Or.It(i.Mt,t)}var Eu=function(){function e(t,i,o,s){this.batchId=t,this.localWriteTime=i,this.baseMutations=o,this.mutations=s}return e.prototype.applyToRemoteDocument=function(t,i){for(var o=i.mutationResults,s=0;s<this.mutations.length;s++){var u=this.mutations[s];u.key.isEqual(t.key)&&Bf(u,t,o[s])}},e.prototype.applyToLocalView=function(t){for(var i=0,o=this.baseMutations;i<o.length;i++)(a=o[i]).key.isEqual(t.key)&&pu(a,t,this.localWriteTime);for(var s=0,u=this.mutations;s<u.length;s++){var a;(a=u[s]).key.isEqual(t.key)&&pu(a,t,this.localWriteTime)}},e.prototype.applyToLocalDocumentSet=function(t){var i=this;this.mutations.forEach(function(o){var s=t.get(o.key),u=s;i.applyToLocalView(u),s.isValidDocument()||u.convertToNoDocument(j.min())})},e.prototype.keys=function(){return this.mutations.reduce(function(t,i){return t.add(i.key)},Y())},e.prototype.isEqual=function(t){return this.batchId===t.batchId&&_r(this.mutations,t.mutations,function(i,o){return Sc(i,o)})&&_r(this.baseMutations,t.baseMutations,function(i,o){return Sc(i,o)})},e}(),dd=function(){function e(t,i,o,s){this.batch=t,this.commitVersion=i,this.mutationResults=o,this.docVersions=s}return e.from=function(t,i,o){q(t.mutations.length===o.length);for(var s=kc(),u=t.mutations,a=0;a<u.length;a++)s=s.insert(u[a].key,o[a].version);return new e(t,i,o,s)},e}(),is=function(){function e(t,i,o,s,u,a,c){void 0===u&&(u=j.min()),void 0===a&&(a=j.min()),void 0===c&&(c=Lt.EMPTY_BYTE_STRING),this.target=t,this.targetId=i,this.purpose=o,this.sequenceNumber=s,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c}return e.prototype.withSequenceNumber=function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},e.prototype.withResumeToken=function(t,i){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,t)},e.prototype.withLastLimboFreeSnapshotVersion=function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},e}(),ul=function(e){this.Lt=e};function Cu(e,t){if(t.document)return Jc(e.Lt,t.document,!!t.hasCommittedMutations);if(t.noDocument){var i=k.fromSegments(t.noDocument.path),o=Fr(t.noDocument.readTime),s=St.newNoDocument(i,o);return t.hasCommittedMutations?s.setHasCommittedMutations():s}if(t.unknownDocument){var u=k.fromSegments(t.unknownDocument.path);return o=Fr(t.unknownDocument.version),St.newUnknownDocument(u,o)}return F()}function al(e,t,i){var _,b,o=Tu(i),s=t.key.path.popLast().toArray();if(t.isFoundDocument()){var u={name:zi(_=e.Lt,(b=t).key),fields:b.data.value.mapValue.fields,updateTime:Ji(_,b.version.toTimestamp())},a=t.hasCommittedMutations;return new ut(null,null,u,a,o,s)}if(t.isNoDocument()){var c=t.key.path.toArray(),h=xr(t.version);return a=t.hasCommittedMutations,new ut(null,new ad(c,h),null,a,o,s)}if(t.isUnknownDocument()){var p=t.key.path.toArray(),g=xr(t.version);return new ut(new cd(p,g),null,null,!0,o,s)}return F()}function Tu(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function cl(e){var t=new Gt(e[0],e[1]);return j.fromTimestamp(t)}function xr(e){var t=e.toTimestamp();return new ud(t.seconds,t.nanoseconds)}function Fr(e){var t=new Gt(e.seconds,e.nanoseconds);return j.fromTimestamp(t)}function kr(e,t){for(var i=(t.baseMutations||[]).map(function(h){return zc(e.Lt,h)}),o=0;o<t.mutations.length-1;++o)o+1<t.mutations.length&&void 0!==t.mutations[o+1].transform&&(t.mutations[o].updateTransforms=t.mutations[o+1].transform.fieldTransforms,t.mutations.splice(o+1,1),++o);var a=t.mutations.map(function(h){return zc(e.Lt,h)}),c=Gt.fromMillis(t.localWriteTimeMs);return new Eu(t.batchId,c,i,a)}function Yi(e){var t,i,o=Fr(e.readTime),s=void 0!==e.lastLimboFreeSnapshotVersion?Fr(e.lastLimboFreeSnapshotVersion):j.min();return void 0!==e.query.documents?(q(1===(i=e.query).documents.length),t=ne(Tr(jc(i.documents[0])))):t=ne(Yc(e.query)),new is(t,e.targetId,0,e.lastListenSequenceNumber,o,s,Lt.fromBase64String(e.resumeToken))}function ll(e,t){var i,o=xr(t.snapshotVersion),s=xr(t.lastLimboFreeSnapshotVersion);i=zo(t.target)?Qc(e.Lt,t.target):Wc(e.Lt,t.target);var u=t.resumeToken.toBase64();return new qt(t.targetId,Ui(t.target),o,u,t.sequenceNumber,s,i)}function Iu(e){var t=Yc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?mc(t,t.limit,"L"):t}var pd=function(){function e(){}return e.prototype.getBundleMetadata=function(t,i){return hl(t).get(i).next(function(o){if(o)return{id:(s=o).bundleId,createTime:Fr(s.createTime),version:s.version};var s})},e.prototype.saveBundleMetadata=function(t,i){return hl(t).put({bundleId:(o=i).id,createTime:xr(wt(o.createTime)),version:o.version});var o},e.prototype.getNamedQuery=function(t,i){return fl(t).get(i).next(function(o){if(o)return{name:(s=o).name,query:Iu(s.bundledQuery),readTime:Fr(s.readTime)};var s})},e.prototype.saveNamedQuery=function(t,i){return fl(t).put({name:(o=i).name,readTime:xr(wt(o.readTime)),bundledQuery:o.bundledQuery});var o},e}();function hl(e){return Bt(e,Vr.store)}function fl(e){return Bt(e,Mr.store)}var gd=function(){function e(){this.Bt=new Au}return e.prototype.addToCollectionParentIndex=function(t,i){return this.Bt.add(i),S.resolve()},e.prototype.getCollectionParents=function(t,i){return S.resolve(this.Bt.getEntries(i))},e}(),Au=function(){function e(){this.index={}}return e.prototype.add=function(t){var i=t.lastSegment(),o=t.popLast(),s=this.index[i]||new vt(Q.comparator),u=!s.has(o);return this.index[i]=s.add(o),u},e.prototype.has=function(t){var i=t.lastSegment(),o=t.popLast(),s=this.index[i];return s&&s.has(o)},e.prototype.getEntries=function(t){return(this.index[t]||new vt(Q.comparator)).toArray()},e}(),md=function(){function e(){this.qt=new Au}return e.prototype.addToCollectionParentIndex=function(t,i){var o=this;if(!this.qt.has(i)){var s=i.lastSegment(),u=i.popLast();t.addOnCommittedListener(function(){o.qt.add(i)});var a={collectionId:s,parent:ae(u)};return dl(t).put(a)}return S.resolve()},e.prototype.getCollectionParents=function(t,i){var o=[],s=IDBKeyRange.bound([i,""],[ec(i),""],!1,!0);return dl(t).Nt(s).next(function(u){for(var a=0,c=u;a<c.length;a++){var h=c[a];if(h.collectionId!==i)break;o.push(De(h.parent))}return o})},e}();function dl(e){return Bt(e,Vn.store)}var pl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ye=function(){function e(t,i,o){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=o}return e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},e}();function gl(e,t,i){var o=e.store(tt.store),s=e.store(Ft.store),u=[],a=IDBKeyRange.only(i.batchId),c=0,h=o.$t({range:a},function(E,T,D){return c++,D.delete()});u.push(h.next(function(){q(1===c)}));for(var p=[],g=0,_=i.mutations;g<_.length;g++){var b=_[g],w=Ft.key(t,b.key.path,i.batchId);u.push(s.delete(w)),p.push(b.key)}return S.waitFor(u).next(function(){return p})}function os(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw F();t=e.noDocument}return JSON.stringify(t).length}ye.DEFAULT_COLLECTION_PERCENTILE=10,ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ye.DEFAULT=new ye(41943040,ye.DEFAULT_COLLECTION_PERCENTILE,ye.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ye.DISABLED=new ye(-1,0,0);var yd=function(){function e(t,i,o,s){this.userId=t,this.R=i,this.Ut=o,this.referenceDelegate=s,this.Kt={}}return e.Qt=function(t,i,o,s){return q(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",i,o,s)},e.prototype.checkEmpty=function(t){var i=!0,o=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ze(t).$t({index:tt.userMutationsIndex,range:o},function(s,u,a){i=!1,a.done()}).next(function(){return i})},e.prototype.addMutationBatch=function(t,i,o,s){var u=this,a=Rr(t),c=Ze(t);return c.add({}).next(function(h){q("number"==typeof h);for(var p=new Eu(h,i,o,s),g=function(V,R,P){var K=P.baseMutations.map(function($){return rs(V.Lt,$)}),z=P.mutations.map(function($){return rs(V.Lt,$)});return new tt(R,P.batchId,P.localWriteTime.toMillis(),K,z)}(u.R,u.userId,p),_=[],b=new vt(function(V,R){return H(V.canonicalString(),R.canonicalString())}),w=0,E=s;w<E.length;w++){var T=E[w],D=Ft.key(u.userId,T.key.path,h);b=b.add(T.key.path.popLast()),_.push(c.put(g)),_.push(a.put(D,Ft.PLACEHOLDER))}return b.forEach(function(V){_.push(u.Ut.addToCollectionParentIndex(t,V))}),t.addOnCommittedListener(function(){u.Kt[h]=p.keys()}),S.waitFor(_).next(function(){return p})})},e.prototype.lookupMutationBatch=function(t,i){var o=this;return Ze(t).get(i).next(function(s){return s?(q(s.userId===o.userId),kr(o.R,s)):null})},e.prototype.jt=function(t,i){var o=this;return this.Kt[i]?S.resolve(this.Kt[i]):this.lookupMutationBatch(t,i).next(function(s){if(s){var u=s.keys();return o.Kt[i]=u,u}return null})},e.prototype.getNextMutationBatchAfterBatchId=function(t,i){var o=this,s=i+1,u=IDBKeyRange.lowerBound([this.userId,s]),a=null;return Ze(t).$t({index:tt.userMutationsIndex,range:u},function(c,h,p){h.userId===o.userId&&(q(h.batchId>=s),a=kr(o.R,h)),p.done()}).next(function(){return a})},e.prototype.getHighestUnacknowledgedBatchId=function(t){var i=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),o=-1;return Ze(t).$t({index:tt.userMutationsIndex,range:i,reverse:!0},function(s,u,a){o=u.batchId,a.done()}).next(function(){return o})},e.prototype.getAllMutationBatches=function(t){var i=this,o=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ze(t).Nt(tt.userMutationsIndex,o).next(function(s){return s.map(function(u){return kr(i.R,u)})})},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,i){var o=this,s=Ft.prefixForPath(this.userId,i.path),u=IDBKeyRange.lowerBound(s),a=[];return Rr(t).$t({range:u},function(c,h,p){var g=c[0],b=c[2],w=De(c[1]);if(g===o.userId&&i.path.isEqual(w))return Ze(t).get(b).next(function(E){if(!E)throw F();q(E.userId===o.userId),a.push(kr(o.R,E))});p.done()}).next(function(){return a})},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,i){var o=this,s=new vt(H),u=[];return i.forEach(function(a){var c=Ft.prefixForPath(o.userId,a.path),h=IDBKeyRange.lowerBound(c),p=Rr(t).$t({range:h},function(g,_,b){var w=g[0],T=g[2],D=De(g[1]);w===o.userId&&a.path.isEqual(D)?s=s.add(T):b.done()});u.push(p)}),S.waitFor(u).next(function(){return o.Wt(t,s)})},e.prototype.getAllMutationBatchesAffectingQuery=function(t,i){var o=this,s=i.path,u=s.length+1,a=Ft.prefixForPath(this.userId,s),c=IDBKeyRange.lowerBound(a),h=new vt(H);return Rr(t).$t({range:c},function(p,g,_){var b=p[0],E=p[2],T=De(p[1]);b===o.userId&&s.isPrefixOf(T)?T.length===u&&(h=h.add(E)):_.done()}).next(function(){return o.Wt(t,h)})},e.prototype.Wt=function(t,i){var o=this,s=[],u=[];return i.forEach(function(a){u.push(Ze(t).get(a).next(function(c){if(null===c)throw F();q(c.userId===o.userId),s.push(kr(o.R,c))}))}),S.waitFor(u).next(function(){return s})},e.prototype.removeMutationBatch=function(t,i){var o=this;return gl(t.Mt,this.userId,i).next(function(s){return t.addOnCommittedListener(function(){o.Gt(i.batchId)}),S.forEach(s,function(u){return o.referenceDelegate.markPotentiallyOrphaned(t,u)})})},e.prototype.Gt=function(t){delete this.Kt[t]},e.prototype.performConsistencyCheck=function(t){var i=this;return this.checkEmpty(t).next(function(o){if(!o)return S.resolve();var s=IDBKeyRange.lowerBound(Ft.prefixForUser(i.userId)),u=[];return Rr(t).$t({range:s},function(a,c,h){if(a[0]===i.userId){var p=De(a[1]);u.push(p)}else h.done()}).next(function(){q(0===u.length)})})},e.prototype.containsKey=function(t,i){return ml(t,this.userId,i)},e.prototype.zt=function(t){var i=this;return yl(t).get(this.userId).next(function(o){return o||new $e(i.userId,-1,"")})},e}();function ml(e,t,i){var o=Ft.prefixForPath(t,i.path),s=o[1],u=IDBKeyRange.lowerBound(o),a=!1;return Rr(e).$t({range:u,Ft:!0},function(c,h,p){c[0]===t&&c[1]===s&&(a=!0),p.done()}).next(function(){return a})}function Ze(e){return Bt(e,tt.store)}function Rr(e){return Bt(e,Ft.store)}function yl(e){return Bt(e,$e.store)}var ss=function(){function e(t){this.Ht=t}return e.prototype.next=function(){return this.Ht+=2,this.Ht},e.Jt=function(){return new e(0)},e.Yt=function(){return new e(-1)},e}(),vd=function(){function e(t,i){this.referenceDelegate=t,this.R=i}return e.prototype.allocateTargetId=function(t){var i=this;return this.Xt(t).next(function(o){var s=new ss(o.highestTargetId);return o.highestTargetId=s.next(),i.Zt(t,o).next(function(){return o.highestTargetId})})},e.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(i){return j.fromTimestamp(new Gt(i.lastRemoteSnapshotVersion.seconds,i.lastRemoteSnapshotVersion.nanoseconds))})},e.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(i){return i.highestListenSequenceNumber})},e.prototype.setTargetsMetadata=function(t,i,o){var s=this;return this.Xt(t).next(function(u){return u.highestListenSequenceNumber=i,o&&(u.lastRemoteSnapshotVersion=o.toTimestamp()),i>u.highestListenSequenceNumber&&(u.highestListenSequenceNumber=i),s.Zt(t,u)})},e.prototype.addTargetData=function(t,i){var o=this;return this.te(t,i).next(function(){return o.Xt(t).next(function(s){return s.targetCount+=1,o.ee(i,s),o.Zt(t,s)})})},e.prototype.updateTargetData=function(t,i){return this.te(t,i)},e.prototype.removeTargetData=function(t,i){var o=this;return this.removeMatchingKeysForTargetId(t,i.targetId).next(function(){return Pr(t).delete(i.targetId)}).next(function(){return o.Xt(t)}).next(function(s){return q(s.targetCount>0),s.targetCount-=1,o.Zt(t,s)})},e.prototype.removeTargets=function(t,i,o){var s=this,u=0,a=[];return Pr(t).$t(function(c,h){var p=Yi(h);p.sequenceNumber<=i&&null===o.get(p.targetId)&&(u++,a.push(s.removeTargetData(t,p)))}).next(function(){return S.waitFor(a)}).next(function(){return u})},e.prototype.forEachTarget=function(t,i){return Pr(t).$t(function(o,s){var u=Yi(s);i(u)})},e.prototype.Xt=function(t){return vl(t).get(Wt.key).next(function(i){return q(null!==i),i})},e.prototype.Zt=function(t,i){return vl(t).put(Wt.key,i)},e.prototype.te=function(t,i){return Pr(t).put(ll(this.R,i))},e.prototype.ee=function(t,i){var o=!1;return t.targetId>i.highestTargetId&&(i.highestTargetId=t.targetId,o=!0),t.sequenceNumber>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t.sequenceNumber,o=!0),o},e.prototype.getTargetCount=function(t){return this.Xt(t).next(function(i){return i.targetCount})},e.prototype.getTargetData=function(t,i){var o=Ui(i),s=IDBKeyRange.bound([o,Number.NEGATIVE_INFINITY],[o,Number.POSITIVE_INFINITY]),u=null;return Pr(t).$t({range:s,index:qt.queryTargetsIndexName},function(a,c,h){var p=Yi(c);Jo(i,p.target)&&(u=p,h.done())}).next(function(){return u})},e.prototype.addMatchingKeys=function(t,i,o){var s=this,u=[],a=Xe(t);return i.forEach(function(c){var h=ae(c.path);u.push(a.put(new Dt(o,h))),u.push(s.referenceDelegate.addReference(t,o,c))}),S.waitFor(u)},e.prototype.removeMatchingKeys=function(t,i,o){var s=this,u=Xe(t);return S.forEach(i,function(a){var c=ae(a.path);return S.waitFor([u.delete([o,c]),s.referenceDelegate.removeReference(t,o,a)])})},e.prototype.removeMatchingKeysForTargetId=function(t,i){var o=Xe(t),s=IDBKeyRange.bound([i],[i+1],!1,!0);return o.delete(s)},e.prototype.getMatchingKeysForTargetId=function(t,i){var o=IDBKeyRange.bound([i],[i+1],!1,!0),s=Xe(t),u=Y();return s.$t({range:o,Ft:!0},function(a,c,h){var p=De(a[1]),g=new k(p);u=u.add(g)}).next(function(){return u})},e.prototype.containsKey=function(t,i){var o=ae(i.path),s=IDBKeyRange.bound([o],[ec(o)],!1,!0),u=0;return Xe(t).$t({index:Dt.documentTargetsIndex,Ft:!0,range:s},function(a,c,h){0!==a[0]&&(u++,h.done())}).next(function(){return u>0})},e.prototype.lt=function(t,i){return Pr(t).get(i).next(function(o){return o?Yi(o):null})},e}();function Pr(e){return Bt(e,qt.store)}function vl(e){return Bt(e,Wt.store)}function Xe(e){return Bt(e,Dt.store)}function xn(e){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(t){if(e.code!==C.FAILED_PRECONDITION||e.message!==nl)throw e;return N("LocalStore","Unexpectedly lost primary lease"),[2]})})}function _l(e,t){var o=e[1],u=t[1],a=H(e[0],t[0]);return 0===a?H(o,u):a}var _d=function(){function e(t){this.ne=t,this.buffer=new vt(_l),this.se=0}return e.prototype.ie=function(){return++this.se},e.prototype.re=function(t){var i=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(i);else{var o=this.buffer.last();_l(i,o)<0&&(this.buffer=this.buffer.delete(o).add(i))}},Object.defineProperty(e.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),e}(),bd=function(){function e(t,i){this.garbageCollector=t,this.asyncQueue=i,this.oe=!1,this.ce=null}return e.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},e.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(e.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),e.prototype.ue=function(t){var i=this,o=this.oe?3e5:6e4;N("LruGarbageCollector","Garbage collection scheduled in "+o+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",o,function(){return(0,v.mG)(i,void 0,void 0,function(){var s;return(0,v.Jh)(this,function(u){switch(u.label){case 0:this.ce=null,this.oe=!0,u.label=1;case 1:return u.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return u.sent(),[3,7];case 3:return Mn(s=u.sent())?(N("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",s),[3,6]):[3,4];case 4:return[4,xn(s)];case 5:u.sent(),u.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return u.sent(),[2]}})})})},e}(),wd=function(){function e(t,i){this.ae=t,this.params=i}return e.prototype.calculateTargetCount=function(t,i){return this.ae.he(t).next(function(o){return Math.floor(i/100*o)})},e.prototype.nthSequenceNumber=function(t,i){var o=this;if(0===i)return S.resolve(Ht.o);var s=new _d(i);return this.ae.forEachTarget(t,function(u){return s.re(u.sequenceNumber)}).next(function(){return o.ae.le(t,function(u){return s.re(u)})}).next(function(){return s.maxValue})},e.prototype.removeTargets=function(t,i,o){return this.ae.removeTargets(t,i,o)},e.prototype.removeOrphanedDocuments=function(t,i){return this.ae.removeOrphanedDocuments(t,i)},e.prototype.collect=function(t,i){var o=this;return-1===this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(pl)):this.getCacheSize(t).next(function(s){return s<o.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector","Garbage collection skipped; Cache size "+s+" is lower than threshold "+o.params.cacheSizeCollectionThreshold),pl):o.fe(t,i)})},e.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},e.prototype.fe=function(t,i){var o,s,u,a,c,h,p,g=this,_=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(b){return b>g.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+g.params.maximumSequenceNumbersToCollect+" from "+b),s=g.params.maximumSequenceNumbersToCollect):s=b,a=Date.now(),g.nthSequenceNumber(t,s)}).next(function(b){return o=b,c=Date.now(),g.removeTargets(t,o,i)}).next(function(b){return u=b,h=Date.now(),g.removeOrphanedDocuments(t,o)}).next(function(b){return p=Date.now(),ru()<=Mt.in.DEBUG&&N("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-_)+"ms\n\tDetermined least recently used "+s+" in "+(c-a)+"ms\n\tRemoved "+u+" targets in "+(h-c)+"ms\n\tRemoved "+b+" documents in "+(p-h)+"ms\nTotal Duration: "+(p-_)+"ms"),S.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:u,documentsRemoved:b})})},e}(),Ed=function(){function e(t,i){this.db=t,this.garbageCollector=new wd(this,i)}return e.prototype.he=function(t){var i=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(o){return i.next(function(s){return o+s})})},e.prototype.de=function(t){var i=0;return this.le(t,function(o){i++}).next(function(){return i})},e.prototype.forEachTarget=function(t,i){return this.db.getTargetCache().forEachTarget(t,i)},e.prototype.le=function(t,i){return this.we(t,function(o,s){return i(s)})},e.prototype.addReference=function(t,i,o){return us(t,o)},e.prototype.removeReference=function(t,i,o){return us(t,o)},e.prototype.removeTargets=function(t,i,o){return this.db.getTargetCache().removeTargets(t,i,o)},e.prototype.markPotentiallyOrphaned=function(t,i){return us(t,i)},e.prototype._e=function(t,i){return s=i,u=!1,yl(o=t).Ot(function(a){return ml(o,a,s).next(function(c){return c&&(u=!0),S.resolve(!c)})}).next(function(){return u});var o,s,u},e.prototype.removeOrphanedDocuments=function(t,i){var o=this,s=this.db.getRemoteDocumentCache().newChangeBuffer(),u=[],a=0;return this.we(t,function(c,h){if(h<=i){var p=o._e(t,c).next(function(g){if(!g)return a++,s.getEntry(t,c).next(function(){return s.removeEntry(c),Xe(t).delete([0,ae(c.path)])})});u.push(p)}}).next(function(){return S.waitFor(u)}).next(function(){return s.apply(t)}).next(function(){return a})},e.prototype.removeTarget=function(t,i){var o=i.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,o)},e.prototype.updateLimboDocument=function(t,i){return us(t,i)},e.prototype.we=function(t,i){var o,s=Xe(t),u=Ht.o;return s.$t({index:Dt.documentTargetsIndex},function(a,c){var p=c.path,g=c.sequenceNumber;0===a[0]?(u!==Ht.o&&i(new k(De(o)),u),u=g,o=p):u=Ht.o}).next(function(){u!==Ht.o&&i(new k(De(o)),u)})},e.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},e}();function us(e,t){return Xe(e).put((o=e.currentSequenceNumber,new Dt(0,ae(t.path),o)));var o}var Lr=function(){function e(t,i){this.mapKeyFn=t,this.equalsFn=i,this.inner={}}return e.prototype.get=function(t){var i=this.mapKeyFn(t),o=this.inner[i];if(void 0!==o)for(var s=0,u=o;s<u.length;s++){var a=u[s],h=a[1];if(this.equalsFn(a[0],t))return h}},e.prototype.has=function(t){return void 0!==this.get(t)},e.prototype.set=function(t,i){var o=this.mapKeyFn(t),s=this.inner[o];if(void 0!==s){for(var u=0;u<s.length;u++)if(this.equalsFn(s[u][0],t))return void(s[u]=[t,i]);s.push([t,i])}else this.inner[o]=[[t,i]]},e.prototype.delete=function(t){var i=this.mapKeyFn(t),o=this.inner[i];if(void 0===o)return!1;for(var s=0;s<o.length;s++)if(this.equalsFn(o[s][0],t))return 1===o.length?delete this.inner[i]:o.splice(s,1),!0;return!1},e.prototype.forEach=function(t){In(this.inner,function(i,o){for(var s=0,u=o;s<u.length;s++){var a=u[s];t(a[0],a[1])}})},e.prototype.isEmpty=function(){return rc(this.inner)},e}(),bl=function(){function e(){this.changes=new Lr(function(t){return t.toString()},function(t,i){return t.isEqual(i)}),this.changesApplied=!1}return e.prototype.getReadTime=function(t){var i=this.changes.get(t);return i?i.readTime:j.min()},e.prototype.addEntry=function(t,i){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:i})},e.prototype.removeEntry=function(t,i){void 0===i&&(i=null),this.assertNotApplied(),this.changes.set(t,{document:St.newInvalidDocument(t),readTime:i})},e.prototype.getEntry=function(t,i){this.assertNotApplied();var o=this.changes.get(i);return void 0!==o?S.resolve(o.document):this.getFromCache(t,i)},e.prototype.getEntries=function(t,i){return this.getAllFromCache(t,i)},e.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},e.prototype.assertNotApplied=function(){},e}(),Cd=function(){function e(t,i){this.R=t,this.Ut=i}return e.prototype.addEntry=function(t,i,o){return tn(t).put(as(i),o)},e.prototype.removeEntry=function(t,i){var o=tn(t),s=as(i);return o.delete(s)},e.prototype.updateMetadata=function(t,i){var o=this;return this.getMetadata(t).next(function(s){return s.byteSize+=i,o.me(t,s)})},e.prototype.getEntry=function(t,i){var o=this;return tn(t).get(as(i)).next(function(s){return o.ye(i,s)})},e.prototype.ge=function(t,i){var o=this;return tn(t).get(as(i)).next(function(s){return{document:o.ye(i,s),size:os(s)}})},e.prototype.getEntries=function(t,i){var o=this,s=re();return this.pe(t,i,function(u,a){var c=o.ye(u,a);s=s.insert(u,c)}).next(function(){return s})},e.prototype.Ee=function(t,i){var o=this,s=re(),u=new xt(k.comparator);return this.pe(t,i,function(a,c){var h=o.ye(a,c);s=s.insert(a,h),u=u.insert(a,os(c))}).next(function(){return{documents:s,Te:u}})},e.prototype.pe=function(t,i,o){if(i.isEmpty())return S.resolve();var s=IDBKeyRange.bound(i.first().path.toArray(),i.last().path.toArray()),u=i.getIterator(),a=u.getNext();return tn(t).$t({range:s},function(c,h,p){for(var g=k.fromSegments(c);a&&k.comparator(a,g)<0;)o(a,null),a=u.getNext();a&&a.isEqual(g)&&(o(a,h),a=u.hasNext()?u.getNext():null),a?p.Ct(a.path.toArray()):p.done()}).next(function(){for(;a;)o(a,null),a=u.hasNext()?u.getNext():null})},e.prototype.getDocumentsMatchingQuery=function(t,i,o){var s=this,u=re(),a=i.path.length+1,c={};if(o.isEqual(j.min())){var h=i.path.toArray();c.range=IDBKeyRange.lowerBound(h)}else{var p=i.path.toArray(),g=Tu(o);c.range=IDBKeyRange.lowerBound([p,g],!0),c.index=ut.collectionReadTimeIndex}return tn(t).$t(c,function(_,b,w){if(_.length===a){var E=Cu(s.R,b);i.path.isPrefixOf(E.key.path)?Bi(i,E)&&(u=u.insert(E.key,E)):w.done()}}).next(function(){return u})},e.prototype.newChangeBuffer=function(t){return new Td(this,!!t&&t.trackRemovals)},e.prototype.getSize=function(t){return this.getMetadata(t).next(function(i){return i.byteSize})},e.prototype.getMetadata=function(t){return wl(t).get(me.key).next(function(i){return q(!!i),i})},e.prototype.me=function(t,i){return wl(t).put(me.key,i)},e.prototype.ye=function(t,i){if(i){var o=Cu(this.R,i);if(!o.isNoDocument()||!o.version.isEqual(j.min()))return o}return St.newInvalidDocument(t)},e}(),Td=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).Ie=i,s.trackRemovals=o,s.Ae=new Lr(function(u){return u.toString()},function(u,a){return u.isEqual(a)}),s}return(0,v.ZT)(t,e),t.prototype.applyChanges=function(i){var o=this,s=[],u=0,a=new vt(function(c,h){return H(c.canonicalString(),h.canonicalString())});return this.changes.forEach(function(c,h){var p=o.Ae.get(c);if(h.document.isValidDocument()){var g=al(o.Ie.R,h.document,o.getReadTime(c));a=a.add(c.path.popLast());var _=os(g);u+=_-p,s.push(o.Ie.addEntry(i,c,g))}else if(u-=p,o.trackRemovals){var b=al(o.Ie.R,St.newNoDocument(c,j.min()),o.getReadTime(c));s.push(o.Ie.addEntry(i,c,b))}else s.push(o.Ie.removeEntry(i,c))}),a.forEach(function(c){s.push(o.Ie.Ut.addToCollectionParentIndex(i,c))}),s.push(this.Ie.updateMetadata(i,u)),S.waitFor(s)},t.prototype.getFromCache=function(i,o){var s=this;return this.Ie.ge(i,o).next(function(u){return s.Ae.set(o,u.size),u.document})},t.prototype.getAllFromCache=function(i,o){var s=this;return this.Ie.Ee(i,o).next(function(u){var a=u.documents;return u.Te.forEach(function(c,h){s.Ae.set(c,h)}),a})},t}(bl);function wl(e){return Bt(e,me.store)}function tn(e){return Bt(e,ut.store)}function as(e){return e.path.toArray()}var Id=function(){function e(t){this.R=t}return e.prototype.Rt=function(t,i,o,s){var u=this;q(o<s&&o>=0&&s<=11);var h,a=new il("createOrUpgrade",i);o<1&&s>=1&&(t.createObjectStore(Qt.store),(h=t).createObjectStore($e.store,{keyPath:$e.keyPath}),h.createObjectStore(tt.store,{keyPath:tt.keyPath,autoIncrement:!0}).createIndex(tt.userMutationsIndex,tt.userMutationsKeyPath,{unique:!0}),h.createObjectStore(Ft.store),El(t),function(h){h.createObjectStore(ut.store)}(t));var c=S.resolve();return o<3&&s>=3&&(0!==o&&(function(h){h.deleteObjectStore(Dt.store),h.deleteObjectStore(qt.store),h.deleteObjectStore(Wt.store)}(t),El(t)),c=c.next(function(){return function(h){var p=h.store(Wt.store),g=new Wt(0,0,j.min().toTimestamp(),0);return p.put(Wt.key,g)}(a)})),o<4&&s>=4&&(0!==o&&(c=c.next(function(){return function(h,p){return p.store(tt.store).Nt().next(function(g){h.deleteObjectStore(tt.store),h.createObjectStore(tt.store,{keyPath:tt.keyPath,autoIncrement:!0}).createIndex(tt.userMutationsIndex,tt.userMutationsKeyPath,{unique:!0});var _=p.store(tt.store),b=g.map(function(w){return _.put(w)});return S.waitFor(b)})}(t,a)})),c=c.next(function(){!function(h){h.createObjectStore(Ne.store,{keyPath:Ne.keyPath})}(t)})),o<5&&s>=5&&(c=c.next(function(){return u.Re(a)})),o<6&&s>=6&&(c=c.next(function(){return function(h){h.createObjectStore(me.store)}(t),u.be(a)})),o<7&&s>=7&&(c=c.next(function(){return u.ve(a)})),o<8&&s>=8&&(c=c.next(function(){return u.Pe(t,a)})),o<9&&s>=9&&(c=c.next(function(){(function(h){h.objectStoreNames.contains("remoteDocumentChanges")&&h.deleteObjectStore("remoteDocumentChanges")})(t),function(h){var p=h.objectStore(ut.store);p.createIndex(ut.readTimeIndex,ut.readTimeIndexPath,{unique:!1}),p.createIndex(ut.collectionReadTimeIndex,ut.collectionReadTimeIndexPath,{unique:!1})}(i)})),o<10&&s>=10&&(c=c.next(function(){return u.Ve(a)})),o<11&&s>=11&&(c=c.next(function(){(function(h){h.createObjectStore(Vr.store,{keyPath:Vr.keyPath})})(t),function(h){h.createObjectStore(Mr.store,{keyPath:Mr.keyPath})}(t)})),c},e.prototype.be=function(t){var i=0;return t.store(ut.store).$t(function(o,s){i+=os(s)}).next(function(){var o=new me(i);return t.store(me.store).put(me.key,o)})},e.prototype.Re=function(t){var i=this,o=t.store($e.store),s=t.store(tt.store);return o.Nt().next(function(u){return S.forEach(u,function(a){var c=IDBKeyRange.bound([a.userId,-1],[a.userId,a.lastAcknowledgedBatchId]);return s.Nt(tt.userMutationsIndex,c).next(function(h){return S.forEach(h,function(p){q(p.userId===a.userId);var g=kr(i.R,p);return gl(t,a.userId,g).next(function(){})})})})})},e.prototype.ve=function(t){var i=t.store(Dt.store),o=t.store(ut.store);return t.store(Wt.store).get(Wt.key).next(function(s){var u=[];return o.$t(function(a,c){var h=new Q(a),p=[0,ae(h)];u.push(i.get(p).next(function(g){return g?S.resolve():i.put(new Dt(0,ae(h),s.highestListenSequenceNumber))}))}).next(function(){return S.waitFor(u)})})},e.prototype.Pe=function(t,i){t.createObjectStore(Vn.store,{keyPath:Vn.keyPath});var o=i.store(Vn.store),s=new Au,u=function(a){if(s.add(a)){var c=a.lastSegment(),h=a.popLast();return o.put({collectionId:c,parent:ae(h)})}};return i.store(ut.store).$t({Ft:!0},function(a,c){var h=new Q(a);return u(h.popLast())}).next(function(){return i.store(Ft.store).$t({Ft:!0},function(a,c){var p=De(a[1]);return u(p.popLast())})})},e.prototype.Ve=function(t){var i=this,o=t.store(qt.store);return o.$t(function(s,u){var a=Yi(u),c=ll(i.R,a);return o.put(c)})},e}();function El(e){e.createObjectStore(Dt.store,{keyPath:Dt.keyPath}).createIndex(Dt.documentTargetsIndex,Dt.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(qt.store,{keyPath:qt.keyPath}).createIndex(qt.queryTargetsIndexName,qt.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Wt.store)}var Su="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ad=function(){function e(t,i,o,s,u,a,c,h,p,g){if(this.allowTabSynchronization=t,this.persistenceKey=i,this.clientId=o,this.Se=u,this.window=a,this.document=c,this.De=p,this.Ce=g,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(_){return Promise.resolve()},!e.yt())throw new A(C.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ed(this,s),this.Le=i+"main",this.R=new ul(h),this.Be=new Or(this.Le,11,new Id(this.R)),this.qe=new vd(this.referenceDelegate,this.R),this.Ut=new md,this.Ue=new Cd(this.R,this.Ut),this.Ke=new pd,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===g&&ht("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return e.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new A(C.FAILED_PRECONDITION,Su);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(i){return t.qe.getHighestSequenceNumber(i)})}).then(function(i){t.Ne=new Ht(i,t.De)}).then(function(){t.xe=!0}).catch(function(i){return t.Be&&t.Be.close(),Promise.reject(i)})},e.prototype.He=function(t){var i=this;return this.Me=function(o){return(0,v.mG)(i,void 0,void 0,function(){return(0,v.Jh)(this,function(s){return this.started?[2,t(o)]:[2]})})},t(this.isPrimary)},e.prototype.setDatabaseDeletedListener=function(t){var i=this;this.Be.vt(function(o){return(0,v.mG)(i,void 0,void 0,function(){return(0,v.Jh)(this,function(s){switch(s.label){case 0:return null===o.newVersion?[4,t()]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})})},e.prototype.setNetworkEnabled=function(t){var i=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return(0,v.mG)(i,void 0,void 0,function(){return(0,v.Jh)(this,function(o){switch(o.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}})})}))},e.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(i){return cs(i).put(new Ne(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(i).next(function(o){o||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(i)}).next(function(o){return t.isPrimary&&!o?t.Xe(i).next(function(){return!1}):!!o&&t.Ze(i).next(function(){return!0})})}).catch(function(i){if(Mn(i))return N("IndexedDbPersistence","Failed to extend owner lease: ",i),t.isPrimary;if(!t.allowTabSynchronization)throw i;return N("IndexedDbPersistence","Releasing owner lease after error during lease refresh",i),!1}).then(function(i){t.isPrimary!==i&&t.Se.enqueueRetryable(function(){return t.Me(i)}),t.isPrimary=i})},e.prototype.Je=function(t){var i=this;return $i(t).get(Qt.key).next(function(o){return S.resolve(i.tn(o))})},e.prototype.en=function(t){return cs(t).delete(this.clientId)},e.prototype.nn=function(){return(0,v.mG)(this,void 0,void 0,function(){var t,i,o,u=this;return(0,v.Jh)(this,function(a){switch(a.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(c){var h=Bt(c,Ne.store);return h.Nt().next(function(p){var g=u.rn(p,18e5),_=p.filter(function(b){return-1===g.indexOf(b)});return S.forEach(_,function(b){return h.delete(b.clientId)}).next(function(){return _})})}).catch(function(){return[]})]);case 1:if(t=a.sent(),this.Qe)for(i=0,o=t;i<o.length;i++)this.Qe.removeItem(this.on(o[i].clientId));a.label=2;case 2:return[2]}})})},e.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},e.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},e.prototype.Ye=function(t){var i=this;return this.Ce?S.resolve(!0):$i(t).get(Qt.key).next(function(o){if(null!==o&&i.sn(o.leaseTimestampMs,5e3)&&!i.cn(o.ownerId)){if(i.tn(o)&&i.networkEnabled)return!0;if(!i.tn(o)){if(!o.allowTabSynchronization)throw new A(C.FAILED_PRECONDITION,Su);return!1}}return!(!i.networkEnabled||!i.inForeground)||cs(t).Nt().next(function(s){return void 0===i.rn(s,5e3).find(function(u){return!(i.clientId===u.clientId||!(!i.networkEnabled&&u.networkEnabled||!i.inForeground&&u.inForeground&&i.networkEnabled===u.networkEnabled))})})}).next(function(o){return i.isPrimary!==o&&N("IndexedDbPersistence","Client "+(o?"is":"is not")+" eligible for a primary lease."),o})},e.prototype.shutdown=function(){return(0,v.mG)(this,void 0,void 0,function(){var t=this;return(0,v.Jh)(this,function(i){switch(i.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Qt.store,Ne.store],function(o){var s=new sl(o,Ht.o);return t.Xe(s).next(function(){return t.en(s)})})];case 1:return i.sent(),this.Be.close(),this.ln(),[2]}})})},e.prototype.rn=function(t,i){var o=this;return t.filter(function(s){return o.sn(s.updateTimeMs,i)&&!o.cn(s.clientId)})},e.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(i){return cs(i).Nt().next(function(o){return t.rn(o,18e5).map(function(s){return s.clientId})})})},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.getMutationQueue=function(t){return yd.Qt(t,this.R,this.Ut,this.referenceDelegate)},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,i,o){var u,s=this;return N("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===i?"readonly":"readwrite",ld,function(c){return u=new sl(c,s.Ne?s.Ne.next():Ht.o),"readwrite-primary"===i?s.Je(u).next(function(h){return!!h||s.Ye(u)}).next(function(h){if(!h)throw ht("Failed to obtain primary lease for action '"+t+"'."),s.isPrimary=!1,s.Se.enqueueRetryable(function(){return s.Me(!1)}),new A(C.FAILED_PRECONDITION,nl);return o(u)}).next(function(h){return s.Ze(u).next(function(){return h})}):s.dn(u).next(function(){return o(u)})}).then(function(c){return u.raiseOnCommittedEvent(),c})},e.prototype.dn=function(t){var i=this;return $i(t).get(Qt.key).next(function(o){if(null!==o&&i.sn(o.leaseTimestampMs,5e3)&&!i.cn(o.ownerId)&&!i.tn(o)&&!(i.Ce||i.allowTabSynchronization&&o.allowTabSynchronization))throw new A(C.FAILED_PRECONDITION,Su)})},e.prototype.Ze=function(t){var i=new Qt(this.clientId,this.allowTabSynchronization,Date.now());return $i(t).put(Qt.key,i)},e.yt=function(){return Or.yt()},e.prototype.Xe=function(t){var i=this,o=$i(t);return o.get(Qt.key).next(function(s){return i.tn(s)?(N("IndexedDbPersistence","Releasing primary lease."),o.delete(Qt.key)):S.resolve()})},e.prototype.sn=function(t,i){var o=Date.now();return!(t<o-i||t>o&&(ht("Detected an update time that is in the future: "+t+" > "+o),1))},e.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},e.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},e.prototype.Ge=function(){var t,i=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){i.un(),(0,U.G6)()&&navigator.appVersion.match("Version/14")&&i.Se.enterRestrictedMode(!0),i.Se.enqueueAndForget(function(){return i.shutdown()})},this.window.addEventListener("pagehide",this.ke))},e.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},e.prototype.cn=function(t){var i;try{var o=null!==(null===(i=this.Qe)||void 0===i?void 0:i.getItem(this.on(t)));return N("IndexedDbPersistence","Client '"+t+"' "+(o?"is":"is not")+" zombied in LocalStorage"),o}catch(s){return ht("IndexedDbPersistence","Failed to get zombied client id.",s),!1}},e.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){ht("Failed to set zombie client id.",t)}},e.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},e.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},e}();function $i(e){return Bt(e,Qt.store)}function cs(e){return Bt(e,Ne.store)}function Du(e,t){var i=e.projectId;return e.isDefaultDatabase||(i+="."+e.database),"firestore/"+t+"/"+i+"/"}var Sd=function(e,t){this.progress=e,this.wn=t},Cl=function(){function e(t,i,o){this.Ue=t,this._n=i,this.Ut=o}return e.prototype.mn=function(t,i){var o=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,i).next(function(s){return o.yn(t,i,s)})},e.prototype.yn=function(t,i,o){return this.Ue.getEntry(t,i).next(function(s){for(var u=0,a=o;u<a.length;u++)a[u].applyToLocalView(s);return s})},e.prototype.gn=function(t,i){t.forEach(function(o,s){for(var u=0,a=i;u<a.length;u++)a[u].applyToLocalView(s)})},e.prototype.pn=function(t,i){var o=this;return this.Ue.getEntries(t,i).next(function(s){return o.En(t,s).next(function(){return s})})},e.prototype.En=function(t,i){var o=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,i).next(function(s){return o.gn(i,s)})},e.prototype.getDocumentsMatchingQuery=function(t,i,o){return k.isDocumentKey((s=i).path)&&null===s.collectionGroup&&0===s.filters.length?this.Tn(t,i.path):fu(i)?this.In(t,i,o):this.An(t,i,o);var s},e.prototype.Tn=function(t,i){return this.mn(t,new k(i)).next(function(o){var s=mu();return o.isFoundDocument()&&(s=s.insert(o.key,o)),s})},e.prototype.In=function(t,i,o){var s=this,u=i.collectionGroup,a=mu();return this.Ut.getCollectionParents(t,u).next(function(c){return S.forEach(c,function(h){var g,_,p=(g=i,_=h.child(u),new Se(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt));return s.An(t,p,o).next(function(g){g.forEach(function(_,b){a=a.insert(_,b)})})}).next(function(){return a})})},e.prototype.An=function(t,i,o){var s,u,a=this;return this.Ue.getDocumentsMatchingQuery(t,i,o).next(function(c){return s=c,a._n.getAllMutationBatchesAffectingQuery(t,i)}).next(function(c){return a.Rn(t,u=c,s).next(function(h){s=h;for(var p=0,g=u;p<g.length;p++)for(var _=g[p],b=0,w=_.mutations;b<w.length;b++){var E=w[b],T=E.key,D=s.get(T);null==D&&(D=St.newInvalidDocument(T),s=s.insert(T,D)),pu(E,D,_.localWriteTime),D.isFoundDocument()||(s=s.remove(T))}})}).next(function(){return s.forEach(function(c,h){Bi(i,h)||(s=s.remove(c))}),s})},e.prototype.Rn=function(t,i,o){for(var s=Y(),u=0,a=i;u<a.length;u++)for(var c=0,h=a[u].mutations;c<h.length;c++){var p=h[c];p instanceof We&&null===o.get(p.key)&&(s=s.add(p.key))}var g=o;return this.Ue.getEntries(t,s).next(function(_){return _.forEach(function(b,w){w.isFoundDocument()&&(g=g.insert(b,w))}),g})},e}(),Dd=function(){function e(t,i,o,s){this.targetId=t,this.fromCache=i,this.bn=o,this.vn=s}return e.Pn=function(t,i){for(var o=Y(),s=Y(),u=0,a=i.docChanges;u<a.length;u++){var c=a[u];switch(c.type){case 0:o=o.add(c.doc.key);break;case 1:s=s.add(c.doc.key)}}return new e(t,i.fromCache,o,s)},e}(),Tl=function(){function e(){}return e.prototype.Vn=function(t){this.Sn=t},e.prototype.getDocumentsMatchingQuery=function(t,i,o,s){var a,u=this;return 0===(a=i).filters.length&&null===a.limit&&null==a.startAt&&null==a.endAt&&(0===a.explicitOrderBy.length||1===a.explicitOrderBy.length&&a.explicitOrderBy[0].field.isKeyField())||o.isEqual(j.min())?this.Dn(t,i):this.Sn.pn(t,s).next(function(a){var c=u.Cn(i,a);return(Wo(i)||Yo(i))&&u.Nn(i.limitType,c,s,o)?u.Dn(t,i):(ru()<=Mt.in.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",o.toString(),du(i)),u.Sn.getDocumentsMatchingQuery(t,i,o).next(function(h){return c.forEach(function(p){h=h.insert(p.key,p)}),h}))})},e.prototype.Cn=function(t,i){var o=new vt(vc(t));return i.forEach(function(s,u){Bi(t,u)&&(o=o.add(u))}),o},e.prototype.Nn=function(t,i,o,s){if(o.size!==i.size)return!0;var u="F"===t?i.last():i.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(s)>0)},e.prototype.Dn=function(t,i){return ru()<=Mt.in.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",du(i)),this.Sn.getDocumentsMatchingQuery(t,i,j.min())},e}(),Nd=function(){function e(t,i,o,s){this.persistence=t,this.xn=i,this.R=s,this.kn=new xt(H),this.Fn=new Lr(function(u){return Ui(u)},Jo),this.$n=j.min(),this._n=t.getMutationQueue(o),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Cl(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return e.prototype.collectGarbage=function(t){var i=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(o){return t.collect(o,i.kn)})},e}();function Il(e,t,i,o){return new Nd(e,t,i,o)}function Al(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i,o,s,u;return(0,v.Jh)(this,function(a){switch(a.label){case 0:return i=M(e),o=i._n,s=i.Mn,[4,i.persistence.runTransaction("Handle user change","readonly",function(c){var h;return i._n.getAllMutationBatches(c).next(function(p){return h=p,o=i.persistence.getMutationQueue(t),s=new Cl(i.On,o,i.persistence.getIndexManager()),o.getAllMutationBatches(c)}).next(function(p){for(var g=[],_=[],b=Y(),w=0,E=h;w<E.length;w++){var T=E[w];g.push(T.batchId);for(var D=0,V=T.mutations;D<V.length;D++)b=b.add(V[D].key)}for(var P=0,K=p;P<K.length;P++){var z=K[P];_.push(z.batchId);for(var $=0,Vt=z.mutations;$<Vt.length;$++)b=b.add(Vt[$].key)}return s.pn(c,b).next(function(co){return{Ln:co,removedBatchIds:g,addedBatchIds:_}})})})];case 1:return u=a.sent(),[2,(i._n=o,i.Mn=s,i.xn.Vn(i.Mn),u)]}})})}function Vd(e,t){var i=M(e);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(o){var a,c,h,p,g,_,b,s=t.batch.keys(),u=i.On.newChangeBuffer({trackRemovals:!0});return(a=i,c=o,h=t,p=u,g=h.batch,_=g.keys(),b=S.resolve(),_.forEach(function(w){b=b.next(function(){return p.getEntry(c,w)}).next(function(E){var T=h.docVersions.get(w);q(null!==T),E.version.compareTo(T)<0&&(g.applyToRemoteDocument(E,h),E.isValidDocument()&&p.addEntry(E,h.commitVersion))})}),b.next(function(){return a._n.removeMutationBatch(c,g)})).next(function(){return u.apply(o)}).next(function(){return i._n.performConsistencyCheck(o)}).next(function(){return i.Mn.pn(o,s)})})}function Sl(e){var t=M(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(i){return t.qe.getLastRemoteSnapshotVersion(i)})}function Md(e,t){var i=M(e),o=t.snapshotVersion,s=i.kn;return i.persistence.runTransaction("Apply remote event","readwrite-primary",function(u){var a=i.On.newChangeBuffer({trackRemovals:!0});s=i.kn;var c=[];t.targetChanges.forEach(function(g,_){var T,D,V,b=s.get(_);if(b){c.push(i.qe.removeMatchingKeys(u,g.removedDocuments,_).next(function(){return i.qe.addMatchingKeys(u,g.addedDocuments,_)}));var w=g.resumeToken;if(w.approximateByteSize()>0){var E=b.withResumeToken(w,o).withSequenceNumber(u.currentSequenceNumber);s=s.insert(_,E),T=b,V=g,q((D=E).resumeToken.approximateByteSize()>0),(0===T.resumeToken.approximateByteSize()||D.snapshotVersion.toMicroseconds()-T.snapshotVersion.toMicroseconds()>=3e8||V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0)&&c.push(i.qe.updateTargetData(u,E))}}});var h=re();if(t.documentUpdates.forEach(function(g,_){t.resolvedLimboDocuments.has(g)&&c.push(i.persistence.referenceDelegate.updateLimboDocument(u,g))}),c.push(Dl(u,a,t.documentUpdates,o,void 0).next(function(g){h=g})),!o.isEqual(j.min())){var p=i.qe.getLastRemoteSnapshotVersion(u).next(function(g){return i.qe.setTargetsMetadata(u,u.currentSequenceNumber,o)});c.push(p)}return S.waitFor(c).next(function(){return a.apply(u)}).next(function(){return i.Mn.En(u,h)}).next(function(){return h})}).then(function(u){return i.kn=s,u})}function Dl(e,t,i,o,s){var u=Y();return i.forEach(function(a){return u=u.add(a)}),t.getEntries(e,u).next(function(a){var c=re();return i.forEach(function(h,p){var g=a.get(h),_=(null==s?void 0:s.get(h))||o;p.isNoDocument()&&p.version.isEqual(j.min())?(t.removeEntry(h,_),c=c.insert(h,p)):!g.isValidDocument()||p.version.compareTo(g.version)>0||0===p.version.compareTo(g.version)&&g.hasPendingWrites?(t.addEntry(p,_),c=c.insert(h,p)):N("LocalStore","Ignoring outdated watch update for ",h,". Current version:",g.version," Watch version:",p.version)}),c})}function Od(e,t){var i=M(e);return i.persistence.runTransaction("Get next mutation batch","readonly",function(o){return void 0===t&&(t=-1),i._n.getNextMutationBatchAfterBatchId(o,t)})}function Ur(e,t){var i=M(e);return i.persistence.runTransaction("Allocate target","readwrite",function(o){var s;return i.qe.getTargetData(o,t).next(function(u){return u?S.resolve(s=u):i.qe.allocateTargetId(o).next(function(a){return s=new is(t,a,0,o.currentSequenceNumber),i.qe.addTargetData(o,s).next(function(){return s})})})}).then(function(o){var s=i.kn.get(o.targetId);return(null===s||o.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(i.kn=i.kn.insert(o.targetId,o),i.Fn.set(t,o.targetId)),o})}function Gr(e,t,i){return(0,v.mG)(this,void 0,void 0,function(){var o,s,u,a;return(0,v.Jh)(this,function(c){switch(c.label){case 0:o=M(e),s=o.kn.get(t),u=i?"readwrite":"readwrite-primary",c.label=1;case 1:return c.trys.push([1,4,,5]),i?[3,3]:[4,o.persistence.runTransaction("Release target",u,function(h){return o.persistence.referenceDelegate.removeTarget(h,s)})];case 2:c.sent(),c.label=3;case 3:return[3,5];case 4:if(!Mn(a=c.sent()))throw a;return N("LocalStore","Failed to update sequence numbers for target "+t+": "+a),[3,5];case 5:return o.kn=o.kn.remove(t),o.Fn.delete(s.target),[2]}})})}function ls(e,t,i){var o=M(e),s=j.min(),u=Y();return o.persistence.runTransaction("Execute query","readonly",function(a){return(c=o,h=a,p=ne(t),g=M(c),_=g.Fn.get(p),void 0!==_?S.resolve(g.kn.get(_)):g.qe.getTargetData(h,p)).next(function(c){if(c)return s=c.lastLimboFreeSnapshotVersion,o.qe.getMatchingKeysForTargetId(a,c.targetId).next(function(h){u=h})}).next(function(){return o.xn.getDocumentsMatchingQuery(a,t,i?s:j.min(),i?u:Y())}).next(function(c){return{documents:c,Bn:u}});var c,h,p,g,_})}function Nl(e,t){var i=M(e),o=M(i.qe),s=i.kn.get(t);return s?Promise.resolve(s.target):i.persistence.runTransaction("Get target data","readonly",function(u){return o.lt(u,t).next(function(a){return a?a.target:null})})}function Vl(e){var t=M(e);return t.persistence.runTransaction("Get new document changes","readonly",function(i){return s=i,u=t.$n,a=M(t.On),c=re(),h=Tu(u),p=tn(s),g=IDBKeyRange.lowerBound(h,!0),p.$t({index:ut.readTimeIndex,range:g},function(_,b){var w=Cu(a.R,b);c=c.insert(w.key,w),h=b.readTime}).next(function(){return{wn:c,readTime:cl(h)}});var s,u,a,c,h,p,g}).then(function(i){var o=i.wn;return t.$n=i.readTime,o})}function xd(e){return(0,v.mG)(this,void 0,void 0,function(){var t;return(0,v.Jh)(this,function(i){return[2,(t=M(e)).persistence.runTransaction("Synchronize last document change read time","readonly",function(o){return u=tn(o),a=j.min(),u.$t({index:ut.readTimeIndex,reverse:!0},function(c,h,p){h.readTime&&(a=cl(h.readTime)),p.done()}).next(function(){return a});var u,a}).then(function(o){t.$n=o})]})})}function Fd(e,t,i,o){return(0,v.mG)(this,void 0,void 0,function(){var s,u,a,c,h,p,g,_,b,w;return(0,v.Jh)(this,function(E){switch(E.label){case 0:for(s=M(e),u=Y(),a=re(),c=kc(),h=0,p=i;h<p.length;h++)_=t.qn((g=p[h]).metadata.name),g.document&&(u=u.add(_)),a=a.insert(_,t.Un(g)),c=c.insert(_,t.Kn(g.metadata.readTime));return b=s.On.newChangeBuffer({trackRemovals:!0}),[4,Ur(s,(T=o,ne(Tr(Q.fromString("__bundle__/docs/"+T)))))];case 1:return w=E.sent(),[2,s.persistence.runTransaction("Apply bundle documents","readwrite",function(T){return Dl(T,b,a,j.min(),c).next(function(D){return b.apply(T),D}).next(function(D){return s.qe.removeMatchingKeysForTargetId(T,w.targetId).next(function(){return s.qe.addMatchingKeys(T,u,w.targetId)}).next(function(){return s.Mn.En(T,D)}).next(function(){return D})})})]}var T})})}function kd(e,t,i){return void 0===i&&(i=Y()),(0,v.mG)(this,void 0,void 0,function(){var o,s;return(0,v.Jh)(this,function(u){switch(u.label){case 0:return[4,Ur(e,ne(Iu(t.bundledQuery)))];case 1:return o=u.sent(),[2,(s=M(e)).persistence.runTransaction("Save named query","readwrite",function(a){var c=wt(t.readTime);if(o.snapshotVersion.compareTo(c)>=0)return s.Ke.saveNamedQuery(a,t);var h=o.withResumeToken(Lt.EMPTY_BYTE_STRING,c);return s.kn=s.kn.insert(h.targetId,h),s.qe.updateTargetData(a,h).next(function(){return s.qe.removeMatchingKeysForTargetId(a,o.targetId)}).next(function(){return s.qe.addMatchingKeys(a,i,o.targetId)}).next(function(){return s.Ke.saveNamedQuery(a,t)})})]}})})}var Rd=function(){function e(t){this.R=t,this.Qn=new Map,this.jn=new Map}return e.prototype.getBundleMetadata=function(t,i){return S.resolve(this.Qn.get(i))},e.prototype.saveBundleMetadata=function(t,i){var o;return this.Qn.set(i.id,{id:(o=i).id,version:o.version,createTime:wt(o.createTime)}),S.resolve()},e.prototype.getNamedQuery=function(t,i){return S.resolve(this.jn.get(i))},e.prototype.saveNamedQuery=function(t,i){return this.jn.set(i.name,{name:(o=i).name,query:Iu(o.bundledQuery),readTime:wt(o.readTime)}),S.resolve();var o},e}(),Nu=function(){function e(){this.Wn=new vt(Et.Gn),this.zn=new vt(Et.Hn)}return e.prototype.isEmpty=function(){return this.Wn.isEmpty()},e.prototype.addReference=function(t,i){var o=new Et(t,i);this.Wn=this.Wn.add(o),this.zn=this.zn.add(o)},e.prototype.Jn=function(t,i){var o=this;t.forEach(function(s){return o.addReference(s,i)})},e.prototype.removeReference=function(t,i){this.Yn(new Et(t,i))},e.prototype.Xn=function(t,i){var o=this;t.forEach(function(s){return o.removeReference(s,i)})},e.prototype.Zn=function(t){var i=this,o=new k(new Q([])),s=new Et(o,t),u=new Et(o,t+1),a=[];return this.zn.forEachInRange([s,u],function(c){i.Yn(c),a.push(c.key)}),a},e.prototype.ts=function(){var t=this;this.Wn.forEach(function(i){return t.Yn(i)})},e.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},e.prototype.es=function(t){var i=new k(new Q([])),o=new Et(i,t),s=new Et(i,t+1),u=Y();return this.zn.forEachInRange([o,s],function(a){u=u.add(a.key)}),u},e.prototype.containsKey=function(t){var i=new Et(t,0),o=this.Wn.firstAfterOrEqual(i);return null!==o&&t.isEqual(o.key)},e}(),Et=function(){function e(t,i){this.key=t,this.ns=i}return e.Gn=function(t,i){return k.comparator(t.key,i.key)||H(t.ns,i.ns)},e.Hn=function(t,i){return H(t.ns,i.ns)||k.comparator(t.key,i.key)},e}(),Pd=function(){function e(t,i){this.Ut=t,this.referenceDelegate=i,this._n=[],this.ss=1,this.rs=new vt(Et.Gn)}return e.prototype.checkEmpty=function(t){return S.resolve(0===this._n.length)},e.prototype.addMutationBatch=function(t,i,o,s){var u=this.ss;this.ss++;var a=new Eu(u,i,o,s);this._n.push(a);for(var c=0,h=s;c<h.length;c++){var p=h[c];this.rs=this.rs.add(new Et(p.key,u)),this.Ut.addToCollectionParentIndex(t,p.key.path.popLast())}return S.resolve(a)},e.prototype.lookupMutationBatch=function(t,i){return S.resolve(this.os(i))},e.prototype.getNextMutationBatchAfterBatchId=function(t,i){var s=this.cs(i+1),u=s<0?0:s;return S.resolve(this._n.length>u?this._n[u]:null)},e.prototype.getHighestUnacknowledgedBatchId=function(){return S.resolve(0===this._n.length?-1:this.ss-1)},e.prototype.getAllMutationBatches=function(t){return S.resolve(this._n.slice())},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,i){var o=this,s=new Et(i,0),u=new Et(i,Number.POSITIVE_INFINITY),a=[];return this.rs.forEachInRange([s,u],function(c){var h=o.os(c.ns);a.push(h)}),S.resolve(a)},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,i){var o=this,s=new vt(H);return i.forEach(function(u){var a=new Et(u,0),c=new Et(u,Number.POSITIVE_INFINITY);o.rs.forEachInRange([a,c],function(h){s=s.add(h.ns)})}),S.resolve(this.us(s))},e.prototype.getAllMutationBatchesAffectingQuery=function(t,i){var o=i.path,s=o.length+1,u=o;k.isDocumentKey(u)||(u=u.child(""));var a=new Et(new k(u),0),c=new vt(H);return this.rs.forEachWhile(function(h){var p=h.key.path;return!!o.isPrefixOf(p)&&(p.length===s&&(c=c.add(h.ns)),!0)},a),S.resolve(this.us(c))},e.prototype.us=function(t){var i=this,o=[];return t.forEach(function(s){var u=i.os(s);null!==u&&o.push(u)}),o},e.prototype.removeMutationBatch=function(t,i){var o=this;q(0===this.hs(i.batchId,"removed")),this._n.shift();var s=this.rs;return S.forEach(i.mutations,function(u){var a=new Et(u.key,i.batchId);return s=s.delete(a),o.referenceDelegate.markPotentiallyOrphaned(t,u.key)}).next(function(){o.rs=s})},e.prototype.Gt=function(t){},e.prototype.containsKey=function(t,i){var o=new Et(i,0),s=this.rs.firstAfterOrEqual(o);return S.resolve(i.isEqual(s&&s.key))},e.prototype.performConsistencyCheck=function(t){return S.resolve()},e.prototype.hs=function(t,i){return this.cs(t)},e.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},e.prototype.os=function(t){var i=this.cs(t);return i<0||i>=this._n.length?null:this._n[i]},e}(),Ld=function(){function e(t,i){this.Ut=t,this.ls=i,this.docs=new xt(k.comparator),this.size=0}return e.prototype.addEntry=function(t,i,o){var s=i.key,u=this.docs.get(s),a=u?u.size:0,c=this.ls(i);return this.docs=this.docs.insert(s,{document:i.clone(),size:c,readTime:o}),this.size+=c-a,this.Ut.addToCollectionParentIndex(t,s.path.popLast())},e.prototype.removeEntry=function(t){var i=this.docs.get(t);i&&(this.docs=this.docs.remove(t),this.size-=i.size)},e.prototype.getEntry=function(t,i){var o=this.docs.get(i);return S.resolve(o?o.document.clone():St.newInvalidDocument(i))},e.prototype.getEntries=function(t,i){var o=this,s=re();return i.forEach(function(u){var a=o.docs.get(u);s=s.insert(u,a?a.document.clone():St.newInvalidDocument(u))}),S.resolve(s)},e.prototype.getDocumentsMatchingQuery=function(t,i,o){for(var s=re(),u=new k(i.path.child("")),a=this.docs.getIteratorFrom(u);a.hasNext();){var c=a.getNext(),p=c.value,g=p.document,_=p.readTime;if(!i.path.isPrefixOf(c.key.path))break;_.compareTo(o)<=0||Bi(i,g)&&(s=s.insert(g.key,g.clone()))}return S.resolve(s)},e.prototype.fs=function(t,i){return S.forEach(this.docs,function(o){return i(o)})},e.prototype.newChangeBuffer=function(t){return new Ud(this)},e.prototype.getSize=function(t){return S.resolve(this.size)},e}(),Ud=function(e){function t(i){var o=this;return(o=e.call(this)||this).Ie=i,o}return(0,v.ZT)(t,e),t.prototype.applyChanges=function(i){var o=this,s=[];return this.changes.forEach(function(u,a){a.document.isValidDocument()?s.push(o.Ie.addEntry(i,a.document,o.getReadTime(u))):o.Ie.removeEntry(u)}),S.waitFor(s)},t.prototype.getFromCache=function(i,o){return this.Ie.getEntry(i,o)},t.prototype.getAllFromCache=function(i,o){return this.Ie.getEntries(i,o)},t}(bl),Gd=function(){function e(t){this.persistence=t,this.ds=new Lr(function(i){return Ui(i)},Jo),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.ws=0,this._s=new Nu,this.targetCount=0,this.ys=ss.Jt()}return e.prototype.forEachTarget=function(t,i){return this.ds.forEach(function(o,s){return i(s)}),S.resolve()},e.prototype.getLastRemoteSnapshotVersion=function(t){return S.resolve(this.lastRemoteSnapshotVersion)},e.prototype.getHighestSequenceNumber=function(t){return S.resolve(this.ws)},e.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),S.resolve(this.highestTargetId)},e.prototype.setTargetsMetadata=function(t,i,o){return o&&(this.lastRemoteSnapshotVersion=o),i>this.ws&&(this.ws=i),S.resolve()},e.prototype.te=function(t){this.ds.set(t.target,t);var i=t.targetId;i>this.highestTargetId&&(this.ys=new ss(i),this.highestTargetId=i),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},e.prototype.addTargetData=function(t,i){return this.te(i),this.targetCount+=1,S.resolve()},e.prototype.updateTargetData=function(t,i){return this.te(i),S.resolve()},e.prototype.removeTargetData=function(t,i){return this.ds.delete(i.target),this._s.Zn(i.targetId),this.targetCount-=1,S.resolve()},e.prototype.removeTargets=function(t,i,o){var s=this,u=0,a=[];return this.ds.forEach(function(c,h){h.sequenceNumber<=i&&null===o.get(h.targetId)&&(s.ds.delete(c),a.push(s.removeMatchingKeysForTargetId(t,h.targetId)),u++)}),S.waitFor(a).next(function(){return u})},e.prototype.getTargetCount=function(t){return S.resolve(this.targetCount)},e.prototype.getTargetData=function(t,i){var o=this.ds.get(i)||null;return S.resolve(o)},e.prototype.addMatchingKeys=function(t,i,o){return this._s.Jn(i,o),S.resolve()},e.prototype.removeMatchingKeys=function(t,i,o){this._s.Xn(i,o);var s=this.persistence.referenceDelegate,u=[];return s&&i.forEach(function(a){u.push(s.markPotentiallyOrphaned(t,a))}),S.waitFor(u)},e.prototype.removeMatchingKeysForTargetId=function(t,i){return this._s.Zn(i),S.resolve()},e.prototype.getMatchingKeysForTargetId=function(t,i){var o=this._s.es(i);return S.resolve(o)},e.prototype.containsKey=function(t,i){return S.resolve(this._s.containsKey(i))},e}(),qd=function(){function e(t,i){var o=this;this.gs={},this.Ne=new Ht(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Gd(this),this.Ut=new gd,this.Ue=new Ld(this.Ut,function(a){return o.referenceDelegate.ps(a)}),this.R=new ul(i),this.Ke=new Rd(this.R)}return e.prototype.start=function(){return Promise.resolve()},e.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.setDatabaseDeletedListener=function(){},e.prototype.setNetworkEnabled=function(){},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getMutationQueue=function(t){var i=this.gs[t.toKey()];return i||(i=new Pd(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=i),i},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,i,o){var s=this;N("MemoryPersistence","Starting transaction:",t);var u=new Bd(this.Ne.next());return this.referenceDelegate.Es(),o(u).next(function(a){return s.referenceDelegate.Ts(u).next(function(){return a})}).toPromise().then(function(a){return u.raiseOnCommittedEvent(),a})},e.prototype.Is=function(t,i){return S.or(Object.values(this.gs).map(function(o){return function(){return o.containsKey(t,i)}}))},e}(),Bd=function(e){function t(i){var o=this;return(o=e.call(this)||this).currentSequenceNumber=i,o}return(0,v.ZT)(t,e),t}(rl),jd=function(){function e(t){this.persistence=t,this.As=new Nu,this.Rs=null}return e.bs=function(t){return new e(t)},Object.defineProperty(e.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw F()},enumerable:!1,configurable:!0}),e.prototype.addReference=function(t,i,o){return this.As.addReference(o,i),this.vs.delete(o.toString()),S.resolve()},e.prototype.removeReference=function(t,i,o){return this.As.removeReference(o,i),this.vs.add(o.toString()),S.resolve()},e.prototype.markPotentiallyOrphaned=function(t,i){return this.vs.add(i.toString()),S.resolve()},e.prototype.removeTarget=function(t,i){var o=this;this.As.Zn(i.targetId).forEach(function(u){return o.vs.add(u.toString())});var s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(t,i.targetId).next(function(u){u.forEach(function(a){return o.vs.add(a.toString())})}).next(function(){return s.removeTargetData(t,i)})},e.prototype.Es=function(){this.Rs=new Set},e.prototype.Ts=function(t){var i=this,o=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.vs,function(s){var u=k.fromPath(s);return i.Ps(t,u).next(function(a){a||o.removeEntry(u)})}).next(function(){return i.Rs=null,o.apply(t)})},e.prototype.updateLimboDocument=function(t,i){var o=this;return this.Ps(t,i).next(function(s){s?o.vs.delete(i.toString()):o.vs.add(i.toString())})},e.prototype.ps=function(t){return 0},e.prototype.Ps=function(t,i){var o=this;return S.or([function(){return S.resolve(o.As.containsKey(i))},function(){return o.persistence.getTargetCache().containsKey(t,i)},function(){return o.persistence.Is(t,i)}])},e}(),Nt=function(){function e(t){this.uid=t}return e.prototype.isAuthenticated=function(){return null!=this.uid},e.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},e.prototype.isEqual=function(t){return t.uid===this.uid},e}();function Ml(e,t){return"firestore_clients_"+e+"_"+t}function Ol(e,t,i){var o="firestore_mutations_"+e+"_"+i;return t.isAuthenticated()&&(o+="_"+t.uid),o}function Vu(e,t){return"firestore_targets_"+e+"_"+t}Nt.UNAUTHENTICATED=new Nt(null),Nt.GOOGLE_CREDENTIALS=new Nt("google-credentials-uid"),Nt.FIRST_PARTY=new Nt("first-party-uid"),Nt.MOCK_USER=new Nt("mock-user");var xl=function(){function e(t,i,o,s){this.user=t,this.batchId=i,this.state=o,this.error=s}return e.Vs=function(t,i,o){var s,u=JSON.parse(o),a="object"==typeof u&&-1!==["pending","acknowledged","rejected"].indexOf(u.state)&&(void 0===u.error||"object"==typeof u.error);return a&&u.error&&(a="string"==typeof u.error.message&&"string"==typeof u.error.code)&&(s=new A(u.error.code,u.error.message)),a?new e(t,i,u.state,s):(ht("SharedClientState","Failed to parse mutation state for ID '"+i+"': "+o),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),Mu=function(){function e(t,i,o){this.targetId=t,this.state=i,this.error=o}return e.Vs=function(t,i){var o,s=JSON.parse(i),u="object"==typeof s&&-1!==["not-current","current","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return u&&s.error&&(u="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(o=new A(s.error.code,s.error.message)),u?new e(t,s.state,o):(ht("SharedClientState","Failed to parse target state for ID '"+t+"': "+i),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),Fl=function(){function e(t,i){this.clientId=t,this.activeTargetIds=i}return e.Vs=function(t,i){for(var o=JSON.parse(i),s="object"==typeof o&&o.activeTargetIds instanceof Array,u=es(),a=0;s&&a<o.activeTargetIds.length;++a)s=sc(o.activeTargetIds[a]),u=u.add(o.activeTargetIds[a]);return s?new e(t,u):(ht("SharedClientState","Failed to parse client data for instance '"+t+"': "+i),null)},e}(),Kd=function(){function e(t,i){this.clientId=t,this.onlineState=i}return e.Vs=function(t){var i=JSON.parse(t);return"object"==typeof i&&-1!==["Unknown","Online","Offline"].indexOf(i.onlineState)&&"string"==typeof i.clientId?new e(i.clientId,i.onlineState):(ht("SharedClientState","Failed to parse online state: "+t),null)},e}(),Ou=function(){function e(){this.activeTargetIds=es()}return e.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},e.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},e.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},e}(),xu=function(){function e(t,i,o,s,u){this.window=t,this.Se=i,this.persistenceKey=o,this.Ns=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new xt(H),this.started=!1,this.$s=[];var a=o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=u,this.Os=Ml(this.persistenceKey,this.Ns),this.Ms="firestore_sequence_number_"+this.persistenceKey,this.Fs=this.Fs.insert(this.Ns,new Ou),this.Ls=new RegExp("^firestore_clients_"+a+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+a+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+a+"_(\\d+)$"),this.Us="firestore_online_state_"+this.persistenceKey,this.Ks=function(c){return"firestore_bundle_loaded_"+c}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return e.yt=function(t){return!(!t||!t.localStorage)},e.prototype.start=function(){return(0,v.mG)(this,void 0,void 0,function(){var t,i,o,s,u,a,c,h,p,g,b=this;return(0,v.Jh)(this,function(w){switch(w.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=w.sent(),i=0,o=t;i<o.length;i++)(s=o[i])!==this.Ns&&(u=this.getItem(Ml(this.persistenceKey,s)))&&(a=Fl.Vs(s,u))&&(this.Fs=this.Fs.insert(a.clientId,a));for(this.Qs(),(c=this.storage.getItem(this.Us))&&(h=this.js(c))&&this.Ws(h),p=0,g=this.$s;p<g.length;p++)this.ks(g[p]);return this.$s=[],this.window.addEventListener("pagehide",function(){return b.shutdown()}),this.started=!0,[2]}})})},e.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},e.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},e.prototype.isActiveQueryTarget=function(t){var i=!1;return this.Fs.forEach(function(o,s){s.activeTargetIds.has(t)&&(i=!0)}),i},e.prototype.addPendingMutation=function(t){this.zs(t,"pending")},e.prototype.updateMutationState=function(t,i,o){this.zs(t,i,o),this.Hs(t)},e.prototype.addLocalQueryTarget=function(t){var i="not-current";if(this.isActiveQueryTarget(t)){var o=this.storage.getItem(Vu(this.persistenceKey,t));if(o){var s=Mu.Vs(t,o);s&&(i=s.state)}}return this.Js.Ds(t),this.Qs(),i},e.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},e.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){this.removeItem(Vu(this.persistenceKey,t))},e.prototype.updateQueryState=function(t,i,o){this.Ys(t,i,o)},e.prototype.handleUserChange=function(t,i,o){var s=this;i.forEach(function(u){s.Hs(u)}),this.currentUser=t,o.forEach(function(u){s.addPendingMutation(u)})},e.prototype.setOnlineState=function(t){this.Xs(t)},e.prototype.notifyBundleLoaded=function(){this.Zs()},e.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},e.prototype.getItem=function(t){var i=this.storage.getItem(t);return N("SharedClientState","READ",t,i),i},e.prototype.setItem=function(t,i){N("SharedClientState","SET",t,i),this.storage.setItem(t,i)},e.prototype.removeItem=function(t){N("SharedClientState","REMOVE",t),this.storage.removeItem(t)},e.prototype.ks=function(t){var i=this,o=t;if(o.storageArea===this.storage){if(N("SharedClientState","EVENT",o.key,o.newValue),o.key===this.Os)return void ht("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return(0,v.mG)(i,void 0,void 0,function(){var s,u,a,c,h,p;return(0,v.Jh)(this,function(g){if(this.started){if(null!==o.key)if(this.Ls.test(o.key)){if(null==o.newValue)return s=this.ti(o.key),[2,this.ei(s,null)];if(u=this.ni(o.key,o.newValue))return[2,this.ei(u.clientId,u)]}else if(this.Bs.test(o.key)){if(null!==o.newValue&&(a=this.si(o.key,o.newValue)))return[2,this.ii(a)]}else if(this.qs.test(o.key)){if(null!==o.newValue&&(c=this.ri(o.key,o.newValue)))return[2,this.oi(c)]}else if(o.key===this.Us){if(null!==o.newValue&&(h=this.js(o.newValue)))return[2,this.Ws(h)]}else if(o.key===this.Ms)(p=function(_){var b=Ht.o;if(null!=_)try{var w=JSON.parse(_);q("number"==typeof w),b=w}catch(E){ht("SharedClientState","Failed to read sequence number from WebStorage",E)}return b}(o.newValue))!==Ht.o&&this.sequenceNumberHandler(p);else if(o.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(o);return[2]})})})}},Object.defineProperty(e.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),e.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},e.prototype.zs=function(t,i,o){var s=new xl(this.currentUser,t,i,o),u=Ol(this.persistenceKey,this.currentUser,t);this.setItem(u,s.Ss())},e.prototype.Hs=function(t){var i=Ol(this.persistenceKey,this.currentUser,t);this.removeItem(i)},e.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},e.prototype.Ys=function(t,i,o){var s=Vu(this.persistenceKey,t),u=new Mu(t,i,o);this.setItem(s,u.Ss())},e.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},e.prototype.ti=function(t){var i=this.Ls.exec(t);return i?i[1]:null},e.prototype.ni=function(t,i){var o=this.ti(t);return Fl.Vs(o,i)},e.prototype.si=function(t,i){var o=this.Bs.exec(t),s=Number(o[1]);return xl.Vs(new Nt(void 0!==o[2]?o[2]:null),s,i)},e.prototype.ri=function(t,i){var o=this.qs.exec(t),s=Number(o[1]);return Mu.Vs(s,i)},e.prototype.js=function(t){return Kd.Vs(t)},e.prototype.ii=function(t){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(i){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(N("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},e.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},e.prototype.ei=function(t,i){var o=this,s=i?this.Fs.insert(t,i):this.Fs.remove(t),u=this.Gs(this.Fs),a=this.Gs(s),c=[],h=[];return a.forEach(function(p){u.has(p)||c.push(p)}),u.forEach(function(p){a.has(p)||h.push(p)}),this.syncEngine.hi(c,h).then(function(){o.Fs=s})},e.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},e.prototype.Gs=function(t){var i=es();return t.forEach(function(o,s){i=i.unionWith(s.activeTargetIds)}),i},e}(),kl=function(){function e(){this.li=new Ou,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return e.prototype.addPendingMutation=function(t){},e.prototype.updateMutationState=function(t,i,o){},e.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},e.prototype.updateQueryState=function(t,i,o){this.fi[t]=i},e.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},e.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){delete this.fi[t]},e.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},e.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.start=function(){return this.li=new Ou,Promise.resolve()},e.prototype.handleUserChange=function(t,i,o){},e.prototype.setOnlineState=function(t){},e.prototype.shutdown=function(){},e.prototype.writeSequenceNumber=function(t){},e.prototype.notifyBundleLoaded=function(){},e}(),Hd=function(){function e(){}return e.prototype.di=function(t){},e.prototype.shutdown=function(){},e}(),Rl=function(){function e(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return e.prototype.di=function(t){this.gi.push(t)},e.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},e.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},e.prototype._i=function(){N("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,i=this.gi;t<i.length;t++)(0,i[t])(0)},e.prototype.yi=function(){N("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,i=this.gi;t<i.length;t++)(0,i[t])(1)},e.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},e}(),Jd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},zd=function(){function e(t){this.Ei=t.Ei,this.Ti=t.Ti}return e.prototype.Ii=function(t){this.Ai=t},e.prototype.Ri=function(t){this.bi=t},e.prototype.onMessage=function(t){this.vi=t},e.prototype.close=function(){this.Ti()},e.prototype.send=function(t){this.Ei(t)},e.prototype.Pi=function(){this.Ai()},e.prototype.Vi=function(t){this.bi(t)},e.prototype.Si=function(t){this.vi(t)},e}(),Qd=function(e){function t(i){var o=this;return(o=e.call(this,i)||this).forceLongPolling=i.forceLongPolling,o.autoDetectLongPolling=i.autoDetectLongPolling,o.useFetchStreams=i.useFetchStreams,o}return(0,v.ZT)(t,e),t.prototype.Fi=function(i,o,s,u){return new Promise(function(a,c){var h=new Xa;h.listenOnce(Ya.COMPLETE,function(){try{switch(h.getLastErrorCode()){case Bo.NO_ERROR:var g=h.getResponseJson();N("Connection","XHR received:",JSON.stringify(g)),a(g);break;case Bo.TIMEOUT:N("Connection",'RPC "'+i+'" timed out'),c(new A(C.DEADLINE_EXCEEDED,"Request time out"));break;case Bo.HTTP_ERROR:var _=h.getStatus();if(N("Connection",'RPC "'+i+'" failed with status:',_,"response text:",h.getResponseText()),_>0){var b=h.getResponseJson().error;if(b&&b.status&&b.message){var w=(T=b.status.toLowerCase().replace(/_/g,"-"),Object.values(C).indexOf(T)>=0?T:C.UNKNOWN);c(new A(w,b.message))}else c(new A(C.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new A(C.UNAVAILABLE,"Connection failed."));break;default:F()}}finally{N("Connection",'RPC "'+i+'" completed.')}var T});var p=JSON.stringify(u);h.send(o,"POST",p,s,15)})},t.prototype.Oi=function(i,o){var s=[this.Di,"/","google.firestore.v1.Firestore","/",i,"/channel"],u=new qo,a=or(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(c.xmlHttpFactory=new Za({})),this.ki(c.initMessageHeaders,o),(0,U.uI)()||(0,U.b$)()||(0,U.d)()||(0,U.w1)()||(0,U.Mn)()||(0,U.ru)()||(c.httpHeadersOverwriteParam="$httpHeaders");var h=s.join("");N("Connection","Creating WebChannel: "+h,c);var p=u.createWebChannel(h,c),g=!1,_=!1,b=new zd({Ei:function(E){_?N("Connection","Not sending because WebChannel is closed:",E):(g||(N("Connection","Opening WebChannel transport."),p.open(),g=!0),N("Connection","WebChannel sending:",E),p.send(E))},Ti:function(){return p.close()}}),w=function(E,T,D){E.listen(T,function(V){try{D(V)}catch(R){setTimeout(function(){throw R},0)}})};return w(p,Fi.EventType.OPEN,function(){_||N("Connection","WebChannel transport opened.")}),w(p,Fi.EventType.CLOSE,function(){_||(_=!0,N("Connection","WebChannel transport closed"),b.Vi())}),w(p,Fi.EventType.ERROR,function(E){_||(_=!0,ki("Connection","WebChannel transport errored:",E),b.Vi(new A(C.UNAVAILABLE,"The operation could not be completed")))}),w(p,Fi.EventType.MESSAGE,function(E){var T;if(!_){var D=E.data[0];q(!!D);var R=D.error||(null===(T=D[0])||void 0===T?void 0:T.error);if(R){N("Connection","WebChannel received error:",R);var P=R.status,K=function($){var Vt=dt[$];if(void 0!==Vt)return xc(Vt)}(P),z=R.message;void 0===K&&(K=C.INTERNAL,z="Unknown error status: "+P+" with message "+R.message),_=!0,b.Vi(new A(K,z)),p.close()}else N("Connection","WebChannel received:",D),b.Si(D)}}),w(a,$a.STAT_EVENT,function(E){E.stat===nu_PROXY?N("Connection","Detected buffering proxy"):E.stat===nu_NOPROXY&&N("Connection","Detected no buffering proxy")}),setTimeout(function(){b.Pi()},0),b},t}(function(){function e(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return e.prototype.Ni=function(t,i,o,s){var u=this.xi(t,i);N("RestConnection","Sending: ",u,o);var a={};return this.ki(a,s),this.Fi(t,u,a,o).then(function(c){return N("RestConnection","Received: ",c),c},function(c){throw ki("RestConnection",t+" failed with error: ",c,"url: ",u,"request:",o),c})},e.prototype.$i=function(t,i,o,s){return this.Ni(t,i,o,s)},e.prototype.ki=function(t,i){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i)for(var o in i.authHeaders)i.authHeaders.hasOwnProperty(o)&&(t[o]=i.authHeaders[o])},e.prototype.xi=function(t,i){return this.Di+"/v1/"+i+":"+Jd[t]},e}());function Pl(){return"undefined"!=typeof window?window:null}function hs(){return"undefined"!=typeof document?document:null}function Zi(e){return new Xf(e,!0)}var Fu=function(){function e(t,i,o,s,u){void 0===o&&(o=1e3),void 0===s&&(s=1.5),void 0===u&&(u=6e4),this.Se=t,this.timerId=i,this.Mi=o,this.Li=s,this.Bi=u,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return e.prototype.reset=function(){this.qi=0},e.prototype.Qi=function(){this.qi=this.Bi},e.prototype.ji=function(t){var i=this;this.cancel();var o=Math.floor(this.qi+this.Wi()),s=Math.max(0,Date.now()-this.Ki),u=Math.max(0,o-s);u>0&&N("ExponentialBackoff","Backing off for "+u+" ms (base delay: "+this.qi+" ms, delay with jitter: "+o+" ms, last attempt: "+s+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,u,function(){return i.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},e.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},e.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},e.prototype.Wi=function(){return(Math.random()-.5)*this.qi},e}(),Ll=function(){function e(t,i,o,s,u,a){this.Se=t,this.zi=o,this.Hi=s,this.Ji=u,this.listener=a,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Fu(t,i)}return e.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},e.prototype.er=function(){return 2===this.state},e.prototype.start=function(){3!==this.state?this.auth():this.nr()},e.prototype.stop=function(){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},e.prototype.sr=function(){this.state=0,this.Zi.reset()},e.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},e.prototype.cr=function(t){this.ur(),this.stream.send(t)},e.prototype.rr=function(){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},e.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},e.prototype.close=function(t,i){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(o){switch(o.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():i&&i.code===C.RESOURCE_EXHAUSTED?(ht(i.toString()),ht("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):i&&i.code===C.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(i)];case 1:return o.sent(),[2]}})})},e.prototype.ar=function(){},e.prototype.auth=function(){var t=this;this.state=1;var i=this.hr(this.Yi),o=this.Yi;this.Ji.getToken().then(function(s){t.Yi===o&&t.lr(s)},function(s){i(function(){var u=new A(C.UNKNOWN,"Fetching auth token failed: "+s.message);return t.dr(u)})})},e.prototype.lr=function(t){var i=this,o=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){o(function(){return i.state=2,i.listener.Ii()})}),this.stream.Ri(function(s){o(function(){return i.dr(s)})}),this.stream.onMessage(function(s){o(function(){return i.onMessage(s)})})},e.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return(0,v.mG)(t,void 0,void 0,function(){return(0,v.Jh)(this,function(i){return this.state=0,this.start(),[2]})})})},e.prototype.dr=function(t){return N("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},e.prototype.hr=function(t){var i=this;return function(o){i.Se.enqueueAndForget(function(){return i.Yi===t?o():(N("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},e}(),Wd=function(e){function t(i,o,s,u,a){var c=this;return(c=e.call(this,i,"listen_stream_connection_backoff","listen_stream_idle",o,s,a)||this).R=u,c}return(0,v.ZT)(t,e),t.prototype.wr=function(i){return this.Hi.Oi("Listen",i)},t.prototype.onMessage=function(i){this.Zi.reset();var o=function(u,a){var c,D;if("targetChange"in a){var h="NO_CHANGE"===(D=a.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===D?1:"REMOVE"===D?2:"CURRENT"===D?3:"RESET"===D?4:F(),p=a.targetChange.targetIds||[],g=function(D,V){return D.I?(q(void 0===V||"string"==typeof V),Lt.fromBase64String(V||"")):(q(void 0===V||V instanceof Uint8Array),Lt.fromUint8Array(V||new Uint8Array))}(u,a.targetChange.resumeToken),_=(b=a.targetChange.cause)&&function(D){var V=void 0===D.code?C.UNKNOWN:xc(D.code);return new A(V,D.message||"")}(b);c=new Pc(h,p,g,_||null)}else if("documentChange"in a){p=ge(u,(h=a.documentChange).document.name),g=wt(h.document.updateTime);var b=new Jt({mapValue:{fields:h.document.fields}}),w=(_=St.newFoundDocument(p,g,b),h.targetIds||[]);c=new ns(w,h.removedTargetIds||[],_.key,_)}else if("documentDelete"in a)p=ge(u,(h=a.documentDelete).document),g=h.readTime?wt(h.readTime):j.min(),b=St.newNoDocument(p,g),c=new ns([],_=h.removedTargetIds||[],b.key,b);else if("documentRemove"in a)p=ge(u,(h=a.documentRemove).document),c=new ns([],g=h.removedTargetIds||[],p,null);else{if(!("filter"in a))return F();var T=a.filter;p=new Kf(h=T.count||0),c=new Rc(g=T.targetId,p)}return c}(this.R,i),s=function(u){if(!("targetChange"in u))return j.min();var a=u.targetChange;return a.targetIds&&a.targetIds.length?j.min():a.readTime?wt(a.readTime):j.min()}(i);return this.listener._r(o,s)},t.prototype.mr=function(i){var u,a,c,h,o={};o.database=Qi(this.R),o.addTarget=(u=this.R,(c=zo(h=(a=i).target)?{documents:Qc(u,h)}:{query:Wc(u,h)}).targetId=a.targetId,a.resumeToken.approximateByteSize()>0?c.resumeToken=qc(u,a.resumeToken):a.snapshotVersion.compareTo(j.min())>0&&(c.readTime=Ji(u,a.snapshotVersion.toTimestamp())),c);var s=function(u,a){var c=function(h,p){switch(p){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return F()}}(0,a.purpose);return null==c?null:{"goog-listen-tags":c}}(0,i);s&&(o.labels=s),this.cr(o)},t.prototype.yr=function(i){var o={};o.database=Qi(this.R),o.removeTarget=i,this.cr(o)},t}(Ll),Yd=function(e){function t(i,o,s,u,a){var c=this;return(c=e.call(this,i,"write_stream_connection_backoff","write_stream_idle",o,s,a)||this).R=u,c.gr=!1,c}return(0,v.ZT)(t,e),Object.defineProperty(t.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,e.prototype.start.call(this)},t.prototype.ar=function(){this.gr&&this.Er([])},t.prototype.wr=function(i){return this.Hi.Oi("Write",i)},t.prototype.onMessage=function(i){if(q(!!i.streamToken),this.lastStreamToken=i.streamToken,this.gr){this.Zi.reset();var o=(a=i.commitTime,(u=i.writeResults)&&u.length>0?(q(void 0!==a),u.map(function(c){return p=a,(g=wt((h=c).updateTime?h.updateTime:p)).isEqual(j.min())&&(g=wt(p)),new qf(g,h.transformResults||[]);var h,p,g})):[]),s=wt(i.commitTime);return this.listener.Tr(s,o)}var u,a;return q(!i.writeResults||0===i.writeResults.length),this.gr=!0,this.listener.Ir()},t.prototype.Ar=function(){var i={};i.database=Qi(this.R),this.cr(i)},t.prototype.Er=function(i){var o=this,s={streamToken:this.lastStreamToken,writes:i.map(function(u){return rs(o.R,u)})};this.cr(s)},t}(Ll),$d=function(e){function t(i,o,s){var u=this;return(u=e.call(this)||this).credentials=i,u.Hi=o,u.R=s,u.Rr=!1,u}return(0,v.ZT)(t,e),t.prototype.br=function(){if(this.Rr)throw new A(C.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.Ni=function(i,o,s){var u=this;return this.br(),this.credentials.getToken().then(function(a){return u.Hi.Ni(i,o,s,a)}).catch(function(a){throw"FirebaseError"===a.name?(a.code===C.UNAUTHENTICATED&&u.credentials.invalidateToken(),a):new A(C.UNKNOWN,a.toString())})},t.prototype.$i=function(i,o,s){var u=this;return this.br(),this.credentials.getToken().then(function(a){return u.Hi.$i(i,o,s,a)}).catch(function(a){throw"FirebaseError"===a.name?(a.code===C.UNAUTHENTICATED&&u.credentials.invalidateToken(),a):new A(C.UNKNOWN,a.toString())})},t.prototype.terminate=function(){this.Rr=!0},t}(function(){}),Zd=function(){function e(t,i){this.asyncQueue=t,this.onlineStateHandler=i,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return e.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},e.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},e.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},e.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},e.prototype.Cr=function(t){var i="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(ht(i),this.Vr=!1):N("OnlineStateTracker",i)},e.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},e}(),Xd=function(e,t,i,o,s){var u=this;this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=s,this.Lr.di(function(a){i.enqueueAndForget(function(){return(0,v.mG)(u,void 0,void 0,function(){return(0,v.Jh)(this,function(c){switch(c.label){case 0:return en(this)?(N("RemoteStore","Restarting streams for network reachability change."),[4,function(h){return(0,v.mG)(this,void 0,void 0,function(){var p;return(0,v.Jh)(this,function(g){switch(g.label){case 0:return(p=M(h)).Or.add(4),[4,qr(p)];case 1:return g.sent(),p.Br.set("Unknown"),p.Or.delete(4),[4,Xi(p)];case 2:return g.sent(),[2]}})})}(this)]):[3,2];case 1:c.sent(),c.label=2;case 2:return[2]}})})})}),this.Br=new Zd(i,o)};function Xi(e){return(0,v.mG)(this,void 0,void 0,function(){var t,i;return(0,v.Jh)(this,function(o){switch(o.label){case 0:if(!en(e))return[3,4];t=0,i=e.Mr,o.label=1;case 1:return t<i.length?[4,(0,i[t])(!0)]:[3,4];case 2:o.sent(),o.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function qr(e){return(0,v.mG)(this,void 0,void 0,function(){var t,i;return(0,v.Jh)(this,function(o){switch(o.label){case 0:t=0,i=e.Mr,o.label=1;case 1:return t<i.length?[4,(0,i[t])(!1)]:[3,4];case 2:o.sent(),o.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function fs(e,t){var i=M(e);i.$r.has(t.targetId)||(i.$r.set(t.targetId,t),Pu(i)?Ru(i):jr(i).er()&&ku(i,t))}function to(e,t){var i=M(e),o=jr(i);i.$r.delete(t),o.er()&&Ul(i,t),0===i.$r.size&&(o.er()?o.ir():en(i)&&i.Br.set("Unknown"))}function ku(e,t){e.qr.U(t.targetId),jr(e).mr(t)}function Ul(e,t){e.qr.U(t),jr(e).yr(t)}function Ru(e){e.qr=new Yf({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.$r.get(t)||null}}),jr(e).start(),e.Br.Sr()}function Pu(e){return en(e)&&!jr(e).tr()&&e.$r.size>0}function en(e){return 0===M(e).Or.size}function Gl(e){e.qr=void 0}function tp(e){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(t){return e.$r.forEach(function(i,o){ku(e,i)}),[2]})})}function ep(e,t){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(i){return Gl(e),Pu(e)?(e.Br.Nr(t),Ru(e)):e.Br.set("Unknown"),[2]})})}function np(e,t,i){return(0,v.mG)(this,void 0,void 0,function(){var o,s,u;return(0,v.Jh)(this,function(a){switch(a.label){case 0:if(e.Br.set("Online"),!(t instanceof Pc&&2===t.state&&t.cause))return[3,6];a.label=1;case 1:return a.trys.push([1,3,,5]),[4,function(c,h){return(0,v.mG)(this,void 0,void 0,function(){var p,g,_,b;return(0,v.Jh)(this,function(w){switch(w.label){case 0:p=h.cause,g=0,_=h.targetIds,w.label=1;case 1:return g<_.length?c.$r.has(b=_[g])?[4,c.remoteSyncer.rejectListen(b,p)]:[3,3]:[3,5];case 2:w.sent(),c.$r.delete(b),c.qr.removeTarget(b),w.label=3;case 3:w.label=4;case 4:return g++,[3,1];case 5:return[2]}})})}(e,t)];case 2:return a.sent(),[3,5];case 3:return o=a.sent(),N("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),o),[4,ds(e,o)];case 4:return a.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof ns?e.qr.X(t):t instanceof Rc?e.qr.rt(t):e.qr.et(t),i.isEqual(j.min()))return[3,13];a.label=7;case 7:return a.trys.push([7,11,,13]),[4,Sl(e.localStore)];case 8:return s=a.sent(),i.compareTo(s)>=0?[4,(c=e,h=i,p=c.qr.ut(h),p.targetChanges.forEach(function(g,_){if(g.resumeToken.approximateByteSize()>0){var b=c.$r.get(_);b&&c.$r.set(_,b.withResumeToken(g.resumeToken,h))}}),p.targetMismatches.forEach(function(g){var _=c.$r.get(g);if(_){c.$r.set(g,_.withResumeToken(Lt.EMPTY_BYTE_STRING,_.snapshotVersion)),Ul(c,g);var b=new is(_.target,g,1,_.sequenceNumber);ku(c,b)}}),c.remoteSyncer.applyRemoteEvent(p))]:[3,10];case 9:a.sent(),a.label=10;case 10:return[3,13];case 11:return N("RemoteStore","Failed to raise snapshot:",u=a.sent()),[4,ds(e,u)];case 12:return a.sent(),[3,13];case 13:return[2]}var c,h,p})})}function ds(e,t,i){return(0,v.mG)(this,void 0,void 0,function(){var o=this;return(0,v.Jh)(this,function(s){switch(s.label){case 0:if(!Mn(t))throw t;return e.Or.add(1),[4,qr(e)];case 1:return s.sent(),e.Br.set("Offline"),i||(i=function(){return Sl(e.localStore)}),e.asyncQueue.enqueueRetryable(function(){return(0,v.mG)(o,void 0,void 0,function(){return(0,v.Jh)(this,function(u){switch(u.label){case 0:return N("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return u.sent(),e.Or.delete(1),[4,Xi(e)];case 2:return u.sent(),[2]}})})}),[2]}})})}function ql(e,t){return t().catch(function(i){return ds(e,i,t)})}function Br(e){return(0,v.mG)(this,void 0,void 0,function(){var t,i,o,s,u;return(0,v.Jh)(this,function(a){switch(a.label){case 0:t=M(e),i=nn(t),o=t.Fr.length>0?t.Fr[t.Fr.length-1].batchId:-1,a.label=1;case 1:if(!(en(c=t)&&c.Fr.length<10))return[3,7];a.label=2;case 2:return a.trys.push([2,4,,6]),[4,Od(t.localStore,o)];case 3:return null===(s=a.sent())?(0===t.Fr.length&&i.ir(),[3,7]):(o=s.batchId,function(c,h){c.Fr.push(h);var p=nn(c);p.er()&&p.pr&&p.Er(h.mutations)}(t,s),[3,6]);case 4:return u=a.sent(),[4,ds(t,u)];case 5:return a.sent(),[3,6];case 6:return[3,1];case 7:return Bl(t)&&jl(t),[2]}var c})})}function Bl(e){return en(e)&&!nn(e).tr()&&e.Fr.length>0}function jl(e){nn(e).start()}function rp(e){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(t){return nn(e).Ar(),[2]})})}function ip(e){return(0,v.mG)(this,void 0,void 0,function(){var t,i,o;return(0,v.Jh)(this,function(u){for(t=nn(e),i=0,o=e.Fr;i<o.length;i++)t.Er(o[i].mutations);return[2]})})}function op(e,t,i){return(0,v.mG)(this,void 0,void 0,function(){var o,s;return(0,v.Jh)(this,function(u){switch(u.label){case 0:return o=e.Fr.shift(),s=dd.from(o,t,i),[4,ql(e,function(){return e.remoteSyncer.applySuccessfulWrite(s)})];case 1:return u.sent(),[4,Br(e)];case 2:return u.sent(),[2]}})})}function sp(e,t){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(i){switch(i.label){case 0:return t&&nn(e).pr?[4,function(o,s){return(0,v.mG)(this,void 0,void 0,function(){var u,a;return(0,v.Jh)(this,function(c){switch(c.label){case 0:return Oc(a=s.code)&&a!==C.ABORTED?(u=o.Fr.shift(),nn(o).sr(),[4,ql(o,function(){return o.remoteSyncer.rejectFailedWrite(u.batchId,s)})]):[3,3];case 1:return c.sent(),[4,Br(o)];case 2:c.sent(),c.label=3;case 3:return[2]}})})}(e,t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return Bl(e)&&jl(e),[2]}})})}function Lu(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i;return(0,v.Jh)(this,function(o){switch(o.label){case 0:return i=M(e),t?(i.Or.delete(2),[4,Xi(i)]):[3,2];case 1:return o.sent(),[3,5];case 2:return t?[3,4]:(i.Or.add(2),[4,qr(i)]);case 3:o.sent(),i.Br.set("Unknown"),o.label=4;case 4:o.label=5;case 5:return[2]}})})}function jr(e){var i,o,s,u,t=this;return e.Ur||(e.Ur=(i=e.datastore,o=e.asyncQueue,s={Ii:tp.bind(null,e),Ri:ep.bind(null,e),_r:np.bind(null,e)},(u=M(i)).br(),new Wd(o,u.Hi,u.credentials,u.R,s)),e.Mr.push(function(i){return(0,v.mG)(t,void 0,void 0,function(){return(0,v.Jh)(this,function(o){switch(o.label){case 0:return i?(e.Ur.sr(),Pu(e)?Ru(e):e.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,e.Ur.stop()];case 2:o.sent(),Gl(e),o.label=3;case 3:return[2]}})})})),e.Ur}function nn(e){var i,o,s,u,t=this;return e.Kr||(e.Kr=(i=e.datastore,o=e.asyncQueue,s={Ii:rp.bind(null,e),Ri:sp.bind(null,e),Ir:ip.bind(null,e),Tr:op.bind(null,e)},(u=M(i)).br(),new Yd(o,u.Hi,u.credentials,u.R,s)),e.Mr.push(function(i){return(0,v.mG)(t,void 0,void 0,function(){return(0,v.Jh)(this,function(o){switch(o.label){case 0:return i?(e.Kr.sr(),[4,Br(e)]):[3,2];case 1:return o.sent(),[3,4];case 2:return[4,e.Kr.stop()];case 3:o.sent(),e.Fr.length>0&&(N("RemoteStore","Stopping write stream with "+e.Fr.length+" pending writes"),e.Fr=[]),o.label=4;case 4:return[2]}})})})),e.Kr}var up=function(){function e(t,i,o,s,u){this.asyncQueue=t,this.timerId=i,this.targetTimeMs=o,this.op=s,this.removalCallback=u,this.deferred=new kt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(a){})}return e.createAndSchedule=function(t,i,o,s,u){var a=new e(t,i,Date.now()+o,s,u);return a.start(o),a},e.prototype.start=function(t){var i=this;this.timerHandle=setTimeout(function(){return i.handleDelayElapsed()},t)},e.prototype.skipDelay=function(){return this.handleDelayElapsed()},e.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new A(C.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},e.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(i){return t.deferred.resolve(i)})):Promise.resolve()})},e.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},e}();function Kr(e,t){if(ht("AsyncQueue",t+": "+e),Mn(e))return new A(C.UNAVAILABLE,t+": "+e);throw e}var Kl=function(){function e(t){this.comparator=t?function(i,o){return t(i,o)||k.comparator(i.key,o.key)}:function(i,o){return k.comparator(i.key,o.key)},this.keyedMap=mu(),this.sortedSet=new xt(this.comparator)}return e.emptySet=function(t){return new e(t.comparator)},e.prototype.has=function(t){return null!=this.keyedMap.get(t)},e.prototype.get=function(t){return this.keyedMap.get(t)},e.prototype.first=function(){return this.sortedSet.minKey()},e.prototype.last=function(){return this.sortedSet.maxKey()},e.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},e.prototype.indexOf=function(t){var i=this.keyedMap.get(t);return i?this.sortedSet.indexOf(i):-1},Object.defineProperty(e.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(i,o){return t(i),!1})},e.prototype.add=function(t){var i=this.delete(t.key);return i.copy(i.keyedMap.insert(t.key,t),i.sortedSet.insert(t,null))},e.prototype.delete=function(t){var i=this.get(t);return i?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(i)):this},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var i=this.sortedSet.getIterator(),o=t.sortedSet.getIterator();i.hasNext();){var s=i.getNext().key,u=o.getNext().key;if(!s.isEqual(u))return!1}return!0},e.prototype.toString=function(){var t=[];return this.forEach(function(i){t.push(i.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},e.prototype.copy=function(t,i){var o=new e;return o.comparator=this.comparator,o.keyedMap=t,o.sortedSet=i,o},e}(),Hl=function(){function e(){this.Qr=new xt(k.comparator)}return e.prototype.track=function(t){var i=t.doc.key,o=this.Qr.get(i);o?0!==t.type&&3===o.type?this.Qr=this.Qr.insert(i,t):3===t.type&&1!==o.type?this.Qr=this.Qr.insert(i,{type:o.type,doc:t.doc}):2===t.type&&2===o.type?this.Qr=this.Qr.insert(i,{type:2,doc:t.doc}):2===t.type&&0===o.type?this.Qr=this.Qr.insert(i,{type:0,doc:t.doc}):1===t.type&&0===o.type?this.Qr=this.Qr.remove(i):1===t.type&&2===o.type?this.Qr=this.Qr.insert(i,{type:1,doc:o.doc}):0===t.type&&1===o.type?this.Qr=this.Qr.insert(i,{type:2,doc:t.doc}):F():this.Qr=this.Qr.insert(i,t)},e.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(i,o){t.push(o)}),t},e}(),ps=function(){function e(t,i,o,s,u,a,c,h){this.query=t,this.docs=i,this.oldDocs=o,this.docChanges=s,this.mutatedKeys=u,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=h}return e.fromInitialDocuments=function(t,i,o,s){var u=[];return i.forEach(function(a){u.push({type:0,doc:a})}),new e(t,i,Kl.emptySet(i),u,o,s,!0,!1)},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&qi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var i=this.docChanges,o=t.docChanges;if(i.length!==o.length)return!1;for(var s=0;s<i.length;s++)if(i[s].type!==o[s].type||!i[s].doc.isEqual(o[s].doc))return!1;return!0},e}(),ap=function(){this.Wr=void 0,this.listeners=[]},cp=function(){this.queries=new Lr(function(e){return yc(e)},qi),this.onlineState="Unknown",this.Gr=new Set};function Uu(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i,o,s,u,a,c,h;return(0,v.Jh)(this,function(p){switch(p.label){case 0:if(i=M(e),s=!1,(u=i.queries.get(o=t.query))||(s=!0,u=new ap),!s)return[3,4];p.label=1;case 1:return p.trys.push([1,3,,4]),a=u,[4,i.onListen(o)];case 2:return a.Wr=p.sent(),[3,4];case 3:return c=p.sent(),h=Kr(c,"Initialization of query '"+du(t.query)+"' failed"),[2,void t.onError(h)];case 4:return i.queries.set(o,u),u.listeners.push(t),t.zr(i.onlineState),u.Wr&&t.Hr(u.Wr)&&qu(i),[2]}})})}function Gu(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i,o,s,u,a;return(0,v.Jh)(this,function(c){return i=M(e),s=!1,(u=i.queries.get(o=t.query))&&(a=u.listeners.indexOf(t))>=0&&(u.listeners.splice(a,1),s=0===u.listeners.length),s?[2,(i.queries.delete(o),i.onUnlisten(o))]:[2]})})}function lp(e,t){for(var i=M(e),o=!1,s=0,u=t;s<u.length;s++){var a=u[s],h=i.queries.get(a.query);if(h){for(var p=0,g=h.listeners;p<g.length;p++)g[p].Hr(a)&&(o=!0);h.Wr=a}}o&&qu(i)}function hp(e,t,i){var o=M(e),s=o.queries.get(t);if(s)for(var u=0,a=s.listeners;u<a.length;u++)a[u].onError(i);o.queries.delete(t)}function qu(e){e.Gr.forEach(function(t){t.next()})}var Bu=function(){function e(t,i,o){this.query=t,this.Jr=i,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=o||{}}return e.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var i=[],o=0,s=t.docChanges;o<s.length;o++){var u=s[o];3!==u.type&&i.push(u)}t=new ps(t.query,t.docs,t.oldDocs,i,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var a=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),a=!0):this.eo(t,this.onlineState)&&(this.no(t),a=!0),this.Xr=t,a},e.prototype.onError=function(t){this.Jr.error(t)},e.prototype.zr=function(t){this.onlineState=t;var i=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),i=!0),i},e.prototype.eo=function(t,i){return!t.fromCache||!(this.options.so&&"Offline"!==i||t.docs.isEmpty()&&"Offline"!==i)},e.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},e.prototype.no=function(t){t=ps.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},e}(),fp=function(){function e(t,i){this.payload=t,this.byteLength=i}return e.prototype.io=function(){return"metadata"in this.payload},e}(),Jl=function(){function e(t){this.R=t}return e.prototype.qn=function(t){return ge(this.R,t)},e.prototype.Un=function(t){return t.metadata.exists?Jc(this.R,t.document,!1):St.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},e.prototype.Kn=function(t){return wt(t)},e}();!function(){function e(t,i,o){this.ro=t,this.localStore=i,this.R=o,this.queries=[],this.documents=[],this.progress=function(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(t)}e.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var i=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++i):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++i),i!==this.progress.documentsLoaded?(this.progress.documentsLoaded=i,Object.assign({},this.progress)):null},e.prototype.co=function(t){for(var i=new Map,o=new Jl(this.R),s=0,u=t;s<u.length;s++){var a=u[s];if(a.metadata.queries)for(var c=o.qn(a.metadata.name),h=0,p=a.metadata.queries;h<p.length;h++){var g=p[h],_=(i.get(g)||Y()).add(c);i.set(g,_)}}return i},e.prototype.complete=function(){return(0,v.mG)(this,void 0,void 0,function(){var t,i,o,s,u;return(0,v.Jh)(this,function(a){switch(a.label){case 0:return[4,Fd(this.localStore,new Jl(this.R),this.documents,this.ro.id)];case 1:t=a.sent(),i=this.co(this.documents),o=0,s=this.queries,a.label=2;case 2:return o<s.length?[4,kd(this.localStore,u=s[o],i.get(u.name))]:[3,5];case 3:a.sent(),a.label=4;case 4:return o++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Sd(Object.assign({},this.progress),t))]}})})}}();var Ql=function(e){this.key=e},Wl=function(e){this.key=e},Yl=function(){function e(t,i){this.query=t,this.uo=i,this.ao=null,this.current=!1,this.ho=Y(),this.mutatedKeys=Y(),this.lo=vc(t),this.fo=new Kl(this.lo)}return Object.defineProperty(e.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),e.prototype._o=function(t,i){var o=this,s=i?i.mo:new Hl,u=i?i.fo:this.fo,a=i?i.mutatedKeys:this.mutatedKeys,c=u,h=!1,p=Wo(this.query)&&u.size===this.query.limit?u.last():null,g=Yo(this.query)&&u.size===this.query.limit?u.first():null;if(t.inorderTraversal(function(b,w){var E=u.get(b),T=Bi(o.query,w)?w:null,D=!!E&&o.mutatedKeys.has(E.key),V=!!T&&(T.hasLocalMutations||o.mutatedKeys.has(T.key)&&T.hasCommittedMutations),R=!1;E&&T?E.data.isEqual(T.data)?D!==V&&(s.track({type:3,doc:T}),R=!0):o.yo(E,T)||(s.track({type:2,doc:T}),R=!0,(p&&o.lo(T,p)>0||g&&o.lo(T,g)<0)&&(h=!0)):!E&&T?(s.track({type:0,doc:T}),R=!0):E&&!T&&(s.track({type:1,doc:E}),R=!0,(p||g)&&(h=!0)),R&&(T?(c=c.add(T),a=V?a.add(b):a.delete(b)):(c=c.delete(b),a=a.delete(b)))}),Wo(this.query)||Yo(this.query))for(;c.size>this.query.limit;){var _=Wo(this.query)?c.last():c.first();c=c.delete(_.key),a=a.delete(_.key),s.track({type:1,doc:_})}return{fo:c,mo:s,Nn:h,mutatedKeys:a}},e.prototype.yo=function(t,i){return t.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations},e.prototype.applyChanges=function(t,i,o){var s=this,u=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var a=t.mo.jr();a.sort(function(g,_){return w=_.type,(E=function(T){switch(T){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F()}})(g.type)-E(w)||s.lo(g.doc,_.doc);var w,E}),this.po(o);var c=i?this.Eo():[],h=0===this.ho.size&&this.current?1:0,p=h!==this.ao;return this.ao=h,0!==a.length||p?{snapshot:new ps(this.query,t.fo,u,a,t.mutatedKeys,0===h,p,!1),To:c}:{To:c}},e.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Hl,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},e.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},e.prototype.po=function(t){var i=this;t&&(t.addedDocuments.forEach(function(o){return i.uo=i.uo.add(o)}),t.modifiedDocuments.forEach(function(o){}),t.removedDocuments.forEach(function(o){return i.uo=i.uo.delete(o)}),this.current=t.current)},e.prototype.Eo=function(){var t=this;if(!this.current)return[];var i=this.ho;this.ho=Y(),this.fo.forEach(function(s){t.Io(s.key)&&(t.ho=t.ho.add(s.key))});var o=[];return i.forEach(function(s){t.ho.has(s)||o.push(new Wl(s))}),this.ho.forEach(function(s){i.has(s)||o.push(new Ql(s))}),o},e.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Y();var i=this._o(t.documents);return this.applyChanges(i,!0)},e.prototype.Ro=function(){return ps.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},e}(),pp=function(e,t,i){this.query=e,this.targetId=t,this.view=i},gp=function(e){this.key=e,this.bo=!1},mp=function(){function e(t,i,o,s,u,a){this.localStore=t,this.remoteStore=i,this.eventManager=o,this.sharedClientState=s,this.currentUser=u,this.maxConcurrentLimboResolutions=a,this.vo={},this.Po=new Lr(function(c){return yc(c)},qi),this.Vo=new Map,this.So=new Set,this.Do=new xt(k.comparator),this.Co=new Map,this.No=new Nu,this.xo={},this.ko=new Map,this.Fo=ss.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(e.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),e}();function yp(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i,s,u,a,c;return(0,v.Jh)(this,function(h){switch(h.label){case 0:return i=Qu(e),(u=i.Po.get(t))?(i.sharedClientState.addLocalQueryTarget(u.targetId),s=u.view.Ro(),[3,4]):[3,1];case 1:return[4,Ur(i.localStore,ne(t))];case 2:return a=h.sent(),c=i.sharedClientState.addLocalQueryTarget(a.targetId),[4,ju(i,t,a.targetId,"current"===c)];case 3:s=h.sent(),i.isPrimaryClient&&fs(i.remoteStore,a),h.label=4;case 4:return[2,s]}})})}function ju(e,t,i,o){return(0,v.mG)(this,void 0,void 0,function(){var s,u,a,c,h,p;return(0,v.Jh)(this,function(g){switch(g.label){case 0:return e.Oo=function(_,b,w){return function(E,T,D,V){return(0,v.mG)(this,void 0,void 0,function(){var R,P,K;return(0,v.Jh)(this,function(z){switch(z.label){case 0:return(R=T.view._o(D)).Nn?[4,ls(E.localStore,T.query,!1).then(function($){return T.view._o($.documents,R)})]:[3,2];case 1:R=z.sent(),z.label=2;case 2:return P=V&&V.targetChanges.get(T.targetId),K=T.view.applyChanges(R,E.isPrimaryClient,P),[2,(Ju(E,T.targetId,K.To),K.snapshot)]}})})}(e,_,b,w)},[4,ls(e.localStore,t,!0)];case 1:return s=g.sent(),u=new Yl(t,s.Bn),a=u._o(s.documents),c=vu.createSynthesizedTargetChangeForCurrentChange(i,o&&"Offline"!==e.onlineState),h=u.applyChanges(a,e.isPrimaryClient,c),Ju(e,i,h.To),p=new pp(t,i,u),[2,(e.Po.set(t,p),e.Vo.has(i)?e.Vo.get(i).push(t):e.Vo.set(i,[t]),h.snapshot)]}})})}function vp(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i,o,s;return(0,v.Jh)(this,function(u){switch(u.label){case 0:return i=M(e),o=i.Po.get(t),(s=i.Vo.get(o.targetId)).length>1?[2,(i.Vo.set(o.targetId,s.filter(function(a){return!qi(a,t)})),void i.Po.delete(t))]:i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(o.targetId),i.sharedClientState.isActiveQueryTarget(o.targetId)?[3,2]:[4,Gr(i.localStore,o.targetId,!1).then(function(){i.sharedClientState.clearQueryState(o.targetId),to(i.remoteStore,o.targetId),Hr(i,o.targetId)}).catch(xn)]):[3,3];case 1:u.sent(),u.label=2;case 2:return[3,5];case 3:return Hr(i,o.targetId),[4,Gr(i.localStore,o.targetId,!0)];case 4:u.sent(),u.label=5;case 5:return[2]}})})}function _p(e,t,i){return(0,v.mG)(this,void 0,void 0,function(){var o,s,u,a;return(0,v.Jh)(this,function(c){switch(c.label){case 0:o=Wu(e),c.label=1;case 1:return c.trys.push([1,5,,6]),[4,(h=o.localStore,p=t,_=M(h),b=Gt.now(),w=p.reduce(function(E,T){return E.add(T.key)},Y()),_.persistence.runTransaction("Locally write mutations","readwrite",function(E){return _.Mn.pn(E,w).next(function(T){g=T;for(var D=[],V=0,R=p;V<R.length;V++){var P=R[V],K=jf(P,g.get(P.key));null!=K&&D.push(new We(P.key,K,lc(K.value.mapValue),Ot.exists(!0)))}return _._n.addMutationBatch(E,b,D,p)})}).then(function(E){return E.applyToLocalDocumentSet(g),{batchId:E.batchId,changes:g}}))];case 2:return s=c.sent(),o.sharedClientState.addPendingMutation(s.batchId),function(h,p,g){var _=h.xo[h.currentUser.toKey()];_||(_=new xt(H)),_=_.insert(p,g),h.xo[h.currentUser.toKey()]=_}(o,s.batchId,i),[4,Ve(o,s.changes)];case 3:return c.sent(),[4,Br(o.remoteStore)];case 4:return c.sent(),[3,6];case 5:return u=c.sent(),a=Kr(u,"Failed to persist write"),i.reject(a),[3,6];case 6:return[2]}var h,p,g,_,b,w})})}function $l(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i,o;return(0,v.Jh)(this,function(s){switch(s.label){case 0:i=M(e),s.label=1;case 1:return s.trys.push([1,4,,6]),[4,Md(i.localStore,t)];case 2:return o=s.sent(),t.targetChanges.forEach(function(u,a){var c=i.Co.get(a);c&&(q(u.addedDocuments.size+u.modifiedDocuments.size+u.removedDocuments.size<=1),u.addedDocuments.size>0?c.bo=!0:u.modifiedDocuments.size>0?q(c.bo):u.removedDocuments.size>0&&(q(c.bo),c.bo=!1))}),[4,Ve(i,o,t)];case 3:return s.sent(),[3,6];case 4:return[4,xn(s.sent())];case 5:return s.sent(),[3,6];case 6:return[2]}})})}function Zl(e,t,i){var o=M(e);if(o.isPrimaryClient&&0===i||!o.isPrimaryClient&&1===i){var s=[];o.Po.forEach(function(u,a){var c=a.view.zr(t);c.snapshot&&s.push(c.snapshot)}),function(u,a){var c=M(u);c.onlineState=a;var h=!1;c.queries.forEach(function(p,g){for(var _=0,b=g.listeners;_<b.length;_++)b[_].zr(a)&&(h=!0)}),h&&qu(c)}(o.eventManager,t),s.length&&o.vo._r(s),o.onlineState=t,o.isPrimaryClient&&o.sharedClientState.setOnlineState(t)}}function bp(e,t,i){return(0,v.mG)(this,void 0,void 0,function(){var o,s,u,a,c,h;return(0,v.Jh)(this,function(p){switch(p.label){case 0:return(o=M(e)).sharedClientState.updateQueryState(t,"rejected",i),s=o.Co.get(t),(u=s&&s.key)?(a=(a=new xt(k.comparator)).insert(u,St.newNoDocument(u,j.min())),c=Y().add(u),h=new yu(j.min(),new Map,new vt(H),a,c),[4,$l(o,h)]):[3,2];case 1:return p.sent(),o.Do=o.Do.remove(u),o.Co.delete(t),zu(o),[3,4];case 2:return[4,Gr(o.localStore,t,!1).then(function(){return Hr(o,t,i)}).catch(xn)];case 3:p.sent(),p.label=4;case 4:return[2]}})})}function wp(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i,o,s;return(0,v.Jh)(this,function(u){switch(u.label){case 0:i=M(e),o=t.batch.batchId,u.label=1;case 1:return u.trys.push([1,4,,6]),[4,Vd(i.localStore,t)];case 2:return s=u.sent(),Hu(i,o,null),Ku(i,o),i.sharedClientState.updateMutationState(o,"acknowledged"),[4,Ve(i,s)];case 3:return u.sent(),[3,6];case 4:return[4,xn(u.sent())];case 5:return u.sent(),[3,6];case 6:return[2]}})})}function Ep(e,t,i){return(0,v.mG)(this,void 0,void 0,function(){var o,s;return(0,v.Jh)(this,function(u){switch(u.label){case 0:o=M(e),u.label=1;case 1:return u.trys.push([1,4,,6]),[4,(a=o.localStore,c=t,h=M(a),h.persistence.runTransaction("Reject batch","readwrite-primary",function(p){var g;return h._n.lookupMutationBatch(p,c).next(function(_){return q(null!==_),g=_.keys(),h._n.removeMutationBatch(p,_)}).next(function(){return h._n.performConsistencyCheck(p)}).next(function(){return h.Mn.pn(p,g)})}))];case 2:return s=u.sent(),Hu(o,t,i),Ku(o,t),o.sharedClientState.updateMutationState(t,"rejected",i),[4,Ve(o,s)];case 3:return u.sent(),[3,6];case 4:return[4,xn(u.sent())];case 5:return u.sent(),[3,6];case 6:return[2]}var a,c,h})})}function Cp(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i,o,s,u,a;return(0,v.Jh)(this,function(c){switch(c.label){case 0:en((i=M(e)).remoteStore)||N("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,(h=i.localStore,p=M(h),p.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(g){return p._n.getHighestUnacknowledgedBatchId(g)}))];case 2:return-1===(o=c.sent())?[2,void t.resolve()]:((s=i.ko.get(o)||[]).push(t),i.ko.set(o,s),[3,4]);case 3:return u=c.sent(),a=Kr(u,"Initialization of waitForPendingWrites() operation failed"),t.reject(a),[3,4];case 4:return[2]}var h,p})})}function Ku(e,t){(e.ko.get(t)||[]).forEach(function(i){i.resolve()}),e.ko.delete(t)}function Hu(e,t,i){var o=M(e),s=o.xo[o.currentUser.toKey()];if(s){var u=s.get(t);u&&(i?u.reject(i):u.resolve(),s=s.remove(t)),o.xo[o.currentUser.toKey()]=s}}function Hr(e,t,i){void 0===i&&(i=null),e.sharedClientState.removeLocalQueryTarget(t);for(var o=0,s=e.Vo.get(t);o<s.length;o++){var u=s[o];e.Po.delete(u),i&&e.vo.Mo(u,i)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(function(a){e.No.containsKey(a)||Xl(e,a)})}function Xl(e,t){e.So.delete(t.path.canonicalString());var i=e.Do.get(t);null!==i&&(to(e.remoteStore,i),e.Do=e.Do.remove(t),e.Co.delete(i),zu(e))}function Ju(e,t,i){for(var o=0,s=i;o<s.length;o++){var u=s[o];u instanceof Ql?(e.No.addReference(u.key,t),Tp(e,u)):u instanceof Wl?(N("SyncEngine","Document no longer in limbo: "+u.key),e.No.removeReference(u.key,t),e.No.containsKey(u.key)||Xl(e,u.key)):F()}}function Tp(e,t){var i=t.key,o=i.path.canonicalString();e.Do.get(i)||e.So.has(o)||(N("SyncEngine","New document in limbo: "+i),e.So.add(o),zu(e))}function zu(e){for(;e.So.size>0&&e.Do.size<e.maxConcurrentLimboResolutions;){var t=e.So.values().next().value;e.So.delete(t);var i=new k(Q.fromString(t)),o=e.Fo.next();e.Co.set(o,new gp(i)),e.Do=e.Do.insert(i,o),fs(e.remoteStore,new is(ne(Tr(i.path)),o,2,Ht.o))}}function Ve(e,t,i){return(0,v.mG)(this,void 0,void 0,function(){var o,s,u,a;return(0,v.Jh)(this,function(c){switch(c.label){case 0:return o=M(e),s=[],u=[],a=[],o.Po.isEmpty()?[3,3]:(o.Po.forEach(function(h,p){a.push(o.Oo(p,t,i).then(function(g){if(g){o.isPrimaryClient&&o.sharedClientState.updateQueryState(p.targetId,g.fromCache?"not-current":"current"),s.push(g);var _=Dd.Pn(p.targetId,g);u.push(_)}}))}),[4,Promise.all(a)]);case 1:return c.sent(),o.vo._r(s),[4,function(h,p){return(0,v.mG)(this,void 0,void 0,function(){var g,_,b,w,E,T,D,R;return(0,v.Jh)(this,function(P){switch(P.label){case 0:g=M(h),P.label=1;case 1:return P.trys.push([1,3,,4]),[4,g.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(K){return S.forEach(p,function(z){return S.forEach(z.bn,function($){return g.persistence.referenceDelegate.addReference(K,z.targetId,$)}).next(function(){return S.forEach(z.vn,function($){return g.persistence.referenceDelegate.removeReference(K,z.targetId,$)})})})})];case 2:return P.sent(),[3,4];case 3:if(!Mn(_=P.sent()))throw _;return N("LocalStore","Failed to update sequence numbers: "+_),[3,4];case 4:for(b=0,w=p;b<w.length;b++)T=(E=w[b]).targetId,E.fromCache||(D=g.kn.get(T),R=D.withLastLimboFreeSnapshotVersion(D.snapshotVersion),g.kn=g.kn.insert(T,R));return[2]}})})}(o.localStore,u)];case 2:c.sent(),c.label=3;case 3:return[2]}})})}function Ip(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i,o;return(0,v.Jh)(this,function(s){switch(s.label){case 0:return(i=M(e)).currentUser.isEqual(t)?[3,3]:(N("SyncEngine","User change. New user:",t.toKey()),[4,Al(i.localStore,t)]);case 1:return o=s.sent(),i.currentUser=t,(u=i).ko.forEach(function(c){c.forEach(function(h){h.reject(new A(C.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),u.ko.clear(),i.sharedClientState.handleUserChange(t,o.removedBatchIds,o.addedBatchIds),[4,Ve(i,o.Ln)];case 2:s.sent(),s.label=3;case 3:return[2]}var u})})}function Ap(e,t){var i=M(e),o=i.Co.get(t);if(o&&o.bo)return Y().add(o.key);var s=Y(),u=i.Vo.get(t);if(!u)return s;for(var a=0,c=u;a<c.length;a++){var p=i.Po.get(c[a]);s=s.unionWith(p.view.wo)}return s}function Sp(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i,o,s;return(0,v.Jh)(this,function(u){switch(u.label){case 0:return[4,ls((i=M(e)).localStore,t.query,!0)];case 1:return o=u.sent(),s=t.view.Ao(o),[2,(i.isPrimaryClient&&Ju(i,t.targetId,s.To),s)]}})})}function Dp(e){return(0,v.mG)(this,void 0,void 0,function(){var t;return(0,v.Jh)(this,function(i){return[2,Vl((t=M(e)).localStore).then(function(o){return Ve(t,o)})]})})}function Np(e,t,i,o){return(0,v.mG)(this,void 0,void 0,function(){var s,u;return(0,v.Jh)(this,function(a){switch(a.label){case 0:return[4,(c=(s=M(e)).localStore,h=t,p=M(c),g=M(p._n),p.persistence.runTransaction("Lookup mutation documents","readonly",function(_){return g.jt(_,h).next(function(b){return b?p.Mn.pn(_,b):S.resolve(null)})}))];case 1:return null===(u=a.sent())?[3,6]:"pending"!==i?[3,3]:[4,Br(s.remoteStore)];case 2:return a.sent(),[3,4];case 3:"acknowledged"===i||"rejected"===i?(Hu(s,t,o||null),Ku(s,t),function(c,h){M(M(c)._n).Gt(h)}(s.localStore,t)):F(),a.label=4;case 4:return[4,Ve(s,u)];case 5:return a.sent(),[3,7];case 6:N("SyncEngine","Cannot apply mutation batch with id: "+t),a.label=7;case 7:return[2]}var c,h,p,g})})}function Vp(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i,o,s,u,a,h,p;return(0,v.Jh)(this,function(g){switch(g.label){case 0:return Qu(i=M(e)),Wu(i),!0!==t||!0===i.$o?[3,3]:(o=i.sharedClientState.getAllActiveQueryTargets(),[4,th(i,o.toArray())]);case 1:return s=g.sent(),i.$o=!0,[4,Lu(i.remoteStore,!0)];case 2:for(g.sent(),u=0,a=s;u<a.length;u++)fs(i.remoteStore,a[u]);return[3,7];case 3:return!1!==t||!1===i.$o?[3,7]:(h=[],p=Promise.resolve(),i.Vo.forEach(function(_,b){i.sharedClientState.isLocalQueryTarget(b)?h.push(b):p=p.then(function(){return Hr(i,b),Gr(i.localStore,b,!0)}),to(i.remoteStore,b)}),[4,p]);case 4:return g.sent(),[4,th(i,h)];case 5:return g.sent(),(b=M(i)).Co.forEach(function(w,E){to(b.remoteStore,E)}),b.No.ts(),b.Co=new Map,b.Do=new xt(k.comparator),i.$o=!1,[4,Lu(i.remoteStore,!1)];case 6:g.sent(),g.label=7;case 7:return[2]}var b})})}function th(e,t,i){return(0,v.mG)(this,void 0,void 0,function(){var o,s,u,a,c,h,p,g,_,b,E,T,D;return(0,v.Jh)(this,function(V){switch(V.label){case 0:o=M(e),s=[],u=[],a=0,c=t,V.label=1;case 1:return a<c.length?(p=void 0,(g=o.Vo.get(h=c[a]))&&0!==g.length?[4,Ur(o.localStore,ne(g[0]))]:[3,7]):[3,13];case 2:p=V.sent(),_=0,b=g,V.label=3;case 3:return _<b.length?(E=o.Po.get(b[_]),[4,Sp(o,E)]):[3,6];case 4:(T=V.sent()).snapshot&&u.push(T.snapshot),V.label=5;case 5:return _++,[3,3];case 6:return[3,11];case 7:return[4,Nl(o.localStore,h)];case 8:return D=V.sent(),[4,Ur(o.localStore,D)];case 9:return p=V.sent(),[4,ju(o,eh(D),h,!1)];case 10:V.sent(),V.label=11;case 11:s.push(p),V.label=12;case 12:return a++,[3,1];case 13:return[2,(o.vo._r(u),s)]}})})}function eh(e){return gc(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Mp(e){var t=M(e);return M(M(t.localStore).persistence).fn()}function Op(e,t,i,o){return(0,v.mG)(this,void 0,void 0,function(){var s,u,a;return(0,v.Jh)(this,function(c){switch(c.label){case 0:return(s=M(e)).$o?(N("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!s.Vo.has(t))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Vl(s.localStore)];case 3:return u=c.sent(),a=yu.createSynthesizedRemoteEventForCurrentChange(t,"current"===i),[4,Ve(s,u,a)];case 4:return c.sent(),[3,8];case 5:return[4,Gr(s.localStore,t,!0)];case 6:return c.sent(),Hr(s,t,o),[3,8];case 7:F(),c.label=8;case 8:return[2]}})})}function xp(e,t,i){return(0,v.mG)(this,void 0,void 0,function(){var o,s,u,a,c,h,p,g,_;return(0,v.Jh)(this,function(w){switch(w.label){case 0:if(!(o=Qu(e)).$o)return[3,10];s=0,u=t,w.label=1;case 1:return s<u.length?o.Vo.has(a=u[s])?(N("SyncEngine","Adding an already active target "+a),[3,5]):[4,Nl(o.localStore,a)]:[3,6];case 2:return c=w.sent(),[4,Ur(o.localStore,c)];case 3:return h=w.sent(),[4,ju(o,eh(c),h.targetId,!1)];case 4:w.sent(),fs(o.remoteStore,h),w.label=5;case 5:return s++,[3,1];case 6:p=function(E){return(0,v.Jh)(this,function(T){switch(T.label){case 0:return o.Vo.has(E)?[4,Gr(o.localStore,E,!1).then(function(){to(o.remoteStore,E),Hr(o,E)}).catch(xn)]:[3,2];case 1:T.sent(),T.label=2;case 2:return[2]}})},g=0,_=i,w.label=7;case 7:return g<_.length?[5,p(_[g])]:[3,10];case 8:w.sent(),w.label=9;case 9:return g++,[3,7];case 10:return[2]}})})}function Qu(e){var t=M(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=$l.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ap.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=bp.bind(null,t),t.vo._r=lp.bind(null,t.eventManager),t.vo.Mo=hp.bind(null,t.eventManager),t}function Wu(e){var t=M(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=wp.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Ep.bind(null,t),t}var nh=function(){function e(){this.synchronizeTabs=!1}return e.prototype.initialize=function(t){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(i){switch(i.label){case 0:return this.R=Zi(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return i.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},e.prototype.Uo=function(t){return null},e.prototype.Ko=function(t){return Il(this.persistence,new Tl,t.initialUser,this.R)},e.prototype.qo=function(t){return new qd(jd.bs,this.R)},e.prototype.Bo=function(t){return new kl},e.prototype.terminate=function(){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},e}(),rh=function(e){function t(i,o,s){var u=this;return(u=e.call(this)||this).Qo=i,u.cacheSizeBytes=o,u.forceOwnership=s,u.synchronizeTabs=!1,u}return(0,v.ZT)(t,e),t.prototype.initialize=function(i){return(0,v.mG)(this,void 0,void 0,function(){var o=this;return(0,v.Jh)(this,function(s){switch(s.label){case 0:return[4,e.prototype.initialize.call(this,i)];case 1:return s.sent(),[4,xd(this.localStore)];case 2:return s.sent(),[4,this.Qo.initialize(this,i)];case 3:return s.sent(),[4,Wu(this.Qo.syncEngine)];case 4:return s.sent(),[4,Br(this.Qo.remoteStore)];case 5:return s.sent(),[4,this.persistence.He(function(){return o.gcScheduler&&!o.gcScheduler.started&&o.gcScheduler.start(o.localStore),Promise.resolve()})];case 6:return s.sent(),[2]}})})},t.prototype.Ko=function(i){return Il(this.persistence,new Tl,i.initialUser,this.R)},t.prototype.Uo=function(i){return new bd(this.persistence.referenceDelegate.garbageCollector,i.asyncQueue)},t.prototype.qo=function(i){var o=Du(i.databaseInfo.databaseId,i.databaseInfo.persistenceKey),s=void 0!==this.cacheSizeBytes?ye.withCacheSize(this.cacheSizeBytes):ye.DEFAULT;return new Ad(this.synchronizeTabs,o,i.clientId,s,i.asyncQueue,Pl(),hs(),this.R,this.sharedClientState,!!this.forceOwnership)},t.prototype.Bo=function(i){return new kl},t}(nh),kp=function(e){function t(i,o){var s=this;return(s=e.call(this,i,o,!1)||this).Qo=i,s.cacheSizeBytes=o,s.synchronizeTabs=!0,s}return(0,v.ZT)(t,e),t.prototype.initialize=function(i){return(0,v.mG)(this,void 0,void 0,function(){var o,s=this;return(0,v.Jh)(this,function(u){switch(u.label){case 0:return[4,e.prototype.initialize.call(this,i)];case 1:return u.sent(),o=this.Qo.syncEngine,this.sharedClientState instanceof xu?(this.sharedClientState.syncEngine={ui:Np.bind(null,o),ai:Op.bind(null,o),hi:xp.bind(null,o),fn:Mp.bind(null,o),ci:Dp.bind(null,o)},[4,this.sharedClientState.start()]):[3,3];case 2:u.sent(),u.label=3;case 3:return[4,this.persistence.He(function(a){return(0,v.mG)(s,void 0,void 0,function(){return(0,v.Jh)(this,function(c){switch(c.label){case 0:return[4,Vp(this.Qo.syncEngine,a)];case 1:return c.sent(),this.gcScheduler&&(a&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):a||this.gcScheduler.stop()),[2]}})})})];case 4:return u.sent(),[2]}})})},t.prototype.Bo=function(i){var o=Pl();if(!xu.yt(o))throw new A(C.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var s=Du(i.databaseInfo.databaseId,i.databaseInfo.persistenceKey);return new xu(o,i.asyncQueue,s,i.clientId,i.initialUser)},t}(rh),Yu=function(){function e(){}return e.prototype.initialize=function(t,i){return(0,v.mG)(this,void 0,void 0,function(){var o=this;return(0,v.Jh)(this,function(s){switch(s.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(u){return Zl(o.syncEngine,u,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Ip.bind(null,this.syncEngine),[4,Lu(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:s.sent(),s.label=2;case 2:return[2]}})})},e.prototype.createEventManager=function(t){return new cp},e.prototype.createDatastore=function(t){var o=Zi(t.databaseInfo.databaseId),s=new Qd(t.databaseInfo);return new $d(t.credentials,s,o)},e.prototype.createRemoteStore=function(t){var i,o,s,u,a,c=this;return i=this.localStore,o=this.datastore,s=t.asyncQueue,u=function(h){return Zl(c.syncEngine,h,0)},a=Rl.yt()?new Rl:new Hd,new Xd(i,o,s,u,a)},e.prototype.createSyncEngine=function(t,i){return p=i,g=new mp(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions),p&&(g.$o=!0),g;var p,g},e.prototype.terminate=function(){return function(t){return(0,v.mG)(this,void 0,void 0,function(){var i;return(0,v.Jh)(this,function(o){switch(o.label){case 0:return i=M(t),N("RemoteStore","RemoteStore shutting down."),i.Or.add(5),[4,qr(i)];case 1:return o.sent(),i.Lr.shutdown(),i.Br.set("Unknown"),[2]}})})}(this.remoteStore)},e}(),gs=function(){function e(t){this.observer=t,this.muted=!1}return e.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},e.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},e.prototype.Wo=function(){this.muted=!0},e.prototype.jo=function(t,i){var o=this;this.muted||setTimeout(function(){o.muted||t(i)},0)},e}(),Pp=(function(){function e(t,i){var o=this;this.Go=t,this.R=i,this.metadata=new kt,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(s){s&&s.io()?o.metadata.resolve(s.payload.metadata):o.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==s?void 0:s.payload)))},function(s){return o.metadata.reject(s)})}e.prototype.close=function(){return this.Go.cancel()},e.prototype.getMetadata=function(){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(t){return[2,this.metadata.promise]})})},e.prototype.Lo=function(){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},e.prototype.Ho=function(){return(0,v.mG)(this,void 0,void 0,function(){var t,i,o,s;return(0,v.Jh)(this,function(u){switch(u.label){case 0:return[4,this.Jo()];case 1:return null===(t=u.sent())?[2,null]:(i=this.zo.decode(t),o=Number(i),isNaN(o)&&this.Yo("length string ("+i+") is not valid number"),[4,this.Xo(o)]);case 2:return s=u.sent(),[2,new fp(JSON.parse(s),t.length+o)]}})})},e.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},e.prototype.Jo=function(){return(0,v.mG)(this,void 0,void 0,function(){var t,i;return(0,v.Jh)(this,function(o){switch(o.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(o.sent())return[3,3];o.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),i=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),i)])}})})},e.prototype.Xo=function(t){return(0,v.mG)(this,void 0,void 0,function(){var i;return(0,v.Jh)(this,function(o){switch(o.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:o.sent()&&this.Yo("Reached the end of bundle when more is expected."),o.label=2;case 2:return[3,0];case 3:return i=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),i)]}})})},e.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},e.prototype.tc=function(){return(0,v.mG)(this,void 0,void 0,function(){var t,i;return(0,v.Jh)(this,function(o){switch(o.label){case 0:return[4,this.Go.read()];case 1:return(t=o.sent()).done||((i=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),i.set(t.value,this.buffer.length),this.buffer=i),[2,t.done]}})})}}(),function(){function e(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return e.prototype.lookup=function(t){return(0,v.mG)(this,void 0,void 0,function(){var i,o=this;return(0,v.Jh)(this,function(s){switch(s.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new A(C.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(u,a){return(0,v.mG)(this,void 0,void 0,function(){var c,h,p,g,_,b;return(0,v.Jh)(this,function(w){switch(w.label){case 0:return c=M(u),h=Qi(c.R)+"/documents",p={documents:a.map(function(E){return zi(c.R,E)})},[4,c.$i("BatchGetDocuments",h,p)];case 1:return g=w.sent(),_=new Map,g.forEach(function(E){var D,V,T=(D=c.R,"found"in(V=E)?function(R,P){q(!!P.found);var K=ge(R,P.found.name),z=wt(P.found.updateTime),$=new Jt({mapValue:{fields:P.found.fields}});return St.newFoundDocument(K,z,$)}(D,V):"missing"in V?function(R,P){q(!!P.missing),q(!!P.readTime);var K=ge(R,P.missing),z=wt(P.readTime);return St.newNoDocument(K,z)}(D,V):F());_.set(T.key.toString(),T)}),b=[],[2,(a.forEach(function(E){var T=_.get(E.toString());q(!!T),b.push(T)}),b)]}})})}(this.datastore,t)];case 1:return[2,((i=s.sent()).forEach(function(u){return o.recordVersion(u)}),i)]}})})},e.prototype.set=function(t,i){this.write(i.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.update=function(t,i){try{this.write(i.toMutation(t,this.preconditionForUpdate(t)))}catch(o){this.lastWriteError=o}this.writtenDocs.add(t.toString())},e.prototype.delete=function(t){this.write(new Hi(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.commit=function(){return(0,v.mG)(this,void 0,void 0,function(){var t,i=this;return(0,v.Jh)(this,function(o){switch(o.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(s){t.delete(s.key.toString())}),t.forEach(function(s,u){var a=k.fromPath(u);i.mutations.push(new gu(a,i.precondition(a)))}),[4,function(s,u){return(0,v.mG)(this,void 0,void 0,function(){var a,c,h;return(0,v.Jh)(this,function(p){switch(p.label){case 0:return a=M(s),c=Qi(a.R)+"/documents",h={writes:u.map(function(g){return rs(a.R,g)})},[4,a.Ni("Commit",c,h)];case 1:return p.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return o.sent(),this.committed=!0,[2]}})})},e.prototype.recordVersion=function(t){var i;if(t.isFoundDocument())i=t.version;else{if(!t.isNoDocument())throw F();i=j.min()}var o=this.readVersions.get(t.key.toString());if(o){if(!i.isEqual(o))throw new A(C.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),i)},e.prototype.precondition=function(t){var i=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&i?Ot.updateTime(i):Ot.none()},e.prototype.preconditionForUpdate=function(t){var i=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&i){if(i.isEqual(j.min()))throw new A(C.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ot.updateTime(i)}return Ot.exists(!0)},e.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},e.prototype.ensureCommitNotCalled=function(){},e}()),Lp=function(){function e(t,i,o,s){this.asyncQueue=t,this.datastore=i,this.updateFunction=o,this.deferred=s,this.ec=5,this.Zi=new Fu(this.asyncQueue,"transaction_retry")}return e.prototype.run=function(){this.ec-=1,this.nc()},e.prototype.nc=function(){var t=this;this.Zi.ji(function(){return(0,v.mG)(t,void 0,void 0,function(){var i,o,s=this;return(0,v.Jh)(this,function(u){return i=new Pp(this.datastore),(o=this.sc(i))&&o.then(function(a){s.asyncQueue.enqueueAndForget(function(){return i.commit().then(function(){s.deferred.resolve(a)}).catch(function(c){s.ic(c)})})}).catch(function(a){s.ic(a)}),[2]})})})},e.prototype.sc=function(t){try{var i=this.updateFunction(t);return!An(i)&&i.catch&&i.then?i:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(o){return this.deferred.reject(o),null}},e.prototype.ic=function(t){var i=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return i.nc(),Promise.resolve()})):this.deferred.reject(t)},e.prototype.rc=function(t){if("FirebaseError"===t.name){var i=t.code;return"aborted"===i||"failed-precondition"===i||!Oc(i)}return!1},e}(),Up=function(){function e(t,i,o){var s=this;this.credentials=t,this.asyncQueue=i,this.databaseInfo=o,this.user=Nt.UNAUTHENTICATED,this.clientId=tc.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(i,function(u){return(0,v.mG)(s,void 0,void 0,function(){return(0,v.Jh)(this,function(a){switch(a.label){case 0:return N("FirestoreClient","Received user=",u.uid),[4,this.credentialListener(u)];case 1:return a.sent(),this.user=u,[2]}})})})}return e.prototype.getConfiguration=function(){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},e.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},e.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new A(C.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var i=new kt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return(0,v.mG)(t,void 0,void 0,function(){var o,s;return(0,v.Jh)(this,function(u){switch(u.label){case 0:return u.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:u.sent(),u.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:u.sent(),u.label=4;case 4:return this.credentials.removeChangeListener(),i.resolve(),[3,6];case 5:return o=u.sent(),s=Kr(o,"Failed to shutdown persistence"),i.reject(s),[3,6];case 6:return[2]}})})}),i.promise},e}();function oh(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i,o,s=this;return(0,v.Jh)(this,function(u){switch(u.label){case 0:return e.asyncQueue.verifyOperationInProgress(),N("FirestoreClient","Initializing OfflineComponentProvider"),[4,e.getConfiguration()];case 1:return i=u.sent(),[4,t.initialize(i)];case 2:return u.sent(),o=i.initialUser,e.setCredentialChangeListener(function(a){return(0,v.mG)(s,void 0,void 0,function(){return(0,v.Jh)(this,function(c){switch(c.label){case 0:return o.isEqual(a)?[3,2]:[4,Al(t.localStore,a)];case 1:c.sent(),o=a,c.label=2;case 2:return[2]}})})}),t.persistence.setDatabaseDeletedListener(function(){return e.terminate()}),e.offlineComponents=t,[2]}})})}function sh(e,t){return(0,v.mG)(this,void 0,void 0,function(){var i,o;return(0,v.Jh)(this,function(s){switch(s.label){case 0:return e.asyncQueue.verifyOperationInProgress(),[4,$u(e)];case 1:return i=s.sent(),N("FirestoreClient","Initializing OnlineComponentProvider"),[4,e.getConfiguration()];case 2:return o=s.sent(),[4,t.initialize(i,o)];case 3:return s.sent(),e.setCredentialChangeListener(function(u){return function(a,c){return(0,v.mG)(this,void 0,void 0,function(){var h,p;return(0,v.Jh)(this,function(g){switch(g.label){case 0:return(h=M(a)).asyncQueue.verifyOperationInProgress(),N("RemoteStore","RemoteStore received new credentials"),p=en(h),h.Or.add(3),[4,qr(h)];case 1:return g.sent(),p&&h.Br.set("Unknown"),[4,h.remoteSyncer.handleCredentialChange(c)];case 2:return g.sent(),h.Or.delete(3),[4,Xi(h)];case 3:return g.sent(),[2]}})})}(t.remoteStore,u)}),e.onlineComponents=t,[2]}})})}function $u(e){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(N("FirestoreClient","Using default OfflineComponentProvider"),[4,oh(e,new nh)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function ms(e){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(N("FirestoreClient","Using default OnlineComponentProvider"),[4,sh(e,new Yu)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function uh(e){return $u(e).then(function(t){return t.persistence})}function Zu(e){return $u(e).then(function(t){return t.localStore})}function ah(e){return ms(e).then(function(t){return t.remoteStore})}function Xu(e){return ms(e).then(function(t){return t.syncEngine})}function Jr(e){return(0,v.mG)(this,void 0,void 0,function(){var t,i;return(0,v.Jh)(this,function(o){switch(o.label){case 0:return[4,ms(e)];case 1:return t=o.sent(),[2,((i=t.eventManager).onListen=yp.bind(null,t.syncEngine),i.onUnlisten=vp.bind(null,t.syncEngine),i)]}})})}function ch(e,t,i){var o=this;void 0===i&&(i={});var s=new kt;return e.asyncQueue.enqueueAndForget(function(){return(0,v.mG)(o,void 0,void 0,function(){var u;return(0,v.Jh)(this,function(a){switch(a.label){case 0:return u=function(c,h,p,g,_){var b=new gs({next:function(E){h.enqueueAndForget(function(){return Gu(c,w)});var T=E.docs.has(p);!T&&E.fromCache?_.reject(new A(C.UNAVAILABLE,"Failed to get document because the client is offline.")):T&&E.fromCache&&g&&"server"===g.source?_.reject(new A(C.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):_.resolve(E)},error:function(E){return _.reject(E)}}),w=new Bu(Tr(p.path),b,{includeMetadataChanges:!0,so:!0});return Uu(c,w)},[4,Jr(e)];case 1:return[2,u.apply(void 0,[a.sent(),e.asyncQueue,t,i,s])]}})})}),s.promise}function lh(e,t,i){var o=this;void 0===i&&(i={});var s=new kt;return e.asyncQueue.enqueueAndForget(function(){return(0,v.mG)(o,void 0,void 0,function(){var u;return(0,v.Jh)(this,function(a){switch(a.label){case 0:return u=function(c,h,p,g,_){var b=new gs({next:function(E){h.enqueueAndForget(function(){return Gu(c,w)}),E.fromCache&&"server"===g.source?_.reject(new A(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):_.resolve(E)},error:function(E){return _.reject(E)}}),w=new Bu(p,b,{includeMetadataChanges:!0,so:!0});return Uu(c,w)},[4,Jr(e)];case 1:return[2,u.apply(void 0,[a.sent(),e.asyncQueue,t,i,s])]}})})}),s.promise}var Gp=function(e,t,i,o,s,u,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=o,this.ssl=s,this.forceLongPolling=u,this.autoDetectLongPolling=a,this.useFetchStreams=c},ys=function(){function e(t,i){this.projectId=t,this.database=i||"(default)"}return Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database},e}(),hh=new Map,fh=function(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+e},dh=function(){function e(){this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(null)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,i){this.changeListener=i,t.enqueueRetryable(function(){return i(Nt.UNAUTHENTICATED)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),qp=function(){function e(t){this.token=t,this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(this.token)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,i){var o=this;this.changeListener=i,t.enqueueRetryable(function(){return i(o.token.user)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),Bp=function(){function e(t){var i=this;this.currentUser=Nt.UNAUTHENTICATED,this.oc=new kt,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){i.cc++,i.currentUser=i.ac(),i.oc.resolve(),i.changeListener&&i.asyncQueue.enqueueRetryable(function(){return i.changeListener(i.currentUser)})};var o=function(s){N("FirebaseCredentialsProvider","Auth detected"),i.auth=s,i.auth.addAuthTokenListener(i.uc)};t.onInit(function(s){return o(s)}),setTimeout(function(){if(!i.auth){var s=t.getImmediate({optional:!0});s?o(s):(N("FirebaseCredentialsProvider","Auth not yet detected"),i.oc.resolve())}},0)}return e.prototype.getToken=function(){var t=this,i=this.cc,o=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(o).then(function(s){return t.cc!==i?(N("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):s?(q("string"==typeof s.accessToken),new fh(s.accessToken,t.currentUser)):null}):Promise.resolve(null)},e.prototype.invalidateToken=function(){this.forceRefresh=!0},e.prototype.setChangeListener=function(t,i){var o=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return(0,v.mG)(o,void 0,void 0,function(){return(0,v.Jh)(this,function(s){switch(s.label){case 0:return[4,this.oc.promise];case 1:return s.sent(),[4,i(this.currentUser)];case 2:return s.sent(),this.changeListener=i,[2]}})})})},e.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},e.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return q(null===t||"string"==typeof t),new Nt(t)},e}(),jp=function(){function e(t,i,o){this.hc=t,this.lc=i,this.fc=o,this.type="FirstParty",this.user=Nt.FIRST_PARTY}return Object.defineProperty(e.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},i=this.hc.auth.getAuthHeaderValueForFirstParty([]);return i&&(t.Authorization=i),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),e}(),Kp=function(){function e(t,i,o){this.hc=t,this.lc=i,this.fc=o}return e.prototype.getToken=function(){return Promise.resolve(new jp(this.hc,this.lc,this.fc))},e.prototype.setChangeListener=function(t,i){t.enqueueRetryable(function(){return i(Nt.FIRST_PARTY)})},e.prototype.removeChangeListener=function(){},e.prototype.invalidateToken=function(){},e}();function ta(e,t,i){if(!i)throw new A(C.INVALID_ARGUMENT,"Function "+e+"() cannot be called with an empty "+t+".")}function ea(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new A(C.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" and "mergeFields".');return t}function ph(e,t,i,o){if(!0===t&&!0===o)throw new A(C.INVALID_ARGUMENT,e+" and "+i+" cannot be used together.")}function gh(e){if(!k.isDocumentKey(e))throw new A(C.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e+" has "+e.length+".")}function mh(e){if(k.isDocumentKey(e))throw new A(C.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e+" has "+e.length+".")}function vs(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(i){if(i.constructor){var o=/function\s+([^\s(]+)\s*\(/.exec(i.constructor.toString());if(o&&o.length>1)return o[1]}return null}(e);return t?"a custom "+t+" object":"an object"}return"function"==typeof e?"a function":F()}function W(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new A(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var i=vs(e);throw new A(C.INVALID_ARGUMENT,"Expected type '"+t.name+"', but it was: "+i)}return e}function yh(e,t){if(t<=0)throw new A(C.INVALID_ARGUMENT,"Function "+e+"() requires a positive number, but it was: "+t+".")}var vh=function(){function e(t){var i;if(void 0===t.host){if(void 0!==t.ssl)throw new A(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(i=t.ssl)||void 0===i||i;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new A(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,ph("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return e.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},e}(),eo=function(){function e(t,i){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vh({}),this._settingsFrozen=!1,t instanceof ys?(this._databaseId=t,this._credentials=new dh):(this._app=t,this._databaseId=function(o){if(!Object.prototype.hasOwnProperty.apply(o.options,["projectId"]))throw new A(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ys(o.options.projectId)}(t),this._credentials=new Bp(i))}return Object.defineProperty(e.prototype,"app",{get:function(){if(!this._app)throw new A(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),e.prototype._setSettings=function(t){if(this._settingsFrozen)throw new A(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vh(t),void 0!==t.credentials&&(this._credentials=function(i){if(!i)return new dh;switch(i.type){case"gapi":var o=i.client;return q(!("object"!=typeof o||null===o||!o.auth||!o.auth.getAuthHeaderValueForFirstParty)),new Kp(o,i.sessionIndex||"0",i.iamToken||null);case"provider":return i.client;default:throw new A(C.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},e.prototype._getSettings=function(){return this._settings},e.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},e.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},e.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},e.prototype._terminate=function(){return(i=hh.get(this))&&(N("ComponentProvider","Removing Datastore"),hh.delete(this),i.terminate()),Promise.resolve();var i},e}(),it=function(){function e(t,i,o){this.converter=i,this._key=o,this.type="document",this.firestore=t}return Object.defineProperty(e.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new rn(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._key)},e}(),jt=function(){function e(t,i,o){this.converter=i,this._query=o,this.type="query",this.firestore=t}return e.prototype.withConverter=function(t){return new e(this.firestore,t,this._query)},e}(),rn=function(e){function t(i,o,s){var u=this;return(u=e.call(this,i,o,Tr(s))||this)._path=s,u.type="collection",u}return(0,v.ZT)(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var i=this._path.popLast();return i.isEmpty()?null:new it(this.firestore,null,new k(i))},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(i){return new t(this.firestore,i,this._path)},t}(jt);function _h(e,t){for(var i,o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(e=(0,U.m9)(e),ta("collection","path",t),e instanceof eo)return mh(i=Q.fromString.apply(Q,(0,v.ev)([t],o))),new rn(e,null,i);if(!(e instanceof it||e instanceof rn))throw new A(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return mh(i=Q.fromString.apply(Q,(0,v.ev)([e.path],o)).child(Q.fromString(t))),new rn(e.firestore,null,i)}function _s(e,t){for(var i,o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(e=(0,U.m9)(e),1===arguments.length&&(t=tc.u()),ta("doc","path",t),e instanceof eo)return gh(i=Q.fromString.apply(Q,(0,v.ev)([t],o))),new it(e,null,new k(i));if(!(e instanceof it||e instanceof rn))throw new A(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return gh(i=e._path.child(Q.fromString.apply(Q,(0,v.ev)([t],o)))),new it(e.firestore,e instanceof rn?e.converter:null,new k(i))}function bh(e,t){return e=(0,U.m9)(e),t=(0,U.m9)(t),(e instanceof it||e instanceof rn)&&(t instanceof it||t instanceof rn)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function wh(e,t){return e=(0,U.m9)(e),t=(0,U.m9)(t),e instanceof jt&&t instanceof jt&&e.firestore===t.firestore&&qi(e._query,t._query)&&e.converter===t.converter}var Hp=function(){function e(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new Fu(this,"async_queue_retry"),this.Ic=function(){var o=hs();o&&N("AsyncQueue","Visibility state changed to "+o.visibilityState),t.Zi.Gi()};var i=hs();i&&"function"==typeof i.addEventListener&&i.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(e.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),e.prototype.enqueueAndForget=function(t){this.enqueue(t)},e.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},e.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var i=hs();i&&"function"==typeof i.removeEventListener&&i.removeEventListener("visibilitychange",this.Ic)}},e.prototype.enqueue=function(t){var i=this;if(this.Ac(),this._c)return new Promise(function(){});var o=new kt;return this.Rc(function(){return i._c&&i.Ec?Promise.resolve():(t().then(o.resolve,o.reject),o.promise)}).then(function(){return o.promise})},e.prototype.enqueueRetryable=function(t){var i=this;this.enqueueAndForget(function(){return i.wc.push(t),i.bc()})},e.prototype.bc=function(){return(0,v.mG)(this,void 0,void 0,function(){var t,i=this;return(0,v.Jh)(this,function(o){switch(o.label){case 0:if(0===this.wc.length)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return o.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Mn(t=o.sent()))throw t;return N("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return i.bc()}),o.label=5;case 5:return[2]}})})},e.prototype.Rc=function(t){var i=this,o=this.dc.then(function(){return i.gc=!0,t().catch(function(s){throw i.yc=s,i.gc=!1,ht("INTERNAL UNHANDLED ERROR: ",(a=(u=s).message||"",u.stack&&(a=u.stack.includes(u.message)?u.stack:u.message+"\n"+u.stack),a)),s;var u,a}).then(function(s){return i.gc=!1,s})});return this.dc=o,o},e.prototype.enqueueAfterDelay=function(t,i,o){var s=this;this.Ac(),this.Tc.indexOf(t)>-1&&(i=0);var u=up.createAndSchedule(this,t,i,o,function(a){return s.vc(a)});return this.mc.push(u),u},e.prototype.Ac=function(){this.yc&&F()},e.prototype.verifyOperationInProgress=function(){},e.prototype.Pc=function(){return(0,v.mG)(this,void 0,void 0,function(){var t;return(0,v.Jh)(this,function(i){switch(i.label){case 0:return[4,t=this.dc];case 1:i.sent(),i.label=2;case 2:if(t!==this.dc)return[3,0];i.label=3;case 3:return[2]}})})},e.prototype.Vc=function(t){for(var i=0,o=this.mc;i<o.length;i++)if(o[i].timerId===t)return!0;return!1},e.prototype.Sc=function(t){var i=this;return this.Pc().then(function(){i.mc.sort(function(a,c){return a.targetTimeMs-c.targetTimeMs});for(var o=0,s=i.mc;o<s.length;o++){var u=s[o];if(u.skipDelay(),"all"!==t&&u.timerId===t)break}return i.Pc()})},e.prototype.Dc=function(t){this.Tc.push(t)},e.prototype.vc=function(t){var i=this.mc.indexOf(t);this.mc.splice(i,1)},e}();function zr(e){return function(t,i){if("object"!=typeof t||null===t)return!1;for(var o=t,s=0,u=["next","error","complete"];s<u.length;s++){var a=u[s];if(a in o&&"function"==typeof o[a])return!0}return!1}(e)}!function(){function e(){this._progressObserver={},this._taskCompletionResolver=new kt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}e.prototype.onProgress=function(t,i,o){this._progressObserver={next:t,error:i,complete:o}},e.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},e.prototype.then=function(t,i){return this._taskCompletionResolver.promise.then(t,i)},e.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},e.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},e.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var at=function(e){function t(i,o){var s=this;return(s=e.call(this,i,o)||this).type="firestore",s._queue=new Hp,s._persistenceKey="name"in i?i.name:"[DEFAULT]",s}return(0,v.ZT)(t,e),t.prototype._terminate=function(){return this._firestoreClient||Eh(this),this._firestoreClient.terminate()},t}(eo);function Ct(e){return e._firestoreClient||Eh(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Eh(e){var t,u,c,i=e._freezeSettings(),o=(u=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",new Gp(e._databaseId,u,e._persistenceKey,(c=i).host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,c.useFetchStreams));e._firestoreClient=new Up(e._credentials,e._queue,o)}function Ch(e,t,i){var o=this,s=new kt;return e.asyncQueue.enqueue(function(){return(0,v.mG)(o,void 0,void 0,function(){var u;return(0,v.Jh)(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,oh(e,i)];case 1:return a.sent(),[4,sh(e,t)];case 2:return a.sent(),s.resolve(),[3,4];case 3:if(!("FirebaseError"===(c=u=a.sent()).name?c.code===C.FAILED_PRECONDITION||c.code===C.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&c instanceof DOMException)||22===c.code||20===c.code||11===c.code))throw u;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+u),s.reject(u),[3,4];case 4:return[2]}var c})})}).then(function(){return s.promise})}function Th(e){if(e._initialized||e._terminated)throw new A(C.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var ve=function(){function e(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];for(var o=0;o<t.length;++o)if(0===t[o].length)throw new A(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ue(t)}return e.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},e}(),Fn=function(){function e(t){this._byteString=t}return e.fromBase64String=function(t){try{return new e(Lt.fromBase64String(t))}catch(i){throw new A(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}},e.fromUint8Array=function(t){return new e(Lt.fromUint8Array(t))},e.prototype.toBase64=function(){return this._byteString.toBase64()},e.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},e.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},e.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},e}(),kn=function(e){this._methodName=e},bs=function(){function e(t,i){if(!isFinite(t)||t<-90||t>90)throw new A(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(i)||i<-180||i>180)throw new A(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=t,this._long=i}return Object.defineProperty(e.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},e.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},e.prototype._compareTo=function(t){return H(this._lat,t._lat)||H(this._long,t._long)},e}(),Qp=/^__.*__$/,Wp=function(){function e(t,i,o){this.data=t,this.fieldMask=i,this.fieldTransforms=o}return e.prototype.toMutation=function(t,i){return null!==this.fieldMask?new We(t,this.data,this.fieldMask,i,this.fieldTransforms):new Ki(t,this.data,i,this.fieldTransforms)},e}(),Ih=function(){function e(t,i,o){this.data=t,this.fieldMask=i,this.fieldTransforms=o}return e.prototype.toMutation=function(t,i){return new We(t,this.data,this.fieldMask,i,this.fieldTransforms)},e}();function Ah(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F()}}var Sh=function(){function e(t,i,o,s,u,a){this.settings=t,this.databaseId=i,this.R=o,this.ignoreUndefinedProperties=s,void 0===u&&this.Cc(),this.fieldTransforms=u||[],this.fieldMask=a||[]}return Object.defineProperty(e.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),e.prototype.xc=function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},e.prototype.kc=function(t){var i,o=null===(i=this.path)||void 0===i?void 0:i.child(t),s=this.xc({path:o,Fc:!1});return s.$c(t),s},e.prototype.Oc=function(t){var i,o=null===(i=this.path)||void 0===i?void 0:i.child(t),s=this.xc({path:o,Fc:!1});return s.Cc(),s},e.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},e.prototype.Lc=function(t){return Es(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},e.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(i){return t.isPrefixOf(i)})||void 0!==this.fieldTransforms.find(function(i){return t.isPrefixOf(i.field)})},e.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},e.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(Ah(this.Nc)&&Qp.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},e}(),Yp=function(){function e(t,i,o){this.databaseId=t,this.ignoreUndefinedProperties=i,this.R=o||Zi(t)}return e.prototype.Uc=function(t,i,o,s){return void 0===s&&(s=!1),new Sh({Nc:t,methodName:i,qc:o,path:ue.emptyPath(),Fc:!1,Bc:s},this.databaseId,this.R,this.ignoreUndefinedProperties)},e}();function Rn(e){var t=e._freezeSettings(),i=Zi(e._databaseId);return new Yp(e._databaseId,!!t.ignoreUndefinedProperties,i)}function ws(e,t,i,o,s,u){void 0===u&&(u={});var a=e.Uc(u.merge||u.mergeFields?2:0,t,i,s);oa("Data must be an object, but it was:",a,o);var c,h,p=Vh(o,a);if(u.merge)c=new br(a.fieldMask),h=a.fieldTransforms;else if(u.mergeFields){for(var g=[],_=0,b=u.mergeFields;_<b.length;_++){var w=sa(t,b[_],i);if(!a.contains(w))throw new A(C.INVALID_ARGUMENT,"Field '"+w+"' is specified in your field mask but missing from your input data.");Oh(g,w)||g.push(w)}c=new br(g),h=a.fieldTransforms.filter(function(E){return c.covers(E.field)})}else c=null,h=a.fieldTransforms;return new Wp(new Jt(p),c,h)}var na=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,v.ZT)(t,e),t.prototype._toFieldTransform=function(i){if(2!==i.Nc)throw i.Lc(1===i.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return i.fieldMask.push(i.path),null},t.prototype.isEqual=function(i){return i instanceof t},t}(kn);function Dh(e,t,i){return new Sh({Nc:3,qc:t.settings.qc,methodName:e._methodName,Fc:i},t.databaseId,t.R,t.ignoreUndefinedProperties)}var $p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,v.ZT)(t,e),t.prototype._toFieldTransform=function(i){return new ji(i.path,new Ar)},t.prototype.isEqual=function(i){return i instanceof t},t}(kn),Zp=function(e){function t(i,o){var s=this;return(s=e.call(this,i)||this).Kc=o,s}return(0,v.ZT)(t,e),t.prototype._toFieldTransform=function(i){var o=Dh(this,i,!0),s=this.Kc.map(function(a){return Pn(a,o)}),u=new Dn(s);return new ji(i.path,u)},t.prototype.isEqual=function(i){return this===i},t}(kn),Xp=function(e){function t(i,o){var s=this;return(s=e.call(this,i)||this).Kc=o,s}return(0,v.ZT)(t,e),t.prototype._toFieldTransform=function(i){var o=Dh(this,i,!0),s=this.Kc.map(function(a){return Pn(a,o)}),u=new Nn(s);return new ji(i.path,u)},t.prototype.isEqual=function(i){return this===i},t}(kn),tg=function(e){function t(i,o){var s=this;return(s=e.call(this,i)||this).Qc=o,s}return(0,v.ZT)(t,e),t.prototype._toFieldTransform=function(i){var o=new Sr(i.R,wc(i.R,this.Qc));return new ji(i.path,o)},t.prototype.isEqual=function(i){return this===i},t}(kn);function ra(e,t,i,o){var s=e.Uc(1,t,i);oa("Data must be an object, but it was:",s,o);var u=[],a=Jt.empty();In(o,function(h,p){var g=ua(t,h,i);p=(0,U.m9)(p);var _=s.Oc(g);if(p instanceof na)u.push(g);else{var b=Pn(p,_);null!=b&&(u.push(g),a.set(g,b))}});var c=new br(u);return new Ih(a,c,s.fieldTransforms)}function ia(e,t,i,o,s,u){var a=e.Uc(1,t,i),c=[sa(t,o,i)],h=[s];if(u.length%2!=0)throw new A(C.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var p=0;p<u.length;p+=2)c.push(sa(t,u[p])),h.push(u[p+1]);for(var g=[],_=Jt.empty(),b=c.length-1;b>=0;--b)if(!Oh(g,c[b])){var w=c[b],E=h[b];E=(0,U.m9)(E);var T=a.Oc(w);if(E instanceof na)g.push(w);else{var D=Pn(E,T);null!=D&&(g.push(w),_.set(w,D))}}var V=new br(g);return new Ih(_,V,a.fieldTransforms)}function Nh(e,t,i,o){return void 0===o&&(o=!1),Pn(i,e.Uc(o?4:3,t))}function Pn(e,t){if(Mh(e=(0,U.m9)(e)))return oa("Unsupported field value:",t,e),Vh(e,t);if(e instanceof kn)return function(i,o){if(!Ah(o.Nc))throw o.Lc(i._methodName+"() can only be used with update() and set()");if(!o.path)throw o.Lc(i._methodName+"() is not currently supported inside arrays");var s=i._toFieldTransform(o);s&&o.fieldTransforms.push(s)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&4!==t.Nc)throw t.Lc("Nested arrays are not supported");return function(i,o){for(var s=[],u=0,a=0,c=i;a<c.length;a++){var h=Pn(c[a],o.Mc(u));null==h&&(h={nullValue:"NULL_VALUE"}),s.push(h),u++}return{arrayValue:{values:s}}}(e,t)}return function(i,o){if(null===(i=(0,U.m9)(i)))return{nullValue:"NULL_VALUE"};if("number"==typeof i)return wc(o.R,i);if("boolean"==typeof i)return{booleanValue:i};if("string"==typeof i)return{stringValue:i};if(i instanceof Date){var s=Gt.fromDate(i);return{timestampValue:Ji(o.R,s)}}if(i instanceof Gt)return s=new Gt(i.seconds,1e3*Math.floor(i.nanoseconds/1e3)),{timestampValue:Ji(o.R,s)};if(i instanceof bs)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof Fn)return{bytesValue:qc(o.R,i._byteString)};if(i instanceof it){var u=i.firestore._databaseId;if(!u.isEqual(s=o.databaseId))throw o.Lc("Document reference is for database "+u.projectId+"/"+u.database+" but should be for database "+s.projectId+"/"+s.database);return{referenceValue:_u(i.firestore._databaseId||o.databaseId,i._key.path)}}throw o.Lc("Unsupported field value: "+vs(i))}(e,t)}function Vh(e,t){var i={};return rc(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):In(e,function(o,s){var u=Pn(s,t.kc(o));null!=u&&(i[o]=u)}),{mapValue:{fields:i}}}function Mh(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Gt||e instanceof bs||e instanceof Fn||e instanceof it||e instanceof kn)}function oa(e,t,i){if(!Mh(i)||"object"!=typeof(s=i)||null===s||Object.getPrototypeOf(s)!==Object.prototype&&null!==Object.getPrototypeOf(s)){var o=vs(i);throw t.Lc("an object"===o?e+" a custom object":e+" "+o)}var s}function sa(e,t,i){if((t=(0,U.m9)(t))instanceof ve)return t._internalPath;if("string"==typeof t)return ua(e,t);throw Es("Field path arguments must be of type string or FieldPath.",e,!1,void 0,i)}var eg=new RegExp("[~\\*/\\[\\]]");function ua(e,t,i){if(t.search(eg)>=0)throw Es("Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,i);try{return(new(ve.bind.apply(ve,(0,v.ev)([void 0],t.split(".")))))._internalPath}catch(o){throw Es("Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,i)}}function Es(e,t,i,o,s){var u=o&&!o.isEmpty(),a=void 0!==s,c="Function "+t+"() called with invalid data";i&&(c+=" (via `toFirestore()`)");var h="";return(u||a)&&(h+=" (found",u&&(h+=" in field "+o),a&&(h+=" in document "+s),h+=")"),new A(C.INVALID_ARGUMENT,(c+=". ")+e+h)}function Oh(e,t){return e.some(function(i){return i.isEqual(t)})}var no=function(){function e(t,i,o,s,u){this._firestore=t,this._userDataWriter=i,this._key=o,this._document=s,this._converter=u}return Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new it(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),e.prototype.exists=function(){return null!==this._document},e.prototype.data=function(){if(this._document){if(this._converter){var t=new ng(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},e.prototype.get=function(t){if(this._document){var i=this._document.data.field(Cs("DocumentSnapshot.get",t));if(null!==i)return this._userDataWriter.convertValue(i)}},e}(),ng=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,v.ZT)(t,e),t.prototype.data=function(){return e.prototype.data.call(this)},t}(no);function Cs(e,t){return"string"==typeof t?ua(e,t):t instanceof ve?t._internalPath:t._delegate._internalPath}var Ln=function(){function e(t,i){this.hasPendingWrites=t,this.fromCache=i}return e.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},e}(),Me=function(e){function t(i,o,s,u,a,c){var h=this;return(h=e.call(this,i,o,s,u,c)||this)._firestore=i,h._firestoreImpl=i,h.metadata=a,h}return(0,v.ZT)(t,e),t.prototype.exists=function(){return e.prototype.exists.call(this)},t.prototype.data=function(i){if(void 0===i&&(i={}),this._document){if(this._converter){var o=new ro(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(o,i)}return this._userDataWriter.convertValue(this._document.data.value,i.serverTimestamps)}},t.prototype.get=function(i,o){if(void 0===o&&(o={}),this._document){var s=this._document.data.field(Cs("DocumentSnapshot.get",i));if(null!==s)return this._userDataWriter.convertValue(s,o.serverTimestamps)}},t}(no),ro=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,v.ZT)(t,e),t.prototype.data=function(i){return void 0===i&&(i={}),e.prototype.data.call(this,i)},t}(Me),on=function(){function e(t,i,o,s){this._firestore=t,this._userDataWriter=i,this._snapshot=s,this.metadata=new Ln(s.hasPendingWrites,s.fromCache),this.query=o}return Object.defineProperty(e.prototype,"docs",{get:function(){var t=[];return this.forEach(function(i){return t.push(i)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t,i){var o=this;this._snapshot.docs.forEach(function(s){t.call(i,new ro(o._firestore,o._userDataWriter,s.key,s,new Ln(o._snapshot.mutatedKeys.has(s.key),o._snapshot.fromCache),o.query.converter))})},e.prototype.docChanges=function(t){void 0===t&&(t={});var i=!!t.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new A(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(o,s){if(o._snapshot.oldDocs.isEmpty()){var u=0;return o._snapshot.docChanges.map(function(c){return{type:"added",doc:new ro(o._firestore,o._userDataWriter,c.doc.key,c.doc,new Ln(o._snapshot.mutatedKeys.has(c.doc.key),o._snapshot.fromCache),o.query.converter),oldIndex:-1,newIndex:u++}})}var a=o._snapshot.oldDocs;return o._snapshot.docChanges.filter(function(c){return s||3!==c.type}).map(function(c){var h=new ro(o._firestore,o._userDataWriter,c.doc.key,c.doc,new Ln(o._snapshot.mutatedKeys.has(c.doc.key),o._snapshot.fromCache),o.query.converter),p=-1,g=-1;return 0!==c.type&&(p=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),1!==c.type&&(g=(a=a.add(c.doc)).indexOf(c.doc.key)),{type:rg(c.type),doc:h,oldIndex:p,newIndex:g}})}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges},e}();function rg(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F()}}function xh(e,t){return e instanceof Me&&t instanceof Me?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof on&&t instanceof on&&e._firestore===t._firestore&&wh(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Fh(e){if(Yo(e)&&0===e.explicitOrderBy.length)throw new A(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var io=function(){};function sn(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var o=0,s=t;o<s.length;o++){var u=s[o];e=u._apply(e)}return e}var ig=function(e){function t(i,o,s){var u=this;return(u=e.call(this)||this).jc=i,u.Wc=o,u.Gc=s,u.type="where",u}return(0,v.ZT)(t,e),t.prototype._apply=function(i){var u,c,o=Rn(i.firestore),s=function(u,a,c,h,p,g,_){var b;if(p.isKeyField()){if("array-contains"===g||"array-contains-any"===g)throw new A(C.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+g+"' queries on FieldPath.documentId().");if("in"===g||"not-in"===g){Gh(_,g);for(var w=[],E=0,T=_;E<T.length;E++)w.push(Uh(h,u,T[E]));b={arrayValue:{values:w}}}else b=Uh(h,u,_)}else"in"!==g&&"not-in"!==g&&"array-contains-any"!==g||Gh(_,g),b=Nh(c,"where",_,"in"===g||"not-in"===g);var V=zt.create(p,g,b);return function(R,P){if(P.g()){var K=hu(R);if(null!==K&&!K.isEqual(P.field))throw new A(C.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+K.toString()+"' and '"+P.field.toString()+"'");var z=lu(R);null!==z&&qh(0,P.field,z)}var $=function(Vt,da){for(var co=0,hf=Vt.filters;co<hf.length;co++){var ff=hf[co];if(da.indexOf(ff.op)>=0)return ff.op}return null}(R,function(Vt){switch(Vt){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(P.op));if(null!==$)throw new A(C.INVALID_ARGUMENT,$===P.op?"Invalid query. You cannot use more than one '"+P.op.toString()+"' filter.":"Invalid query. You cannot use '"+P.op.toString()+"' filters with '"+$.toString()+"' filters.")}(u,V),V}(i._query,0,o,i.firestore._databaseId,this.jc,this.Wc,this.Gc);return new jt(i.firestore,i.converter,(c=(u=i._query).filters.concat([s]),new Se(u.path,u.collectionGroup,u.explicitOrderBy.slice(),c,u.limit,u.limitType,u.startAt,u.endAt)))},t}(io),og=function(e){function t(i,o){var s=this;return(s=e.call(this)||this).jc=i,s.zc=o,s.type="orderBy",s}return(0,v.ZT)(t,e),t.prototype._apply=function(i){var s,a,o=function(s,u,a){if(null!==s.startAt)throw new A(C.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==s.endAt)throw new A(C.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var c=new Cr(u,a);return function(h,p){if(null===lu(h)){var g=hu(h);null!==g&&qh(0,g,p.field)}}(s,c),c}(i._query,this.jc,this.zc);return new jt(i.firestore,i.converter,(a=(s=i._query).explicitOrderBy.concat([o]),new Se(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)))},t}(io),kh=function(e){function t(i,o,s){var u=this;return(u=e.call(this)||this).type=i,u.Hc=o,u.Jc=s,u}return(0,v.ZT)(t,e),t.prototype._apply=function(i){return new jt(i.firestore,i.converter,mc(i._query,this.Hc,this.Jc))},t}(io),Rh=function(e){function t(i,o,s){var u=this;return(u=e.call(this)||this).type=i,u.Yc=o,u.Xc=s,u}return(0,v.ZT)(t,e),t.prototype._apply=function(i){var s,u,o=Lh(i,this.type,this.Yc,this.Xc);return new jt(i.firestore,i.converter,(u=o,new Se((s=i._query).path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,u,s.endAt)))},t}(io),Ph=function(e){function t(i,o,s){var u=this;return(u=e.call(this)||this).type=i,u.Yc=o,u.Xc=s,u}return(0,v.ZT)(t,e),t.prototype._apply=function(i){var s,u,o=Lh(i,this.type,this.Yc,this.Xc);return new jt(i.firestore,i.converter,(u=o,new Se((s=i._query).path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,s.startAt,u)))},t}(io);function Lh(e,t,i,o){if(i[0]=(0,U.m9)(i[0]),i[0]instanceof no)return function(u,a,c,h,p){if(!h)throw new A(C.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var g=[],_=0,b=Ir(u);_<b.length;_++){var w=b[_];if(w.field.isKeyField())g.push(Ko(a,h.key));else{var E=h.data.field(w.field);if(ou(E))throw new A(C.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+w.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===E){var T=w.field.canonicalString();throw new A(C.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+T+"' (used as the orderBy) does not exist.")}g.push(E)}}return new Gi(g,p)}(e._query,e.firestore._databaseId,t,i[0]._document,o);var s=Rn(e.firestore);return function(u,a,c,h,p,g){var _=u.explicitOrderBy;if(p.length>_.length)throw new A(C.INVALID_ARGUMENT,"Too many arguments provided to "+h+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var b=[],w=0;w<p.length;w++){var E=p[w];if(_[w].field.isKeyField()){if("string"!=typeof E)throw new A(C.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+h+"(), but got a "+typeof E);if(!fu(u)&&-1!==E.indexOf("/"))throw new A(C.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+h+"() must be a plain document ID, but '"+E+"' contains a slash.");var T=u.path.child(Q.fromString(E));if(!k.isDocumentKey(T))throw new A(C.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+h+"() must result in a valid document path, but '"+T+"' is not because it contains an odd number of segments.");var D=new k(T);b.push(Ko(a,D))}else{var V=Nh(c,h,E);b.push(V)}}return new Gi(b,g)}(e._query,e.firestore._databaseId,s,t,i,o)}function Uh(e,t,i){if("string"==typeof(i=(0,U.m9)(i))){if(""===i)throw new A(C.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!fu(t)&&-1!==i.indexOf("/"))throw new A(C.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+i+"' contains a '/' character.");var o=t.path.child(Q.fromString(i));if(!k.isDocumentKey(o))throw new A(C.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+o+"' is not because it has an odd number of segments ("+o.length+").");return Ko(e,new k(o))}if(i instanceof it)return Ko(e,i._key);throw new A(C.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+vs(i)+".")}function Gh(e,t){if(!Array.isArray(e)||0===e.length)throw new A(C.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(e.length>10)throw new A(C.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.")}function qh(e,t,i){if(!i.isEqual(t))throw new A(C.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+i.toString()+"' instead.")}var aa=function(){function e(){}return e.prototype.convertValue=function(t,i){switch(void 0===i&&(i="none"),Sn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ft(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,i);case 5:return t.stringValue;case 6:return this.convertBytes(wr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,i);case 10:return this.convertObject(t.mapValue,i);default:throw F()}},e.prototype.convertObject=function(t,i){var o=this,s={};return In(t.fields,function(u,a){s[u]=o.convertValue(a,i)}),s},e.prototype.convertGeoPoint=function(t){return new bs(ft(t.latitude),ft(t.longitude))},e.prototype.convertArray=function(t,i){var o=this;return(t.values||[]).map(function(s){return o.convertValue(s,i)})},e.prototype.convertServerTimestamp=function(t,i){switch(i){case"previous":var o=oc(t);return null==o?null:this.convertValue(o,i);case"estimate":return this.convertTimestamp(Ri(t));default:return null}},e.prototype.convertTimestamp=function(t){var i=Qe(t);return new Gt(i.seconds,i.nanos)},e.prototype.convertDocumentKey=function(t,i){var o=Q.fromString(t);q(tl(o));var s=new ys(o.get(1),o.get(3)),u=new k(o.popFirst(5));return s.isEqual(i)||ht("Document "+u+" contains a document reference within a different database ("+s.projectId+"/"+s.database+") which is not supported. It will be treated as a reference in the current database ("+i.projectId+"/"+i.database+") instead."),u},e}();function Ts(e,t,i){return e?i&&(i.merge||i.mergeFields)?e.toFirestore(t,i):e.toFirestore(t):t}var sg=function(e){function t(i){var o=this;return(o=e.call(this)||this).firestore=i,o}return(0,v.ZT)(t,e),t.prototype.convertBytes=function(i){return new Fn(i)},t.prototype.convertReference=function(i){var o=this.convertDocumentKey(i,this.firestore._databaseId);return new it(this.firestore,null,o)},t}(aa),ug=function(){function e(t,i){this._firestore=t,this._commitHandler=i,this._mutations=[],this._committed=!1,this._dataReader=Rn(t)}return e.prototype.set=function(t,i,o){this._verifyNotCommitted();var s=un(t,this._firestore),u=Ts(s.converter,i,o),a=ws(this._dataReader,"WriteBatch.set",s._key,u,null!==s.converter,o);return this._mutations.push(a.toMutation(s._key,Ot.none())),this},e.prototype.update=function(t,i,o){for(var s=[],u=3;u<arguments.length;u++)s[u-3]=arguments[u];this._verifyNotCommitted();var a,c=un(t,this._firestore);return a="string"==typeof(i=(0,U.m9)(i))||i instanceof ve?ia(this._dataReader,"WriteBatch.update",c._key,i,o,s):ra(this._dataReader,"WriteBatch.update",c._key,i),this._mutations.push(a.toMutation(c._key,Ot.exists(!0))),this},e.prototype.delete=function(t){this._verifyNotCommitted();var i=un(t,this._firestore);return this._mutations=this._mutations.concat(new Hi(i._key,Ot.none())),this},e.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},e.prototype._verifyNotCommitted=function(){if(this._committed)throw new A(C.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},e}();function un(e,t){if((e=(0,U.m9)(e)).firestore!==t)throw new A(C.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}var Un=function(e){function t(i){var o=this;return(o=e.call(this)||this).firestore=i,o}return(0,v.ZT)(t,e),t.prototype.convertBytes=function(i){return new Fn(i)},t.prototype.convertReference=function(i){var o=this.convertDocumentKey(i,this.firestore._databaseId);return new it(this.firestore,null,o)},t}(aa);function Bh(e,t,i){e=W(e,it);var o=W(e.firestore,at),s=Ts(e.converter,t,i);return oo(o,[ws(Rn(o),"setDoc",e._key,s,null!==e.converter,i).toMutation(e._key,Ot.none())])}function jh(e,t,i){for(var o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];e=W(e,it);var u=W(e.firestore,at),a=Rn(u);return oo(u,[("string"==typeof(t=(0,U.m9)(t))||t instanceof ve?ia(a,"updateDoc",e._key,t,i,o):ra(a,"updateDoc",e._key,t)).toMutation(e._key,Ot.exists(!0))])}function Kh(e){for(var t,i,o,s=[],u=1;u<arguments.length;u++)s[u-1]=arguments[u];e=(0,U.m9)(e);var a={includeMetadataChanges:!1},c=0;"object"!=typeof s[c]||zr(s[c])||(a=s[c],c++);var h,p,g,_={includeMetadataChanges:a.includeMetadataChanges};if(zr(s[c])){var b=s[c];s[c]=null===(t=b.next)||void 0===t?void 0:t.bind(b),s[c+1]=null===(i=b.error)||void 0===i?void 0:i.bind(b),s[c+2]=null===(o=b.complete)||void 0===o?void 0:o.bind(b)}if(e instanceof it)p=W(e.firestore,at),g=Tr(e._key.path),h={next:function(T){s[c]&&s[c](ca(p,e,T))},error:s[c+1],complete:s[c+2]};else{var w=W(e,jt);p=W(w.firestore,at),g=w._query;var E=new Un(p);h={next:function(T){s[c]&&s[c](new on(p,E,w,T))},error:s[c+1],complete:s[c+2]},Fh(e._query)}return function(T,D,V,R){var P=this,K=new gs(R),z=new Bu(D,K,V);return T.asyncQueue.enqueueAndForget(function(){return(0,v.mG)(P,void 0,void 0,function(){var $;return(0,v.Jh)(this,function(Vt){switch(Vt.label){case 0:return $=Uu,[4,Jr(T)];case 1:return[2,$.apply(void 0,[Vt.sent(),z])]}})})}),function(){K.Wo(),T.asyncQueue.enqueueAndForget(function(){return(0,v.mG)(P,void 0,void 0,function(){var $;return(0,v.Jh)(this,function(Vt){switch(Vt.label){case 0:return $=Gu,[4,Jr(T)];case 1:return[2,$.apply(void 0,[Vt.sent(),z])]}})})})}}(Ct(p),g,_,h)}function oo(e,t){return function(i,o){var s=this,u=new kt;return i.asyncQueue.enqueueAndForget(function(){return(0,v.mG)(s,void 0,void 0,function(){var a;return(0,v.Jh)(this,function(c){switch(c.label){case 0:return a=_p,[4,Xu(i)];case 1:return[2,a.apply(void 0,[c.sent(),o,u])]}})})}),u.promise}(Ct(e),t)}function ca(e,t,i){var o=i.docs.get(t._key),s=new Un(e);return new Me(e,s,t._key,o,new Ln(i.hasPendingWrites,i.fromCache),t.converter)}var ag=function(e){function t(i,o){var s=this;return(s=e.call(this,i,o)||this)._firestore=i,s}return(0,v.ZT)(t,e),t.prototype.get=function(i){var o=this,s=un(i,this._firestore),u=new Un(this._firestore);return e.prototype.get.call(this,i).then(function(a){return new Me(o._firestore,u,s._key,a._document,new Ln(!1,!1),s.converter)})},t}(function(){function e(t,i){this._firestore=t,this._transaction=i,this._dataReader=Rn(t)}return e.prototype.get=function(t){var i=this,o=un(t,this._firestore),s=new sg(this._firestore);return this._transaction.lookup([o._key]).then(function(u){if(!u||1!==u.length)return F();var a=u[0];if(a.isFoundDocument())return new no(i._firestore,s,a.key,a,o.converter);if(a.isNoDocument())return new no(i._firestore,s,o._key,null,o.converter);throw F()})},e.prototype.set=function(t,i,o){var s=un(t,this._firestore),u=Ts(s.converter,i,o),a=ws(this._dataReader,"Transaction.set",s._key,u,null!==s.converter,o);return this._transaction.set(s._key,a),this},e.prototype.update=function(t,i,o){for(var s=[],u=3;u<arguments.length;u++)s[u-3]=arguments[u];var a,c=un(t,this._firestore);return a="string"==typeof(i=(0,U.m9)(i))||i instanceof ve?ia(this._dataReader,"Transaction.update",c._key,i,o,s):ra(this._dataReader,"Transaction.update",c._key,i),this._transaction.update(c._key,a),this},e.prototype.delete=function(t){var i=un(t,this._firestore);return this._transaction.delete(i._key),this},e}());function Hh(){if("undefined"==typeof Uint8Array)throw new A(C.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Jh(){if("undefined"==typeof atob)throw new A(C.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var zh=function(){function e(t){this._delegate=t}return e.fromBase64String=function(t){return Jh(),new e(Fn.fromBase64String(t))},e.fromUint8Array=function(t){return Hh(),new e(Fn.fromUint8Array(t))},e.prototype.toBase64=function(){return Jh(),this._delegate.toBase64()},e.prototype.toUint8Array=function(){return Hh(),this._delegate.toUint8Array()},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(),cg=function(){function e(){}return e.prototype.enableIndexedDbPersistence=function(t,i){return function(o,s){Th(o=W(o,at));var u=Ct(o),a=o._freezeSettings(),c=new Yu;return Ch(u,c,new rh(c,a.cacheSizeBytes,null==s?void 0:s.forceOwnership))}(t._delegate,{forceOwnership:i})},e.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(i){Th(i=W(i,at));var o=Ct(i),s=i._freezeSettings(),u=new Yu;return Ch(o,u,new kp(u,s.cacheSizeBytes))}(t._delegate)},e.prototype.clearIndexedDbPersistence=function(t){return function(i){var o=this;if(i._initialized&&!i._terminated)throw new A(C.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var s=new kt;return i._queue.enqueueAndForgetEvenWhileRestricted(function(){return(0,v.mG)(o,void 0,void 0,function(){var u;return(0,v.Jh)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,function(c){return(0,v.mG)(this,void 0,void 0,function(){return(0,v.Jh)(this,function(p){switch(p.label){case 0:return Or.yt()?[4,Or.delete(c+"main")]:[2,Promise.resolve()];case 1:return p.sent(),[2]}})})}(Du(i._databaseId,i._persistenceKey))];case 1:return a.sent(),s.resolve(),[3,3];case 2:return u=a.sent(),s.reject(u),[3,3];case 3:return[2]}})})}),s.promise}(t._delegate)},e}(),Qh=function(){function e(t,i,o){var s=this;this._delegate=i,this.Zc=o,this.INTERNAL={delete:function(){return s.terminate()}},t instanceof ys||(this.tu=t)}return Object.defineProperty(e.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){var i=this._delegate._getSettings();t.merge||i.host===t.host||ki("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},i),t)).merge,this._delegate._setSettings(t)},e.prototype.useEmulator=function(t,i,o){void 0===o&&(o={}),function(s,u,a,c){var h;void 0===c&&(c={});var p=(s=W(s,eo))._getSettings();if("firestore.googleapis.com"!==p.host&&p.host!==u&&ki("Host has been set in both settings() and useEmulator(), emulator host will be used"),s._setSettings(Object.assign(Object.assign({},p),{host:u+":"+a,ssl:!1})),c.mockUserToken){var g,_;if("string"==typeof c.mockUserToken)g=c.mockUserToken,_=Nt.MOCK_USER;else{g=(0,U.Sg)(c.mockUserToken,null===(h=s._app)||void 0===h?void 0:h.options.projectId);var b=c.mockUserToken.sub||c.mockUserToken.user_id;if(!b)throw new A(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");_=new Nt(b)}s._credentials=new qp(new fh(g,_))}}(this._delegate,t,i,o)},e.prototype.enableNetwork=function(){return function(t){var i=this;return t.asyncQueue.enqueue(function(){return(0,v.mG)(i,void 0,void 0,function(){var o,s;return(0,v.Jh)(this,function(u){switch(u.label){case 0:return[4,uh(t)];case 1:return o=u.sent(),[4,ah(t)];case 2:return s=u.sent(),[2,(o.setNetworkEnabled(!0),a=s,c=M(a),c.Or.delete(0),Xi(c))]}var a,c})})})}(Ct(W(this._delegate,at)))},e.prototype.disableNetwork=function(){return function(t){var i=this;return t.asyncQueue.enqueue(function(){return(0,v.mG)(i,void 0,void 0,function(){var o,s;return(0,v.Jh)(this,function(u){switch(u.label){case 0:return[4,uh(t)];case 1:return o=u.sent(),[4,ah(t)];case 2:return s=u.sent(),[2,(o.setNetworkEnabled(!1),function(a){return(0,v.mG)(this,void 0,void 0,function(){var c;return(0,v.Jh)(this,function(h){switch(h.label){case 0:return(c=M(a)).Or.add(0),[4,qr(c)];case 1:return h.sent(),c.Br.set("Offline"),[2]}})})}(s))]}})})})}(Ct(W(this._delegate,at)))},e.prototype.enablePersistence=function(t){var i=!1,o=!1;return t&&ph("synchronizeTabs",i=!!t.synchronizeTabs,"experimentalForceOwningTab",o=!!t.experimentalForceOwningTab),i?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,o)},e.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},e.prototype.waitForPendingWrites=function(){return function(t){var i=this,o=new kt;return t.asyncQueue.enqueueAndForget(function(){return(0,v.mG)(i,void 0,void 0,function(){var s;return(0,v.Jh)(this,function(u){switch(u.label){case 0:return s=Cp,[4,Xu(t)];case 1:return[2,s.apply(void 0,[u.sent(),o])]}})})}),o.promise}(Ct(W(this._delegate,at)))},e.prototype.onSnapshotsInSync=function(t){return o=t,function(s,u){var a=this,c=new gs(u);return s.asyncQueue.enqueueAndForget(function(){return(0,v.mG)(a,void 0,void 0,function(){var h;return(0,v.Jh)(this,function(p){switch(p.label){case 0:return h=function(g,_){M(g).Gr.add(_),_.next()},[4,Jr(s)];case 1:return[2,h.apply(void 0,[p.sent(),c])]}})})}),function(){c.Wo(),s.asyncQueue.enqueueAndForget(function(){return(0,v.mG)(a,void 0,void 0,function(){var h;return(0,v.Jh)(this,function(p){switch(p.label){case 0:return h=function(g,_){M(g).Gr.delete(_)},[4,Jr(s)];case 1:return[2,h.apply(void 0,[p.sent(),c])]}})})})}}(Ct(W(this._delegate,at)),zr(o)?o:{next:o});var o},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.tu)throw new A(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new Ss(this,_h(this._delegate,t))}catch(i){throw Ut(i,"collection()","Firestore.collection()")}},e.prototype.doc=function(t){try{return new Gn(this,_s(this._delegate,t))}catch(i){throw Ut(i,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(t){try{return new ao(this,function(i,o){if(i=W(i,eo),ta("collectionGroup","collection id",o),o.indexOf("/")>=0)throw new A(C.INVALID_ARGUMENT,"Invalid collection ID '"+o+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new jt(i,null,(s=o,new Se(Q.emptyPath(),s)));var s}(this._delegate,t))}catch(i){throw Ut(i,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(t){var o,i=this;return function(u,a){var c=this,h=new kt;return u.asyncQueue.enqueueAndForget(function(){return(0,v.mG)(c,void 0,void 0,function(){var p;return(0,v.Jh)(this,function(g){switch(g.label){case 0:return[4,(_=u,ms(_).then(function(b){return b.datastore}))];case 1:return p=g.sent(),new Lp(u.asyncQueue,p,a,h).run(),[2]}var _})})}),h.promise}(Ct(o=this._delegate),function(u){return function(o){return t(new Wh(i,o))}(new ag(o,u))})},e.prototype.batch=function(){var t=this;return Ct(this._delegate),new Yh(new ug(this._delegate,function(i){return oo(t._delegate,i)}))},e.prototype.loadBundle=function(t){throw new A(C.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},e.prototype.namedQuery=function(t){throw new A(C.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},e}(),Is=function(e){function t(i){var o=this;return(o=e.call(this)||this).firestore=i,o}return(0,v.ZT)(t,e),t.prototype.convertBytes=function(i){return new zh(new Fn(i))},t.prototype.convertReference=function(i){var o=this.convertDocumentKey(i,this.firestore._databaseId);return Gn.eu(o,this.firestore,null)},t}(aa),Wh=function(){function e(t,i){this._firestore=t,this._delegate=i,this._userDataWriter=new Is(t)}return e.prototype.get=function(t){var i=this,o=qn(t);return this._delegate.get(o).then(function(s){return new so(i._firestore,new Me(i._firestore._delegate,i._userDataWriter,s._key,s._document,s.metadata,o.converter))})},e.prototype.set=function(t,i,o){var s=qn(t);return o?(ea("Transaction.set",o),this._delegate.set(s,i,o)):this._delegate.set(s,i),this},e.prototype.update=function(t,i,o){for(var s,u=[],a=3;a<arguments.length;a++)u[a-3]=arguments[a];var c=qn(t);return 2===arguments.length?this._delegate.update(c,i):(s=this._delegate).update.apply(s,(0,v.ev)([c,i,o],u)),this},e.prototype.delete=function(t){var i=qn(t);return this._delegate.delete(i),this},e}(),Yh=function(){function e(t){this._delegate=t}return e.prototype.set=function(t,i,o){var s=qn(t);return o?(ea("WriteBatch.set",o),this._delegate.set(s,i,o)):this._delegate.set(s,i),this},e.prototype.update=function(t,i,o){for(var s,u=[],a=3;a<arguments.length;a++)u[a-3]=arguments[a];var c=qn(t);return 2===arguments.length?this._delegate.update(c,i):(s=this._delegate).update.apply(s,(0,v.ev)([c,i,o],u)),this},e.prototype.delete=function(t){var i=qn(t);return this._delegate.delete(i),this},e.prototype.commit=function(){return this._delegate.commit()},e}(),As=function(){function e(t,i,o){this._firestore=t,this._userDataWriter=i,this._delegate=o}return e.prototype.fromFirestore=function(t,i){var o=new ro(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new uo(this._firestore,o),null!=i?i:{})},e.prototype.toFirestore=function(t,i){return i?this._delegate.toFirestore(t,i):this._delegate.toFirestore(t)},e.nu=function(t,i){var o=e.su,s=o.get(t);s||(s=new WeakMap,o.set(t,s));var u=s.get(i);return u||(u=new e(t,new Is(t),i),s.set(i,u)),u},e}();As.su=new WeakMap;var Gn=function(){function e(t,i){this.firestore=t,this._delegate=i,this._userDataWriter=new Is(t)}return e.iu=function(t,i,o){if(t.length%2!=0)throw new A(C.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new e(i,new it(i._delegate,o,new k(t)))},e.eu=function(t,i,o){return new e(i,new it(i._delegate,o,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new Ss(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new Ss(this.firestore,_h(this._delegate,t))}catch(i){throw Ut(i,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(t){return(t=(0,U.m9)(t))instanceof it&&bh(this._delegate,t)},e.prototype.set=function(t,i){i=ea("DocumentReference.set",i);try{return i?Bh(this._delegate,t,i):Bh(this._delegate,t)}catch(o){throw Ut(o,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(t,i){for(var o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];try{return 1===arguments.length?jh(this._delegate,t):jh.apply(void 0,(0,v.ev)([this._delegate,t,i],o))}catch(u){throw Ut(u,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return oo(W((t=this._delegate).firestore,at),[new Hi(t._key,Ot.none())]);var t},e.prototype.onSnapshot=function(){for(var t=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var s=$h(i),u=Zh(i,function(a){return new so(t.firestore,new Me(t.firestore._delegate,t._userDataWriter,a._key,a._document,a.metadata,t._delegate.converter))});return Kh(this._delegate,s,u)},e.prototype.get=function(t){var i=this;return("cache"===(null==t?void 0:t.source)?function(o){o=W(o,it);var s=W(o.firestore,at),u=Ct(s),a=new Un(s);return function(c,h){var p=this,g=new kt;return c.asyncQueue.enqueueAndForget(function(){return(0,v.mG)(p,void 0,void 0,function(){var _;return(0,v.Jh)(this,function(b){switch(b.label){case 0:return _=function(w,E,T){return(0,v.mG)(this,void 0,void 0,function(){var D,V;return(0,v.Jh)(this,function(R){switch(R.label){case 0:return R.trys.push([0,2,,3]),[4,(P=w,K=E,z=M(P),z.persistence.runTransaction("read document","readonly",function($){return z.Mn.mn($,K)}))];case 1:return(V=R.sent()).isFoundDocument()?T.resolve(V):V.isNoDocument()?T.resolve(null):T.reject(new A(C.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return D=R.sent(),V=Kr(D,"Failed to get document '"+E+" from cache"),T.reject(V),[3,3];case 3:return[2]}var P,K,z})})},[4,Zu(c)];case 1:return[2,_.apply(void 0,[b.sent(),h,g])]}})})}),g.promise}(u,o._key).then(function(c){return new Me(s,a,o._key,c,new Ln(null!==c&&c.hasLocalMutations,!0),o.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(o){o=W(o,it);var s=W(o.firestore,at);return ch(Ct(s),o._key,{source:"server"}).then(function(u){return ca(s,o,u)})}(this._delegate):function(o){o=W(o,it);var s=W(o.firestore,at);return ch(Ct(s),o._key).then(function(u){return ca(s,o,u)})}(this._delegate)).then(function(o){return new so(i.firestore,new Me(i.firestore._delegate,i._userDataWriter,o._key,o._document,o.metadata,i._delegate.converter))})},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?As.nu(this.firestore,t):null))},e}();function Ut(e,t,i){return e.message=e.message.replace(t,i),e}function $h(e){for(var t=0,i=e;t<i.length;t++){var o=i[t];if("object"==typeof o&&!zr(o))return o}return{}}function Zh(e,t){var i,o,s;return{next:function(u){s.next&&s.next(t(u))},error:null===(i=(s=zr(e[0])?e[0]:zr(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)||void 0===i?void 0:i.bind(s),complete:null===(o=s.complete)||void 0===o?void 0:o.bind(s)}}var so=function(){function e(t,i){this._firestore=t,this._delegate=i}return Object.defineProperty(e.prototype,"ref",{get:function(){return new Gn(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this._delegate.data(t)},e.prototype.get=function(t,i){return this._delegate.get(t,i)},e.prototype.isEqual=function(t){return xh(this._delegate,t._delegate)},e}(),uo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,v.ZT)(t,e),t.prototype.data=function(i){return this._delegate.data(i)},t}(so),ao=function(){function e(t,i){this.firestore=t,this._delegate=i,this._userDataWriter=new Is(t)}return e.prototype.where=function(t,i,o){try{return new e(this.firestore,sn(this._delegate,(a=o,c=i,h=Cs("where",s=t),new ig(h,c,a))))}catch(s){throw Ut(s,/(orderBy|where)\(\)/,"Query.$1()")}var s,a,c,h},e.prototype.orderBy=function(t,i){try{return new e(this.firestore,sn(this._delegate,function(o,s){void 0===s&&(s="asc");var u=s,a=Cs("orderBy",o);return new og(a,u)}(t,i)))}catch(o){throw Ut(o,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,sn(this._delegate,(yh("limit",i=t),new kh("limit",i,"F"))))}catch(i){throw Ut(i,"limit()","Query.limit()")}var i},e.prototype.limitToLast=function(t){try{return new e(this.firestore,sn(this._delegate,(yh("limitToLast",i=t),new kh("limitToLast",i,"L"))))}catch(i){throw Ut(i,"limitToLast()","Query.limitToLast()")}var i},e.prototype.startAt=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{return new e(this.firestore,sn(this._delegate,function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return new Rh("startAt",o,!0)}.apply(void 0,t)))}catch(o){throw Ut(o,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{return new e(this.firestore,sn(this._delegate,function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return new Rh("startAfter",o,!1)}.apply(void 0,t)))}catch(o){throw Ut(o,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{return new e(this.firestore,sn(this._delegate,function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return new Ph("endBefore",o,!0)}.apply(void 0,t)))}catch(o){throw Ut(o,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];try{return new e(this.firestore,sn(this._delegate,function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return new Ph("endAt",o,!1)}.apply(void 0,t)))}catch(o){throw Ut(o,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(t){return wh(this._delegate,t._delegate)},e.prototype.get=function(t){var i=this;return("cache"===(null==t?void 0:t.source)?function(o){o=W(o,jt);var s=W(o.firestore,at),u=Ct(s),a=new Un(s);return function(c,h){var p=this,g=new kt;return c.asyncQueue.enqueueAndForget(function(){return(0,v.mG)(p,void 0,void 0,function(){var _;return(0,v.Jh)(this,function(b){switch(b.label){case 0:return _=function(w,E,T){return(0,v.mG)(this,void 0,void 0,function(){var D,V,R,P,K;return(0,v.Jh)(this,function(z){switch(z.label){case 0:return z.trys.push([0,2,,3]),[4,ls(w,E,!0)];case 1:return K=z.sent(),D=new Yl(E,K.Bn),V=D._o(K.documents),R=D.applyChanges(V,!1),T.resolve(R.snapshot),[3,3];case 2:return P=z.sent(),K=Kr(P,"Failed to execute query '"+E+" against cache"),T.reject(K),[3,3];case 3:return[2]}})})},[4,Zu(c)];case 1:return[2,_.apply(void 0,[b.sent(),h,g])]}})})}),g.promise}(u,o._query).then(function(c){return new on(s,a,o,c)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(o){o=W(o,jt);var s=W(o.firestore,at),u=Ct(s),a=new Un(s);return lh(u,o._query,{source:"server"}).then(function(c){return new on(s,a,o,c)})}(this._delegate):function(o){o=W(o,jt);var s=W(o.firestore,at),u=Ct(s),a=new Un(s);return Fh(o._query),lh(u,o._query).then(function(c){return new on(s,a,o,c)})}(this._delegate)).then(function(o){return new la(i.firestore,new on(i.firestore._delegate,i._userDataWriter,i._delegate,o._snapshot))})},e.prototype.onSnapshot=function(){for(var t=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var s=$h(i),u=Zh(i,function(a){return new la(t.firestore,new on(t.firestore._delegate,t._userDataWriter,t._delegate,a._snapshot))});return Kh(this._delegate,s,u)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?As.nu(this.firestore,t):null))},e}(),hg=function(){function e(t,i){this._firestore=t,this._delegate=i}return Object.defineProperty(e.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new uo(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),e}(),la=function(){function e(t,i){this._firestore=t,this._delegate=i}return Object.defineProperty(e.prototype,"query",{get:function(){return new ao(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(i){return new uo(t._firestore,i)})},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var i=this;return this._delegate.docChanges(t).map(function(o){return new hg(i._firestore,o)})},e.prototype.forEach=function(t,i){var o=this;this._delegate.forEach(function(s){t.call(i,new uo(o._firestore,s))})},e.prototype.isEqual=function(t){return xh(this._delegate,t._delegate)},e}(),Ss=function(e){function t(i,o){var s=this;return(s=e.call(this,i,o)||this).firestore=i,s._delegate=o,s}return(0,v.ZT)(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var i=this._delegate.parent;return i?new Gn(this.firestore,i):null},enumerable:!1,configurable:!0}),t.prototype.doc=function(i){try{return new Gn(this.firestore,void 0===i?_s(this._delegate):_s(this._delegate,i))}catch(o){throw Ut(o,"doc()","CollectionReference.doc()")}},t.prototype.add=function(i){var s,u,a,c,h,o=this;return(s=this._delegate,u=i,a=W(s.firestore,at),c=_s(s),h=Ts(s.converter,u),oo(a,[ws(Rn(s.firestore),"addDoc",c._key,h,null!==s.converter,{}).toMutation(c._key,Ot.exists(!1))]).then(function(){return c})).then(function(s){return new Gn(o.firestore,s)})},t.prototype.isEqual=function(i){return bh(this._delegate,i._delegate)},t.prototype.withConverter=function(i){return new t(this.firestore,this._delegate.withConverter(i?As.nu(this.firestore,i):null))},t}(ao);function qn(e){return W(e,it)}var fg=function(){function e(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this._delegate=new(ve.bind.apply(ve,(0,v.ev)([void 0],t)))}return e.documentId=function(){return new e(ue.keyField().canonicalString())},e.prototype.isEqual=function(t){return(t=(0,U.m9)(t))instanceof ve&&this._delegate._internalPath.isEqual(t._internalPath)},e}(),dg=function(){function e(t){this._delegate=t}return e.serverTimestamp=function(){var t=new $p("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new na("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var o=function(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];return new Zp("arrayUnion",s)}.apply(void 0,t);return o._methodName="FieldValue.arrayUnion",new e(o)},e.arrayRemove=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var o=function(){for(var s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];return new Xp("arrayRemove",s)}.apply(void 0,t);return o._methodName="FieldValue.arrayRemove",new e(o)},e.increment=function(t){var i=new tg("increment",t);return i._methodName="FieldValue.increment",new e(i)},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e}(),pg=L(6034),gg={Firestore:Qh,GeoPoint:bs,Timestamp:Gt,Blob:zh,Transaction:Wh,WriteBatch:Yh,DocumentReference:Gn,DocumentSnapshot:so,Query:ao,QueryDocumentSnapshot:uo,QuerySnapshot:la,CollectionReference:Ss,FieldPath:fg,FieldValue:dg,setLogLevel:function(e){se.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};!function(e){e.INTERNAL.registerComponent(new pg.wA("firestore",function(o){return t=o.getProvider("app").getImmediate(),i=o.getProvider("auth-internal"),new Qh(t,new at(t,i),new cg);var t,i},"PUBLIC").setServiceProps(Object.assign({},gg))),e.registerVersion("@firebase/firestore","2.4.1")}(ce.Z);var Xh=L(1562);function tf(e,t){return function(e,t=pt.z){return new Yt.y(i=>{let o;return null!=t?t.schedule(()=>{o=e.onSnapshot({includeMetadataChanges:!0},i)}):o=e.onSnapshot({includeMetadataChanges:!0},i),()=>{null!=o&&o()}})}(e,t)}function ha(e,t){return tf(e,t).pipe((0,Z.U)(i=>({payload:i,type:"query"})))}function Ds(e,t){return ha(e,t).pipe((0,ot.O)(void 0),$t(),(0,Z.U)(([i,o])=>{const s=o.payload.docChanges(),u=s.map(a=>({type:a.type,payload:a}));return i&&JSON.stringify(i.payload.metadata)!==JSON.stringify(o.payload.metadata)&&o.payload.docs.forEach((a,c)=>{const h=s.find(g=>g.doc.ref.isEqual(a.ref)),p=null==i?void 0:i.payload.docs.find(g=>g.ref.isEqual(a.ref));h&&JSON.stringify(h.doc.metadata)===JSON.stringify(a.metadata)||!h&&p&&JSON.stringify(p.metadata)===JSON.stringify(a.metadata)||u.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:a}})}),u}))}function ef(e,t,i){return Ds(e,i).pipe((0,B.R)((o,s)=>function(e,t,i){return t.forEach(o=>{i.indexOf(o.type)>-1&&(e=function(e,t){switch(t.type){case"added":if(!e[t.newIndex]||!e[t.newIndex].doc.ref.isEqual(t.doc.ref))return fa(e,t.newIndex,0,t);break;case"modified":if(null==e[t.oldIndex]||e[t.oldIndex].doc.ref.isEqual(t.doc.ref)){if(t.oldIndex!==t.newIndex){const i=e.slice();return i.splice(t.oldIndex,1),i.splice(t.newIndex,0,t),i}return fa(e,t.newIndex,1,t)}break;case"removed":if(e[t.oldIndex]&&e[t.oldIndex].doc.ref.isEqual(t.doc.ref))return fa(e,t.oldIndex,1)}return e}(e,o))}),e}(o,s.map(u=>u.payload),t),[]),(0,It.x)(),(0,Z.U)(o=>o.map(s=>({type:s.type,payload:s}))))}function fa(e,t,i,...o){const s=e.slice();return s.splice(t,i,...o),s}function nf(e){return(!e||0===e.length)&&(e=["added","removed","modified"]),e}class rf{constructor(t,i,o){this.ref=t,this.query=i,this.afs=o}stateChanges(t){let i=Ds(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(i=i.pipe((0,Z.U)(o=>o.filter(s=>t.indexOf(s.type)>-1)))),i.pipe((0,ot.O)(void 0),$t(),(0,Zt.h)(([o,s])=>s.length>0||!o),(0,Z.U)(([o,s])=>s),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe((0,B.R)((i,o)=>[...i,...o],[]))}snapshotChanges(t){const i=nf(t);return ef(this.query,i,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return ha(this.query,this.afs.schedulers.outsideAngular).pipe((0,Z.U)(i=>i.payload.docs.map(o=>t.idField?Object.assign(Object.assign({},o.data()),{[t.idField]:o.id}):o.data())),this.afs.keepUnstableUntilFirst)}get(t){return(0,Rt.D)(this.query.get(t)).pipe((0,Qr.QV)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new of(this.ref.doc(t),this.afs)}}class of{constructor(t,i){this.ref=t,this.afs=i}set(t,i){return this.ref.set(t,i)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,i){const o=this.ref.collection(t),{ref:s,query:u}=lf(o,i);return new rf(s,u,this.afs)}snapshotChanges(){return function(e,t){return tf(e,t).pipe((0,ot.O)(void 0),$t(),(0,Z.U)(([i,o])=>o.exists?(null==i?void 0:i.exists)?{payload:o,type:"modified"}:{payload:o,type:"added"}:{payload:o,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe((0,Z.U)(({payload:i})=>t.idField?Object.assign(Object.assign({},i.data()),{[t.idField]:i.id}):i.data()))}get(t){return(0,Rt.D)(this.ref.get(t)).pipe((0,Qr.QV)(this.afs.schedulers.insideAngular))}}class wg{constructor(t,i){this.query=t,this.afs=i}stateChanges(t){return t&&0!==t.length?Ds(this.query,this.afs.schedulers.outsideAngular).pipe((0,Z.U)(i=>i.filter(o=>t.indexOf(o.type)>-1)),(0,Zt.h)(i=>i.length>0),this.afs.keepUnstableUntilFirst):Ds(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe((0,B.R)((i,o)=>[...i,...o],[]))}snapshotChanges(t){const i=nf(t);return ef(this.query,i,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return ha(this.query,this.afs.schedulers.outsideAngular).pipe((0,Z.U)(o=>o.payload.docs.map(s=>t.idField?Object.assign({[t.idField]:s.id},s.data()):s.data())),this.afs.keepUnstableUntilFirst)}get(t){return(0,Rt.D)(this.query.get(t)).pipe((0,Qr.QV)(this.afs.schedulers.insideAngular))}}const sf=new y.OlP("angularfire2.enableFirestorePersistence"),uf=new y.OlP("angularfire2.firestore.persistenceSettings"),af=new y.OlP("angularfire2.firestore.settings"),cf=new y.OlP("angularfire2.firestore.use-emulator");function lf(e,t=(i=>i)){return{query:t(e),ref:e}}let Eg=(()=>{class e{constructor(i,o,s,u,a,c,h,p,g){this.schedulers=new oe.HU(c),this.keepUnstableUntilFirst=(0,oe.ss)(this.schedulers);const _=(0,oe.on)(i,c,o);!Bn.Z.auth&&g&&(0,oe.yq)();const b=p;[this.firestore,this.persistenceEnabled$]=(0,oe.sI)(`${_.name}.firestore`,"AngularFirestore",_,()=>{const w=c.runOutsideAngular(()=>_.firestore());if(u&&w.settings(u),b&&w.useEmulator(...b),s&&!(0,Ns.PM)(a)){const E=()=>{try{return(0,Rt.D)(w.enablePersistence(h||void 0).then(()=>!0,()=>!1))}catch(T){return"undefined"!=typeof console&&console.warn(T),(0,ie.of)(!1)}};return[w,c.runOutsideAngular(E)]}return[w,(0,ie.of)(!1)]},[u,b,s])}collection(i,o){let s;s="string"==typeof i?this.firestore.collection(i):i;const{ref:u,query:a}=lf(s,o),c=this.schedulers.ngZone.run(()=>u);return new rf(c,a,this)}collectionGroup(i,o){const s=o||(a=>a),u=this.firestore.collectionGroup(i);return new wg(s(u),this)}doc(i){let o;o="string"==typeof i?this.firestore.doc(i):i;const s=this.schedulers.ngZone.run(()=>o);return new of(s,this)}createId(){return this.firestore.collection("_").doc().id}}return e.\u0275fac=function(i){return new(i||e)(y.LFG(oe.Dh),y.LFG(oe.xv,8),y.LFG(sf,8),y.LFG(af,8),y.LFG(y.Lbi),y.LFG(y.R0b),y.LFG(uf,8),y.LFG(cf,8),y.LFG(Xh.Qv,8))},e.\u0275prov=y.Yz7({factory:function(){return new e(y.LFG(oe.Dh),y.LFG(oe.xv,8),y.LFG(sf,8),y.LFG(af,8),y.LFG(y.Lbi),y.LFG(y.R0b),y.LFG(uf,8),y.LFG(cf,8),y.LFG(Xh.Qv,8))},token:e,providedIn:"any"}),e})()},665:(lo,_e,L)=>{L.d(_e,{Fj:()=>Bn,NI:()=>nt,u:()=>cr,cw:()=>Ee,sg:()=>mn,JJ:()=>ni,JL:()=>ri,UX:()=>mr,kI:()=>Vs,_Y:()=>Do});var y=L(7716),pt=L(8583),Yt=L(7574),Rt=L(9796),ie=L(8002),gt=L(1555),$t=L(4402);function Pt(d,f){return new Yt.y(l=>{const m=d.length;if(0===m)return void l.complete();const I=new Array(m);let x=0,rt=0;for(let ee=0;ee<m;ee++){const En=(0,$t.D)(d[ee]);let Di=!1;l.add(En.subscribe({next:ze=>{Di||(Di=!0,rt++),I[ee]=ze},error:ze=>l.error(ze),complete:()=>{x++,(x===m||!Di)&&(rt===m&&l.next(f?f.reduce((ze,Cn,de)=>(ze[Cn]=I[de],ze),{}):I),l.complete())}}))}})}let ot=(()=>{class d{constructor(l,m){this._renderer=l,this._elementRef=m,this.onChange=I=>{},this.onTouched=()=>{}}setProperty(l,m){this._renderer.setProperty(this._elementRef.nativeElement,l,m)}registerOnTouched(l){this.onTouched=l}registerOnChange(l){this.onChange=l}setDisabledState(l){this.setProperty("disabled",l)}}return d.\u0275fac=function(l){return new(l||d)(y.Y36(y.Qsj),y.Y36(y.SBq))},d.\u0275dir=y.lG2({type:d}),d})(),Z=(()=>{class d extends ot{}return d.\u0275fac=function(){let f;return function(m){return(f||(f=y.n5z(d)))(m||d)}}(),d.\u0275dir=y.lG2({type:d,features:[y.qOj]}),d})();const B=new y.OlP("NgValueAccessor"),Qr={provide:B,useExisting:(0,y.Gpc)(()=>Bn),multi:!0},Ns=new y.OlP("CompositionEventMode");let Bn=(()=>{class d extends ot{constructor(l,m,I){super(l,m),this._compositionMode=I,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const d=(0,pt.q)()?(0,pt.q)().getUserAgent():"";return/android (\d+)/.test(d.toLowerCase())}())}writeValue(l){this.setProperty("value",null==l?"":l)}_handleInput(l){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(l)}_compositionStart(){this._composing=!0}_compositionEnd(l){this._composing=!1,this._compositionMode&&this.onChange(l)}}return d.\u0275fac=function(l){return new(l||d)(y.Y36(y.Qsj),y.Y36(y.SBq),y.Y36(Ns,8))},d.\u0275dir=y.lG2({type:d,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(l,m){1&l&&y.NdJ("input",function(x){return m._handleInput(x.target.value)})("blur",function(){return m.onTouched()})("compositionstart",function(){return m._compositionStart()})("compositionend",function(x){return m._compositionEnd(x.target.value)})},features:[y._Bn([Qr]),y.qOj]}),d})();function ce(d){return null==d||0===d.length}function v(d){return null!=d&&"number"==typeof d.length}const U=new y.OlP("NgValidators"),Mt=new y.OlP("NgAsyncValidators"),Wr=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class Vs{static min(f){return d=f,f=>{if(ce(f.value)||ce(d))return null;const l=parseFloat(f.value);return!isNaN(l)&&l<d?{min:{min:d,actual:f.value}}:null};var d}static max(f){return d=f,f=>{if(ce(f.value)||ce(d))return null;const l=parseFloat(f.value);return!isNaN(l)&&l>d?{max:{max:d,actual:f.value}}:null};var d}static required(f){return ce(f.value)?{required:!0}:null}static requiredTrue(f){return!0===f.value?null:{required:!0}}static email(f){return ce((d=f).value)||Wr.test(d.value)?null:{email:!0};var d}static minLength(f){return d=f,f=>ce(f.value)||!v(f.value)?null:f.value.length<d?{minlength:{requiredLength:d,actualLength:f.value.length}}:null;var d}static maxLength(f){return d=f,f=>v(f.value)&&f.value.length>d?{maxlength:{requiredLength:d,actualLength:f.value.length}}:null;var d}static pattern(f){return function(d){if(!d)return le;let f,l;return"string"==typeof d?(l="","^"!==d.charAt(0)&&(l+="^"),l+=d,"$"!==d.charAt(d.length-1)&&(l+="$"),f=new RegExp(l)):(l=d.toString(),f=d),m=>{if(ce(m.value))return null;const I=m.value;return f.test(I)?null:{pattern:{requiredPattern:l,actualValue:I}}}}(f)}static nullValidator(f){return null}static compose(f){return ct(f)}static composeAsync(f){return mo(f)}}function le(d){return null}function Hn(d){return null!=d}function fo(d){const f=(0,y.QGY)(d)?(0,$t.D)(d):d;return(0,y.CqO)(f),f}function po(d){let f={};return d.forEach(l=>{f=null!=l?Object.assign(Object.assign({},f),l):f}),0===Object.keys(f).length?null:f}function go(d,f){return f.map(l=>l(d))}function cn(d){return d.map(f=>function(d){return!d.validate}(f)?f:l=>f.validate(l))}function ct(d){if(!d)return null;const f=d.filter(Hn);return 0==f.length?null:function(l){return po(go(l,f))}}function Xt(d){return null!=d?ct(cn(d)):null}function mo(d){if(!d)return null;const f=d.filter(Hn);return 0==f.length?null:function(l){return function(...d){if(1===d.length){const f=d[0];if((0,Rt.k)(f))return Pt(f,null);if((0,gt.K)(f)&&Object.getPrototypeOf(f)===Object.prototype){const l=Object.keys(f);return Pt(l.map(m=>f[m]),l)}}if("function"==typeof d[d.length-1]){const f=d.pop();return Pt(d=1===d.length&&(0,Rt.k)(d[0])?d[0]:d,null).pipe((0,ie.U)(l=>f(...l)))}return Pt(d,null)}(go(l,f).map(fo)).pipe((0,ie.U)(po))}}function $r(d){return null!=d?mo(cn(d)):null}function Zr(d,f){return null===d?[f]:Array.isArray(d)?[...d,f]:[d,f]}function Xr(d){return d._rawValidators}function yo(d){return d._rawAsyncValidators}function Jn(d){return d?Array.isArray(d)?d:[d]:[]}function xe(d,f){return Array.isArray(d)?d.includes(f):d===f}function ln(d,f){const l=Jn(f);return Jn(d).forEach(I=>{xe(l,I)||l.push(I)}),l}function ti(d,f){return Jn(f).filter(l=>!xe(d,l))}let _t=(()=>{class d{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(l){this._rawValidators=l||[],this._composedValidatorFn=Xt(this._rawValidators)}_setAsyncValidators(l){this._rawAsyncValidators=l||[],this._composedAsyncValidatorFn=$r(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(l){this._onDestroyCallbacks.push(l)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(l=>l()),this._onDestroyCallbacks=[]}reset(l){this.control&&this.control.reset(l)}hasError(l,m){return!!this.control&&this.control.hasError(l,m)}getError(l,m){return this.control?this.control.getError(l,m):null}}return d.\u0275fac=function(l){return new(l||d)},d.\u0275dir=y.lG2({type:d}),d})(),yt=(()=>{class d extends _t{get formDirective(){return null}get path(){return null}}return d.\u0275fac=function(){let f;return function(m){return(f||(f=y.n5z(d)))(m||d)}}(),d.\u0275dir=y.lG2({type:d,features:[y.qOj]}),d})();class et extends _t{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class ei{constructor(f){this._cd=f}is(f){var l,m,I;return"submitted"===f?!!(null===(l=this._cd)||void 0===l?void 0:l.submitted):!!(null===(I=null===(m=this._cd)||void 0===m?void 0:m.control)||void 0===I?void 0:I[f])}}let ni=(()=>{class d extends ei{constructor(l){super(l)}}return d.\u0275fac=function(l){return new(l||d)(y.Y36(et,2))},d.\u0275dir=y.lG2({type:d,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(l,m){2&l&&y.ekj("ng-untouched",m.is("untouched"))("ng-touched",m.is("touched"))("ng-pristine",m.is("pristine"))("ng-dirty",m.is("dirty"))("ng-valid",m.is("valid"))("ng-invalid",m.is("invalid"))("ng-pending",m.is("pending"))},features:[y.qOj]}),d})(),ri=(()=>{class d extends ei{constructor(l){super(l)}}return d.\u0275fac=function(l){return new(l||d)(y.Y36(yt,10))},d.\u0275dir=y.lG2({type:d,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(l,m){2&l&&y.ekj("ng-untouched",m.is("untouched"))("ng-touched",m.is("touched"))("ng-pristine",m.is("pristine"))("ng-dirty",m.is("dirty"))("ng-valid",m.is("valid"))("ng-invalid",m.is("invalid"))("ng-pending",m.is("pending"))("ng-submitted",m.is("submitted"))},features:[y.qOj]}),d})();function be(d,f){Yn(d,f),f.valueAccessor.writeValue(d.value),function(d,f){f.valueAccessor.registerOnChange(l=>{d._pendingValue=l,d._pendingChange=!0,d._pendingDirty=!0,"change"===d.updateOn&&Pe(d,f)})}(d,f),function(d,f){const l=(m,I)=>{f.valueAccessor.writeValue(m),I&&f.viewToModelUpdate(m)};d.registerOnChange(l),f._registerOnDestroy(()=>{d._unregisterOnChange(l)})}(d,f),function(d,f){f.valueAccessor.registerOnTouched(()=>{d._pendingTouched=!0,"blur"===d.updateOn&&d._pendingChange&&Pe(d,f),"submit"!==d.updateOn&&d.markAsTouched()})}(d,f),function(d,f){if(f.valueAccessor.setDisabledState){const l=m=>{f.valueAccessor.setDisabledState(m)};d.registerOnDisabledChange(l),f._registerOnDestroy(()=>{d._unregisterOnDisabledChange(l)})}}(d,f)}function Qn(d,f,l=!0){const m=()=>{};f.valueAccessor&&(f.valueAccessor.registerOnChange(m),f.valueAccessor.registerOnTouched(m)),$n(d,f),d&&(f._invokeOnDestroyCallbacks(),d._registerOnCollectionChange(()=>{}))}function Wn(d,f){d.forEach(l=>{l.registerOnValidatorChange&&l.registerOnValidatorChange(f)})}function Yn(d,f){const l=Xr(d);null!==f.validator?d.setValidators(Zr(l,f.validator)):"function"==typeof l&&d.setValidators([l]);const m=yo(d);null!==f.asyncValidator?d.setAsyncValidators(Zr(m,f.asyncValidator)):"function"==typeof m&&d.setAsyncValidators([m]);const I=()=>d.updateValueAndValidity();Wn(f._rawValidators,I),Wn(f._rawAsyncValidators,I)}function $n(d,f){let l=!1;if(null!==d){if(null!==f.validator){const I=Xr(d);if(Array.isArray(I)&&I.length>0){const x=I.filter(rt=>rt!==f.validator);x.length!==I.length&&(l=!0,d.setValidators(x))}}if(null!==f.asyncValidator){const I=yo(d);if(Array.isArray(I)&&I.length>0){const x=I.filter(rt=>rt!==f.asyncValidator);x.length!==I.length&&(l=!0,d.setAsyncValidators(x))}}}const m=()=>{};return Wn(f._rawValidators,m),Wn(f._rawAsyncValidators,m),l}function Pe(d,f){d._pendingDirty&&d.markAsDirty(),d.setValue(d._pendingValue,{emitModelToViewChange:!1}),f.viewToModelUpdate(d._pendingValue),d._pendingChange=!1}function Ge(d,f){const l=d.indexOf(f);l>-1&&d.splice(l,1)}const qe="VALID",tr="INVALID",we="PENDING",Be="DISABLED";function er(d){return(dn(d)?d.validators:d)||null}function bo(d){return Array.isArray(d)?Xt(d):d||null}function fn(d,f){return(dn(f)?f.asyncValidators:d)||null}function nr(d){return Array.isArray(d)?$r(d):d||null}function dn(d){return null!=d&&!Array.isArray(d)&&"object"==typeof d}class st{constructor(f,l){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=f,this._rawAsyncValidators=l,this._composedValidatorFn=bo(this._rawValidators),this._composedAsyncValidatorFn=nr(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(f){this._rawValidators=this._composedValidatorFn=f}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(f){this._rawAsyncValidators=this._composedAsyncValidatorFn=f}get parent(){return this._parent}get valid(){return this.status===qe}get invalid(){return this.status===tr}get pending(){return this.status==we}get disabled(){return this.status===Be}get enabled(){return this.status!==Be}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(f){this._rawValidators=f,this._composedValidatorFn=bo(f)}setAsyncValidators(f){this._rawAsyncValidators=f,this._composedAsyncValidatorFn=nr(f)}addValidators(f){this.setValidators(ln(f,this._rawValidators))}addAsyncValidators(f){this.setAsyncValidators(ln(f,this._rawAsyncValidators))}removeValidators(f){this.setValidators(ti(f,this._rawValidators))}removeAsyncValidators(f){this.setAsyncValidators(ti(f,this._rawAsyncValidators))}hasValidator(f){return xe(this._rawValidators,f)}hasAsyncValidator(f){return xe(this._rawAsyncValidators,f)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(f={}){this.touched=!0,this._parent&&!f.onlySelf&&this._parent.markAsTouched(f)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(f=>f.markAllAsTouched())}markAsUntouched(f={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(l=>{l.markAsUntouched({onlySelf:!0})}),this._parent&&!f.onlySelf&&this._parent._updateTouched(f)}markAsDirty(f={}){this.pristine=!1,this._parent&&!f.onlySelf&&this._parent.markAsDirty(f)}markAsPristine(f={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(l=>{l.markAsPristine({onlySelf:!0})}),this._parent&&!f.onlySelf&&this._parent._updatePristine(f)}markAsPending(f={}){this.status=we,!1!==f.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!f.onlySelf&&this._parent.markAsPending(f)}disable(f={}){const l=this._parentMarkedDirty(f.onlySelf);this.status=Be,this.errors=null,this._forEachChild(m=>{m.disable(Object.assign(Object.assign({},f),{onlySelf:!0}))}),this._updateValue(),!1!==f.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},f),{skipPristineCheck:l})),this._onDisabledChange.forEach(m=>m(!0))}enable(f={}){const l=this._parentMarkedDirty(f.onlySelf);this.status=qe,this._forEachChild(m=>{m.enable(Object.assign(Object.assign({},f),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:f.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},f),{skipPristineCheck:l})),this._onDisabledChange.forEach(m=>m(!1))}_updateAncestors(f){this._parent&&!f.onlySelf&&(this._parent.updateValueAndValidity(f),f.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(f){this._parent=f}updateValueAndValidity(f={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===qe||this.status===we)&&this._runAsyncValidator(f.emitEvent)),!1!==f.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!f.onlySelf&&this._parent.updateValueAndValidity(f)}_updateTreeValidity(f={emitEvent:!0}){this._forEachChild(l=>l._updateTreeValidity(f)),this.updateValueAndValidity({onlySelf:!0,emitEvent:f.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Be:qe}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(f){if(this.asyncValidator){this.status=we,this._hasOwnPendingAsyncValidator=!0;const l=fo(this.asyncValidator(this));this._asyncValidationSubscription=l.subscribe(m=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(m,{emitEvent:f})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(f,l={}){this.errors=f,this._updateControlsErrors(!1!==l.emitEvent)}get(f){return function(d,f,l){if(null==f||(Array.isArray(f)||(f=f.split(".")),Array.isArray(f)&&0===f.length))return null;let m=d;return f.forEach(I=>{m=m instanceof Ee?m.controls.hasOwnProperty(I)?m.controls[I]:null:m instanceof li&&m.at(I)||null}),m}(this,f)}getError(f,l){const m=l?this.get(l):this;return m&&m.errors?m.errors[f]:null}hasError(f,l){return!!this.getError(f,l)}get root(){let f=this;for(;f._parent;)f=f._parent;return f}_updateControlsErrors(f){this.status=this._calculateStatus(),f&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(f)}_initObservables(){this.valueChanges=new y.vpe,this.statusChanges=new y.vpe}_calculateStatus(){return this._allControlsDisabled()?Be:this.errors?tr:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(we)?we:this._anyControlsHaveStatus(tr)?tr:qe}_anyControlsHaveStatus(f){return this._anyControls(l=>l.status===f)}_anyControlsDirty(){return this._anyControls(f=>f.dirty)}_anyControlsTouched(){return this._anyControls(f=>f.touched)}_updatePristine(f={}){this.pristine=!this._anyControlsDirty(),this._parent&&!f.onlySelf&&this._parent._updatePristine(f)}_updateTouched(f={}){this.touched=this._anyControlsTouched(),this._parent&&!f.onlySelf&&this._parent._updateTouched(f)}_isBoxedValue(f){return"object"==typeof f&&null!==f&&2===Object.keys(f).length&&"value"in f&&"disabled"in f}_registerOnCollectionChange(f){this._onCollectionChange=f}_setUpdateStrategy(f){dn(f)&&null!=f.updateOn&&(this._updateOn=f.updateOn)}_parentMarkedDirty(f){return!f&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class nt extends st{constructor(f=null,l,m){super(er(l),fn(m,l)),this._onChange=[],this._applyFormState(f),this._setUpdateStrategy(l),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(f,l={}){this.value=this._pendingValue=f,this._onChange.length&&!1!==l.emitModelToViewChange&&this._onChange.forEach(m=>m(this.value,!1!==l.emitViewToModelChange)),this.updateValueAndValidity(l)}patchValue(f,l={}){this.setValue(f,l)}reset(f=null,l={}){this._applyFormState(f),this.markAsPristine(l),this.markAsUntouched(l),this.setValue(this.value,l),this._pendingChange=!1}_updateValue(){}_anyControls(f){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(f){this._onChange.push(f)}_unregisterOnChange(f){Ge(this._onChange,f)}registerOnDisabledChange(f){this._onDisabledChange.push(f)}_unregisterOnDisabledChange(f){Ge(this._onDisabledChange,f)}_forEachChild(f){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(f){this._isBoxedValue(f)?(this.value=this._pendingValue=f.value,f.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=f}}class Ee extends st{constructor(f,l,m){super(er(l),fn(m,l)),this.controls=f,this._initObservables(),this._setUpdateStrategy(l),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(f,l){return this.controls[f]?this.controls[f]:(this.controls[f]=l,l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange),l)}addControl(f,l,m={}){this.registerControl(f,l),this.updateValueAndValidity({emitEvent:m.emitEvent}),this._onCollectionChange()}removeControl(f,l={}){this.controls[f]&&this.controls[f]._registerOnCollectionChange(()=>{}),delete this.controls[f],this.updateValueAndValidity({emitEvent:l.emitEvent}),this._onCollectionChange()}setControl(f,l,m={}){this.controls[f]&&this.controls[f]._registerOnCollectionChange(()=>{}),delete this.controls[f],l&&this.registerControl(f,l),this.updateValueAndValidity({emitEvent:m.emitEvent}),this._onCollectionChange()}contains(f){return this.controls.hasOwnProperty(f)&&this.controls[f].enabled}setValue(f,l={}){this._checkAllValuesPresent(f),Object.keys(f).forEach(m=>{this._throwIfControlMissing(m),this.controls[m].setValue(f[m],{onlySelf:!0,emitEvent:l.emitEvent})}),this.updateValueAndValidity(l)}patchValue(f,l={}){null!=f&&(Object.keys(f).forEach(m=>{this.controls[m]&&this.controls[m].patchValue(f[m],{onlySelf:!0,emitEvent:l.emitEvent})}),this.updateValueAndValidity(l))}reset(f={},l={}){this._forEachChild((m,I)=>{m.reset(f[I],{onlySelf:!0,emitEvent:l.emitEvent})}),this._updatePristine(l),this._updateTouched(l),this.updateValueAndValidity(l)}getRawValue(){return this._reduceChildren({},(f,l,m)=>(f[m]=l instanceof nt?l.value:l.getRawValue(),f))}_syncPendingControls(){let f=this._reduceChildren(!1,(l,m)=>!!m._syncPendingControls()||l);return f&&this.updateValueAndValidity({onlySelf:!0}),f}_throwIfControlMissing(f){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[f])throw new Error(`Cannot find form control with name: ${f}.`)}_forEachChild(f){Object.keys(this.controls).forEach(l=>{const m=this.controls[l];m&&f(m,l)})}_setUpControls(){this._forEachChild(f=>{f.setParent(this),f._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(f){for(const l of Object.keys(this.controls)){const m=this.controls[l];if(this.contains(l)&&f(m))return!0}return!1}_reduceValue(){return this._reduceChildren({},(f,l,m)=>((l.enabled||this.disabled)&&(f[m]=l.value),f))}_reduceChildren(f,l){let m=f;return this._forEachChild((I,x)=>{m=l(m,I,x)}),m}_allControlsDisabled(){for(const f of Object.keys(this.controls))if(this.controls[f].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(f){this._forEachChild((l,m)=>{if(void 0===f[m])throw new Error(`Must supply a value for form control with name: '${m}'.`)})}}class li extends st{constructor(f,l,m){super(er(l),fn(m,l)),this.controls=f,this._initObservables(),this._setUpdateStrategy(l),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(f){return this.controls[f]}push(f,l={}){this.controls.push(f),this._registerControl(f),this.updateValueAndValidity({emitEvent:l.emitEvent}),this._onCollectionChange()}insert(f,l,m={}){this.controls.splice(f,0,l),this._registerControl(l),this.updateValueAndValidity({emitEvent:m.emitEvent})}removeAt(f,l={}){this.controls[f]&&this.controls[f]._registerOnCollectionChange(()=>{}),this.controls.splice(f,1),this.updateValueAndValidity({emitEvent:l.emitEvent})}setControl(f,l,m={}){this.controls[f]&&this.controls[f]._registerOnCollectionChange(()=>{}),this.controls.splice(f,1),l&&(this.controls.splice(f,0,l),this._registerControl(l)),this.updateValueAndValidity({emitEvent:m.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(f,l={}){this._checkAllValuesPresent(f),f.forEach((m,I)=>{this._throwIfControlMissing(I),this.at(I).setValue(m,{onlySelf:!0,emitEvent:l.emitEvent})}),this.updateValueAndValidity(l)}patchValue(f,l={}){null!=f&&(f.forEach((m,I)=>{this.at(I)&&this.at(I).patchValue(m,{onlySelf:!0,emitEvent:l.emitEvent})}),this.updateValueAndValidity(l))}reset(f=[],l={}){this._forEachChild((m,I)=>{m.reset(f[I],{onlySelf:!0,emitEvent:l.emitEvent})}),this._updatePristine(l),this._updateTouched(l),this.updateValueAndValidity(l)}getRawValue(){return this.controls.map(f=>f instanceof nt?f.value:f.getRawValue())}clear(f={}){this.controls.length<1||(this._forEachChild(l=>l._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:f.emitEvent}))}_syncPendingControls(){let f=this.controls.reduce((l,m)=>!!m._syncPendingControls()||l,!1);return f&&this.updateValueAndValidity({onlySelf:!0}),f}_throwIfControlMissing(f){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(f))throw new Error(`Cannot find form control at index ${f}`)}_forEachChild(f){this.controls.forEach((l,m)=>{f(l,m)})}_updateValue(){this.value=this.controls.filter(f=>f.enabled||this.disabled).map(f=>f.value)}_anyControls(f){return this.controls.some(l=>l.enabled&&f(l))}_setUpControls(){this._forEachChild(f=>this._registerControl(f))}_checkAllValuesPresent(f){this._forEachChild((l,m)=>{if(void 0===f[m])throw new Error(`Must supply a value for form control at index: ${m}.`)})}_allControlsDisabled(){for(const f of this.controls)if(f.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(f){f.setParent(this),f._registerOnCollectionChange(this._onCollectionChange)}}let Do=(()=>{class d{}return d.\u0275fac=function(l){return new(l||d)},d.\u0275dir=y.lG2({type:d,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),d})(),gn=(()=>{class d{}return d.\u0275fac=function(l){return new(l||d)},d.\u0275mod=y.oAB({type:d}),d.\u0275inj=y.cJS({}),d})();const pi=new y.OlP("NgModelWithFormControlWarning"),or={provide:yt,useExisting:(0,y.Gpc)(()=>mn)};let mn=(()=>{class d extends yt{constructor(l,m){super(),this.validators=l,this.asyncValidators=m,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new y.vpe,this._setValidators(l),this._setAsyncValidators(m)}ngOnChanges(l){this._checkFormPresent(),l.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&($n(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(l){const m=this.form.get(l.path);return be(m,l),m.updateValueAndValidity({emitEvent:!1}),this.directives.push(l),m}getControl(l){return this.form.get(l.path)}removeControl(l){Qn(l.control||null,l,!1),Ge(this.directives,l)}addFormGroup(l){this._setUpFormContainer(l)}removeFormGroup(l){this._cleanUpFormContainer(l)}getFormGroup(l){return this.form.get(l.path)}addFormArray(l){this._setUpFormContainer(l)}removeFormArray(l){this._cleanUpFormContainer(l)}getFormArray(l){return this.form.get(l.path)}updateModel(l,m){this.form.get(l.path).setValue(m)}onSubmit(l){return this.submitted=!0,function(d,f){d._syncPendingControls(),f.forEach(l=>{const m=l.control;"submit"===m.updateOn&&m._pendingChange&&(l.viewToModelUpdate(m._pendingValue),m._pendingChange=!1)})}(this.form,this.directives),this.ngSubmit.emit(l),!1}onReset(){this.resetForm()}resetForm(l){this.form.reset(l),this.submitted=!1}_updateDomValue(){this.directives.forEach(l=>{const m=l.control,I=this.form.get(l.path);m!==I&&(Qn(m||null,l),I instanceof nt&&(be(I,l),l.control=I))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(l){const m=this.form.get(l.path);(function(d,f){Yn(d,f)})(m,l),m.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(l){if(this.form){const m=this.form.get(l.path);m&&function(d,f){return $n(d,f)}(m,l)&&m.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Yn(this.form,this),this._oldForm&&$n(this._oldForm,this)}_checkFormPresent(){}}return d.\u0275fac=function(l){return new(l||d)(y.Y36(U,10),y.Y36(Mt,10))},d.\u0275dir=y.lG2({type:d,selectors:[["","formGroup",""]],hostBindings:function(l,m){1&l&&y.NdJ("submit",function(x){return m.onSubmit(x)})("reset",function(){return m.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[y._Bn([or]),y.qOj,y.TTD]}),d})();const ar={provide:et,useExisting:(0,y.Gpc)(()=>cr)};let cr=(()=>{class d extends et{constructor(l,m,I,x,rt){super(),this._ngModelWarningConfig=rt,this._added=!1,this.update=new y.vpe,this._ngModelWarningSent=!1,this._parent=l,this._setValidators(m),this._setAsyncValidators(I),this.valueAccessor=function(d,f){if(!f)return null;let l,m,I;return Array.isArray(f),f.forEach(x=>{x.constructor===Bn?l=x:function(d){return Object.getPrototypeOf(d.constructor)===Z}(x)?m=x:I=x}),I||m||l||null}(0,x)}set isDisabled(l){}ngOnChanges(l){this._added||this._setUpControl(),function(d,f){if(!d.hasOwnProperty("model"))return!1;const l=d.model;return!!l.isFirstChange()||!Object.is(f,l.currentValue)}(l,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(l){this.viewModel=l,this.update.emit(l)}get path(){return function(d,f){return[...f.path,d]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return d.\u0275fac=function(l){return new(l||d)(y.Y36(yt,13),y.Y36(U,10),y.Y36(Mt,10),y.Y36(B,10),y.Y36(pi,8))},d.\u0275dir=y.lG2({type:d,selectors:[["","formControlName",""]],inputs:{isDisabled:["disabled","isDisabled"],name:["formControlName","name"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[y._Bn([ar]),y.qOj,y.TTD]}),d._ngModelWarningSentOnce=!1,d})(),te=(()=>{class d{}return d.\u0275fac=function(l){return new(l||d)},d.\u0275mod=y.oAB({type:d}),d.\u0275inj=y.cJS({imports:[[gn]]}),d})(),mr=(()=>{class d{static withConfig(l){return{ngModule:d,providers:[{provide:pi,useValue:l.warnOnNgModelWithFormControl}]}}}return d.\u0275fac=function(l){return new(l||d)},d.\u0275mod=y.oAB({type:d}),d.\u0275inj=y.cJS({imports:[te]}),d})()},5298:(lo,_e,L)=>{L.d(_e,{d:()=>Pt});var y=L(7716),pt=L(665),Yt=L(9932),Rt=L(8583);function ie(ot,Z){if(1&ot){const B=y.EpF();y.TgZ(0,"button",11),y.NdJ("click",function(){return y.CHM(B),y.oxw().onClickcloseChat()}),y._uU(1,"X"),y.qZA()}}const gt=function(ot){return{agent:ot}};function $t(ot,Z){if(1&ot&&(y.TgZ(0,"div",12),y.TgZ(1,"div",13),y._uU(2),y.TgZ(3,"span",14),y._uU(4),y.qZA(),y.qZA(),y.qZA()),2&ot){const B=Z.$implicit;y.Q6J("ngClass",y.VKq(3,gt,"agent"===B.sender)),y.xp6(2),y.hij("",null==B?null:B.message," "),y.xp6(2),y.Oqu(null==B?null:B.dateText)}}const Tt=function(ot){return{"sender-agent":ot}};let Pt=(()=>{class ot{constructor(){this.inputForm=new pt.cw({message:new pt.NI}),this.messageSent=new y.vpe,this.closeChat=new y.vpe}ngOnInit(){}ngOnChanges(B){(null==B?void 0:B.newMessages)&&B.newMessages.currentValue>0&&setTimeout(()=>{this.scrollToBottom()},100)}sendMessage(){this.messageSent.emit(this.inputForm.value.message),this.inputForm.reset()}onClickcloseChat(){this.closeChat.emit()}scrollToBottom(){var B;null===(B=this.perfectScrollbarComponent)||void 0===B||B.directiveRef.scrollToBottom()}}return ot.\u0275fac=function(B){return new(B||ot)},ot.\u0275cmp=y.Xpm({type:ot,selectors:[["app-messages"]],viewQuery:function(B,It){if(1&B&&(y.Gf(Yt.Vv,5),y.Gf(Yt.$V,5)),2&B){let Zt;y.iGM(Zt=y.CRH())&&(It.perfectScrollbarComponent=Zt.first),y.iGM(Zt=y.CRH())&&(It.perfectScrollbarDirective=Zt.first)}},inputs:{isAgent:"isAgent",messages:"messages",newMessages:"newMessages"},outputs:{messageSent:"messageSent",closeChat:"closeChat"},features:[y.TTD],decls:13,vars:6,consts:[[1,"wrapper",3,"ngClass"],[1,"action-buttons"],["class","btn",3,"click",4,"ngIf"],[1,"messages-box"],["fxFlex","auto",2,"max-height","380px"],["class","message",3,"ngClass",4,"ngFor","ngForOf"],[1,"input-box"],[3,"formGroup","submit"],[1,"col"],["type","text","placeholder","message","formControlName","message"],[1,"btn"],[1,"btn",3,"click"],[1,"message",3,"ngClass"],[1,"inner"],[1,"dateText"]],template:function(B,It){1&B&&(y.TgZ(0,"div",0),y.TgZ(1,"div",1),y.YNc(2,ie,2,0,"button",2),y.qZA(),y.TgZ(3,"div",3),y.TgZ(4,"perfect-scrollbar",4),y.YNc(5,$t,5,5,"div",5),y.qZA(),y.qZA(),y.TgZ(6,"div",6),y.TgZ(7,"form",7),y.NdJ("submit",function(){return It.sendMessage()}),y.TgZ(8,"div",8),y._UZ(9,"input",9),y.qZA(),y.TgZ(10,"div",8),y.TgZ(11,"button",10),y._uU(12,"Send"),y.qZA(),y.qZA(),y.qZA(),y.qZA(),y.qZA()),2&B&&(y.Q6J("ngClass",y.VKq(4,Tt,It.isAgent)),y.xp6(2),y.Q6J("ngIf",It.isAgent),y.xp6(3),y.Q6J("ngForOf",It.messages),y.xp6(2),y.Q6J("formGroup",It.inputForm))},directives:[Rt.mk,Rt.O5,Yt.Vv,Rt.sg,pt._Y,pt.JL,pt.sg,pt.Fj,pt.JJ,pt.u],styles:[".wrapper[_ngcontent-%COMP%]{background-color:#eee;padding:10px;border:1px solid blue;border-radius:10px}.messages-box[_ngcontent-%COMP%]{background-color:#fff;padding:10px 0 10px 10px;margin-bottom:10px;height:400px;display:flex;align-items:flex-end;border:1px solid #ccc}.message[_ngcontent-%COMP%]{margin-bottom:5px;text-align:right;padding-right:10px}.message[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{display:inline-block;background-color:#57c28e;padding:5px 10px;max-width:500px;border-radius:5px;color:#fff}.message[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]   .dateText[_ngcontent-%COMP%]{font-size:9px}.message.agent[_ngcontent-%COMP%]{text-align:left}.message.agent[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{background-color:#748ccc}.input-box[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex}.input-box[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]{display:flex}.input-box[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]:nth-child(1){flex-grow:1;padding-right:10px}.input-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;outline:none;padding:5px 10px;border:1px solid #ccc}.sender-agent[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{text-align:left}.sender-agent[_ngcontent-%COMP%]   .message.agent[_ngcontent-%COMP%]{text-align:right}"]}),ot})()},629:(lo,_e,L)=>{L.d(_e,{e:()=>ie});var y=L(9765),pt=L(7716),Yt=L(1562),Rt=L(5209);let ie=(()=>{class gt{constructor(Tt,Pt){this.afAuth=Tt,this.router=Pt,this.isFbUserSingedIn=new y.xQ,this.fbUserLsStr="fbUser"}get _isAgentSignedIn(){return Boolean(localStorage.getItem(this.fbUserLsStr))}signInCheckRemote(Tt){this.afAuth.authState.subscribe(Pt=>{Pt?(this.user={uid:Pt.uid},localStorage.setItem(this.fbUserLsStr,"1"),setTimeout(()=>{this.isFbUserSingedIn.next(!0)},0)):Tt?this.signIn(Tt.email,Tt.password):this.signOut()})}signIn(Tt,Pt){return new Promise((Z,B)=>{this.afAuth.signInWithEmailAndPassword(Tt,Pt).then(It=>{localStorage.setItem(this.fbUserLsStr,"1"),this.isFbUserSingedIn.next(!0),Z("")}).catch(It=>{console.log(It),B(It.message),localStorage.setItem(this.fbUserLsStr,"")})})}signOut(){this.afAuth.signOut().then(()=>{localStorage.setItem(this.fbUserLsStr,""),this.isFbUserSingedIn.next(!1),this.router.navigate(["/agent/login"])})}}return gt.\u0275fac=function(Tt){return new(Tt||gt)(pt.LFG(Yt.zQ),pt.LFG(Rt.F0))},gt.\u0275prov=pt.Yz7({token:gt,factory:gt.\u0275fac,providedIn:"root"}),gt})()},4466:(lo,_e,L)=>{L.d(_e,{m:()=>ie});var y=L(9932),pt=L(665),Yt=L(7716);const Rt={suppressScrollX:!0,wheelSpeed:1,swipeEasing:!1};let ie=(()=>{class gt{}return gt.\u0275fac=function(Tt){return new(Tt||gt)},gt.\u0275mod=Yt.oAB({type:gt}),gt.\u0275inj=Yt.cJS({providers:[{provide:y.op,useValue:Rt}],imports:[[pt.UX,y.Xd]]}),gt})()}}]);