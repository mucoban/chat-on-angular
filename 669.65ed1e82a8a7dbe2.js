"use strict";(self.webpackChunkchat_on_angular=self.webpackChunkchat_on_angular||[]).push([[669],{1669:(W,b,r)=>{r.r(b),r.d(b,{AgentModule:()=>H});var u=r(4755),m=r(8929),C=r(7625),t=r(2223),h=r(8395),d=r(629);function M(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div"),t._uU(3,"Chat on Angular"),t.qZA(),t.TgZ(4,"div"),t._uU(5,"Agent Panel"),t.qZA()(),t.TgZ(6,"a",3),t._uU(7,"Chats"),t.qZA(),t.TgZ(8,"div",4)(9,"button",5),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onLogout())}),t._uU(10,"\u21eb Log out"),t.qZA()()()}}let O=(()=>{class n{constructor(e,s,a){this.router=e,this.authService=s,this.renderer2=a,this.destroy$=new m.xQ}ngOnInit(){this.renderer2.setStyle(document.body,"width","auto"),this.renderer2.setStyle(document.body,"height","100vh"),this.renderer2.setStyle(document.body,"position","static"),this.isAgentLoggedIn=this.authService._isAgentSignedIn,this.authService.isFbUserSingedIn.pipe((0,C.R)(this.destroy$)).subscribe({next:e=>{this.isAgentLoggedIn=e}})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}onLogout(){this.authService.signOut()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(h.F0),t.Y36(d.e),t.Y36(t.Qsj))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-agent"]],decls:2,vars:1,consts:[["class","header",4,"ngIf"],[1,"header"],[1,"logo"],["routerLink","/agent/chats",1,"btn"],[1,"logout-holder"],[1,"btn","logout",3,"click"]],template:function(e,s){1&e&&(t.YNc(0,M,11,0,"div",0),t._UZ(1,"router-outlet")),2&e&&t.Q6J("ngIf",s.isAgentLoggedIn)},dependencies:[u.O5,h.lC,h.rH],styles:[".logout[_ngcontent-%COMP%]{align-self:flex-end;cursor:pointer}.logout-holder[_ngcontent-%COMP%]{flex-grow:1;text-align:right}.header[_ngcontent-%COMP%]{padding:10px;box-shadow:0 5px 5px -3px #0003;display:flex;align-items:center;z-index:2;position:relative}.clear[_ngcontent-%COMP%]{clear:both}.logo[_ngcontent-%COMP%]{margin-right:15px;display:inline-block;text-align:center}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{font-size:14px;font-weight:600}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(1){font-size:14px}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(2){font-size:14px}"]}),n})();var c=r(1199);let A=(()=>{class n{constructor(e,s){this.router=e,this.authService=s}canActivate(e,s){return!!(this.authService._isAgentSignedIn||e.children&&e.children[0].data?.noGuard)||this.router.createUrlTree(["agent/login"])}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(h.F0),t.LFG(d.e))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})();function Z(n,o){if(1&n&&(t.TgZ(0,"div",8),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.error," ")}}let w=(()=>{class n{constructor(e,s){this.authService=e,this.router=s,this.form=new c.nJ({username:new c.p4(null,[c.kI.required]),password:new c.p4(null,[c.kI.required])})}ngOnInit(){this.authService._isAgentSignedIn&&this.router.navigate(["/agent"])}onSubmit(){this.form.invalid?this.error="The form is invalid":(this.error="",this.authService.signIn(this.form.value.username,this.form.value.password).then(()=>{this.router.navigate(["/agent"])}).catch(e=>{this.error=e}).finally(()=>{this.form.reset()}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(d.e),t.Y36(h.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-login"]],decls:21,vars:3,consts:[[1,"main-wrapper"],["class","error",4,"ngIf"],[1,"form-wrapper"],[3,"formGroup","ngSubmit"],[1,"group"],["type","text","formControlName","username"],["type","password","formControlName","password","autocomplete",""],[1,"btn","positive2",3,"disabled"],[1,"error"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"h1"),t._uU(2,"Chat On Angular"),t.qZA(),t.TgZ(3,"h3"),t._uU(4,"Agent Panel"),t.qZA(),t.YNc(5,Z,2,1,"div",1),t.TgZ(6,"div",2)(7,"form",3),t.NdJ("ngSubmit",function(){return s.onSubmit()}),t.TgZ(8,"div",4)(9,"label"),t._uU(10,"E-mail:"),t.qZA(),t._UZ(11,"br")(12,"input",5),t.qZA(),t.TgZ(13,"div",4)(14,"label"),t._uU(15,"Password:"),t.qZA(),t._UZ(16,"br")(17,"input",6),t.qZA(),t.TgZ(18,"div",4)(19,"button",7),t._uU(20,"Login"),t.qZA()()()()()),2&e&&(t.xp6(5),t.Q6J("ngIf",s.error),t.xp6(2),t.Q6J("formGroup",s.form),t.xp6(12),t.Q6J("disabled",s.form.dirty&&s.form.invalid))},dependencies:[u.O5,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u],styles:[".main-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;align-content:center;height:100vh;flex-wrap:wrap;flex-direction:column;background:url(bg.2d47cee4340d99bb.jpg) center;background-size:cover}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{text-align:center;margin:0}h3[_ngcontent-%COMP%]{margin-bottom:45px}.form-wrapper[_ngcontent-%COMP%]{text-align:center;background-color:#fff;box-shadow:0 0 5px #0003;padding:40px 30px 20px;border-radius:5px}form[_ngcontent-%COMP%]{text-align:left;display:inline-block}.group[_ngcontent-%COMP%]{margin-bottom:15px}.group[_ngcontent-%COMP%]:last-child{text-align:right}.error[_ngcontent-%COMP%]{background-color:#b63030;padding:5px;border-radius:5px;color:#fff;margin-bottom:15px;width:300px}input[_ngcontent-%COMP%]{border:1px solid #ccc;width:200px;outline:none!important;padding:6px 10px}label[_ngcontent-%COMP%]{font-weight:400;margin-bottom:5px;display:inline-block}"]}),n})();var S=r(7224),L=r(1737),_=r(7221),P=r(4941),I=r(7525);let v=(()=>{class n{constructor(e,s,a){this.afAuth=e,this.db=s,this.authService=a,this.newMessage=new m.xQ,this.messages=[]}getAgentsChats(e){return this.db.list("chatRooms",a=>a.orderByChild("agentUid").equalTo(e)).snapshotChanges().pipe((0,_.K)(a=>this.handleError(a)))}getNewChats(){return this.db.list("chatRooms",s=>s.orderByChild("isAgent").equalTo(!1)).snapshotChanges().pipe((0,_.K)(s=>this.handleError(s)))}takeChat(e,s){return this.db.list("chatRooms").update(s,{isAgent:!0,agentUid:e})}closeChat(e){return this.db.list("chatRooms").update(e,{status:"closed"})}deleteChat(e){return this.db.list("chatRooms").remove(e)}enterChat(e){this.messages=[],this.db.list("chatRooms/"+e).snapshotChanges().pipe((0,_.K)(a=>this.handleError(a))).subscribe(a=>{const i=a.find(l=>"status"===l.key),p=a.find(l=>"messages"===l.key);"open"===i?.payload.val()&&p&&Object.values(p.payload.val()).sort((l,g)=>l.time-g.time).map(l=>{const g=l;if(!this.messages.find(T=>T.time===g.time)){const X=new Date(g.time).toTimeString().substr(0,5),y={time:g.time,dateText:X,sender:g.sender,message:g.message};this.messages.push(y),this.newMessage.next(y)}return g})})}sendMessage(e,s){const a={time:(new Date).getTime(),sender:"agent",message:s};this.db.list("chatRooms/"+e+"/messages").push(a)}handleError(e){return"PERMISSION_DENIED"===e.code&&this.authService.signOut(),(0,L._)(e.message)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(P.zQ),t.LFG(I.KQ),t.LFG(d.e))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})();function k(n,o){1&n&&(t.TgZ(0,"p"),t._uU(1,"No new chats"),t.qZA())}const U=function(){return{joinButton:!0}},x=function(n,o){return{chat:n,options:o}};function F(n,o){if(1&n&&t.GkF(0,7),2&n){const e=o.$implicit;t.oxw();const s=t.MAs(17);t.Q6J("ngTemplateOutlet",s)("ngTemplateOutletContext",t.WLB(3,x,e,t.DdM(2,U)))}}function J(n,o){1&n&&(t.TgZ(0,"p"),t._uU(1,"No active chats"),t.qZA())}const N=function(){return{joinButtonVerB:!0}};function Y(n,o){if(1&n&&t.GkF(0,7),2&n){const e=o.$implicit;t.oxw();const s=t.MAs(17);t.Q6J("ngTemplateOutlet",s)("ngTemplateOutletContext",t.WLB(3,x,e,t.DdM(2,N)))}}function Q(n,o){1&n&&(t.TgZ(0,"p"),t._uU(1,"No closed chats"),t.qZA())}const q=function(){return{deleteButton:!0,joinButtonVerB:!0}};function j(n,o){if(1&n&&t.GkF(0,7),2&n){const e=o.$implicit;t.oxw();const s=t.MAs(17);t.Q6J("ngTemplateOutlet",s)("ngTemplateOutletContext",t.WLB(3,x,e,t.DdM(2,q)))}}function D(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",12)(1,"button",13),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().chat,i=t.oxw();return t.KtG(i.deleteChat(a.key))}),t._UZ(2,"img",14),t.qZA()()}}function B(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().chat,i=t.oxw();return t.KtG(i.takeChat(a.key))}),t._uU(1,"Join"),t.qZA()}}function G(n,o){if(1&n&&(t.TgZ(0,"a",16),t._uU(1,"Join"),t.qZA()),2&n){const e=t.oxw().chat;t.Q6J("routerLink","/agent/chats/"+e.key)}}function R(n,o){if(1&n&&(t.TgZ(0,"div",8),t.YNc(1,D,3,0,"div",9),t.TgZ(2,"div")(3,"b"),t._uU(4,"Chat Id:"),t.qZA(),t._uU(5),t.qZA(),t.TgZ(6,"div")(7,"b"),t._uU(8,"Started at:"),t.qZA(),t._uU(9),t.qZA(),t.TgZ(10,"div")(11,"b"),t._uU(12,"Last Message:"),t.qZA(),t._uU(13),t.qZA(),t.TgZ(14,"div"),t.YNc(15,B,2,0,"button",10),t.YNc(16,G,2,1,"a",11),t.qZA()()),2&n){const e=o.chat,s=o.options;t.xp6(1),t.Q6J("ngIf",s.deleteButton),t.xp6(4),t.hij(" ",e.key,""),t.xp6(4),t.hij(" ",e.date,""),t.xp6(4),t.hij(" ",e.cardMessage,""),t.xp6(2),t.Q6J("ngIf",s.joinButton),t.xp6(1),t.Q6J("ngIf",s.joinButtonVerB)}}let $=(()=>{class n{constructor(e,s,a){this.authService=e,this.agentService=s,this.router=a,this.newChats=[],this.activeChats=[],this.closedChats=[],this.destroy$=new m.xQ}ngOnInit(){this.authService.signInCheckRemote(),this.authService.isFbUserSingedIn.pipe((0,S.P)()).subscribe(e=>{this.agentService.getNewChats().pipe((0,C.R)(this.destroy$)).subscribe(s=>{const i=this.processChats(s).filter(p=>"open"===p.status);this.newChats=i}),this.agentService.getAgentsChats(this.authService.user.uid).pipe((0,C.R)(this.destroy$)).subscribe(s=>{const a=this.processChats(s),i=a.filter(f=>"open"===f.status),p=a.filter(f=>"open"!==f.status);this.activeChats=i,this.closedChats=p})})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}takeChat(e){this.agentService.takeChat(this.authService.user.uid,e).then(s=>{this.router.navigate(["agent/chats/"+e])})}processChats(e){return e.map(a=>{const i=a.payload.val();return i.key=a.key,i.date=new Date(i.date).toLocaleString(),i.cardMessage="",i.messages&&(i.messagesArray=Object.values(i.messages),i.cardMessage=i.messagesArray.length?i.messagesArray.pop().message:""),i})}deleteChat(e){confirm("chat will be deleted?")&&this.agentService.deleteChat(e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(d.e),t.Y36(v),t.Y36(h.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat-list"]],decls:18,vars:9,consts:[[1,"container"],[1,"chats"],[4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngFor","ngForOf"],[1,"chats","active"],[1,"chats","old"],["chatCard",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"chat"],["class","text-center",4,"ngIf"],["class","btn",3,"click",4,"ngIf"],["class","btn",3,"routerLink",4,"ngIf"],[1,"text-center"],[1,"btn","circle","remove",3,"click"],["src","./assets/images/trash.svg"],[1,"btn",3,"click"],[1,"btn",3,"routerLink"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"h4"),t._uU(2),t.qZA(),t.TgZ(3,"div",1),t.YNc(4,k,2,0,"p",2),t.YNc(5,F,1,6,"ng-container",3),t.qZA(),t.TgZ(6,"h4"),t._uU(7),t.qZA(),t.TgZ(8,"div",4),t.YNc(9,J,2,0,"p",2),t.YNc(10,Y,1,6,"ng-container",3),t.qZA(),t.TgZ(11,"h4"),t._uU(12),t.qZA(),t.TgZ(13,"div",5),t.YNc(14,Q,2,0,"p",2),t.YNc(15,j,1,6,"ng-container",3),t.qZA(),t.YNc(16,R,17,6,"ng-template",null,6,t.W1O),t.qZA()),2&e&&(t.xp6(2),t.hij("New Chats(",s.newChats.length,")"),t.xp6(2),t.Q6J("ngIf",!s.newChats.length),t.xp6(1),t.Q6J("ngForOf",s.newChats),t.xp6(2),t.hij("Active Chats(",s.activeChats.length,")"),t.xp6(2),t.Q6J("ngIf",!s.activeChats.length),t.xp6(1),t.Q6J("ngForOf",s.activeChats),t.xp6(2),t.hij("Closed Chats(",s.closedChats.length,")"),t.xp6(2),t.Q6J("ngIf",!s.closedChats.length),t.xp6(1),t.Q6J("ngForOf",s.closedChats))},dependencies:[u.sg,u.O5,u.tP,h.rH],styles:["h4[_ngcontent-%COMP%]{font-weight:600;color:#333}h4[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;font-weight:400;margin-left:15px}.chats[_ngcontent-%COMP%]{margin-bottom:15px;display:flex;flex-wrap:wrap}.chats.active[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{border-color:#aaa;background-color:#66bb3d}.chats.old[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{border-color:#aaa;background-color:#bbdbef}.chat[_ngcontent-%COMP%]{padding:10px;background-color:#fff;border-radius:5px;border:1px solid green;cursor:pointer;margin-right:10px;text-decoration:none;color:#333;margin-bottom:15px}.container[_ngcontent-%COMP%]{background-color:#eee;padding:15px}"]}),n})();var E=r(5298);let z=(()=>{class n{constructor(e,s,a){this.agentService=e,this.activatedRoute=s,this.router=a,this.messages=[],this.newMessages=0,this.destroy$=new m.xQ}ngOnInit(){this.chatId=this.activatedRoute.snapshot.params.id,this.agentService.enterChat(this.chatId),this.agentService.newMessage.pipe((0,C.R)(this.destroy$)).subscribe(e=>{this.messages.push(e),this.newMessages++})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}sendMessage(e){this.agentService.sendMessage(this.chatId,e)}closeChat(){confirm("are you sure")&&(this.agentService.closeChat(this.chatId),this.router.navigate(["../"],{relativeTo:this.activatedRoute}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(v),t.Y36(h.gz),t.Y36(h.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat-detail"]],decls:1,vars:3,consts:[[3,"isAgent","newMessages","messages","closeChat","messageSent"]],template:function(e,s){1&e&&(t.TgZ(0,"app-messages",0),t.NdJ("closeChat",function(){return s.closeChat()})("messageSent",function(i){return s.sendMessage(i)}),t.qZA()),2&e&&t.Q6J("isAgent",!0)("newMessages",s.newMessages)("messages",s.messages)},dependencies:[E.d]}),n})();var K=r(4466);let H=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[v,A],imports:[u.ez,c.UX,h.Bz.forChild([{path:"",redirectTo:"chats",pathMatch:"full"},{path:"",canActivate:[A],component:O,children:[{path:"login",component:w,data:{noGuard:!0}},{path:"chats",component:$},{path:"chats/:id",component:z}]}]),K.m]}),n})()}}]);