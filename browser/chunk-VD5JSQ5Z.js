import{a as Ct,b as N,c as ft,d as _t,e as vt,f as B,g as xt,h as bt,i as yt,j as Mt,k as A,l as St,m as wt,n as Ot,p as U,r as v,s as Pt,t as kt,u as It,v as At,x as Tt}from"./chunk-PIBHCUCO.js";import{$ as tt,E as b,F as Z,Fa as st,Ga as ct,N as c,Na as lt,Oa as dt,P as H,Pa as mt,Q as d,Qa as _,R as M,Ra as R,S as K,Sa as pt,V as Q,X as h,Y as g,Z as X,_ as Y,aa as u,b as O,ba as a,ca as r,da as p,db as ht,e as J,ea as et,eb as gt,fa as I,ga as f,gb as ut,ha as m,l as j,la as nt,m as W,na as it,o as y,oa as s,q as P,qa as S,r as k,ra as ot,sa as rt,ua as D,xa as F,ya as at,z as L}from"./chunk-HKAPHFVP.js";import"./chunk-BJZWCY5R.js";function Nt(n,l){if(n&1){let t=I();a(0,"a",5),p(1,"img",6),s(2," All Chats "),r(),a(3,"a",7),f("click",function(){P(t);let i=m(2);return k(i.endTheChat())}),p(4,"img",8),s(5," End The Chat "),r()}}function Bt(n,l){if(n&1){let t=I();a(0,"div",0)(1,"div",1)(2,"div"),s(3,"Chat on Angular"),r(),a(4,"div"),s(5,"Agent Panel"),r()(),h(6,Nt,6,0),a(7,"div",2)(8,"button",3),f("click",function(){P(t);let i=m();return k(i.onLogout())}),p(9,"img",4),s(10," Log out"),r()()()}if(n&2){let t=m();c(6),g(t.isChatDetail?6:-1)}}var jt=(()=>{class n{constructor(t,e,i,o){this.router=t,this.authService=e,this.renderer2=i,this.store=o,this.destroy$=new O}ngOnInit(){this.renderer2.setStyle(document.body,"width","auto"),this.renderer2.setStyle(document.body,"height","100vh"),this.renderer2.setStyle(document.body,"position","static"),this.isAgentLoggedIn=this.authService._isAgentSignedIn,this.authService.isFbAgentSingedIn.pipe(b(this.destroy$)).subscribe({next:e=>{this.isAgentLoggedIn=e}});let t=e=>{this.isChatDetail=!!e.match(/\/agent\/chats\/(.*?)/)};t(window.location.href),this.router.events.subscribe(e=>{e instanceof lt&&t(e.url)})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}endTheChat(){this.store.dispatch(U("endTheChat")),this.store.dispatch(U(null))}onLogout(){this.authService.signOut(!0)}static{this.\u0275fac=function(e){return new(e||n)(d(_),d(v),d(H),d(A))}}static{this.\u0275cmp=M({type:n,selectors:[["app-agent"]],standalone:!1,decls:2,vars:1,consts:[[1,"header"],[1,"logo"],[1,"logout-holder"],[1,"btn","image","no-wrap",3,"click"],["src","./assets/images/logout.svg","alt","logout"],["routerLink","/agent/chats",1,"btn","image","m-r-10"],["src","./assets/images/back.svg","alt","back"],[1,"btn","image","warning",3,"click"],["src","./assets/images/close.svg","alt","close"]],template:function(e,i){e&1&&(h(0,Bt,11,1,"div",0),p(1,"router-outlet")),e&2&&g(i.isAgentLoggedIn?0:-1)},dependencies:[mt,R],styles:[".logout[_ngcontent-%COMP%]{align-self:flex-end;cursor:pointer}.logout-holder[_ngcontent-%COMP%]{flex-grow:1;text-align:right}.header[_ngcontent-%COMP%]{padding:10px;box-shadow:#0000000d 0 6px 24px,#00000014 0 0 0 1px;display:flex;align-items:center;z-index:2;position:relative}.clear[_ngcontent-%COMP%]{clear:both}.logo[_ngcontent-%COMP%]{margin-right:15px;display:inline-block;text-align:center}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{font-size:14px;font-weight:600}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(1){font-size:14px}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(2){font-size:14px}"]})}}return n})();var G=(()=>{class n{constructor(t,e){this.router=t,this.authService=e}canActivate(t,e){return this.authService._isAgentSignedIn||t.children&&t.children[0].data?.noGuard?!0:this.router.createUrlTree(["agent/login"])}static{this.\u0275fac=function(e){return new(e||n)(y(_),y(v))}}static{this.\u0275prov=j({token:n,factory:n.\u0275fac})}}return n})();function Ut(n,l){if(n&1&&(a(0,"div",1),s(1),r()),n&2){let t=m();c(),S(" ",t.error," ")}}function Gt(n,l){n&1&&(a(0,"div",4)(1,"div")(2,"b"),s(3,"email:"),r(),s(4," coatestfirebase@gmail.com"),r(),a(5,"div")(6,"b"),s(7,"passwod:"),r(),s(8," 123123"),r()())}var Lt=(()=>{class n{constructor(t,e){this.authService=t,this.router=e,this.environment=ht,this.form=new vt({username:new B(null,[N.required]),password:new B(null,[N.required])})}ngOnInit(){this.authService._isAgentSignedIn&&this.router.navigate(["/agent"])}onSubmit(){if(this.form.invalid){this.error="The form is invalid";return}this.error="",this.authService.signIn(this.form.value.username,this.form.value.password,!0).then(()=>{this.router.navigate(["/agent"])}).catch(t=>{this.error=t}).finally(()=>{this.form.reset()})}static{this.\u0275fac=function(e){return new(e||n)(d(v),d(_))}}static{this.\u0275cmp=M({type:n,selectors:[["app-login"]],standalone:!1,decls:22,vars:4,consts:[[1,"main-wrapper"],[1,"error"],[1,"form-wrapper"],[3,"ngSubmit","formGroup"],[1,"demo-creds"],[1,"group"],["type","text","formControlName","username"],["type","password","formControlName","password","autocomplete",""],[1,"btn","positive2",3,"disabled"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"h1"),s(2,"Chat On Angular"),r(),a(3,"h3"),s(4,"Agent Panel"),r(),h(5,Ut,2,1,"div",1),a(6,"div",2)(7,"form",3),f("ngSubmit",function(){return i.onSubmit()}),h(8,Gt,9,0,"div",4),a(9,"div",5)(10,"label"),s(11,"E-mail:"),r(),p(12,"br")(13,"input",6),r(),a(14,"div",5)(15,"label"),s(16,"Password:"),r(),p(17,"br")(18,"input",7),r(),a(19,"div",5)(20,"button",8),s(21,"Login"),r()()()()()),e&2&&(c(5),g(i.error?5:-1),c(2),u("formGroup",i.form),c(),g(i.environment.demoCreds?8:-1),c(12),u("disabled",i.form.dirty&&i.form.invalid))},dependencies:[xt,Ct,ft,_t,yt,bt],styles:['.main-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;align-content:center;height:100vh;flex-wrap:wrap;flex-direction:column;background:url("./media/bg-FVD45ZBU.jpg") center;background-size:cover}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{text-align:center;margin:0}h3[_ngcontent-%COMP%]{margin-bottom:45px}.form-wrapper[_ngcontent-%COMP%]{text-align:center;background-color:#fff;box-shadow:0 0 5px #0003;padding:40px 30px 20px;border-radius:5px}form[_ngcontent-%COMP%]{text-align:left;display:inline-block}.group[_ngcontent-%COMP%]{margin-bottom:15px}.group[_ngcontent-%COMP%]:last-child{text-align:right}.error[_ngcontent-%COMP%]{background-color:#b63030;padding:5px;border-radius:5px;color:#fff;margin-bottom:15px;width:300px}input[_ngcontent-%COMP%]{border:1px solid #ccc;width:200px;outline:none!important;padding:6px 10px}label[_ngcontent-%COMP%]{font-weight:400;margin-bottom:5px;display:inline-block}.demo-creds[_ngcontent-%COMP%]{background:#8e7b75;padding:10px;margin-bottom:15px;border-radius:5px}']})}}return n})();var E=(()=>{class n{constructor(t,e,i,o){this.afAuth=t,this.db=e,this.authService=i,this.store=o,this.messages=[]}getAgentsChats(t){return this.db.list("chatRooms",i=>i.orderByChild("agentUid").equalTo(t)).snapshotChanges().pipe(L(i=>this.handleError(i)))}getNewChats(){return this.db.list("chatRooms",e=>e.orderByChild("isAgent").equalTo(!1)).snapshotChanges().pipe(L(e=>this.handleError(e)))}takeChat(t,e){return this.db.list("chatRooms").update(e,{isAgent:!0,agentUid:t})}endTheChat(t){return this.db.list("chatRooms").update(t,{status:"closed"})}deleteChat(t){return this.db.list("chatRooms").remove(t)}enterChat(t){return this.messages=[],this.db.list("chatRooms/"+t).snapshotChanges().pipe(L(i=>this.handleError(i)),Z(i=>{let o=i.find(w=>w.key==="status"),C=i.find(w=>w.key==="messages");if(o?.payload.val()!=="open"||!C)return;Object.values(C.payload.val()).sort((w,x)=>w.time-x.time).map(w=>{let x=w;if(!this.messages.find(z=>z.time===x.time)){let Vt=new Date(x.time).toTimeString().substr(0,5),q={time:x.time,dateText:Vt,sender:x.sender,isInfo:x.isInfo,message:x.message};this.messages.push(q),this.store.dispatch(Ot(q))}return x})}))}sendMessage(t,e,i){let o={time:new Date().getTime(),sender:"agent",message:e};i&&(o.isInfo=!0),this.db.list("chatRooms/"+t+"/messages").push(o)}handleError(t){return t.code==="PERMISSION_DENIED"&&this.authService.signOut(),J(t.message)}static{this.\u0275fac=function(e){return new(e||n)(y(gt),y(ut),y(v),y(A))}}static{this.\u0275prov=j({token:n,factory:n.\u0275fac})}}return n})();var zt=()=>({joinButton:!0}),qt=(n,l,t)=>({chats:n,type:"new",headline:"New Chats",preloader:l,preloaderBarColor:"#7fd59f",options:t}),Ft=()=>({joinButtonVerB:!0}),Jt=(n,l,t)=>({chats:n,type:"active",headline:"Active Chats",preloader:l,preloaderBarColor:"#b7abab",options:t}),Wt=(n,l,t)=>({chats:n,type:"old",headline:"Closed Chats",preloader:l,preloaderBarColor:"#dbae04",options:t});function Zt(n,l){if(n&1&&p(0,"app-preloader",4),n&2){let t=m().preloaderBarColor;u("borderColor",t)}}function Ht(n,l){if(n&1&&(a(0,"p"),s(1),r()),n&2){let t=m(2).type;c(),S("No ",t," chats")}}function Kt(n,l){if(n&1){let t=I();a(0,"button",14),f("click",function(){P(t);let i=m().$implicit,o=m(3);return k(o.takeChat(i.key))}),s(1," Join "),p(2,"img",15),r()}}function Qt(n,l){if(n&1&&(a(0,"a",13),s(1," Join "),p(2,"img",15),r()),n&2){let t=m().$implicit;u("routerLink","/agent/chats/"+t.key)}}function Xt(n,l){if(n&1){let t=I();a(0,"div",6)(1,"div",7)(2,"button",8),f("click",function(){let i=P(t).$implicit,o=m(3);return k(o.deleteChat(i.key))}),p(3,"img",9),r()(),a(4,"div")(5,"span",10),s(6,"Chat Id:"),r(),s(7),r(),a(8,"div")(9,"span",10),s(10,"Chat Date:"),r(),s(11),r(),a(12,"div")(13,"span",10),s(14,"Message Count:"),r(),s(15),r(),a(16,"div")(17,"span",10),s(18,"Last Message:"),r(),s(19),r(),a(20,"div",11),h(21,Kt,3,0,"button",12),h(22,Qt,3,1,"a",13),r()()}if(n&2){let t=l.$implicit,e=m(2).options;c(7),S(" ",t.key),c(4),S(" ",t.date),c(4),S(" ",t.messageCount||0),c(4),S(" ",t.cardMessage),c(2),g(e.joinButton?21:-1),c(),g(e.joinButtonVerB?22:-1)}}function Yt(n,l){if(n&1&&(h(0,Ht,2,1,"p"),a(1,"div",5),Y(2,Xt,23,6,"div",6,X),r()),n&2){let t=m().chats;g(t.length?-1:0),c(2),tt(t)}}function te(n,l){if(n&1&&(a(0,"div")(1,"h2",3),s(2),r(),h(3,Zt,1,1,"app-preloader",4),h(4,Yt,4,1),r()),n&2){let t=l.headline,e=l.chats,i=l.preloader,o=l.type;it(rt("chat-list-box ",o)),c(2),ot("",t,"(",e.length,")"),c(),g(i?3:-1),c(),g(i?-1:4)}}var Rt=(()=>{class n{constructor(t,e,i){this.authService=t,this.agentService=e,this.router=i,this.newChats=[],this.activeChats=[],this.closedChats=[],this.preloaders={newChats:!0,activeChats:!0,closedChats:!0},this.destroy$=new O}ngOnInit(){this.agentService.getNewChats().pipe(b(this.destroy$)).subscribe(t=>{let i=this.processChats(t).filter(o=>o.status==="open");this.newChats=i,this.preloaders.newChats=!1}),this.uuid=this.authService._agentDetail,this.agentService.getAgentsChats(this.uuid).pipe(b(this.destroy$)).subscribe(t=>{let e=this.processChats(t),i=e.filter(C=>C.status==="open"),o=e.filter(C=>C.status!=="open");this.activeChats=i,this.closedChats=o,this.preloaders.activeChats=this.preloaders.closedChats=!1})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}takeChat(t){this.agentService.takeChat(this.uuid,t).then(e=>{this.router.navigate(["agent/chats/"+t])})}processChats(t){return t.map(i=>{let o=i.payload.val();return o.key=i.key,o.date=new Date(o.date).toLocaleString(),o.cardMessage="",o.messages&&(o.messagesArray=Object.values(o.messages).filter(C=>!C.isInfo),o.messageCount=o.messagesArray.length,o.cardMessage=o.messagesArray.length?o.messagesArray.pop().message:""),o})}deleteChat(t){confirm("chat will be deleted?")&&this.agentService.deleteChat(t)}static{this.\u0275fac=function(e){return new(e||n)(d(v),d(E),d(_))}}static{this.\u0275cmp=M({type:n,selectors:[["app-chat-list"]],standalone:!1,decls:6,vars:21,consts:[["chatCard",""],[1,"container"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"font-weight-400"],[3,"borderColor"],[1,"chats"],[1,"chat"],[1,"text-center"],[1,"btn","circle","remove",3,"click"],["src","./assets/images/trash.svg"],[1,"label"],[1,"buttons","text-right"],[1,"btn","image","i-right"],[1,"btn","image","i-right",3,"routerLink"],[1,"btn","image","i-right",3,"click"],["src","./assets/images/right.svg","alt","right"]],template:function(e,i){if(e&1&&(a(0,"div",1),et(1,2)(2,2)(3,2),r(),Q(4,te,5,7,"ng-template",null,0,at)),e&2){let o=nt(5);c(),u("ngTemplateOutlet",o)("ngTemplateOutletContext",F(7,qt,i.newChats,i.preloaders.newChats,D(6,zt))),c(),u("ngTemplateOutlet",o)("ngTemplateOutletContext",F(12,Jt,i.activeChats,i.preloaders.activeChats,D(11,Ft))),c(),u("ngTemplateOutlet",o)("ngTemplateOutletContext",F(17,Wt,i.closedChats,i.preloaders.closedChats,D(16,Ft)))}},dependencies:[st,R,Pt],styles:[".chat-list-box[_ngcontent-%COMP%]{margin-bottom:30px;padding:20px 40px;border-radius:24px;box-shadow:#0000001a 0 1px 2px}.chat-list-box.new[_ngcontent-%COMP%]{background:#c2fbd7}.chat-list-box.new[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{background:#7ef1a9;border-color:#7fd09c}.chat-list-box.new[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-color:#7fd09c;background:#23e26a}.chat-list-box.active[_ngcontent-%COMP%]{background:#f8f8f8}.chat-list-box.old[_ngcontent-%COMP%]{background:#fdd231}.chat-list-box.old[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{background:#fdb430;border:1px solid #d59a30}.chat-list-box.old[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{background-color:#e49300;border-color:#d59a30}.chats[_ngcontent-%COMP%]{margin-bottom:15px;display:flex;flex-wrap:wrap}.chats.active[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{border-color:#aaa;background-color:#66bb3d}.chat[_ngcontent-%COMP%]{padding:10px;background-color:#fff;border-radius:5px;border:1px solid #ddd;cursor:pointer;margin-right:10px;text-decoration:none;color:#333;margin-bottom:15px}.chat[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{margin-top:15px}.chat[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#555;font-size:14px}.container[_ngcontent-%COMP%]{padding:100px 15px 15px}"]})}}return n})();var $t=(()=>{class n{constructor(t,e,i,o){this.agentService=t,this.activatedRoute=e,this.router=i,this.store=o,this.messages=[],this.newMessages=0,this.agentMessgesCount=0,this.destroy$=new O}ngOnInit(){this.chatId=this.activatedRoute.snapshot.params.id,this.agentService.enterChat(this.chatId).pipe(b(this.destroy$)).subscribe(t=>{this.agentMessgesCount||setTimeout(()=>{this.sendMessage("Welcome agent, you are now chatting with a customer",!0)},300)}),this.store.select("messages").pipe(b(this.destroy$)).subscribe(t=>{this.messages=t,this.newMessages++,this.agentMessgesCount=t.filter(e=>e.sender==="agent").length}),this.store.select("agent").pipe(b(this.destroy$)).subscribe(t=>{t==="endTheChat"&&this.endTheChat()})}ngOnDestroy(){this.store.dispatch(wt()),this.destroy$.next(!0),this.destroy$.unsubscribe()}sendMessage(t,e){this.agentService.sendMessage(this.chatId,t,e)}endTheChat(){confirm("are you sure?")&&(this.agentService.endTheChat(this.chatId),this.router.navigate(["../"],{relativeTo:this.activatedRoute}))}static{this.\u0275fac=function(e){return new(e||n)(d(E),d(dt),d(_),d(A))}}static{this.\u0275cmp=M({type:n,selectors:[["app-chat-detail"]],standalone:!1,decls:1,vars:3,consts:[[3,"messageSent","isAgent","newMessages","messages"]],template:function(e,i){e&1&&(a(0,"app-messages",0),f("messageSent",function(C){return i.sendMessage(C)}),r()),e&2&&u("isAgent",!0)("newMessages",i.newMessages)("messages",i.messages)},dependencies:[kt],encapsulation:2})}}return n})();var Ne=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=K({type:n})}static{this.\u0275inj=W({providers:[E,G],imports:[ct,Mt,pt.forChild([{path:"",redirectTo:"chats",pathMatch:"full"},{path:"",canActivate:[G],component:jt,children:[{path:"login",component:Lt,data:{noGuard:!0}},{path:"chats",component:Rt},{path:"chats/:id",component:$t}]}]),It,St.forRoot({messages:At,agent:Tt})]})}}return n})();export{Ne as AgentModule};
