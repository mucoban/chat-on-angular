"use strict";(self.webpackChunkchat_on_angular=self.webpackChunkchat_on_angular||[]).push([[592],{9592:(ot,M,r)=>{r.r(M),r.d(M,{AgentModule:()=>et});var p=r(4755),g=r(8395),b=r(8929),u=r(7625),C=r(9826),t=r(2223),m=r(629),_=r(1806);function T(n,s){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"a",7),t._UZ(2,"img",8),t._uU(3," All Chats "),t.qZA(),t.TgZ(4,"a",9),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.endTheChat())}),t._UZ(5,"img",10),t._uU(6," End The Chat "),t.qZA(),t.BQk()}}function w(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div"),t._uU(3,"Chat on Angular"),t.qZA(),t.TgZ(4,"div"),t._uU(5,"Agent Panel"),t.qZA()(),t.YNc(6,T,7,0,"ng-container",3),t.TgZ(7,"div",4)(8,"button",5),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.onLogout())}),t._UZ(9,"img",6),t._uU(10," Log out"),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(6),t.Q6J("ngIf",e.isChatDetail)}}let k=(()=>{class n{constructor(e,o,a,i){this.router=e,this.authService=o,this.renderer2=a,this.store=i,this.destroy$=new b.xQ}ngOnInit(){this.renderer2.setStyle(document.body,"width","auto"),this.renderer2.setStyle(document.body,"height","100vh"),this.renderer2.setStyle(document.body,"position","static"),this.isAgentLoggedIn=this.authService._isAgentSignedIn,this.authService.isFbAgentSingedIn.pipe((0,u.R)(this.destroy$)).subscribe({next:o=>{this.isAgentLoggedIn=o}});const e=o=>{this.isChatDetail=!!o.match(/\/agent\/chats\/(.*?)/)};e(window.location.href),this.router.events.subscribe(o=>{o instanceof g.m2&&e(o.url)})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}endTheChat(){this.store.dispatch((0,C.m3)("endTheChat")),this.store.dispatch((0,C.m3)(null))}onLogout(){this.authService.signOut(!0)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.F0),t.Y36(m.e),t.Y36(t.Qsj),t.Y36(_.yh))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-agent"]],decls:2,vars:1,consts:[["class","header",4,"ngIf"],[1,"header"],[1,"logo"],[4,"ngIf"],[1,"logout-holder"],[1,"btn","image","no-wrap",3,"click"],["src","./assets/images/logout.svg","alt","logout"],["routerLink","/agent/chats",1,"btn","image","m-r-10"],["src","./assets/images/back.svg","alt","back"],[1,"btn","image","warning",3,"click"],["src","./assets/images/close.svg","alt","close"]],template:function(e,o){1&e&&(t.YNc(0,w,11,1,"div",0),t._UZ(1,"router-outlet")),2&e&&t.Q6J("ngIf",o.isAgentLoggedIn)},dependencies:[p.O5,g.lC,g.rH],styles:[".logout[_ngcontent-%COMP%]{align-self:flex-end;cursor:pointer}.logout-holder[_ngcontent-%COMP%]{flex-grow:1;text-align:right}.header[_ngcontent-%COMP%]{padding:10px;box-shadow:#0000000d 0 6px 24px,#00000014 0 0 0 1px;display:flex;align-items:center;z-index:2;position:relative}.clear[_ngcontent-%COMP%]{clear:both}.logo[_ngcontent-%COMP%]{margin-right:15px;display:inline-block;text-align:center}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{font-size:14px;font-weight:600}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(1){font-size:14px}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(2){font-size:14px}"]}),n})();var c=r(1199);let y=(()=>{class n{constructor(e,o){this.router=e,this.authService=o}canActivate(e,o){return!!(this.authService._isAgentSignedIn||e.children&&e.children[0].data?.noGuard)||this.router.createUrlTree(["agent/login"])}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(g.F0),t.LFG(m.e))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})();var I=r(2340);function S(n,s){if(1&n&&(t.TgZ(0,"div",9),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.error," ")}}function U(n,s){1&n&&(t.TgZ(0,"div",10)(1,"div")(2,"b"),t._uU(3,"email:"),t.qZA(),t._uU(4," coatestfirebase@gmail.com"),t.qZA(),t.TgZ(5,"div")(6,"b"),t._uU(7,"passwod:"),t.qZA(),t._uU(8," 123123"),t.qZA()())}let L=(()=>{class n{constructor(e,o){this.authService=e,this.router=o,this.environment=I.N,this.form=new c.nJ({username:new c.p4(null,[c.kI.required]),password:new c.p4(null,[c.kI.required])})}ngOnInit(){this.authService._isAgentSignedIn&&this.router.navigate(["/agent"])}onSubmit(){this.form.invalid?this.error="The form is invalid":(this.error="",this.authService.signIn(this.form.value.username,this.form.value.password,!0).then(()=>{this.router.navigate(["/agent"])}).catch(e=>{this.error=e}).finally(()=>{this.form.reset()}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.e),t.Y36(g.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-login"]],decls:22,vars:4,consts:[[1,"main-wrapper"],["class","error",4,"ngIf"],[1,"form-wrapper"],[3,"formGroup","ngSubmit"],["class","demo-creds",4,"ngIf"],[1,"group"],["type","text","formControlName","username"],["type","password","formControlName","password","autocomplete",""],[1,"btn","positive2",3,"disabled"],[1,"error"],[1,"demo-creds"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"h1"),t._uU(2,"Chat On Angular"),t.qZA(),t.TgZ(3,"h3"),t._uU(4,"Agent Panel"),t.qZA(),t.YNc(5,S,2,1,"div",1),t.TgZ(6,"div",2)(7,"form",3),t.NdJ("ngSubmit",function(){return o.onSubmit()}),t.YNc(8,U,9,0,"div",4),t.TgZ(9,"div",5)(10,"label"),t._uU(11,"E-mail:"),t.qZA(),t._UZ(12,"br")(13,"input",6),t.qZA(),t.TgZ(14,"div",5)(15,"label"),t._uU(16,"Password:"),t.qZA(),t._UZ(17,"br")(18,"input",7),t.qZA(),t.TgZ(19,"div",5)(20,"button",8),t._uU(21,"Login"),t.qZA()()()()()),2&e&&(t.xp6(5),t.Q6J("ngIf",o.error),t.xp6(2),t.Q6J("formGroup",o.form),t.xp6(1),t.Q6J("ngIf",o.environment.demoCreds),t.xp6(12),t.Q6J("disabled",o.form.dirty&&o.form.invalid))},dependencies:[p.O5,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u],styles:[".main-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;align-content:center;height:100vh;flex-wrap:wrap;flex-direction:column;background:url(bg.2d47cee4340d99bb.jpg) center;background-size:cover}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{text-align:center;margin:0}h3[_ngcontent-%COMP%]{margin-bottom:45px}.form-wrapper[_ngcontent-%COMP%]{text-align:center;background-color:#fff;box-shadow:0 0 5px #0003;padding:40px 30px 20px;border-radius:5px}form[_ngcontent-%COMP%]{text-align:left;display:inline-block}.group[_ngcontent-%COMP%]{margin-bottom:15px}.group[_ngcontent-%COMP%]:last-child{text-align:right}.error[_ngcontent-%COMP%]{background-color:#b63030;padding:5px;border-radius:5px;color:#fff;margin-bottom:15px;width:300px}input[_ngcontent-%COMP%]{border:1px solid #ccc;width:200px;outline:none!important;padding:6px 10px}label[_ngcontent-%COMP%]{font-weight:400;margin-bottom:5px;display:inline-block}.demo-creds[_ngcontent-%COMP%]{background:#8e7b75;padding:10px;margin-bottom:15px;border-radius:5px}"]}),n})();var J=r(1737),v=r(7221),F=r(2868),N=r(4941),Y=r(2788);let x=(()=>{class n{constructor(e,o,a,i){this.afAuth=e,this.db=o,this.authService=a,this.store=i,this.messages=[]}getAgentsChats(e){return this.db.list("chatRooms",a=>a.orderByChild("agentUid").equalTo(e)).snapshotChanges().pipe((0,v.K)(a=>this.handleError(a)))}getNewChats(){return this.db.list("chatRooms",o=>o.orderByChild("isAgent").equalTo(!1)).snapshotChanges().pipe((0,v.K)(o=>this.handleError(o)))}takeChat(e,o){return this.db.list("chatRooms").update(o,{isAgent:!0,agentUid:e})}endTheChat(e){return this.db.list("chatRooms").update(e,{status:"closed"})}deleteChat(e){return this.db.list("chatRooms").remove(e)}enterChat(e){return this.messages=[],this.db.list("chatRooms/"+e).snapshotChanges().pipe((0,v.K)(a=>this.handleError(a)),(0,F.b)(a=>{const i=a.find(l=>"status"===l.key),h=a.find(l=>"messages"===l.key);"open"===i?.payload.val()&&h&&Object.values(h.payload.val()).sort((l,d)=>l.time-d.time).map(l=>{const d=l;if(!this.messages.find(P=>P.time===d.time)){const nt=new Date(d.time).toTimeString().substr(0,5),Z={time:d.time,dateText:nt,sender:d.sender,isInfo:d.isInfo,message:d.message};this.messages.push(Z),this.store.dispatch((0,C.rW)(Z))}return d})}))}sendMessage(e,o,a){const i={time:(new Date).getTime(),sender:"agent",message:o};a&&(i.isInfo=!0),this.db.list("chatRooms/"+e+"/messages").push(i)}handleError(e){return"PERMISSION_DENIED"===e.code&&this.authService.signOut(),(0,J._)(e.message)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(N.zQ),t.LFG(Y.KQ),t.LFG(m.e),t.LFG(_.yh))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})(),Q=(()=>{class n{constructor(){this.barColor="black"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-preloader"]],inputs:{barColor:"barColor"},decls:17,vars:1,consts:[[1,"content","new"],[1,"bars"],[1,"bar"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"div",2)(3,"div",2)(4,"div",2)(5,"div",2)(6,"div",2)(7,"div",2)(8,"div",2),t.qZA(),t.TgZ(9,"div",1),t._UZ(10,"div",2)(11,"div",2)(12,"div",2)(13,"div",2)(14,"div",2)(15,"div",2)(16,"div",2),t.qZA()()),2&e&&t.uIk("style","--bar-color:"+o.barColor,t.Ckj)},styles:[".content[_ngcontent-%COMP%]{width:100px;height:100px;text-align:center;display:flex;align-items:center;justify-content:center;flex-direction:column;perspective:2000px}.bars[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;padding:13px 6px;animation:_ngcontent-%COMP%_mirror1 4s ease 0s infinite}.bar[_ngcontent-%COMP%]{width:88px;height:6px;margin:4px 0;background:linear-gradient(90deg,rgba(255,255,255,0) 33%,var(--bar-color) 33% 67%,rgba(255,255,255,0) 67% 100%);animation:_ngcontent-%COMP%_grow 2s ease-in-out 0s infinite alternate;background-size:300%;background-position-x:-203%}.bars[_ngcontent-%COMP%] + .bars[_ngcontent-%COMP%]{transform:rotate(90deg) rotateX(180deg);animation:_ngcontent-%COMP%_mirror2 4s ease 1s infinite}.bars[_ngcontent-%COMP%]:nth-child(2)   .bar[_ngcontent-%COMP%]:nth-child(1){animation-delay:-1.002s}.bars[_ngcontent-%COMP%]:nth-child(2)   .bar[_ngcontent-%COMP%]:nth-child(2){animation-delay:-1.04s}.bars[_ngcontent-%COMP%]:nth-child(2)   .bar[_ngcontent-%COMP%]:nth-child(3){animation-delay:-1.08s}.bars[_ngcontent-%COMP%]:nth-child(2)   .bar[_ngcontent-%COMP%]:nth-child(4){animation-delay:-1.12s}.bars[_ngcontent-%COMP%]:nth-child(2)   .bar[_ngcontent-%COMP%]:nth-child(5){animation-delay:-1.16s}.bars[_ngcontent-%COMP%]:nth-child(2)   .bar[_ngcontent-%COMP%]:nth-child(6){animation-delay:-1.2s}.bars[_ngcontent-%COMP%]:nth-child(2)   .bar[_ngcontent-%COMP%]:nth-child(7){animation-delay:-1.24s}@keyframes _ngcontent-%COMP%_mirror1{0%,47%,99.99%,to{transform:rotate(180deg) rotateX(0)}47.01%,99.98%{transform:rotate(180deg) rotateX(180deg)}}@keyframes _ngcontent-%COMP%_mirror2{0%,47%,99.99%,to{transform:rotate(90deg) rotateX(180deg)}47.01%,99.98%{transform:rotate(90deg) rotateX(0)}}@keyframes _ngcontent-%COMP%_grow{0%,25%{background-position-x:-297%}45%,55%{background-position-x:-250%}75%,to{background-position-x:-203%}}"]}),n})();function D(n,s){if(1&n&&(t.TgZ(0,"div",6),t._UZ(1,"app-preloader",7),t.qZA()),2&n){const e=t.oxw().preloaderBarColor;t.xp6(1),t.Q6J("barColor",e)}}function q(n,s){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2).type;t.xp6(1),t.hij("No ",e," chats")}}function j(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"button",18),t.NdJ("click",function(){t.CHM(e);const a=t.oxw().$implicit,i=t.oxw(3);return t.KtG(i.takeChat(a.key))}),t._uU(1," Join "),t._UZ(2,"img",19),t.qZA()}}function E(n,s){if(1&n&&(t.TgZ(0,"a",20),t._uU(1," Join "),t._UZ(2,"img",19),t.qZA()),2&n){const e=t.oxw().$implicit;t.Q6J("routerLink","/agent/chats/"+e.key)}}function G(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"div",10)(1,"div",11)(2,"button",12),t.NdJ("click",function(){const i=t.CHM(e).$implicit,h=t.oxw(3);return t.KtG(h.deleteChat(i.key))}),t._UZ(3,"img",13),t.qZA()(),t.TgZ(4,"div")(5,"span",14),t._uU(6,"Chat Id:"),t.qZA(),t._uU(7),t.qZA(),t.TgZ(8,"div")(9,"span",14),t._uU(10,"Chat Date:"),t.qZA(),t._uU(11),t.qZA(),t.TgZ(12,"div")(13,"span",14),t._uU(14,"Message Count:"),t.qZA(),t._uU(15),t.qZA(),t.TgZ(16,"div")(17,"span",14),t._uU(18,"Last Message:"),t.qZA(),t._uU(19),t.qZA(),t.TgZ(20,"div",15),t.YNc(21,j,3,0,"button",16),t.YNc(22,E,3,1,"a",17),t.qZA()()}if(2&n){const e=s.$implicit,o=t.oxw(2).options;t.xp6(7),t.hij(" ",e.key,""),t.xp6(4),t.hij(" ",e.date,""),t.xp6(4),t.hij(" ",e.messageCount||0,""),t.xp6(4),t.hij(" ",e.cardMessage,""),t.xp6(2),t.Q6J("ngIf",o.joinButton),t.xp6(1),t.Q6J("ngIf",o.joinButtonVerB)}}function $(n,s){if(1&n&&(t.ynx(0),t.YNc(1,q,2,1,"p",5),t.TgZ(2,"div",8),t.YNc(3,G,23,6,"div",9),t.qZA(),t.BQk()),2&n){const e=t.oxw().chats;t.xp6(1),t.Q6J("ngIf",!e.length),t.xp6(2),t.Q6J("ngForOf",e)}}function B(n,s){if(1&n&&(t.TgZ(0,"div")(1,"h2",3),t._uU(2),t.qZA(),t.YNc(3,D,2,1,"div",4),t.YNc(4,$,4,2,"ng-container",5),t.qZA()),2&n){const e=s.headline,o=s.chats,a=s.preloader;t.Gre("chat-list-box ",s.type,""),t.xp6(2),t.AsE("",e,"(",o.length,")"),t.xp6(1),t.Q6J("ngIf",a),t.xp6(1),t.Q6J("ngIf",!a)}}const R=function(){return{joinButton:!0}},z=function(n,s,e){return{chats:n,type:"new",headline:"New Chats",preloader:s,preloaderBarColor:"#7fd59f",options:e}},O=function(){return{joinButtonVerB:!0}},X=function(n,s,e){return{chats:n,type:"active",headline:"Active Chats",preloader:s,preloaderBarColor:"#b7abab",options:e}},K=function(n,s,e){return{chats:n,type:"old",headline:"Closed Chats",preloader:s,preloaderBarColor:"#dbae04",options:e}};let H=(()=>{class n{constructor(e,o,a){this.authService=e,this.agentService=o,this.router=a,this.newChats=[],this.activeChats=[],this.closedChats=[],this.preloaders={newChats:!0,activeChats:!0,closedChats:!0},this.destroy$=new b.xQ}ngOnInit(){this.agentService.getNewChats().pipe((0,u.R)(this.destroy$)).subscribe(o=>{const i=this.processChats(o).filter(h=>"open"===h.status);this.newChats=i,this.preloaders.newChats=!1});const e=localStorage.getItem("fbAgent")||"";this.agentService.getAgentsChats(e).pipe((0,u.R)(this.destroy$)).subscribe(o=>{const a=this.processChats(o),i=a.filter(f=>"open"===f.status),h=a.filter(f=>"open"!==f.status);this.activeChats=i,this.closedChats=h,this.preloaders.activeChats=this.preloaders.closedChats=!1})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}takeChat(e){this.agentService.takeChat(this.authService.user.uid,e).then(o=>{this.router.navigate(["agent/chats/"+e])})}processChats(e){return e.map(a=>{const i=a.payload.val();return i.key=a.key,i.date=new Date(i.date).toLocaleString(),i.cardMessage="",i.messages&&(i.messagesArray=Object.values(i.messages).filter(h=>!h.isInfo),i.messageCount=i.messagesArray.length,i.cardMessage=i.messagesArray.length?i.messagesArray.pop().message:""),i})}deleteChat(e){confirm("chat will be deleted?")&&this.agentService.deleteChat(e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.e),t.Y36(x),t.Y36(g.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat-list"]],decls:6,vars:21,consts:[[1,"container"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["chatCard",""],[1,"font-weight-400"],["class","preloader-wrapper",4,"ngIf"],[4,"ngIf"],[1,"preloader-wrapper"],[3,"barColor"],[1,"chats"],["class","chat",4,"ngFor","ngForOf"],[1,"chat"],[1,"text-center"],[1,"btn","circle","remove",3,"click"],["src","./assets/images/trash.svg"],[1,"label"],[1,"buttons","text-right"],["class","btn image i-right",3,"click",4,"ngIf"],["class","btn image i-right",3,"routerLink",4,"ngIf"],[1,"btn","image","i-right",3,"click"],["src","./assets/images/right.svg","alt","right"],[1,"btn","image","i-right",3,"routerLink"]],template:function(e,o){if(1&e&&(t.TgZ(0,"div",0),t.GkF(1,1)(2,1)(3,1),t.qZA(),t.YNc(4,B,5,7,"ng-template",null,2,t.W1O)),2&e){const a=t.MAs(5);t.xp6(1),t.Q6J("ngTemplateOutlet",a)("ngTemplateOutletContext",t.kEZ(7,z,o.newChats,o.preloaders.newChats,t.DdM(6,R))),t.xp6(1),t.Q6J("ngTemplateOutlet",a)("ngTemplateOutletContext",t.kEZ(12,X,o.activeChats,o.preloaders.activeChats,t.DdM(11,O))),t.xp6(1),t.Q6J("ngTemplateOutlet",a)("ngTemplateOutletContext",t.kEZ(17,K,o.closedChats,o.preloaders.closedChats,t.DdM(16,O)))}},dependencies:[p.sg,p.O5,p.tP,g.rH,Q],styles:[".chat-list-box[_ngcontent-%COMP%]{margin-bottom:30px;padding:20px 40px;border-radius:24px;box-shadow:#0000001a 0 1px 2px}.chat-list-box.new[_ngcontent-%COMP%]{background:#c2fbd7}.chat-list-box.new[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{background:#7ef1a9;border-color:#7fd09c}.chat-list-box.new[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-color:#7fd09c;background:#23e26a}.chat-list-box.active[_ngcontent-%COMP%]{background:#f8f8f8}.chat-list-box.old[_ngcontent-%COMP%]{background:#FDD231}.chat-list-box.old[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{background:#fdb430;border:1px solid #d59a30}.chat-list-box.old[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{background-color:#e49300;border-color:#d59a30}.chats[_ngcontent-%COMP%]{margin-bottom:15px;display:flex;flex-wrap:wrap}.chats.active[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{border-color:#aaa;background-color:#66bb3d}.chat[_ngcontent-%COMP%]{padding:10px;background-color:#fff;border-radius:5px;border:1px solid #ddd;cursor:pointer;margin-right:10px;text-decoration:none;color:#333;margin-bottom:15px}.chat[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{margin-top:15px}.chat[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#555;font-size:14px}.container[_ngcontent-%COMP%]{padding:100px 15px 15px}.preloader-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:20px 0}"]}),n})();var W=r(4115);let V=(()=>{class n{constructor(e,o,a,i){this.agentService=e,this.activatedRoute=o,this.router=a,this.store=i,this.messages=[],this.newMessages=0,this.agentMessgesCount=0,this.destroy$=new b.xQ}ngOnInit(){this.chatId=this.activatedRoute.snapshot.params.id,this.agentService.enterChat(this.chatId).pipe((0,u.R)(this.destroy$)).subscribe(e=>{this.agentMessgesCount||setTimeout(()=>{this.sendMessage("Welcome agent, you are now chatting with a customer",!0)},300)}),this.store.select("messages").pipe((0,u.R)(this.destroy$)).subscribe(e=>{this.messages=e,this.newMessages++,this.agentMessgesCount=e.filter(o=>"agent"===o.sender).length}),this.store.select("agent").pipe((0,u.R)(this.destroy$)).subscribe(e=>{"endTheChat"===e&&this.endTheChat()})}ngOnDestroy(){this.store.dispatch((0,C.ZS)()),this.destroy$.next(!0),this.destroy$.unsubscribe()}sendMessage(e,o){this.agentService.sendMessage(this.chatId,e,o)}endTheChat(){confirm("are you sure?")&&(this.agentService.endTheChat(this.chatId),this.router.navigate(["../"],{relativeTo:this.activatedRoute}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(x),t.Y36(g.gz),t.Y36(g.F0),t.Y36(_.yh))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat-detail"]],decls:1,vars:3,consts:[[3,"isAgent","newMessages","messages","messageSent"]],template:function(e,o){1&e&&(t.TgZ(0,"app-messages",0),t.NdJ("messageSent",function(i){return o.sendMessage(i)}),t.qZA()),2&e&&t.Q6J("isAgent",!0)("newMessages",o.newMessages)("messages",o.messages)},dependencies:[W.d]}),n})();var tt=r(4466),A=r(5546);let et=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[x,y],imports:[p.ez,c.UX,g.Bz.forChild([{path:"",redirectTo:"chats",pathMatch:"full"},{path:"",canActivate:[y],component:k,children:[{path:"login",component:L,data:{noGuard:!0}},{path:"chats",component:H},{path:"chats/:id",component:V}]}]),tt.m,_.Aw.forRoot({messages:A.XN,agent:A.ih})]}),n})()}}]);