"use strict";(self.webpackChunkchat_on_angular=self.webpackChunkchat_on_angular||[]).push([[669],{1669:(et,y,r)=>{r.r(y),r.d(y,{AgentModule:()=>V});var u=r(4755),g=r(8395),v=r(8929),p=r(7625),C=r(9826),t=r(2223),m=r(629),f=r(1806);function Z(n,a){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"a",7),t._UZ(2,"img",8),t._uU(3," All Chats "),t.qZA(),t.TgZ(4,"a",9),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.endTheChat())}),t._UZ(5,"img",10),t._uU(6," End The Chat "),t.qZA(),t.BQk()}}function w(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div"),t._uU(3,"Chat on Angular"),t.qZA(),t.TgZ(4,"div"),t._uU(5,"Agent Panel"),t.qZA()(),t.YNc(6,Z,7,0,"ng-container",3),t.TgZ(7,"div",4)(8,"button",5),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.onLogout())}),t._UZ(9,"img",6),t._uU(10," Log out"),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(6),t.Q6J("ngIf",e.isChatDetail)}}let P=(()=>{class n{constructor(e,s,o,i){this.router=e,this.authService=s,this.renderer2=o,this.store=i,this.destroy$=new v.xQ}ngOnInit(){this.renderer2.setStyle(document.body,"width","auto"),this.renderer2.setStyle(document.body,"height","100vh"),this.renderer2.setStyle(document.body,"position","static"),this.isAgentLoggedIn=this.authService._isAgentSignedIn,this.authService.isFbUserSingedIn.pipe((0,p.R)(this.destroy$)).subscribe({next:s=>{this.isAgentLoggedIn=s}});const e=s=>{this.isChatDetail=!s.match(/\/agent\/chats$/)};e(window.location.href),this.router.events.subscribe(s=>{s instanceof g.m2&&e(s.url)})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}endTheChat(){this.store.dispatch((0,C.m3)("endTheChat")),this.store.dispatch((0,C.m3)(null))}onLogout(){this.authService.signOut()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.F0),t.Y36(m.e),t.Y36(t.Qsj),t.Y36(f.yh))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-agent"]],decls:2,vars:1,consts:[["class","header",4,"ngIf"],[1,"header"],[1,"logo"],[4,"ngIf"],[1,"logout-holder"],[1,"btn","image","no-wrap",3,"click"],["src","./assets/images/logout.svg","alt","logout"],["routerLink","/agent/chats",1,"btn","image","m-r-10"],["src","./assets/images/back.svg","alt","back"],[1,"btn","image","warning",3,"click"],["src","./assets/images/close.svg","alt","close"]],template:function(e,s){1&e&&(t.YNc(0,w,11,1,"div",0),t._UZ(1,"router-outlet")),2&e&&t.Q6J("ngIf",s.isAgentLoggedIn)},dependencies:[u.O5,g.lC,g.rH],styles:[".logout[_ngcontent-%COMP%]{align-self:flex-end;cursor:pointer}.logout-holder[_ngcontent-%COMP%]{flex-grow:1;text-align:right}.header[_ngcontent-%COMP%]{padding:10px;box-shadow:#0000000d 0 6px 24px,#00000014 0 0 0 1px;display:flex;align-items:center;z-index:2;position:relative}.clear[_ngcontent-%COMP%]{clear:both}.logo[_ngcontent-%COMP%]{margin-right:15px;display:inline-block;text-align:center}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{font-size:14px;font-weight:600}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(1){font-size:14px}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(2){font-size:14px}"]}),n})();var c=r(1199);let M=(()=>{class n{constructor(e,s){this.router=e,this.authService=s}canActivate(e,s){return!!(this.authService._isAgentSignedIn||e.children&&e.children[0].data?.noGuard)||this.router.createUrlTree(["agent/login"])}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(g.F0),t.LFG(m.e))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})();function S(n,a){if(1&n&&(t.TgZ(0,"div",8),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.error," ")}}let I=(()=>{class n{constructor(e,s){this.authService=e,this.router=s,this.form=new c.nJ({username:new c.p4(null,[c.kI.required]),password:new c.p4(null,[c.kI.required])})}ngOnInit(){this.authService._isAgentSignedIn&&this.router.navigate(["/agent"])}onSubmit(){this.form.invalid?this.error="The form is invalid":(this.error="",this.authService.signIn(this.form.value.username,this.form.value.password).then(()=>{this.router.navigate(["/agent"])}).catch(e=>{this.error=e}).finally(()=>{this.form.reset()}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.e),t.Y36(g.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-login"]],decls:21,vars:3,consts:[[1,"main-wrapper"],["class","error",4,"ngIf"],[1,"form-wrapper"],[3,"formGroup","ngSubmit"],[1,"group"],["type","text","formControlName","username"],["type","password","formControlName","password","autocomplete",""],[1,"btn","positive2",3,"disabled"],[1,"error"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"h1"),t._uU(2,"Chat On Angular"),t.qZA(),t.TgZ(3,"h3"),t._uU(4,"Agent Panel"),t.qZA(),t.YNc(5,S,2,1,"div",1),t.TgZ(6,"div",2)(7,"form",3),t.NdJ("ngSubmit",function(){return s.onSubmit()}),t.TgZ(8,"div",4)(9,"label"),t._uU(10,"E-mail:"),t.qZA(),t._UZ(11,"br")(12,"input",5),t.qZA(),t.TgZ(13,"div",4)(14,"label"),t._uU(15,"Password:"),t.qZA(),t._UZ(16,"br")(17,"input",6),t.qZA(),t.TgZ(18,"div",4)(19,"button",7),t._uU(20,"Login"),t.qZA()()()()()),2&e&&(t.xp6(5),t.Q6J("ngIf",s.error),t.xp6(2),t.Q6J("formGroup",s.form),t.xp6(12),t.Q6J("disabled",s.form.dirty&&s.form.invalid))},dependencies:[u.O5,c._Y,c.Fj,c.JJ,c.JL,c.sg,c.u],styles:[".main-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;align-content:center;height:100vh;flex-wrap:wrap;flex-direction:column;background:url(bg.2d47cee4340d99bb.jpg) center;background-size:cover}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{text-align:center;margin:0}h3[_ngcontent-%COMP%]{margin-bottom:45px}.form-wrapper[_ngcontent-%COMP%]{text-align:center;background-color:#fff;box-shadow:0 0 5px #0003;padding:40px 30px 20px;border-radius:5px}form[_ngcontent-%COMP%]{text-align:left;display:inline-block}.group[_ngcontent-%COMP%]{margin-bottom:15px}.group[_ngcontent-%COMP%]:last-child{text-align:right}.error[_ngcontent-%COMP%]{background-color:#b63030;padding:5px;border-radius:5px;color:#fff;margin-bottom:15px;width:300px}input[_ngcontent-%COMP%]{border:1px solid #ccc;width:200px;outline:none!important;padding:6px 10px}label[_ngcontent-%COMP%]{font-weight:400;margin-bottom:5px;display:inline-block}"]}),n})();var L=r(7224),k=r(1737),x=r(7221),U=r(2868),F=r(4941),J=r(2788);let b=(()=>{class n{constructor(e,s,o,i){this.afAuth=e,this.db=s,this.authService=o,this.store=i,this.messages=[]}getAgentsChats(e){return this.db.list("chatRooms",o=>o.orderByChild("agentUid").equalTo(e)).snapshotChanges().pipe((0,x.K)(o=>this.handleError(o)))}getNewChats(){return this.db.list("chatRooms",s=>s.orderByChild("isAgent").equalTo(!1)).snapshotChanges().pipe((0,x.K)(s=>this.handleError(s)))}takeChat(e,s){return this.db.list("chatRooms").update(s,{isAgent:!0,agentUid:e})}endTheChat(e){return this.db.list("chatRooms").update(e,{status:"closed"})}deleteChat(e){return this.db.list("chatRooms").remove(e)}enterChat(e){return this.messages=[],this.db.list("chatRooms/"+e).snapshotChanges().pipe((0,x.K)(o=>this.handleError(o)),(0,U.b)(o=>{const i=o.find(d=>"status"===d.key),l=o.find(d=>"messages"===d.key);"open"===i?.payload.val()&&l&&Object.values(l.payload.val()).sort((d,h)=>d.time-h.time).map(d=>{const h=d;if(!this.messages.find(O=>O.time===h.time)){const tt=new Date(h.time).toTimeString().substr(0,5),T={time:h.time,dateText:tt,sender:h.sender,isInfo:h.isInfo,message:h.message};this.messages.push(T),this.store.dispatch((0,C.rW)(T))}return h})}))}sendMessage(e,s,o){const i={time:(new Date).getTime(),sender:"agent",message:s};o&&(i.isInfo=!0),this.db.list("chatRooms/"+e+"/messages").push(i)}handleError(e){return"PERMISSION_DENIED"===e.code&&this.authService.signOut(),(0,k._)(e.message)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(F.zQ),t.LFG(J.KQ),t.LFG(m.e),t.LFG(f.yh))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})();function Y(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=t.oxw().type;t.xp6(1),t.hij("No ",e," chats")}}function D(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",13)(1,"button",14),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,i=t.oxw(2);return t.KtG(i.deleteChat(o.key))}),t._UZ(2,"img",15),t.qZA()()}}function N(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,i=t.oxw(2);return t.KtG(i.takeChat(o.key))}),t._uU(1," Join "),t._UZ(2,"img",17),t.qZA()}}function Q(n,a){if(1&n&&(t.TgZ(0,"a",18),t._uU(1," Join "),t._UZ(2,"img",17),t.qZA()),2&n){const e=t.oxw().$implicit;t.Q6J("routerLink","/agent/chats/"+e.key)}}function $(n,a){if(1&n&&(t.TgZ(0,"div",7),t.YNc(1,D,3,0,"div",8),t.TgZ(2,"div")(3,"span",9),t._uU(4,"Chat Id:"),t.qZA(),t._uU(5),t.qZA(),t.TgZ(6,"div")(7,"span",9),t._uU(8,"Chat Date:"),t.qZA(),t._uU(9),t.qZA(),t.TgZ(10,"div")(11,"span",9),t._uU(12,"Message Count:"),t.qZA(),t._uU(13),t.qZA(),t.TgZ(14,"div")(15,"span",9),t._uU(16,"Last Message:"),t.qZA(),t._uU(17),t.qZA(),t.TgZ(18,"div",10),t.YNc(19,N,3,0,"button",11),t.YNc(20,Q,3,1,"a",12),t.qZA()()),2&n){const e=a.$implicit,s=t.oxw().options;t.xp6(1),t.Q6J("ngIf",s.deleteButton),t.xp6(4),t.hij(" ",e.key,""),t.xp6(4),t.hij(" ",e.date,""),t.xp6(4),t.hij(" ",e.messageCount||0,""),t.xp6(4),t.hij(" ",e.cardMessage,""),t.xp6(2),t.Q6J("ngIf",s.joinButton),t.xp6(1),t.Q6J("ngIf",s.joinButtonVerB)}}function j(n,a){if(1&n&&(t.TgZ(0,"div")(1,"h2",3),t._uU(2),t.qZA(),t.YNc(3,Y,2,1,"p",4),t.TgZ(4,"div",5),t.YNc(5,$,21,7,"div",6),t.qZA()()),2&n){const e=a.headline,s=a.chats;t.Gre("chat-list-box ",a.type,""),t.xp6(2),t.AsE("",e,"(",s.length,")"),t.xp6(1),t.Q6J("ngIf",!s.length),t.xp6(2),t.Q6J("ngForOf",s)}}const G=function(){return{joinButton:!0}},R=function(n,a){return{chats:n,type:"new",headline:"New Chats",options:a}},B=function(){return{joinButtonVerB:!0}},E=function(n,a){return{chats:n,type:"active",headline:"Active Chats",options:a}},q=function(){return{deleteButton:!0,joinButtonVerB:!0}},z=function(n,a){return{chats:n,type:"old",headline:"Closed Chats",options:a}};let K=(()=>{class n{constructor(e,s,o){this.authService=e,this.agentService=s,this.router=o,this.newChats=[],this.activeChats=[],this.closedChats=[],this.destroy$=new v.xQ}ngOnInit(){this.authService.signInCheckRemote(),this.authService.isFbUserSingedIn.pipe((0,L.P)()).subscribe(e=>{this.agentService.getNewChats().pipe((0,p.R)(this.destroy$)).subscribe(s=>{const i=this.processChats(s).filter(l=>"open"===l.status);this.newChats=i}),this.agentService.getAgentsChats(this.authService.user.uid).pipe((0,p.R)(this.destroy$)).subscribe(s=>{const o=this.processChats(s),i=o.filter(_=>"open"===_.status),l=o.filter(_=>"open"!==_.status);this.activeChats=i,this.closedChats=l})})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}takeChat(e){this.agentService.takeChat(this.authService.user.uid,e).then(s=>{this.router.navigate(["agent/chats/"+e])})}processChats(e){return e.map(o=>{const i=o.payload.val();return i.key=o.key,i.date=new Date(i.date).toLocaleString(),i.cardMessage="",i.messages&&(i.messagesArray=Object.values(i.messages).filter(l=>!l.isInfo),i.messageCount=i.messagesArray.length,i.cardMessage=i.messagesArray.length?i.messagesArray.pop().message:""),i})}deleteChat(e){confirm("chat will be deleted?")&&this.agentService.deleteChat(e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(m.e),t.Y36(b),t.Y36(g.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat-list"]],decls:6,vars:18,consts:[[1,"container"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["chatCard",""],[1,"font-weight-400"],[4,"ngIf"],[1,"chats"],["class","chat",4,"ngFor","ngForOf"],[1,"chat"],["class","text-center",4,"ngIf"],[1,"label"],[1,"buttons","text-right"],["class","btn image i-right",3,"click",4,"ngIf"],["class","btn image i-right",3,"routerLink",4,"ngIf"],[1,"text-center"],[1,"btn","circle","remove",3,"click"],["src","./assets/images/trash.svg"],[1,"btn","image","i-right",3,"click"],["src","./assets/images/right.svg","alt","right"],[1,"btn","image","i-right",3,"routerLink"]],template:function(e,s){if(1&e&&(t.TgZ(0,"div",0),t.GkF(1,1)(2,1)(3,1),t.qZA(),t.YNc(4,j,6,7,"ng-template",null,2,t.W1O)),2&e){const o=t.MAs(5);t.xp6(1),t.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",t.WLB(7,R,s.newChats,t.DdM(6,G))),t.xp6(1),t.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",t.WLB(11,E,s.activeChats,t.DdM(10,B))),t.xp6(1),t.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",t.WLB(15,z,s.closedChats,t.DdM(14,q)))}},dependencies:[u.sg,u.O5,u.tP,g.rH],styles:[".chat-list-box[_ngcontent-%COMP%]{margin-bottom:30px;padding:20px 40px;border-radius:24px;box-shadow:#0000001a 0 1px 2px}.chat-list-box.new[_ngcontent-%COMP%]{background:#c2fbd7}.chat-list-box.new[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{background:#7ef1a9;border-color:#7fd09c}.chat-list-box.new[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-color:#7fd09c;background:#23e26a}.chat-list-box.active[_ngcontent-%COMP%]{background:#f8f8f8}.chat-list-box.old[_ngcontent-%COMP%]{background:#FDD231}.chat-list-box.old[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{background:#fdb430;border:1px solid #d59a30}.chat-list-box.old[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{background-color:#e49300;border-color:#d59a30}.chats[_ngcontent-%COMP%]{margin-bottom:15px;display:flex;flex-wrap:wrap}.chats.active[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{border-color:#aaa;background-color:#66bb3d}.chat[_ngcontent-%COMP%]{padding:10px;background-color:#fff;border-radius:5px;border:1px solid #ddd;cursor:pointer;margin-right:10px;text-decoration:none;color:#333;margin-bottom:15px}.chat[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{margin-top:15px}.chat[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#555;font-size:14px}.container[_ngcontent-%COMP%]{padding:100px 15px 15px}"]}),n})();var H=r(5298);let W=(()=>{class n{constructor(e,s,o,i){this.agentService=e,this.activatedRoute=s,this.router=o,this.store=i,this.messages=[],this.newMessages=0,this.agentMessgesCount=0,this.destroy$=new v.xQ}ngOnInit(){this.chatId=this.activatedRoute.snapshot.params.id,this.agentService.enterChat(this.chatId).pipe((0,p.R)(this.destroy$)).subscribe(e=>{this.agentMessgesCount||setTimeout(()=>{this.sendMessage("Welcome agent, you are now chatting with a customer",!0)},300)}),this.store.select("messages").pipe((0,p.R)(this.destroy$)).subscribe(e=>{this.messages=e,this.newMessages++,this.agentMessgesCount=e.filter(s=>"agent"===s.sender).length}),this.store.select("agent").pipe((0,p.R)(this.destroy$)).subscribe(e=>{"endTheChat"===e&&this.endTheChat()})}ngOnDestroy(){this.store.dispatch((0,C.ZS)()),this.destroy$.next(!0),this.destroy$.unsubscribe()}sendMessage(e,s){this.agentService.sendMessage(this.chatId,e,s)}endTheChat(){confirm("are you sure?")&&(this.agentService.endTheChat(this.chatId),this.router.navigate(["../"],{relativeTo:this.activatedRoute}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(b),t.Y36(g.gz),t.Y36(g.F0),t.Y36(f.yh))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat-detail"]],decls:1,vars:3,consts:[[3,"isAgent","newMessages","messages","messageSent"]],template:function(e,s){1&e&&(t.TgZ(0,"app-messages",0),t.NdJ("messageSent",function(i){return s.sendMessage(i)}),t.qZA()),2&e&&t.Q6J("isAgent",!0)("newMessages",s.newMessages)("messages",s.messages)},dependencies:[H.d]}),n})();var X=r(4466),A=r(5546);let V=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[b,M],imports:[u.ez,c.UX,g.Bz.forChild([{path:"",redirectTo:"chats",pathMatch:"full"},{path:"",canActivate:[M],component:P,children:[{path:"login",component:I,data:{noGuard:!0}},{path:"chats",component:K},{path:"chats/:id",component:W}]}]),X.m,f.Aw.forRoot({messages:A.XN,agent:A.ih})]}),n})()}}]);