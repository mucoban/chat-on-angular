"use strict";(self.webpackChunkchat_on_angular=self.webpackChunkchat_on_angular||[]).push([[900],{5900:(R,_,r)=>{r.r(_),r.d(_,{AgentModule:()=>D});var u=r(8583),m=r(9765),f=r(6782),t=r(7716),g=r(5492),p=r(629);function T(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",1),t.TgZ(1,"div",2),t.TgZ(2,"div"),t._uU(3,"Chat on Angular"),t.qZA(),t.TgZ(4,"div"),t._uU(5,"Agent Panel"),t.qZA(),t.qZA(),t.TgZ(6,"a",3),t._uU(7,"Chats"),t.qZA(),t.TgZ(8,"div",4),t.TgZ(9,"button",5),t.NdJ("click",function(){return t.CHM(e),t.oxw().onLogout()}),t._uU(10,"\u21eb Log out"),t.qZA(),t.qZA(),t.qZA()}}let y=(()=>{class n{constructor(e,s,o){this.router=e,this.authService=s,this.renderer2=o,this.destroy$=new m.xQ}ngOnInit(){this.renderer2.setStyle(document.body,"width","auto"),this.renderer2.setStyle(document.body,"height","100vh"),this.renderer2.setStyle(document.body,"position","static"),this.isAgentLoggedIn=this.authService._isAgentSignedIn,this.authService.isFbUserSingedIn.pipe((0,f.R)(this.destroy$)).subscribe({next:e=>{this.isAgentLoggedIn=e}})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}onLogout(){this.authService.signOut()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g.F0),t.Y36(p.e),t.Y36(t.Qsj))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-agent"]],decls:2,vars:1,consts:[["class","header",4,"ngIf"],[1,"header"],[1,"logo"],["routerLink","/agent/chats",1,"btn"],[1,"logout-holder"],[1,"btn","logout",3,"click"]],template:function(e,s){1&e&&(t.YNc(0,T,11,0,"div",0),t._UZ(1,"router-outlet")),2&e&&t.Q6J("ngIf",s.isAgentLoggedIn)},directives:[u.O5,g.lC,g.yS],styles:[".logout[_ngcontent-%COMP%]{align-self:flex-end;cursor:pointer}.logout-holder[_ngcontent-%COMP%]{flex-grow:1;text-align:right}.header[_ngcontent-%COMP%]{padding:10px;box-shadow:0 5px 5px -3px #0003;display:flex;align-items:center;z-index:2;position:relative}.clear[_ngcontent-%COMP%]{clear:both}.logo[_ngcontent-%COMP%]{margin-right:15px;display:inline-block;text-align:center}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{font-size:14px;font-weight:600}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(1){font-size:14px}.logo[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:nth-child(2){font-size:14px}"]}),n})();var M=r(8049),O=r(205),v=r(5304),w=r(1562),S=r(7318);let Z=(()=>{class n{constructor(e,s,o){this.afAuth=e,this.db=s,this.authService=o,this.newMessage=new m.xQ,this.messages=[]}getAgentsChats(e){return this.db.list("chatRooms",o=>o.orderByChild("agentUid").equalTo(e)).snapshotChanges().pipe((0,v.K)(o=>this.handleError(o)))}getNewChats(){return this.db.list("chatRooms",s=>s.orderByChild("isAgent").equalTo(!1)).snapshotChanges().pipe((0,v.K)(s=>this.handleError(s)))}takeChat(e,s){return this.db.list("chatRooms").update(s,{isAgent:!0,agentUid:e})}closeChat(e){return this.db.list("chatRooms").update(e,{status:"closed"})}enterChat(e){this.messages=[],this.db.list("chatRooms/"+e).snapshotChanges().pipe((0,v.K)(o=>this.handleError(o))).subscribe(o=>{const i=o.find(d=>"status"===d.key),l=o.find(d=>"messages"===d.key);"open"===(null==i?void 0:i.payload.val())&&l&&Object.values(l.payload.val()).sort((d,h)=>d.time-h.time).map(d=>{const h=d;if(!this.messages.find(b=>b.time===h.time)){const j=new Date(h.time).toTimeString().substr(0,5),x={time:h.time,dateText:j,sender:h.sender,message:h.message};this.messages.push(x),this.newMessage.next(x)}return h})})}sendMessage(e,s){const o={time:(new Date).getTime(),sender:"agent",message:s};this.db.list("chatRooms/"+e+"/messages").push(o)}handleError(e){return"PERMISSION_DENIED"===e.code&&this.authService.signOut(),(0,O._)(e.message)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(w.zQ),t.LFG(S.KQ),t.LFG(p.e))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})();function P(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",8),t.NdJ("click",function(){const i=t.CHM(e).$implicit;return t.oxw().takeChat(i.key)}),t.TgZ(1,"div"),t.TgZ(2,"b"),t._uU(3,"Client Name:"),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"div"),t.TgZ(6,"b"),t._uU(7,"Message:"),t.qZA(),t._uU(8),t.qZA(),t.qZA()}if(2&n){const e=a.$implicit;t.xp6(4),t.hij(" ",e.date,""),t.xp6(4),t.hij(" ",e.firstMessage,"")}}function U(n,a){1&n&&(t.TgZ(0,"p"),t._uU(1,"No new chats"),t.qZA())}function I(n,a){if(1&n&&(t.TgZ(0,"a",9),t.TgZ(1,"div"),t.TgZ(2,"b"),t._uU(3,"Client Name:"),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"div"),t.TgZ(6,"b"),t._uU(7,"Message:"),t.qZA(),t._uU(8),t.qZA(),t.qZA()),2&n){const e=a.$implicit;t.Q6J("routerLink","/agent/chats/"+e.key),t.xp6(4),t.hij(" ",e.date,""),t.xp6(4),t.hij(" ",e.firstMessage,"")}}function L(n,a){1&n&&(t.TgZ(0,"p"),t._uU(1,"No active chats"),t.qZA())}function q(n,a){if(1&n&&(t.TgZ(0,"div",10),t.TgZ(1,"div"),t.TgZ(2,"b"),t._uU(3,"Client Name:"),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"div"),t.TgZ(6,"b"),t._uU(7,"Message:"),t.qZA(),t._uU(8),t.qZA(),t.qZA()),2&n){const e=a.$implicit;t.xp6(4),t.hij(" ",e.date,""),t.xp6(4),t.hij(" ",e.firstMessage,"")}}function F(n,a){1&n&&(t.TgZ(0,"p"),t._uU(1,"No closed chats"),t.qZA())}let k=(()=>{class n{constructor(e,s,o){this.authService=e,this.agentService=s,this.router=o,this.newChats=[],this.activeChats=[],this.closedChats=[],this.destroy$=new m.xQ}ngOnInit(){this.authService.signInCheckRemote(),this.authService.isFbUserSingedIn.pipe((0,M.P)()).subscribe(e=>{this.agentService.getNewChats().pipe((0,f.R)(this.destroy$)).subscribe(s=>{const i=this.processChats(s).filter(l=>"open"===l.status);this.newChats=i}),this.agentService.getAgentsChats(this.authService.user.uid).pipe((0,f.R)(this.destroy$)).subscribe(s=>{const o=this.processChats(s),i=o.filter(C=>"open"===C.status),l=o.filter(C=>"open"!==C.status);this.activeChats=i,this.closedChats=l})})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}takeChat(e){this.agentService.takeChat(this.authService.user.uid,e).then(s=>{this.router.navigate(["agent/chats/"+e])})}processChats(e){return e.map(o=>{const i=o.payload.val();return i.key=o.key,i.date=new Date(i.date).toLocaleString(),i.firstMessage="",i.messages&&(i.messagesArray=Object.values(i.messages),i.firstMessage=i.messagesArray[0]?i.messagesArray[0].message:""),i})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(p.e),t.Y36(Z),t.Y36(g.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat-list"]],decls:16,vars:6,consts:[[1,"container"],[1,"chats"],["class","chat",3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"chats","active"],["class","chat",3,"routerLink",4,"ngFor","ngForOf"],[1,"chats","old"],["class","chat",4,"ngFor","ngForOf"],[1,"chat",3,"click"],[1,"chat",3,"routerLink"],[1,"chat"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"h4"),t._uU(2,"New Chats"),t.qZA(),t.TgZ(3,"div",1),t.YNc(4,P,9,2,"div",2),t.YNc(5,U,2,0,"p",3),t.qZA(),t.TgZ(6,"h4"),t._uU(7,"Active Chats"),t.qZA(),t.TgZ(8,"div",4),t.YNc(9,I,9,3,"a",5),t.YNc(10,L,2,0,"p",3),t.qZA(),t.TgZ(11,"h4"),t._uU(12,"Closed Chats"),t.qZA(),t.TgZ(13,"div",6),t.YNc(14,q,9,2,"div",7),t.YNc(15,F,2,0,"p",3),t.qZA(),t.qZA()),2&e&&(t.xp6(4),t.Q6J("ngForOf",s.newChats),t.xp6(1),t.Q6J("ngIf",!s.newChats.length),t.xp6(4),t.Q6J("ngForOf",s.activeChats),t.xp6(1),t.Q6J("ngIf",!s.activeChats.length),t.xp6(4),t.Q6J("ngForOf",s.closedChats),t.xp6(1),t.Q6J("ngIf",!s.closedChats.length))},directives:[u.sg,u.O5,g.yS],styles:["h4[_ngcontent-%COMP%]{font-weight:600;color:#333}h4[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px;font-weight:400;margin-left:15px}.chats[_ngcontent-%COMP%]{margin-bottom:15px;display:flex;flex-wrap:wrap}.chats.active[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{border-color:#aaa;background-color:#66bb3d}.chats.old[_ngcontent-%COMP%]   .chat[_ngcontent-%COMP%]{border-color:#aaa;background-color:#bbdbef}.chat[_ngcontent-%COMP%]{padding:10px;background-color:#fff;width:200px;border-radius:5px;border:1px solid green;cursor:pointer;margin-right:10px;text-decoration:none;color:#333;margin-bottom:15px}.container[_ngcontent-%COMP%]{background-color:#eee;padding:15px}"]}),n})();var N=r(5298);let Y=(()=>{class n{constructor(e,s,o){this.agentService=e,this.activatedRoute=s,this.router=o,this.messages=[],this.newMessages=0,this.destroy$=new m.xQ}ngOnInit(){this.chatId=this.activatedRoute.snapshot.params.id,this.agentService.enterChat(this.chatId),this.agentService.newMessage.pipe((0,f.R)(this.destroy$)).subscribe(e=>{this.messages.push(e),this.newMessages++})}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.unsubscribe()}sendMessage(e){this.agentService.sendMessage(this.chatId,e)}closeChat(){confirm("are you sure")&&(this.agentService.closeChat(this.chatId),this.router.navigate(["../"],{relativeTo:this.activatedRoute}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Z),t.Y36(g.gz),t.Y36(g.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat-detail"]],decls:1,vars:3,consts:[[3,"isAgent","newMessages","messages","closeChat","messageSent"]],template:function(e,s){1&e&&(t.TgZ(0,"app-messages",0),t.NdJ("closeChat",function(){return s.closeChat()})("messageSent",function(i){return s.sendMessage(i)}),t.qZA()),2&e&&t.Q6J("isAgent",!0)("newMessages",s.newMessages)("messages",s.messages)},directives:[N.d],styles:[""]}),n})();var J=r(4466),c=r(665);function Q(n,a){if(1&n&&(t.TgZ(0,"div",8),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.error," ")}}let $=(()=>{class n{constructor(e,s){this.authService=e,this.router=s,this.form=new c.cw({username:new c.NI(null,[c.kI.required]),password:new c.NI(null,[c.kI.required])})}ngOnInit(){this.authService._isAgentSignedIn&&this.router.navigate(["/agent"])}onSubmit(){this.form.invalid?this.error="The form is invalid":(this.error="",this.authService.signIn(this.form.value.username,this.form.value.password).then(()=>{this.router.navigate(["/agent"])}).catch(e=>{this.error=e}).finally(()=>{this.form.reset()}))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(p.e),t.Y36(g.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-login"]],decls:21,vars:3,consts:[[1,"main-wrapper"],["class","error",4,"ngIf"],[1,"form-wrapper"],[3,"formGroup","ngSubmit"],[1,"group"],["type","text","formControlName","username"],["type","password","formControlName","password","autocomplete",""],[1,"btn","positive2",3,"disabled"],[1,"error"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"h1"),t._uU(2,"Chat On Angular"),t.qZA(),t.TgZ(3,"h3"),t._uU(4,"Agent Panel"),t.qZA(),t.YNc(5,Q,2,1,"div",1),t.TgZ(6,"div",2),t.TgZ(7,"form",3),t.NdJ("ngSubmit",function(){return s.onSubmit()}),t.TgZ(8,"div",4),t.TgZ(9,"label"),t._uU(10,"E-mail:"),t.qZA(),t._UZ(11,"br"),t._UZ(12,"input",5),t.qZA(),t.TgZ(13,"div",4),t.TgZ(14,"label"),t._uU(15,"Password:"),t.qZA(),t._UZ(16,"br"),t._UZ(17,"input",6),t.qZA(),t.TgZ(18,"div",4),t.TgZ(19,"button",7),t._uU(20,"Login"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(5),t.Q6J("ngIf",s.error),t.xp6(2),t.Q6J("formGroup",s.form),t.xp6(12),t.Q6J("disabled",s.form.dirty&&s.form.invalid))},directives:[u.O5,c._Y,c.JL,c.sg,c.Fj,c.JJ,c.u],styles:[".main-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;align-content:center;height:100vh;flex-wrap:wrap;flex-direction:column;background:url(bg.beb30e30a8dd748eb4b8.jpg) center;background-size:cover}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], h6[_ngcontent-%COMP%]{text-align:center;margin:0}h3[_ngcontent-%COMP%]{margin-bottom:45px}.form-wrapper[_ngcontent-%COMP%]{text-align:center;background-color:#fff;box-shadow:0 0 5px #0003;padding:40px 30px 20px;border-radius:5px}form[_ngcontent-%COMP%]{text-align:left;display:inline-block}.group[_ngcontent-%COMP%]{margin-bottom:15px}.group[_ngcontent-%COMP%]:last-child{text-align:right}.error[_ngcontent-%COMP%]{background-color:#b63030;padding:5px;border-radius:5px;color:#fff;margin-bottom:15px;width:300px}input[_ngcontent-%COMP%]{border:1px solid #ccc;width:200px;outline:none!important;padding:6px 10px}label[_ngcontent-%COMP%]{font-weight:400;margin-bottom:5px;display:inline-block}"]}),n})(),A=(()=>{class n{constructor(e,s){this.router=e,this.authService=s}canActivate(e,s){var o;return!!(this.authService._isAgentSignedIn||e.children&&(null===(o=e.children[0].data)||void 0===o?void 0:o.noGuard))||this.router.createUrlTree(["agent/login"])}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(g.F0),t.LFG(p.e))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac}),n})(),D=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[Z,A],imports:[[u.ez,c.UX,g.Bz.forChild([{path:"",redirectTo:"chats",pathMatch:"full"},{path:"",canActivate:[A],component:y,children:[{path:"login",component:$,data:{noGuard:!0}},{path:"chats",component:k},{path:"chats/:id",component:Y}]}]),J.m]]}),n})()}}]);